(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    108558,       2526]
NotebookOptionsPosition[    102463,       2419]
NotebookOutlinePosition[    103257,       2446]
CellTagsIndexPosition[    103178,       2441]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Evolution Original", "Subsection",
 CellChangeTimes->{{3.957640394002343*^9, 
  3.957640421964456*^9}},ExpressionUUID->"ffa5537e-bd90-44e8-8eba-\
d9a770784b91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymIndexMap", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymIndexMap", "[", 
    RowBox[{"k", ",", "r"}], "]"}], "=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tups", "=", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{"k", "-", "1"}]}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"2", "r"}], "+", "1"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Sort", "[", 
      RowBox[{"Catenate", "[", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"tups", ",", "#"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"tups", ",", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{"Reverse", "[", "#", "]"}]}], "}"}], "]"}], "&"}]}], 
          "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.921276552687866*^9, 3.921276580328933*^9}, {
  3.9216710929557953`*^9, 3.921671100676935*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"bd644c3a-7136-4cfa-bd0a-c91e4216e1a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymUp", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymUp", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{
    RowBox[{"SymIndexMap", "[", 
     RowBox[{"k", ",", "r"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.921276384975207*^9, 3.921276649760997*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"67fff8ff-52aa-481f-8e67-bb76a5578f16"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymDown", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymDown", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{"Values", "[", 
    RowBox[{"KeySort", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"First", ",", "\[IndentingNewLine]", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"SymIndexMap", "[", 
          RowBox[{"k", ",", "r"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Last", "->", "First"}]}], "]"}]}], "]"}], "]"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9212766561634283`*^9, 3.921276659673758*^9}, {
  3.9212767190156803`*^9, 3.921276735250161*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"fb7cf031-2730-441a-9c43-fe54f05633d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RandomRuleMutation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rn_", ",", "k_", ",", "r_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"many_Integer", ":", "1"}], ",", "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Symmetric\>\"", "->", "False"}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"up", ",", "down", ",", "cases"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"up", ",", "down"}], "}"}], "=", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Symmetric\>\"", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"SymUp", "[", 
           RowBox[{"k", ",", "r"}], "]"}], ",", 
          RowBox[{"SymDown", "[", 
           RowBox[{"k", ",", "r"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"All", ",", "All"}], "}"}]}], "\[IndentingNewLine]", "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"cases", "=", 
      RowBox[{
       RowBox[{"IntegerDigits", "[", 
        RowBox[{"rn", ",", "k", ",", 
         RowBox[{"k", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}], "[", 
       RowBox[{"[", "down", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FromDigits", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "up", "]"}], "]"}], ",", "k"}], "]"}], ",", "k", ",",
          "r"}], "}"}], "&"}], "[", "\[IndentingNewLine]", 
      RowBox[{"MapAt", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}], "]"}]}], ",", "k"}], "]"}], 
         "&"}], ",", "\[IndentingNewLine]", "cases", ",", 
        RowBox[{"List", "/@", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"1", ";;", 
            RowBox[{
             RowBox[{"Length", "[", "cases", "]"}], "-", "1"}]}], ",", 
           "many"}], "]"}]}]}], "]"}], "\[IndentingNewLine]", "]"}]}]}], " ", 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.921670382180455*^9, 3.9216704001484337`*^9}, {
   3.921670458950673*^9, 3.921670490905508*^9}, {3.921670547867655*^9, 
   3.921670629419989*^9}, {3.921670778485465*^9, 3.921670814619083*^9}, 
   3.9216709080992117`*^9, 3.921670958748285*^9, {3.921671035870837*^9, 
   3.921671054992505*^9}, 3.921671123292804*^9, {3.921674934661059*^9, 
   3.921674935244424*^9}, {3.922633915912894*^9, 3.922633916815826*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"847a3ce0-95b9-4d34-aa31-040641d82d70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestLifetime", "[", 
   RowBox[{"rule_", ",", 
    RowBox[{"init_List", ":", 
     RowBox[{"{", "1", "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"max_Integer", ":", "100"}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"array", "=", 
      RowBox[{"CellularAutomaton", "[", 
       RowBox[{"rule", ",", 
        RowBox[{"{", 
         RowBox[{"init", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"max", ",", "All"}], "}"}]}], "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "==", "0"}], ",", 
        RowBox[{"-", "Infinity"}], ",", 
        RowBox[{"max", "-", "#", "+", "1"}]}], "]"}], "&"}], "[", 
     "\[IndentingNewLine]", 
     RowBox[{"LengthWhile", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", "array", "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.957639592389352*^9, 3.957639595514226*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"c155d4c4-409b-4148-bcdd-68e9410d848b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"colorrules", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0", "\[Rule]", 
      TemplateBox[<|"color" -> GrayLevel[1]|>,
       "GrayLevelColorSwatchTemplate"]}], ",", 
     RowBox[{"1", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"2", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"3", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"4", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 0]|>,
       "RGBColorSwatchTemplate"]}], ",", 
     RowBox[{"5", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 1]|>,
       "RGBColorSwatchTemplate"]}]}], "}"}]}], ";"}]], "Input",
 CellLabel->"In[6]:=",
 CellID->480495091,ExpressionUUID->"ffc5e07b-6ee5-4d39-9227-d70584375130"]
}, Closed]],

Cell[CellGroupData[{

Cell["Medicine", "Subsection",
 CellChangeTimes->{{3.957640428780501*^9, 
  3.957640430767367*^9}},ExpressionUUID->"f1717a5f-a61d-4246-9b80-\
af26c41e3b9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifetime", "[", "ca_List", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", "==", "0"}], ",", 
      RowBox[{"-", "Infinity"}], ",", 
      RowBox[{
       RowBox[{"Length", "[", "ca", "]"}], "-", "#"}]}], "]"}], "&"}], "[", 
   RowBox[{"LengthWhile", "[", 
    RowBox[{
     RowBox[{"Reverse", "[", "ca", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.957626301669526*^9, 3.957626301792465*^9}},
 CellLabel->
  "In[562]:=",ExpressionUUID->"5ece4a73-a8b9-4357-943d-755df9751eae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nonzeroRange", "[", "list_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"SparseArray", "[", "list", "]"}], "[", "\"\<NonzeroPositions\>\"",
     "]"}], " ", "//", " ", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], " ", "==", " ", "0"}], ",", " ", 
      "#", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], ",", " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", " ", "1"}], "]"}], "]"}]}], "}"}]}], 
     "]"}], "&"}]}]}]], "Input",
 CellLabel->
  "In[563]:=",ExpressionUUID->"e9f2adb6-1bc1-4599-a3e5-26e43571e4c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CAPolygon", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"z_", ":", "None"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"coords", ",", " ", "points"}], "}"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"coords", " ", "=", " ", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<left\>\"", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], ",", 
           RowBox[{"\"\<right\>\"", "->", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}]}], "|>"}], "&"}], 
        ",", " ", 
        RowBox[{"TakeWhile", "[", 
         RowBox[{
          RowBox[{"nonzeroRange", "/@", "ca"}], ",", " ", 
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"points", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "\"\<left\>\""}], "]"}], "]"}], ",", " ", 
        RowBox[{"Reverse", "[", 
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "\"\<right\>\""}], "]"}], "]"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Polygon", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"z", " ", "===", " ", "None"}], ",", " ", "points", ",", " ", 
        
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", " ", "z"}], "]"}], "&"}], "/@", "points"}]}], 
       "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.957640489718995*^9, 3.957640490652442*^9}},
 CellLabel->
  "In[564]:=",ExpressionUUID->"989c6baf-d7f3-4ca7-9e62-cf5c8747bdea"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bodyidxs", "[", 
   RowBox[{"ca_List", ",", " ", "row_Integer"}], "]"}], ":=", " ", 
  RowBox[{"Range", "@@", 
   RowBox[{"nonzeroRange", "[", 
    RowBox[{"ca", "[", 
     RowBox[{"[", "row", "]"}], "]"}], "]"}]}]}]], "Input",
 CellLabel->
  "In[565]:=",ExpressionUUID->"1cfbd488-c0ba-4d70-821c-9ce7fd4cc85a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bodyidxs", "[", "ca_List", "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ranges", " ", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"nonzeroRange", "/@", " ", "ca"}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], "/@", " ", 
       RowBox[{"Range", "@@", 
        RowBox[{"ranges", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "ranges", "]"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[573]:=",ExpressionUUID->"91d45ef4-9b59-4dda-a0c7-e6f2f1265182"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gettrimoffsets", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"trimwidth_", ",", " ", "trimheight_"}], "}"}]}], "]"}], ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"left", ",", " ", "right", ",", " ", "bottom"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left", ",", " ", "right"}], "}"}], " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"bodyidxs", "[", "ca", "]"}], ",", " ", "1"}], "]"}], ",",
           " ", "trimwidth"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_", ",", " ", "None"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], ",", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{
              RowBox[{"2", "width"}], "+", "1"}]}], "}"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"idxs_", ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{"1", ",", " ", 
                  RowBox[{"#1", " ", "-", " ", "width"}]}], "]"}], ",", " ", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"ca", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
                  RowBox[{"#2", "+", "width"}]}], "]"}]}], "}"}], "&"}], 
             ")"}], "@@", 
            RowBox[{"MinMax", "[", 
             RowBox[{"idxs", "[", 
              RowBox[{"[", " ", 
               RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}]}]}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bottom", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"trimheight", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"None", "->", 
           RowBox[{"Length", "[", "ca", "]"}]}], ",", " ", 
          RowBox[{"h_", ":>", " ", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Replace", "[", 
               RowBox[{
                RowBox[{"TestCALifetime", "[", "ca", "]"}], ",", " ", 
                RowBox[{
                 RowBox[{"-", "Infinity"}], "->", "0"}]}], "]"}], " ", "+", 
              " ", "trimheight"}], ",", " ", 
             RowBox[{"Length", "[", "ca", "]"}]}], "]"}]}]}], "}"}]}], 
       "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
      "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.945293194658641*^9, 3.9452932867187643`*^9}, {
   3.945293322355928*^9, 3.945293357136991*^9}, {3.945293421873876*^9, 
   3.945293494229478*^9}, 3.945293534644459*^9, {3.945293588253034*^9, 
   3.9452935924197893`*^9}, {3.945293681304782*^9, 3.94529380369692*^9}, 
   3.945293850614188*^9, {3.945293882011123*^9, 3.945293886715385*^9}, {
   3.9452974644331837`*^9, 3.945297561725452*^9}, {3.94529761593769*^9, 
   3.945297618749472*^9}, {3.945297691265308*^9, 3.945297722631607*^9}, {
   3.945297787180779*^9, 3.945297789483876*^9}, {3.945298172886071*^9, 
   3.945298316467525*^9}, {3.9452984588534603`*^9, 3.945298461589884*^9}, {
   3.945300077631274*^9, 3.945300078042661*^9}, {3.945383439210944*^9, 
   3.945383440606598*^9}, {3.945656331796973*^9, 3.9456563345873947`*^9}, {
   3.946690665789307*^9, 3.946690676760977*^9}, {3.957906614187084*^9, 
   3.9579066144022207`*^9}},
 CellLabel->
  "In[566]:=",ExpressionUUID->"58f23849-9e5e-4f66-b179-ee4cbf69a2e4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{"width_", ",", "height_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr", ",", " ", 
    RowBox[{"gettrimoffsets", "[", 
     RowBox[{"arr", ",", " ", 
      RowBox[{"{", 
       RowBox[{"width", ",", " ", "height"}], "}"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294624188524*^9}, {
   3.945294671884531*^9, 3.945294699185649*^9}, {3.945298321348089*^9, 
   3.945298332825746*^9}, {3.946403856292363*^9, 3.946403860952742*^9}},
 CellLabel->
  "In[567]:=",ExpressionUUID->"2a954a93-f383-431f-bd7d-09c4e20e9fa4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left_", ",", " ", "right_"}], "}"}], ",", "bottom_"}], 
     "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "[", 
     RowBox[{"[", 
      RowBox[{"left", ";;", " ", "right"}], "]"}], "]"}], "&"}], "/@", " ", 
   RowBox[{"arr", "[", 
    RowBox[{"[", 
     RowBox[{";;", "bottom"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294664969989*^9}, 
   3.9452946951882153`*^9, 3.945297648752054*^9, {3.945297917133191*^9, 
   3.945297952805462*^9}, {3.945297983947146*^9, 3.945297988951889*^9}, {
   3.945298338937427*^9, 3.945298354347632*^9}, {3.945299225211084*^9, 
   3.945299226614546*^9}, {3.945384135842697*^9, 3.945384136410026*^9}},
 CellLabel->
  "In[568]:=",ExpressionUUID->"939b4f65-e3c4-4fb6-b89c-1962d77c1076"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{"ca_List", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"PlotCA", ",", " ", "ArrayPlot"}], "}"}], "]"}]}]}], "]"}], ":=",
   " ", 
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", 
      RowBox[{"<|", "|>"}]}], "}"}], ",", "\n", 
    RowBox[{"Normal", "[", 
     RowBox[{"Merge", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ops", ",", " ", 
         RowBox[{"\"\<PerturbationArrows\>\"", "->", "False"}]}], "}"}], ",", 
       " ", "Last"}], "]"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.945294845624233*^9, 3.945294873786907*^9}, {
   3.945294983499583*^9, 3.9452950510281057`*^9}, {3.945296909754796*^9, 
   3.945296950145707*^9}, 3.945298866189291*^9, {3.945300447162889*^9, 
   3.945300448193713*^9}, {3.945302689272188*^9, 3.945302773782592*^9}, {
   3.94530282174085*^9, 3.945302870957955*^9}, {3.9453029277364283`*^9, 
   3.945302980666069*^9}, {3.945303027226782*^9, 3.945303060146553*^9}, 
   3.945526057656592*^9, {3.945635294326138*^9, 3.945635294929057*^9}, {
   3.945641100353385*^9, 3.945641100702373*^9}, {3.945656565229887*^9, 
   3.9456565690322723`*^9}},
 CellLabel->
  "In[569]:=",ExpressionUUID->"62e9a3a2-87aa-445b-953b-792e3bed82e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorRules", " ", "->", " ", "colorrules"}], ",", " ", 
     RowBox[{"\"\<Trim\>\"", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "None"}], "}"}]}], ",", " ", "\n", 
     RowBox[{"Mesh", "->", "False"}], ",", " ", 
     RowBox[{"MeshStyle", " ", "->", " ", 
      RowBox[{"Opacity", "[", "0.1", "]"}]}], ",", " ", 
     RowBox[{"\"\<PerturbationArrows\>\"", "->", "True"}], ",", " ", 
     RowBox[{"\"\<ArrowSize\>\"", "->", "Medium"}], ",", " ", 
     RowBox[{"\"\<MaxWidth\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "All"}], "}"}]}], ",", " ", "\n", 
     RowBox[{"\"\<ArrowDirection\>\"", "->", "Automatic"}], ",", " ", 
     RowBox[{"\"\<Graphics\>\"", "->", 
      RowBox[{"{", "}"}]}], ",", "\n", 
     RowBox[{"\"\<ArrowStyle\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Haloing", "[", 
         RowBox[{
          RowBox[{"Lighter", "[", 
           RowBox[{"Cyan", ",", " ", ".85"}], "]"}], ",", "2"}], "]"}], ",", 
        RowBox[{"GrayLevel", "[", "0.35", "]"}]}], "}"}]}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", "perts_Association"}], "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"PlotCA", ",", " ", "ArrayPlot"}], "}"}], "]"}]}]}], "]"}], 
  " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"allops", " ", "=", " ", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Options", "[", "PlotCA", "]"}], ",", "ops"}], "}"}], ",", 
         "Last"}], "]"}]}], ",", " ", "left", ",", " ", "right", ",", " ", 
      "bottom", ",", " ", "capped"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"capped", " ", "=", " ", 
      RowBox[{"ca", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ";;", 
          RowBox[{
           RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"capped", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", " ", 
     "\n", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{
         RowBox[{"TrimArray", "[", 
          RowBox[{"capped", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", 
             "bottom"}], "}"}]}], "]"}], ",", " ", "##"}], "]"}], "&"}], "[", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
          RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], " ", "||",
            " ", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<Graphics\>\"", "]"}], " ", "=!=", " ", 
            RowBox[{"{", "}"}]}]}], ",", " ", "\n", 
          RowBox[{"Epilog", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Sequence", "@@", 
              RowBox[{"allops", "[", "\"\<Graphics\>\"", "]"}]}], ",", 
             RowBox[{"Arrowheads", "[", 
              RowBox[{"{", 
               RowBox[{"allops", "[", "\"\<ArrowSize\>\"", "]"}], "}"}], 
              "]"}], ",", "\n", 
             RowBox[{
              RowBox[{
               RowBox[{"getarrow", "[", 
                RowBox[{"capped", ",", " ", "#", ",", " ", 
                 RowBox[{"left", " ", "+", " ", 
                  RowBox[{"First", "[", 
                   RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "]"}], 
                  " ", "-", " ", "1"}], ",", " ", "bottom", ",", " ", "\n", 
                 RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], ",", 
                 " ", 
                 RowBox[{"allops", "[", "\"\<ArrowStyle\>\"", "]"}]}], "]"}], 
               "&"}], "/@", " ", 
              RowBox[{"Keys", "[", "perts", "]"}]}]}], "}"}]}], ",", " ", 
          "\n", "Nothing"}], "]"}]}], "]"}], "]"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "  ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Steps\>\"", "->", 
            RowBox[{"{", 
             RowBox[{"200", ",", " ", "All"}], "}"}]}], "}"}], ",", "ops"}], 
         "}"}], ",", "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"PlotCA", "[", 
     RowBox[{
      RowBox[{"CellularAutomaton", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<Steps\>\"", "]"}]}], "]"}], ",", " ", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}], "]"}]}]}], "Input",\

 CellChangeTimes->{{3.943106358688594*^9, 3.943106375048778*^9}, {
   3.943106979531597*^9, 3.943106988235869*^9}, {3.94310786010571*^9, 
   3.943107865349316*^9}, {3.94311390218522*^9, 3.943113916165694*^9}, 
   3.943114206799518*^9, {3.943364337468414*^9, 3.943364356291*^9}, {
   3.94336439171276*^9, 3.9433644005207233`*^9}, {3.943364472464894*^9, 
   3.943364473040235*^9}, {3.94337218900583*^9, 3.943372193858235*^9}, {
   3.943372227748727*^9, 3.943372229008975*^9}, {3.943377838524406*^9, 
   3.943377844722754*^9}, {3.943455471192767*^9, 3.943455542176583*^9}, {
   3.943455637493842*^9, 3.943455685260359*^9}, {3.943455721343861*^9, 
   3.943455769714992*^9}, {3.943456396435326*^9, 3.943456432408684*^9}, {
   3.94353834209827*^9, 3.943538367957181*^9}, {3.943566345930059*^9, 
   3.943566351208854*^9}, {3.943566468830921*^9, 3.943566469091758*^9}, {
   3.943566841883333*^9, 3.943566842042541*^9}, {3.943567082571121*^9, 
   3.943567100426882*^9}, 3.943799420615381*^9, {3.943800726099045*^9, 
   3.94380074188017*^9}, {3.9438008034312897`*^9, 3.943800813658866*^9}, {
   3.943800844862834*^9, 3.943800902396796*^9}, {3.943800958948412*^9, 
   3.943800963102242*^9}, {3.943801200441373*^9, 3.943801282513608*^9}, {
   3.943801312748512*^9, 3.943801328887786*^9}, {3.9438020059305143`*^9, 
   3.9438020148781543`*^9}, 3.94380264751248*^9, {3.943802684760384*^9, 
   3.943802687214029*^9}, {3.944432031546154*^9, 3.944432032264789*^9}, {
   3.944493423584108*^9, 3.94449343416045*^9}, {3.945295199439509*^9, 
   3.945295221703529*^9}, {3.945295311298005*^9, 3.945295361190892*^9}, {
   3.945295397137776*^9, 3.945295450027227*^9}, {3.945295487660928*^9, 
   3.94529571318329*^9}, {3.945295849347142*^9, 3.945295872323279*^9}, {
   3.94529590487897*^9, 3.945296022782197*^9}, {3.945296486934933*^9, 
   3.945296503346024*^9}, 3.945296847269151*^9, {3.945296898097121*^9, 
   3.945296898658659*^9}, {3.945298369086669*^9, 3.945298485925401*^9}, {
   3.94529866756955*^9, 3.945298683712995*^9}, {3.945299631267777*^9, 
   3.945299634545657*^9}, {3.9453001790861607`*^9, 3.94530018039613*^9}, {
   3.945300334249873*^9, 3.9453003343238573`*^9}, {3.945303088195676*^9, 
   3.945303088996951*^9}, 3.945349703961798*^9, {3.94536369904582*^9, 
   3.945363717297109*^9}, 3.945363839510446*^9, 3.945379146293873*^9, {
   3.945383374631634*^9, 3.9453833794638863`*^9}, {3.945383718796687*^9, 
   3.945383725704792*^9}, {3.94552528404148*^9, 3.945525289542871*^9}, 
   3.945526051899728*^9, {3.945533790223825*^9, 3.945533800552722*^9}, {
   3.94563495520962*^9, 3.945634968299815*^9}, {3.945634999044939*^9, 
   3.945635032143476*^9}, {3.945647176059946*^9, 3.945647208017284*^9}, {
   3.945647493698488*^9, 3.945647538372767*^9}, 3.945656574061282*^9, {
   3.945657863909787*^9, 3.945657864956173*^9}, {3.945658108797264*^9, 
   3.945658121326334*^9}, 3.945660491379346*^9, {3.945660909367015*^9, 
   3.94566091016302*^9}, {3.9456613765511*^9, 3.9456614081585827`*^9}, {
   3.9456615103833714`*^9, 3.945661512498241*^9}, {3.945661629111843*^9, 
   3.9456616307049427`*^9}, {3.945661720077988*^9, 3.945661729966634*^9}, {
   3.945661761897276*^9, 3.945661762840654*^9}, {3.945661883775737*^9, 
   3.945661923089397*^9}, {3.945662036644912*^9, 3.9456620796553307`*^9}, {
   3.9464012769439*^9, 3.946401287994206*^9}, {3.946401396558921*^9, 
   3.946401402890257*^9}, {3.946401452631402*^9, 3.946401492653789*^9}, {
   3.946401991083851*^9, 3.946402045579023*^9}, 3.946403095129546*^9, {
   3.946403407334115*^9, 3.946403489672303*^9}, {3.946404190006364*^9, 
   3.946404190680002*^9}, {3.946404226666936*^9, 3.946404265332048*^9}, {
   3.946404840847248*^9, 3.946404849598381*^9}, {3.94640565712808*^9, 
   3.946405664323269*^9}, {3.946405847885517*^9, 3.946405848686509*^9}, {
   3.946406060594774*^9, 3.946406060781722*^9}, {3.946406275387241*^9, 
   3.946406293063033*^9}, 3.9464063547659883`*^9, {3.946414707200455*^9, 
   3.946414781969375*^9}, {3.946414819710042*^9, 3.9464148216942787`*^9}, {
   3.9464148572512283`*^9, 3.946414859681031*^9}, {3.9464148992397947`*^9, 
   3.946414903182425*^9}, {3.946414944854201*^9, 3.9464149812347183`*^9}, {
   3.9464150519677*^9, 3.946415053239094*^9}, {3.9464151610623407`*^9, 
   3.9464151666288767`*^9}, {3.946415236367476*^9, 3.9464152539082127`*^9}, {
   3.946415285666033*^9, 3.94641529413087*^9}, {3.9464155856255198`*^9, 
   3.946415619744156*^9}, {3.946415655890505*^9, 3.946415660595259*^9}, {
   3.946416626703637*^9, 3.9464166588834047`*^9}, 3.946416865188572*^9, {
   3.9464170259351597`*^9, 3.946417041968081*^9}, {3.946423705040704*^9, 
   3.946423759012779*^9}, {3.946424379552889*^9, 3.946424385317236*^9}, {
   3.946424441834894*^9, 3.946424445567153*^9}, {3.946426113376052*^9, 
   3.946426118625676*^9}, {3.946426314118448*^9, 3.946426339357868*^9}, {
   3.946426513534689*^9, 3.946426532523633*^9}, {3.9465661693390923`*^9, 
   3.946566170841405*^9}, {3.9470258808161592`*^9, 3.947025905851392*^9}, {
   3.947025955337736*^9, 3.9470259862155123`*^9}, {3.947026044978957*^9, 
   3.94702605825441*^9}, {3.9470263884946547`*^9, 3.947026415277069*^9}, {
   3.947026457288498*^9, 3.9470264574168243`*^9}, {3.9470265127699423`*^9, 
   3.9470265157555037`*^9}, 3.947026546098349*^9, {3.947026954566276*^9, 
   3.94702695846712*^9}, {3.947026996472039*^9, 3.9470269981821833`*^9}, {
   3.947027430150867*^9, 3.947027478279839*^9}, {3.95790665198112*^9, 
   3.957906667443434*^9}},
 CellLabel->
  "In[570]:=",ExpressionUUID->"54ce04d5-7734-4cd7-bdc0-0b6f7dd79d6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getarrow", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"i_", ",", " ", "j_"}], "}"}], ",", " ", "left_", ",", " ", 
    "bottom_", ",", " ", 
    RowBox[{"direction_", ":", "Automatic"}], ",", " ", "\n", 
    RowBox[{"arrowstyle_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Haloing", "[", 
        RowBox[{
         RowBox[{"Lighter", "[", 
          RowBox[{"Cyan", ",", " ", ".85"}], "]"}], ",", "2"}], "]"}], ",", 
       RowBox[{"GrayLevel", "[", "0.35", "]"}]}], "}"}]}]}], "]"}], ":=", " ",
   "\n", 
  RowBox[{"Append", "[", 
   RowBox[{"arrowstyle", ",", 
    RowBox[{"Arrow", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"direction", " ", "===", " ", "Automatic"}], ",", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"j", "-", "left"}], "<", 
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ca", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ")"}], "/", "2"}], 
               "]"}]}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", " ", "0"}], "]"}], 
           ",", " ", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"direction", " ", "===", " ", "\"\<Right\>\""}], ",", 
             " ", "0", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], "\n", 
         ",", 
         RowBox[{"bottom", "-", "i", " ", "-", "0.5"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"j", "+", ".5", "-", "left"}], ",", 
         RowBox[{"bottom", "-", "i", "-", "0.5"}]}], "}"}]}], "}"}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.945634907821689*^9, 3.945634937648013*^9}, {
   3.9456578721408243`*^9, 3.945657993641839*^9}, {3.945658041164122*^9, 
   3.94565804139354*^9}, {3.9456580780167*^9, 3.945658139931852*^9}, {
   3.945658173827106*^9, 3.945658184044565*^9}, {3.945658221489928*^9, 
   3.945658223412406*^9}, {3.94565831147316*^9, 3.945658330192912*^9}, {
   3.946404722040398*^9, 3.946404728693056*^9}, {3.946406188612273*^9, 
   3.946406206851822*^9}, {3.946406487953494*^9, 3.94640649569016*^9}, {
   3.946409552293276*^9, 3.946409575324222*^9}, {3.946414153742974*^9, 
   3.946414164147415*^9}, {3.9464142342885447`*^9, 3.94641425127284*^9}, {
   3.946414866250152*^9, 3.946414872334289*^9}, {3.946414990474228*^9, 
   3.946414996242106*^9}, {3.946415061065434*^9, 3.946415061696402*^9}, {
   3.946415102138871*^9, 3.946415104837607*^9}, 3.946415648616823*^9, {
   3.946416185199712*^9, 3.946416378046973*^9}, 3.946416453024721*^9, {
   3.94641650884992*^9, 3.9464165250419893`*^9}, {3.946416596068718*^9, 
   3.946416598815462*^9}, {3.9464170635984173`*^9, 3.946417066686971*^9}, {
   3.946417239925265*^9, 3.94641724285909*^9}, {3.946425974845911*^9, 
   3.94642597621773*^9}, {3.946426051262994*^9, 3.94642605169182*^9}, {
   3.946430926082719*^9, 3.946430957801482*^9}, {3.946480594617242*^9, 
   3.9464805974426622`*^9}, {3.946480627873939*^9, 3.94648065758916*^9}, {
   3.947025972982477*^9, 3.947026023218471*^9}, {3.947026119864112*^9, 
   3.947026125043384*^9}, {3.9470263145537987`*^9, 3.94702635465266*^9}, {
   3.947027003835165*^9, 3.947027105673911*^9}, 3.947027469113757*^9},
 CellLabel->
  "In[555]:=",ExpressionUUID->"05a27927-5b52-4d5a-b4fb-e8db9f642268"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LocationDifferences", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_", ",", " ", 
    RowBox[{"levelspec_", ":", "2"}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{
   RowBox[{"SparseArray", "[", 
    RowBox[{"arr1", " ", "-", " ", "arr2"}], "]"}], 
   "[", "\"\<ExplicitPositions\>\"", "]"}]}]], "Input",
 CellChangeTimes->{{3.94284109345717*^9, 3.942841123199259*^9}, {
   3.942841245628819*^9, 3.9428412530122347`*^9}, 3.942841464181205*^9, {
   3.9428415042017107`*^9, 3.942841570648151*^9}, {3.942841603752768*^9, 
   3.942841605973318*^9}, {3.942841685917691*^9, 3.942841716147069*^9}, {
   3.942947182267355*^9, 3.942947182459833*^9}, {3.943105711024732*^9, 
   3.943105738718268*^9}, {3.943105784418694*^9, 3.943105787791119*^9}, {
   3.943374484112621*^9, 3.943374530822165*^9}, 3.944307889143518*^9, 
   3.957907194981822*^9},
 CellLabel->
  "In[580]:=",ExpressionUUID->"9ddfee7d-3fea-47b3-87ad-18d6659cf740"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotDifferences"}]], "Input",
 CellChangeTimes->{{3.9470261582896*^9, 3.947026166278064*^9}},
 CellLabel->
  "In[268]:=",ExpressionUUID->"ffe79914-db49-40a8-bf19-730ddece444d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotDifferences", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"\"\<Perturbations\>\"", "->", 
      RowBox[{"<|", "|>"}]}], ",", "\n", 
     RowBox[{"ColorRules", " ", "->", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", " ", "->", " ", "White"}], ",", " ", 
          RowBox[{
           RowBox[{"-", "100"}], " ", "->", " ", "Black"}]}], "}"}], ",", " ",
         "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", " ", ":>", " ", 
           RowBox[{"Lighter", "[", 
            RowBox[{"#2", ",", " ", ".7"}], "]"}]}], " ", "&"}], " ", "@@@", 
         " ", "colorrules"}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", "#1"}], " ", ":>", " ", 
           RowBox[{"Darker", "[", 
            RowBox[{"#2", ",", " ", ".7"}], "]"}]}], " ", "&"}], " ", "@@@", 
         " ", "colorrules"}]}], "\n", "    ", "]"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"PlotDifferences", "[", 
   RowBox[{"ca1_", ",", " ", "ca2_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locs", ",", " ", "vals", ",", " ", "rus", ",", " ", "highlighted", ",", 
      " ", "trimmed", ",", " ", "allops", ",", "perts", ",", " ", "left", ",",
       "\n", "right", ",", " ", "bottom"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", " ", 
            RowBox[{"Options", "[", "PlotDifferences", "]"}]}], "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"LocationDifferences", "[", 
       RowBox[{"ca1", ",", " ", "ca2"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"vals", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ca2", "[", 
         RowBox[{"[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "]"}], " ", "&"}], " ", "@@@",
        " ", "locs"}]}], ";", "\n", "    ", 
     RowBox[{"rus", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "->", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", " ", "==", " ", "0"}], ",", " ", 
            RowBox[{"-", "100"}], ",", " ", 
            RowBox[{"-", "#2"}]}], "]"}]}], " ", "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"locs", ",", " ", "vals"}], "}"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ca1", ",", " ", "rus"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"ca2", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"trimmed", " ", "=", " ", 
      RowBox[{"TrimArray", "[", 
       RowBox[{"highlighted", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
         "}"}]}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"trimmed", ",", " ", "##"}], "]"}], "&"}], "[", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
          RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], ",", 
          " ", "\n", 
          RowBox[{"Epilog", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Arrowheads", "[", 
              RowBox[{"{", 
               RowBox[{"allops", "[", "\"\<ArrowSize\>\"", "]"}], "}"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"getarrow", "[", 
                RowBox[{
                "trimmed", ",", " ", "#", ",", "left", ",", " ", "bottom", ",",
                  " ", "\n", 
                 RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], ",", 
                 " ", 
                 RowBox[{"allops", "[", "\"\<HaloingWidth\>\"", "]"}]}], 
                "]"}], "&"}], "/@", " ", 
              RowBox[{"Keys", "[", 
               RowBox[{"allops", "[", "\"\<Perturbations\>\"", "]"}], 
               "]"}]}]}], "}"}]}], ",", " ", "\n", "Nothing"}], "]"}]}], 
       "]"}], "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.943140779972243*^9, 3.943140829408785*^9}, {
   3.943140887462928*^9, 3.943140898149803*^9}, {3.9433721303152437`*^9, 
   3.943372147354694*^9}, 3.943377852602972*^9, 3.943379790272509*^9, {
   3.943537959725543*^9, 3.943537993795289*^9}, {3.943538264100615*^9, 
   3.943538273295963*^9}, {3.94355225625259*^9, 3.943552259024941*^9}, {
   3.943799896063838*^9, 3.943799902262787*^9}, {3.943799987363011*^9, 
   3.943800037817508*^9}, {3.943800374543797*^9, 3.9438003801044*^9}, {
   3.943800431351125*^9, 3.9438004710455093`*^9}, {3.9438005227218447`*^9, 
   3.943800524474503*^9}, {3.943800626121389*^9, 3.943800633785177*^9}, {
   3.943801173008723*^9, 3.943801193393601*^9}, 3.943801249712264*^9, 
   3.943802737450279*^9, {3.943802781851212*^9, 3.943802782996443*^9}, {
   3.943802818648016*^9, 3.943802838269998*^9}, {3.945384041816818*^9, 
   3.945384048001148*^9}, {3.945658635748845*^9, 3.945658898852055*^9}, {
   3.945658938296267*^9, 3.945658968322533*^9}, 3.945659217695423*^9, {
   3.9456593823394423`*^9, 3.94565941357098*^9}, {3.945659451538164*^9, 
   3.945659456358239*^9}, {3.945659557279435*^9, 3.945659567562809*^9}, {
   3.945659832680685*^9, 3.945659865763013*^9}, {3.945660598792308*^9, 
   3.945660648742975*^9}, {3.945660689474099*^9, 3.945660894125504*^9}, {
   3.945660924924346*^9, 3.945660929778511*^9}, {3.945661124448642*^9, 
   3.945661124825705*^9}, {3.945661229655545*^9, 3.945661269283289*^9}, {
   3.945662262187432*^9, 3.945662271187779*^9}, 3.945662401521862*^9, {
   3.945662446593384*^9, 3.945662452204391*^9}, 3.945662512927724*^9, {
   3.945662834556205*^9, 3.945662834832768*^9}, 3.945664469738006*^9, {
   3.945664500105354*^9, 3.945664501053206*^9}, {3.945739232159182*^9, 
   3.945739238397667*^9}, {3.946513256755281*^9, 3.9465132952748537`*^9}, {
   3.946513367920168*^9, 3.9465133722387657`*^9}, {3.946513583877543*^9, 
   3.9465135874220476`*^9}, {3.946516671238366*^9, 3.946516711993268*^9}, {
   3.947001155256077*^9, 3.947001198755054*^9}, {3.947001256753283*^9, 
   3.947001279937295*^9}, {3.9470013382247667`*^9, 3.947001351269285*^9}, {
   3.947001437322412*^9, 3.947001439031752*^9}, {3.9470015224424467`*^9, 
   3.947001545440494*^9}, {3.947001656690154*^9, 3.947001681856786*^9}, {
   3.947002635746716*^9, 3.947002637169669*^9}, {3.94702617887142*^9, 
   3.947026196954626*^9}, {3.947026561849224*^9, 3.947026562449195*^9}, 
   3.9579089123183737`*^9},ExpressionUUID->"2a8109da-6ef2-4502-aa8a-\
c3544e48c389"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbedArrayPlot", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ArrowStyle\>\"", "->", 
      RowBox[{"Directive", "[", 
       RowBox[{"Red", ",", " ", 
        RowBox[{"Arrowheads", "[", ".075", "]"}]}], "]"}]}], ",", 
     RowBox[{"\"\<ArrowDirection\>\"", "->", "Automatic"}], ",", " ", 
     RowBox[{"\"\<InitialIndex\>\"", "->", "1"}]}], "}"}]}], ";"}]], "Input",
 TaggingRules->{},
 CellLabel->"In[646]:=",
 CellID->1419443166,ExpressionUUID->"750065ab-8ebb-4fee-85c9-0c2f9e0a421a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Single", " ", "arrow"}], " ", "*)"}], " ", "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{"PerturbedArrayPlot", "[", 
    RowBox[{
     RowBox[{"array", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ".."}], "}"}], ".."}], "}"}]}], ",",
      " ", 
     RowBox[{"{", 
      RowBox[{"i_Integer", ",", " ", "j_Integer"}], "}"}], ",", " ", 
     RowBox[{"ops", ":", " ", 
      RowBox[{"OptionsPattern", "[", 
       RowBox[{"{", 
        RowBox[{"PerturbedArrayPlot", ",", " ", "ArrayPlot"}], "}"}], 
       "]"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"allops", "  ", "=", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Options", "[", "PerturbedArrayPlot", "]"}], ",", "ops"}], 
          "}"}], ",", "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{"array", ",", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
       RowBox[{"Mesh", "->", "True"}], ",", " ", 
       RowBox[{"Epilog", "->", 
        RowBox[{"(", 
         RowBox[{"{", 
          RowBox[{"Red", ",", " ", 
           RowBox[{"Arrowheads", "[", ".075", "]"}], ",", 
           RowBox[{"allops", "[", "\"\<ArrowStyle\>\"", "]"}], ",", " ", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"start", " ", "=", " ", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], " ",
                   "===", " ", "Automatic"}], ",", " ", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"j", "<=", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ")"}], "/", "2"}], 
                    "]"}]}], ",", " ", "0", ",", " ", 
                   RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], 
                    " ", "===", " ", "\"\<Right\>\""}], ",", " ", "0", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
               "}"}], ",", " ", 
             RowBox[{"Arrow", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"start", ",", " ", 
                  RowBox[{
                   RowBox[{"Length", "[", "array", "]"}], " ", "-", " ", "i", 
                   " ", "+", " ", ".5", "  ", "+", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"allops", "[", "\"\<InitialIndex\>\"", "]"}], " ",
                     "-", " ", "1"}], ")"}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"j", "-", ".5"}], " ", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", "array", "]"}], " ", "-", " ", "i", 
                   " ", "+", ".5", "  ", "+", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"allops", "[", "\"\<InitialIndex\>\"", "]"}], " ",
                     "-", " ", "1"}], ")"}]}]}], "}"}]}], "}"}], "]"}]}], 
            "]"}]}], "}"}], ")"}]}]}], "]"}]}], "]"}]}]}]], "Input",
 TaggingRules->{},
 CellTags->"DefaultContent",
 CellLabel->"In[647]:=",
 CellID->876320555,ExpressionUUID->"fc4bc048-f2f3-44e7-93e8-bdfb9f045dcc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Multiple", " ", "arrows"}], " ", "*)"}], " ", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PerturbedArrayPlot", "[", 
    RowBox[{
     RowBox[{"array", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ".."}], "}"}], ".."}], "}"}]}], ",",
      " ", 
     RowBox[{"reps", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], "..."}], "}"}]}], 
     ",", " ", 
     RowBox[{"ops", ":", 
      RowBox[{"OptionsPattern", "[", 
       RowBox[{"{", 
        RowBox[{"PerturbedArrayPlot", ",", " ", "ArrayPlot"}], "}"}], 
       "]"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"allops", "  ", "=", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Options", "[", "PerturbedArrayPlot", "]"}], ",", "ops"}], 
          "}"}], ",", "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{"array", ",", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", 
       RowBox[{"Mesh", "->", "True"}], ",", " ", 
       RowBox[{"Epilog", "->", 
        RowBox[{"(", 
         RowBox[{"{", 
          RowBox[{"Red", ",", " ", 
           RowBox[{"Arrowheads", "[", ".075", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "i", ",", " ", "j", ",", " ", "style", ",", " ", "direction"}],
                "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"start", " ", "=", " ", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"direction", " ", "===", " ", "Automatic"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", "<=", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ")"}], "/", "2"}], 
                    "]"}]}], ",", " ", "0", ",", " ", 
                    RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"direction", " ", "===", " ", "\"\<Right\>\""}], ",",
                     " ", "0", ",", " ", 
                    RowBox[{"Length", "[", 
                    RowBox[{"array", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                  "}"}], ",", " ", "\[IndentingNewLine]", 
                RowBox[{"Style", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Arrow", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"start", ",", " ", 
                    RowBox[{
                    RowBox[{"Length", "[", "array", "]"}], " ", "-", " ", "i",
                     " ", "+", " ", ".5", "  ", "+", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"allops", "[", "\"\<InitialIndex\>\"", "]"}], " ",
                     "-", " ", "1"}], ")"}]}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"j", "-", ".5"}], " ", ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "array", "]"}], " ", "-", " ", "i",
                     " ", "+", ".5", " ", "+", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"allops", "[", "\"\<InitialIndex\>\"", "]"}], " ",
                     "-", " ", "1"}], ")"}]}]}], "}"}]}], "}"}], "]"}], ",", 
                  " ", "style"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
             "]"}], "@@@", "\[IndentingNewLine]", 
            RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Join", "[", 
                RowBox[{"#1", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"#2", ",", " ", "#3"}], "}"}]}], "]"}], "&"}], ",", 
              " ", 
              RowBox[{"{", 
               RowBox[{"reps", ",", " ", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"ListQ", "[", 
                   RowBox[{"allops", "[", "\"\<ArrowStyle\>\"", "]"}], "]"}], 
                  ",", " ", 
                  RowBox[{"allops", "[", "\"\<ArrowStyle\>\"", "]"}], ",", 
                  " ", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"allops", "[", "\"\<ArrowStyle\>\"", "]"}], ",", 
                    " ", 
                    RowBox[{"Length", "[", "reps", "]"}]}], "]"}]}], "]"}], ",",
                 "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"ListQ", "[", 
                   RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], 
                   "]"}], ",", " ", 
                  RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], ",",
                   " ", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}], ",",
                     " ", 
                    RowBox[{"Length", "[", "reps", "]"}]}], "]"}]}], "]"}]}], 
               "\[IndentingNewLine]", "}"}]}], "]"}]}]}], "}"}], ")"}]}]}], 
      "]"}]}], "]"}]}]}]], "Input",
 TaggingRules->{},
 CellTags->"DefaultContent",
 CellLabel->"In[648]:=",
 CellID->1643924747,ExpressionUUID->"e3cb8e40-167c-4de9-a264-776a833b364c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bulk Orchestration", "Subsection",
 CellChangeTimes->{{3.9576404986517344`*^9, 
  3.957640502103754*^9}},ExpressionUUID->"bb707182-8b96-47c3-96b1-\
a01e50a34dfd"],

Cell[CellGroupData[{

Cell["Depracated", "Subsubsection",
 CellChangeTimes->{{3.9578899026700287`*^9, 
  3.957889904214033*^9}},ExpressionUUID->"1babf96c-d0ea-4111-bba4-\
7d825c9034af"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PatchEntropy", "[", 
   RowBox[{"array_", ",", "size_"}], "]"}], ":=", 
  RowBox[{"N", "[", 
   RowBox[{"Entropy", "[", 
    RowBox[{"Rescale", "[", 
     RowBox[{"Values", "[", 
      RowBox[{"Counts", "[", 
       RowBox[{"Catenate", "[", 
        RowBox[{"Partition", "[", 
         RowBox[{"array", ",", 
          RowBox[{"{", 
           RowBox[{"size", ",", "size"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "]"}], "]"}], "]"}], 
     "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.957219192024897*^9, 3.957219234097321*^9}, {
  3.957219298410872*^9, 3.9572193048932943`*^9}, {3.9572195043250217`*^9, 
  3.9572195046295567`*^9}, {3.957219818957699*^9, 3.957219823420504*^9}},
 CellLabel->
  "In[174]:=",ExpressionUUID->"cb46b69c-0304-481b-a16e-43f631cad124"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PatchEntropyNZ", "[", 
   RowBox[{"array_", ",", "size_"}], "]"}], ":=", 
  RowBox[{"N", "[", 
   RowBox[{"Entropy", "[", 
    RowBox[{"Rescale", "[", 
     RowBox[{"Values", "[", 
      RowBox[{"Counts", "[", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Catenate", "[", 
          RowBox[{"Partition", "[", 
           RowBox[{"array", ",", 
            RowBox[{"{", 
             RowBox[{"size", ",", "size"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"Flatten", "[", "#", "]"}], "]"}], ">", "0"}], "&"}]}], 
        "]"}], "]"}], "]"}], "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.957219192024897*^9, 3.957219234097321*^9}, {
  3.957219298410872*^9, 3.9572193048932943`*^9}, {3.9572195043250217`*^9, 
  3.9572195046295567`*^9}, {3.957219818957699*^9, 3.957219823420504*^9}, {
  3.9572199423484983`*^9, 3.957219978730852*^9}},
 CellLabel->
  "In[175]:=",ExpressionUUID->"c4b0ab1c-5e14-4b29-8369-cfcb4c0c57ba"]
}, Closed]],

Cell[CellGroupData[{

Cell["Up to date", "Subsubsection",
 CellChangeTimes->{{3.957889906168253*^9, 
  3.957889914552109*^9}},ExpressionUUID->"25c12eef-c5b2-4e36-b4d4-\
9b09a631b2a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toassoc", "[", "mufuncspec_", "]"}], ":=", " ", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"!", 
      RowBox[{"MatchQ", "[", 
       RowBox[{"mufuncspec", ",", " ", "_Rule"}], "]"}]}], " ", "&&", " ", 
     RowBox[{"!", 
      RowBox[{"MatchQ", "[", 
       RowBox[{"mufuncspec", ",", " ", 
        RowBox[{"List", "[", 
         RowBox[{"_Rule", ".."}], "]"}]}], "]"}]}], "&&", 
     RowBox[{"!", 
      RowBox[{"AssociationQ", "[", "mufuncspec", "]"}]}]}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{"<|", 
     RowBox[{"\"\<MutatedRule\>\"", "->", " ", 
      RowBox[{"getmutationfunction", "[", 
       RowBox[{"mufuncspec", ",", " ", "\"\<Rule\>\""}], "]"}]}], "|>"}], ",",
     "\[IndentingNewLine]", 
    RowBox[{"Association", "[", 
     RowBox[{"KeyValueMap", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<Mutated\>\"", ",", " ", "#1"}], "]"}], "->", " ", 
         RowBox[{"getmutationfunction", "[", 
          RowBox[{"#2", ",", " ", "#1"}], "]"}]}], "&"}], ",", 
       RowBox[{"Association", "[", "mufuncspec", "]"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.957543993295844*^9, 3.957544026127508*^9}, {
  3.957544059901609*^9, 3.95754407359694*^9}, {3.957544159669813*^9, 
  3.957544235489299*^9}},
 CellLabel->"In[10]:=",
 CellID->1955364472,ExpressionUUID->"46b2bcce-93d3-4c00-a630-0ea19a2af945"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tofunction", "[", "mufuncassoc_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Association", "[", " ", "\[IndentingNewLine]", 
    RowBox[{"KeyValueMap", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"key", ",", " ", "val"}], "}"}], ",", 
        RowBox[{"key", "->", 
         RowBox[{"val", "[", "#", "]"}]}]}], "]"}], ",", " ", "mufuncassoc"}],
      "]"}], "]"}], "&"}]}]], "Input",
 CellChangeTimes->{{3.957544275716487*^9, 3.957544460898316*^9}},
 CellLabel->"In[11]:=",
 CellID->226046709,ExpressionUUID->"27c2cd7c-e817-4dd8-b724-2ec3ca6ba6fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getmutationfunction", "[", 
   RowBox[{"args_", ",", "\"\<Rule\>\""}], "]"}], ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"IntegerQ", "[", "args", "]"}], ",", " ", 
    RowBox[{
     RowBox[{"RandomRuleMutation", "[", 
      RowBox[{"#Rule", ",", " ", "args"}], "]"}], "&"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"ListQ", "[", "args", "]"}], ",", " ", 
    RowBox[{
     RowBox[{"RandomRuleMutation", "[", 
      RowBox[{"#Rule", ",", " ", 
       RowBox[{"First", "[", "args", "]"}], ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Rest", "[", "args", "]"}]}]}], "]"}], "&"}], ",", 
    "\[IndentingNewLine]", "True", ",", " ", "args"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9575183032793627`*^9, 3.957518316312593*^9}, {
  3.957518410995461*^9, 3.95751857098343*^9}, {3.957518630581645*^9, 
  3.957518750804929*^9}, {3.95751902099818*^9, 3.9575190219690933`*^9}, {
  3.9575190693099823`*^9, 3.957519072312479*^9}, {3.9575192352865887`*^9, 
  3.957519251578115*^9}, {3.957519325884387*^9, 3.957519326894875*^9}, {
  3.9575198338181047`*^9, 3.957519834414618*^9}},
 CellLabel->"In[12]:=",
 CellID->1324177758,ExpressionUUID->"b9a09fde-90df-4ebb-9fc4-856132108fdd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getmutationfunction", "[", 
   RowBox[{"args_", ",", " ", "\"\<InitialCondition\>\""}], "]"}], ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"Which", "[", 
   RowBox[{
    RowBox[{"IntegerQ", "[", "args", "]"}], ",", " ", 
    RowBox[{
     RowBox[{"InitialConditionMutation", "[", 
      RowBox[{"#InitialCondition", ",", " ", "args"}], "]"}], "&"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"ListQ", "[", "args", "]"}], ",", " ", 
    RowBox[{
     RowBox[{"InitialConditionMutation", "[", 
      RowBox[{"#InitialCondition", ",", " ", 
       RowBox[{"First", "[", "args", "]"}], ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Rest", "[", "args", "]"}]}]}], "]"}], "&"}], ",", 
    "\[IndentingNewLine]", "True", ",", " ", "args"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.957519094028104*^9, 3.957519143712771*^9}, {
  3.9575191815092173`*^9, 3.9575192025670757`*^9}, {3.957519330496539*^9, 
  3.9575193621651983`*^9}, {3.957519838774311*^9, 3.957519839029175*^9}},
 CellLabel->"In[13]:=",
 CellID->155376249,ExpressionUUID->"0f801b89-10b9-4d7d-b964-32484c30e4ce"],

Cell[BoxData[{
 RowBox[{"ClearAll", "@", "getfitnessfunction"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getfitnessfunction", "[", "evospec_", "]"}], ":=", " ", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"evospec", "[", "\"\<FitnessFunction\>\"", "]"}], " ", "===", 
     " ", "\"\<Lifetime\>\""}], ",", " ", 
    RowBox[{
     RowBox[{"TestCALifetime", "[", 
      RowBox[{"CellularAutomaton", "[", 
       RowBox[{"#1", ",", " ", "#2", ",", " ", 
        RowBox[{"evospec", "[", "\"\<Cut\>\"", "]"}]}], "]"}], "]"}], "&"}], ",",
     " ", 
    RowBox[{"evospec", "[", "\"\<FitnessFunction\>\"", "]"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.957573382757185*^9, 3.957573418339332*^9}, {
  3.9575734553400507`*^9, 3.9575734975629*^9}, {3.957573528535646*^9, 
  3.957573529279278*^9}},
 CellLabel->"In[14]:=",
 CellID->164114770,ExpressionUUID->"e2212360-7111-457b-963d-0f680ea95e97"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getsequence", "[", 
   RowBox[{"evos_", ",", " ", "seqspec_"}], "]"}], ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"seqspec", "===", " ", "\"\<Breakthroughs\>\""}], ",", 
    RowBox[{
     RowBox[{"GatherBy", "[", 
      RowBox[{"evos", ",", " ", 
       RowBox[{"#Fitness", "&"}]}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", " ", "1"}], "]"}], "]"}], ",", " ", "evos"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9575207591555367`*^9, 3.9575209263160973`*^9}, {
  3.957521225890073*^9, 3.957521298093132*^9}, {3.9575213484152737`*^9, 
  3.957521403162589*^9}, {3.9575236701942244`*^9, 3.957523670774969*^9}},
 CellLabel->"In[16]:=",
 CellID->1415892439,ExpressionUUID->"c35968c3-fa72-400c-86a7-c32e1d4f63cc"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "getpropertyfunction", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getpropertyfunction", "[", 
   RowBox[{"evospec_", ",", " ", "prop_"}], "]"}], ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"prop", ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<Plot\>\"", "->", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ArrayPad", "[", 
              RowBox[{"#", ",", " ", "1"}], "]"}], "&"}], "/@", 
            RowBox[{"CellularAutomaton", "[", 
             RowBox[{"#Rule", ",", " ", "#InitialCondition", ",", " ", 
              RowBox[{"#Fitness", " ", "+", " ", "1"}]}], "]"}]}], ",", " ", 
           RowBox[{"ColorRules", "->", "colorrules"}], ",", " ", 
           RowBox[{"ImageSize", "->", 
            RowBox[{"10", 
             RowBox[{"Sqrt", "[", "#Fitness", "]"}]}]}]}], "]"}], "&"}], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{"\"\<Plot\>\"", ",", " ", "stepspec_"}], "]"}], ":>", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"CellularAutomaton", "[", 
            RowBox[{"#Rule", ",", " ", "#InitialCondition", ",", " ", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntegerQ", "[", "stepspec", "]"}], " ", "||", 
                RowBox[{"ListQ", "[", "stepspec", "]"}]}], ",", " ", 
               "stepspec", ",", " ", 
               RowBox[{"stepspec", "[", "#", "]"}]}], "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{"ColorRules", "->", "colorrules"}]}], "]"}], "&"}], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"s_String", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "s", "]"}], "]"}], "&"}], ")"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"l_List", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "l", "]"}], "]"}], "&"}], ")"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"All", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "All", "]"}], "]"}], "&"}], ")"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"o_", ":>", " ", "o"}]}], "}"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.957521405874324*^9, 3.957521498843504*^9}, {
   3.957521558317224*^9, 3.9575217208878593`*^9}, {3.957521752165847*^9, 
   3.957521773274498*^9}, {3.9575218530666523`*^9, 3.957521892618189*^9}, {
   3.95752199921627*^9, 3.9575221309273367`*^9}, {3.957522168718804*^9, 
   3.957522234559371*^9}, {3.9575222804409857`*^9, 3.95752229581656*^9}, {
   3.957522329143619*^9, 3.9575223425637627`*^9}, {3.9575224589463377`*^9, 
   3.957522460372016*^9}, {3.9575226647569532`*^9, 3.9575226980340242`*^9}, {
   3.957522874758848*^9, 3.957522968514333*^9}, 3.9575230724993753`*^9, {
   3.9575231061323853`*^9, 3.957523220372285*^9}, 3.957523290805056*^9, {
   3.957554911743622*^9, 3.957554916660358*^9}, {3.9575630663635674`*^9, 
   3.957563092460864*^9}, {3.957572884643598*^9, 3.9575728893063087`*^9}, {
   3.957574384111768*^9, 3.9575745322518682`*^9}, {3.9575751143676853`*^9, 
   3.957575138329488*^9}, {3.9575751952612047`*^9, 3.9575752027478848`*^9}},
 CellLabel->"In[17]:=",
 CellID->1108471064,ExpressionUUID->"4f13fece-6fdd-4b08-b0c8-2a6df40249ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"default", " ", "=", " ", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<Rule\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "3", ",", " ", "1"}], "}"}]}], " ", ",", " ", 
     RowBox[{"\"\<InitialCondition\>\"", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}], ",", 
     RowBox[{"\"\<Cut\>\"", "->", "100"}], ",", 
     RowBox[{"\"\<Depth\>\"", "->", "100"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<MutationFunction\>\"", "->", 
      RowBox[{"(", 
       RowBox[{"<|", 
        RowBox[{"\"\<Rule\>\"", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"RandomRuleMutation", "[", "#Rule", "]"}], "&"}], ")"}]}], 
        "|>"}], ")"}]}], ",", " ", 
     RowBox[{"\"\<FitnessFunction\>\"", "->", "\"\<Lifetime\>\""}], ",", " ", 
     
     RowBox[{"\"\<SelectionFunction\>\"", "->", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#1", ">=", "#2"}], "&"}], ")"}]}]}], "|>"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.957373663363009*^9, 3.957373739442051*^9}, {
   3.957455960696528*^9, 3.957456067392454*^9}, {3.957459465652932*^9, 
   3.957459535854556*^9}, {3.9574596453044357`*^9, 3.957459651126979*^9}, {
   3.957459684560914*^9, 3.9574596948632793`*^9}, {3.957459730046013*^9, 
   3.95745990260147*^9}, {3.957459980226272*^9, 3.9574600039519157`*^9}, {
   3.957460126057555*^9, 3.957460149210435*^9}, {3.95746020267964*^9, 
   3.957460225583542*^9}, {3.957460257998169*^9, 3.9574602624138737`*^9}, {
   3.957460393322659*^9, 3.957460430998933*^9}, {3.9574605652426167`*^9, 
   3.957460593196274*^9}, {3.95746063333217*^9, 3.957460661127059*^9}, {
   3.957461034913019*^9, 3.9574610603063383`*^9}, {3.957461121537426*^9, 
   3.957461127258011*^9}, {3.957461856090622*^9, 3.957461867630555*^9}, {
   3.957461949672456*^9, 3.957462068599927*^9}, {3.95746210983034*^9, 
   3.957462152838483*^9}, {3.957462344366022*^9, 3.9574623449415483`*^9}, {
   3.9574627018935747`*^9, 3.957462702334393*^9}, {3.957463749467175*^9, 
   3.9574637957108393`*^9}, {3.957463874429676*^9, 3.9574638748283453`*^9}, {
   3.957463930922822*^9, 3.9574639391471443`*^9}, {3.957465696265214*^9, 
   3.957465702941654*^9}, {3.957468486353009*^9, 3.957468488057585*^9}, {
   3.957468593466704*^9, 3.957468595729548*^9}, {3.9574693856529713`*^9, 
   3.957469452852675*^9}, {3.957469489932074*^9, 3.957469541905409*^9}, {
   3.9574860654326077`*^9, 3.957486065714569*^9}, {3.9574891601788177`*^9, 
   3.9574891623720303`*^9}, 3.957489295009844*^9, {3.9574893454690638`*^9, 
   3.9574893667418222`*^9}, {3.957490242252225*^9, 3.957490249628827*^9}, {
   3.9574907408758593`*^9, 3.957490769559641*^9}, {3.957490881891737*^9, 
   3.957490888392631*^9}, {3.9574911206703463`*^9, 3.957491130557528*^9}, {
   3.957491604083866*^9, 3.9574916055217733`*^9}, {3.957491840385372*^9, 
   3.957491842326853*^9}, 3.957491984572652*^9, {3.9574923985895233`*^9, 
   3.957492462331711*^9}, {3.9575241811866093`*^9, 3.957524181740703*^9}, {
   3.9575245502674007`*^9, 3.9575245582076397`*^9}, {3.957555116469967*^9, 
   3.95755511661957*^9}, {3.957562479375331*^9, 3.957562504399549*^9}, {
   3.957562539818084*^9, 3.957562562297222*^9}, {3.9575738958919277`*^9, 
   3.9575738969938717`*^9}, {3.9575756782569532`*^9, 3.9575756824141893`*^9}},
 
 CellLabel->"In[19]:=",
 CellID->1326935984,ExpressionUUID->"cb043845-5ff3-479d-9329-65f8994642b1"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "AdaptiveCellularAutomaton", "]"}], "\n", 
 RowBox[{
  RowBox[{"AdaptiveCellularAutomaton", "[", 
   RowBox[{
    RowBox[{"evospec_Association", ":", "default"}], ",", " ", 
    RowBox[{"sequencespec_String", ":", "\"\<All\>\""}], ",", " ", 
    RowBox[{"propertyspec_", ":", 
     RowBox[{"{", 
      RowBox[{"\"\<Rule\>\"", ",", " ", "\"\<Fitness\>\""}], "}"}]}]}], "]"}],
   ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "merged", ",", " ", "initialstate", ",", " ", "fitnessfunction", ",", 
      " ", "evos", ",", " ", "propertyfunction"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"merged", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{"default", ",", " ", "evospec"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"merged", "[", "\"\<MutationFunction\>\"", "]"}], " ", "=", " ", 
      RowBox[{"tofunction", "[", 
       RowBox[{"toassoc", "[", 
        RowBox[{"merged", "[", "\"\<MutationFunction\>\"", "]"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"initialstate", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<Rule\>\"", "->", " ", 
         RowBox[{"merged", "[", "\"\<Rule\>\"", "]"}]}], ",", 
        RowBox[{"\"\<InitialCondition\>\"", "->", 
         RowBox[{"merged", "[", "\"\<InitialCondition\>\"", "]"}]}], ",", 
        RowBox[{"\"\<MutatedRule\>\"", "->", 
         RowBox[{"merged", "[", "\"\<Rule\>\"", "]"}]}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<MutatedInitialCondition\>\"", "->", 
         RowBox[{"merged", "[", "\"\<InitialCondition\>\"", "]"}]}]}], 
       "|>"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fitnessfunction", " ", "=", " ", 
      RowBox[{"getfitnessfunction", "[", "merged", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"initialstate", "[", "\"\<Fitness\>\"", "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"fitnessfunction", "[", 
         RowBox[{"#Rule", ",", " ", "#InitialCondition"}], "]"}], "&"}], "[", 
       "initialstate", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"initialstate", "[", "\"\<MutatedFitness\>\"", "]"}], " ", "=", 
      " ", 
      RowBox[{"initialstate", "[", "\"\<Fitness\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evos", " ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sequencespec", " ", "===", " ", "\"\<Final\>\""}], ",", " ",
          "Nest", ",", " ", "NestList"}], "]"}], "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"newstate", " ", "=", " ", 
             RowBox[{"Join", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{"merged", "[", "\"\<MutationFunction\>\"", "]"}], "[",
                 "#", "]"}]}], "]"}]}], " ", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"newstate", "[", "\"\<MutatedFitness\>\"", "]"}], " ", "=",
              " ", 
             RowBox[{
              RowBox[{
               RowBox[{"fitnessfunction", "[", 
                RowBox[{
                "#MutatedRule", ",", " ", "#MutatedInitialCondition"}], "]"}],
                "&"}], "[", "newstate", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"merged", "[", "\"\<SelectionFunction\>\"", "]"}], "[", 
                 RowBox[{"#MutatedFitness", ",", " ", "#Fitness"}], "]"}], 
                "&"}], "[", "newstate", "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"newstate", "[", "\"\<Rule\>\"", "]"}], " ", "=", " ", 
                RowBox[{"newstate", "[", "\"\<MutatedRule\>\"", "]"}]}], ";", 
               " ", 
               RowBox[{
                RowBox[{"newstate", "[", "\"\<Fitness\>\"", "]"}], " ", "=", 
                " ", 
                RowBox[{"newstate", "[", "\"\<MutatedFitness\>\"", "]"}]}], ";",
                " ", "newstate"}], ",", "\[IndentingNewLine]", "newstate"}], 
             "]"}]}]}], "]"}], "&"}], ",", " ", "initialstate", ",", " ", 
        RowBox[{"merged", "[", "\"\<Depth\>\"", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"propertyfunction", "  ", "=", " ", 
      RowBox[{"getpropertyfunction", "[", 
       RowBox[{"merged", ",", "propertyspec"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"sequencespec", " ", "===", " ", "\"\<Final\>\""}], ",", " ", 
       RowBox[{"propertyfunction", "@", "evos"}], ",", 
       RowBox[{"propertyfunction", "/@", " ", 
        RowBox[{"getsequence", "[", 
         RowBox[{"evos", ",", " ", "sequencespec"}], "]"}]}]}], "]"}]}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.9575619774553843`*^9, 3.957561990999961*^9}, {
   3.95756260841997*^9, 3.9575626089010878`*^9}, {3.957562695506159*^9, 
   3.957562698287986*^9}, {3.957562764696062*^9, 3.957562765518567*^9}, {
   3.957562835839394*^9, 3.957562835972485*^9}, {3.9575656772858458`*^9, 
   3.957565678299512*^9}, {3.9575658351706133`*^9, 3.957565867454632*^9}, {
   3.957565973562685*^9, 3.957565974806044*^9}, {3.957567507741784*^9, 
   3.95756750857624*^9}, 3.957567636716713*^9, {3.957568219394095*^9, 
   3.95756822528863*^9}, {3.957568286180326*^9, 3.9575683032372227`*^9}, {
   3.957568342081355*^9, 3.957568345337091*^9}, 3.957568528674356*^9, {
   3.957572370372726*^9, 3.9575723752920227`*^9}, {3.9575727985216713`*^9, 
   3.9575728036207*^9}, {3.957572843605448*^9, 3.957572844721744*^9}, {
   3.957573667011739*^9, 3.957573727964044*^9}, {3.9575738053935213`*^9, 
   3.957573845836823*^9}, {3.957573885938294*^9, 3.9575739110314093`*^9}, {
   3.957574075015172*^9, 3.957574088701396*^9}, {3.957574266273271*^9, 
   3.957574270767046*^9}, {3.957575699405192*^9, 3.957575714131777*^9}, {
   3.957610610330146*^9, 3.957610631180191*^9}, {3.957625622200471*^9, 
   3.9576256436681757`*^9}},
 CellLabel->"In[20]:=",
 CellID->1446126805,ExpressionUUID->"084c0b5e-bb96-4d30-9659-b15f9d726571"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "PatchFrequencyChart", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PatchFrequencyChart", "]"}], "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ShowSequences\>\"", "->", "True"}], ",", " ", 
     RowBox[{"\"\<SequenceSize\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"30", ",", " ", "30"}], "}"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PatchFrequencyChart", "[", 
   RowBox[{"arr_", ",", " ", "blockspec_", ",", "offsetspec_", ",", " ", 
    RowBox[{"n_", ":", "10"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{"PatchFrequencyChart", ",", " ", "BarChart"}], "}"}], "]"}]}], 
   "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"counts", ",", " ", "labfunc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"counts", " ", "=", " ", 
      RowBox[{
       RowBox[{"ReverseSort", "[", 
        RowBox[{"Counts", "[", 
         RowBox[{"Catenate", "[", 
          RowBox[{"Partition", "[", 
           RowBox[{"arr", ",", "blockspec", ",", " ", "offsetspec"}], "]"}], 
          "]"}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ListQ", "[", "n", "]"}], ",", " ", 
           RowBox[{"First", "[", "n", "]"}], ",", " ", "1"}], "]"}], ";;", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ListQ", "[", "n", "]"}], ",", " ", 
           RowBox[{"Last", "[", "n", "]"}], ",", " ", "n"}], "]"}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"labfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ShowSequences\>\"", "]"}], ",", " ", 
        
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"ArrayPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Keys", "[", "counts", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"#2", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
              RowBox[{"ImageSize", "->", 
               RowBox[{"OptionValue", "[", "\"\<SequenceSize\>\"", "]"}]}], ",",
               " ", 
              RowBox[{"ColorRules", "->", "colorrules"}], ",", " ", 
              RowBox[{"Mesh", "->", "True"}]}], "]"}], ",", "Below"}], "]"}], 
          "&"}], ")"}], ",", " ", "Automatic"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"BarChart", "[", 
      RowBox[{
       RowBox[{"Values", "[", "counts", "]"}], ",", " ", 
       RowBox[{"LabelingFunction", "->", " ", "labfunc"}], ",", 
       RowBox[{"ScalingFunctions", "->", " ", 
        RowBox[{"OptionValue", "[", "ScalingFunctions", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", "->", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.957656661338619*^9, 3.957656702040133*^9}, {
   3.9576568252700033`*^9, 3.957656906772017*^9}, {3.957656939087533*^9, 
   3.957656960852013*^9}, {3.9576578755525913`*^9, 3.957657949180867*^9}, {
   3.957657982330739*^9, 3.957658015104886*^9}, {3.9576580511155252`*^9, 
   3.957658077605948*^9}, {3.957658132952733*^9, 3.957658171283991*^9}, {
   3.957658249856904*^9, 3.957658253186899*^9}, {3.957658312238463*^9, 
   3.957658442357007*^9}, {3.957658746819159*^9, 3.957658791085125*^9}, {
   3.9576622196713657`*^9, 3.9576622248030233`*^9}, {3.957867256601645*^9, 
   3.957867258459215*^9}, 3.957877455103797*^9, {3.957877486551182*^9, 
   3.957877491428944*^9}, 3.957879841568839*^9},
 CellLabel->
  "In[243]:=",ExpressionUUID->"e13f621b-b723-4dfa-8a9f-8328aced11dd"],

Cell[BoxData[{
 RowBox[{"ClearAll", "@", "PatchHighlight"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PatchHighlight", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<HighlightColor\>\"", "->", "Pink"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PatchHighlight", "[", 
   RowBox[{"arr_", ",", "patch_", ",", " ", "blockspec_", ",", " ", 
    RowBox[{"offsetspec_", ":", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"PatchHighlight", ",", " ", "ArrayPlot"}], "}"}], "]"}]}]}], 
   "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"idxs", ",", " ", 
      RowBox[{"allops", " ", "=", " ", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Options", "[", "PatchHighlight", "]"}], ",", "ops"}], 
          "}"}], ",", "Last"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"idxs", " ", "=", " ", 
      RowBox[{"Position", "[", 
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"arr", ",", " ", "blockspec", ",", " ", "offsetspec"}], 
         "]"}], ",", " ", "patch"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"arr", ",", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Catenate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Catenate", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"i", ",", " ", "j"}], "}"}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "#1", ",", " ", 
                   RowBox[{"#1", " ", "+", " ", 
                    RowBox[{"blockspec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", "1"}]}], 
                  "}"}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", " ", "#2", ",", " ", 
                   RowBox[{"#2", " ", "+", " ", 
                    RowBox[{"blockspec", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", "1"}]}], 
                  "}"}]}], "]"}], "]"}], "&"}], "@@@", " ", "idxs"}], "]"}], "->", 
           RowBox[{"allops", "[", "\"\<HighlightColor\>\"", "]"}]}], "]"}]}], 
        "]"}], ",", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{
  3.957877798651627*^9, {3.957877832469281*^9, 3.957877838054059*^9}, {
   3.957877876453738*^9, 3.957877973926218*^9}, {3.9578793109094477`*^9, 
   3.957879311107053*^9}, {3.95787977783291*^9, 3.9578798183865356`*^9}, {
   3.957880653698444*^9, 3.957880654233028*^9}, {3.957880934836253*^9, 
   3.957880945613398*^9}, {3.957882024522935*^9, 3.957882034220714*^9}, {
   3.957882264985092*^9, 3.95788240421953*^9}, {3.957882444951271*^9, 
   3.957882451891272*^9}, {3.9578824937139463`*^9, 3.957882529513504*^9}},
 CellLabel->
  "In[318]:=",ExpressionUUID->"f0089631-09cc-4de8-8192-86054045cbce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CanonicalizeArray", "[", "arr_", "]"}], ":=", " ", 
  RowBox[{"First", "[", 
   RowBox[{"Sort", "[", 
    RowBox[{
     RowBox[{"ResourceFunction", "[", "\"\<ArrayRotations\>\"", "]"}], "[", 
     "arr", "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.957881364407962*^9, 3.957881379621058*^9}},
 CellLabel->
  "In[286]:=",ExpressionUUID->"77cb020c-5fe5-4fe8-89b7-6224c0b05e31"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "ReflectedPatchEntropy", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReflectedPatchEntropy", "[", 
   RowBox[{"arr_", ",", " ", "size_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"N", "[", " ", 
   RowBox[{"Entropy", "[", 
    RowBox[{"Keys", "[", "\[IndentingNewLine]", 
     RowBox[{"Delete", "[", 
      RowBox[{
       RowBox[{"ReverseSort", "[", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{"DeleteDuplicatesBy", "[", 
          RowBox[{
           RowBox[{"Normal", "[", 
            RowBox[{"Counts", "[", 
             RowBox[{"Catenate", "[", 
              RowBox[{"Partition", "[", 
               RowBox[{"arr", ",", 
                RowBox[{"{", 
                 RowBox[{"size", ",", " ", "size"}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"1", ",", " ", "1"}], "}"}]}], "]"}], "]"}], "]"}], 
            "]"}], ",", " ", 
           RowBox[{
            RowBox[{"First", "[", 
             RowBox[{"Sort", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "ResourceFunction", "[", "\"\<ArrayRotations\>\"", "]"}], "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", " ", "6"}], "}"}], "]"}], "]"}], "]"}], 
             "]"}], "&"}]}], "]"}], "]"}], "]"}], ",", " ", 
       RowBox[{"Key", "[", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{"0", "&"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"size", ",", " ", "size"}], "}"}]}], "]"}], "]"}]}], "]"}],
      "]"}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.9578859308036623`*^9, 3.9578859946114607`*^9}, {
  3.957886033355051*^9, 3.957886035163513*^9}, {3.957886087748839*^9, 
  3.9578861432180433`*^9}, {3.957886238734084*^9, 3.957886241674096*^9}, {
  3.9578863010042353`*^9, 3.957886309462329*^9}, {3.957886345410613*^9, 
  3.957886355446344*^9}, {3.9578864910984173`*^9, 3.957886586114319*^9}, {
  3.957886645110524*^9, 3.957886647126643*^9}, {3.957886682205147*^9, 
  3.957886696080604*^9}, {3.957886735796898*^9, 3.9578867883384666`*^9}, {
  3.957889767257502*^9, 3.957889786434338*^9}},
 CellLabel->
  "In[415]:=",ExpressionUUID->"750cedb9-65af-44f0-9e66-6f6e16756356"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "PatchEntropy", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PatchEntropy", "[", 
   RowBox[{"arr_", ",", " ", "size_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"N", "[", 
   RowBox[{"Entropy", "[", 
    RowBox[{"Keys", "[", "\[IndentingNewLine]", 
     RowBox[{"Delete", "[", 
      RowBox[{
       RowBox[{"ReverseSort", "[", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{"Normal", "[", 
          RowBox[{"Counts", "[", 
           RowBox[{"Catenate", "[", 
            RowBox[{"Partition", "[", 
             RowBox[{"arr", ",", 
              RowBox[{"{", 
               RowBox[{"size", ",", " ", "size"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", " ", "1"}], "}"}]}], "]"}], "]"}], "]"}], 
          "]"}], "]"}], "]"}], ",", " ", 
       RowBox[{"Key", "[", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{"0", "&"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"size", ",", " ", "size"}], "}"}]}], "]"}], "]"}]}], "]"}],
      "]"}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.9578859308036623`*^9, 3.9578859946114607`*^9}, {
   3.957886033355051*^9, 3.957886035163513*^9}, {3.957886087748839*^9, 
   3.9578861432180433`*^9}, {3.957886238734084*^9, 3.957886241674096*^9}, {
   3.9578863010042353`*^9, 3.957886309462329*^9}, {3.957886345410613*^9, 
   3.957886355446344*^9}, {3.9578864910984173`*^9, 3.957886586114319*^9}, {
   3.957886645110524*^9, 3.957886647126643*^9}, {3.957886682205147*^9, 
   3.957886696080604*^9}, {3.957886735796898*^9, 3.9578867883384666`*^9}, 
   3.957887121108733*^9, {3.957887171509058*^9, 3.957887178699085*^9}, 
   3.957887314724338*^9},ExpressionUUID->"18956061-a6e8-4ebd-8aae-\
a4b56397c9b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClearAll", "[", "countstepdiffs", "]"}], ";", 
  RowBox[{
   RowBox[{"countstepdiffs", "[", 
    RowBox[{"arr1_", ",", " ", "arr2_"}], "]"}], ":=", " ", "\n", 
   RowBox[{"Length", "/@", 
    RowBox[{"GatherBy", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"SparseArray", "[", 
        RowBox[{"arr1", " ", "-", " ", "arr2"}], "]"}], 
       "[", "\"\<ExplicitPositions\>\"", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "&"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.957905671144475*^9, 3.9579056820841913`*^9}},
 CellLabel->
  "In[469]:=",ExpressionUUID->"cc12d0fd-890c-498e-b692-bc3c6e46766e"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "InformationPropagationPlot", "]"}], ";", 
    RowBox[{
     RowBox[{"Options", "[", "InformationPropagationPlot", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PlotRange", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "5"}], ",", " ", "50"}], "}"}]}], ",", " ", 
       RowBox[{"PlotHighlighting", "->", "None"}], ",", " ", 
       RowBox[{"\"\<LineStyle\>\"", "->", 
        RowBox[{"{", 
         RowBox[{"Red", ",", " ", "Thick"}], "}"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"InformationPropagationPlot", "[", 
     RowBox[{
     "ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", "row_", ",", 
      " ", "nperts_", ",", 
      RowBox[{"ops", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"(*", 
        RowBox[{
        "allops", ",", " ", "ca", ",", " ", "pcasperts", ",", " ", "lt"}], 
        "*)"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allops", " ", "=", " ", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Options", "[", "InformationPropagationPlot", "]"}], ",", 
            " ", "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pcasperts", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "ResourceFunction", "[", "\"\<PerturbedCellularAutomaton\>\"", 
            "]"}], "[", 
           RowBox[{"ru", ",", "init", ",", "txspec", ",", " ", 
            RowBox[{"{", 
             RowBox[{"row", ",", " ", "RandomChoice"}], "}"}], ",", " ", 
            RowBox[{"\"\<Body\>\"", "->", "True"}]}], "]"}], ",", " ", 
          "nperts"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"InformationPropagationPlot", "[", 
        RowBox[{
         RowBox[{"CellularAutomaton", "[", 
          RowBox[{"ru", ",", " ", "init", ",", " ", "txspec"}], "]"}], ",", 
         " ", "pcasperts", ",", " ", "ops"}], "]"}]}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.9442257261890907`*^9, 3.9442257990828953`*^9}, {
   3.944225887831559*^9, 3.944225903424333*^9}, {3.944225950715973*^9, 
   3.944225965794786*^9}, {3.9442260257882137`*^9, 3.9442260829631233`*^9}, {
   3.9442262867732887`*^9, 3.944226350407386*^9}, {3.944226386340079*^9, 
   3.944226458491509*^9}, {3.944226560265594*^9, 3.9442266254154997`*^9}, {
   3.944226690273789*^9, 3.944226698858684*^9}, {3.944226751746167*^9, 
   3.944226767725651*^9}, {3.944226807488984*^9, 3.9442269438234663`*^9}, {
   3.94422701601368*^9, 3.944227043036899*^9}, 3.9442271346617317`*^9, {
   3.944227278830962*^9, 3.94422738168391*^9}, {3.944227452006888*^9, 
   3.944227460029377*^9}, 3.944227509551169*^9, {3.944227544000881*^9, 
   3.944227544392918*^9}, 3.944227602087277*^9, {3.9442277297702208`*^9, 
   3.944227749510415*^9}, {3.944227857419705*^9, 3.944227857752283*^9}, {
   3.944227917479233*^9, 3.944227917619583*^9}, {3.944513457034573*^9, 
   3.9445136395240183`*^9}, {3.944513677092892*^9, 3.944513757292581*^9}, {
   3.944513794768525*^9, 3.944513804030795*^9}, {3.944513834357344*^9, 
   3.944514040078794*^9}, {3.944514081972793*^9, 3.944514519265048*^9}, {
   3.944514551973295*^9, 3.944514685901204*^9}, 3.944514749340536*^9, {
   3.944515011259468*^9, 3.944515019828166*^9}, {3.944515099801543*^9, 
   3.9445151236839*^9}, {3.944515215418655*^9, 3.944515240348115*^9}, {
   3.94451540421021*^9, 3.944515416204427*^9}, {3.9445155641337433`*^9, 
   3.9445155666582203`*^9}, {3.944516124319501*^9, 3.944516126444302*^9}, {
   3.944516467982931*^9, 3.944516777236442*^9}, {3.944516956311542*^9, 
   3.944516956531832*^9}, {3.944517020504977*^9, 3.944517065620974*^9}, {
   3.94451787222213*^9, 3.944517959206838*^9}, {3.944518065707601*^9, 
   3.944518067246185*^9}, {3.944518105492508*^9, 3.944518112866763*^9}, {
   3.944518216176889*^9, 3.944518229074774*^9}, {3.944519030761211*^9, 
   3.944519064138102*^9}, {3.944519239143301*^9, 3.944519251667643*^9}, {
   3.944520875331632*^9, 3.944520878421109*^9}, 3.944521550848152*^9, {
   3.94452548157586*^9, 3.94452548255165*^9}, {3.944768547125078*^9, 
   3.944768550716289*^9}, {3.945361205943533*^9, 3.945361206124344*^9}, {
   3.945384084268691*^9, 3.945384084728002*^9}, {3.945652742747711*^9, 
   3.945652748166785*^9}, {3.946513972678568*^9, 3.94651404688856*^9}, {
   3.946514182228158*^9, 3.946514240021245*^9}, {3.946514309216181*^9, 
   3.9465143398844957`*^9}, {3.946514370835895*^9, 3.946514430295424*^9}, {
   3.9579047869779654`*^9, 3.9579047964158573`*^9}, {3.9579054473693237`*^9, 
   3.95790548366784*^9}, {3.9579055592008257`*^9, 3.957905608134365*^9}, {
   3.957905753519088*^9, 3.957905759092668*^9}, {3.9579058318210993`*^9, 
   3.957905840206744*^9}, {3.9579060009053783`*^9, 3.9579060011239643`*^9}, {
   3.957906225533435*^9, 3.9579062354180603`*^9}},
 CellLabel->
  "In[502]:=",ExpressionUUID->"67253802-9c58-4224-9421-a8bd31553ecb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InformationPropagationPlot", "[", 
   RowBox[{"ca_List", ",", " ", "pcasperts_List", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"allops", ",", " ", "diffstepcountslist", ","}], "*)"}], " ", 
     RowBox[{"lt", " ", "=", " ", 
      RowBox[{"TestCALifetime", "[", "ca", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "InformationPropagationPlot", "]"}], ",", 
          " ", "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffstepcountslist", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"PadLeft", "[", 
         RowBox[{
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"countstepdiffs", "[", 
             RowBox[{"ca", ",", " ", "#1"}], "]"}], ",", " ", "\n", 
            RowBox[{
             RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
             RowBox[{
              RowBox[{"Keys", "[", "#2", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "1"}], "]"}], "]"}]}]}], "]"}], ",", 
          " ", 
          RowBox[{"Length", "[", "ca", "]"}]}], "]"}], "&"}], "@@@", " ", 
       "pcasperts"}]}], ";", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"lt", " ", "==", " ", 
          RowBox[{"-", "Infinity"}]}], ",", " ", "#", ",", " ", 
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\n", 
           RowBox[{"Graphics", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"lt", ",", " ", "0"}], "}"}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"lt", ",", " ", "50"}], "}"}]}], "}"}], "]"}], ",", 
              " ", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"allops", "[", "\"\<LineStyle\>\"", "]"}]}]}], "]"}], 
            "]"}]}], "]"}]}], "]"}], "&"}], "[", 
      RowBox[{"ListLinePlot", "[", 
       RowBox[{"diffstepcountslist", ",", "\n", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "@", "ListLinePlot"}]}], "]"}]}]}], "]"}], 
      "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.944517653871515*^9, 3.944517818989222*^9}, {
   3.944517982155702*^9, 3.944517985149261*^9}, 3.944518046887535*^9, 
   3.944518220024178*^9, 3.944518306785303*^9, {3.944518849995941*^9, 
   3.944518851253766*^9}, {3.944519131225924*^9, 3.944519137406631*^9}, {
   3.944519177805513*^9, 3.944519223420328*^9}, {3.944519260479782*^9, 
   3.944519268661899*^9}, {3.944519317722184*^9, 3.944519332640952*^9}, {
   3.9445215160675*^9, 3.944521535009185*^9}, {3.945361202827179*^9, 
   3.945361202967128*^9}, {3.957904902940118*^9, 3.957904903085997*^9}, {
   3.957905461794022*^9, 3.957905479453582*^9}, {3.957905938626286*^9, 
   3.957905954606461*^9}, {3.9579060128782578`*^9, 3.957906025414356*^9}, {
   3.9579061063121634`*^9, 3.95790619635035*^9}, 3.957906270145234*^9},
 CellLabel->
  "In[506]:=",ExpressionUUID->"41835e23-ca6c-439f-b510-3b47b1e67943"]
}, Open  ]],

Cell[CellGroupData[{

Cell["TODO", "Subsubsection",
 CellChangeTimes->{{3.957906956981241*^9, 
  3.957906957411088*^9}},ExpressionUUID->"9d7cbb13-dfd7-4fd4-9b56-\
5a1762fd68fc"],

Cell[BoxData["CellularAutomatonPlot"], "Input",
 CellChangeTimes->{{3.9579068002423573`*^9, 3.957906809235894*^9}, 
   3.957906960251574*^9},ExpressionUUID->"caeb8563-132f-4505-83da-\
0d5728ed5efe"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{808, 673},
WindowMargins->{{Automatic, 137}, {Automatic, 42}},
Magnification:>1.25 Inherited,
FrontEndVersion->"14.2 for Mac OS X ARM (64-bit) (March 16, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"c7cf70df-fca2-40c9-8755-0e58db9ab493"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "DefaultContent"->{
  Cell[47799, 1144, 4195, 102, 470, "Input",ExpressionUUID->"fc4bc048-f2f3-44e7-93e8-bdfb9f045dcc",
   CellTags->"DefaultContent",
   CellID->876320555],
  Cell[51997, 1248, 6356, 151, 726, "Input",ExpressionUUID->"e3cb8e40-167c-4de9-a264-776a833b364c",
   CellTags->"DefaultContent",
   CellID->1643924747]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"DefaultContent", 102845, 2431}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 166, 3, 66, "Subsection",ExpressionUUID->"ffa5537e-bd90-44e8-8eba-d9a770784b91"],
Cell[591, 20, 1698, 47, 138, "Input",ExpressionUUID->"bd644c3a-7136-4cfa-bd0a-c91e4216e1a7"],
Cell[2292, 69, 504, 13, 61, "Input",ExpressionUUID->"67fff8ff-52aa-481f-8e67-bb76a5578f16"],
Cell[2799, 84, 780, 19, 112, "Input",ExpressionUUID->"fb7cf031-2730-441a-9c43-fe54f05633d0"],
Cell[3582, 105, 3109, 78, 418, "Input",ExpressionUUID->"847a3ce0-95b9-4d34-aa31-040641d82d70"],
Cell[6694, 185, 1247, 34, 188, "Input",ExpressionUUID->"c155d4c4-409b-4148-bcdd-68e9410d848b"],
Cell[7944, 221, 954, 24, 36, "Input",ExpressionUUID->"ffc5e07b-6ee5-4d39-9227-d70584375130",
 CellID->480495091]
}, Closed]],
Cell[CellGroupData[{
Cell[8935, 250, 156, 3, 45, "Subsection",ExpressionUUID->"f1717a5f-a61d-4246-9b80-af26c41e3b9a"],
Cell[9094, 255, 680, 20, 87, "Input",ExpressionUUID->"5ece4a73-a8b9-4357-943d-755df9751eae"],
Cell[9777, 277, 787, 24, 87, "Input",ExpressionUUID->"e9f2adb6-1bc1-4599-a3e5-26e43571e4c4"],
Cell[10567, 303, 2465, 67, 215, "Input",ExpressionUUID->"989c6baf-d7f3-4ca7-9e62-cf5c8747bdea"],
Cell[13035, 372, 345, 9, 36, "Input",ExpressionUUID->"1cfbd488-c0ba-4d70-821c-9ce7fd4cc85a"],
Cell[13383, 383, 883, 25, 113, "Input",ExpressionUUID->"91d45ef4-9b59-4dda-a0c7-e6f2f1265182"],
Cell[14269, 410, 4267, 104, 317, "Input",ExpressionUUID->"58f23849-9e5e-4f66-b179-ee4cbf69a2e4"],
Cell[18539, 516, 1565, 29, 62, "Input",ExpressionUUID->"2a954a93-f383-431f-bd7d-09c4e20e9fa4"],
Cell[20107, 547, 1792, 35, 62, "Input",ExpressionUUID->"939b4f65-e3c4-4fb6-b89c-1962d77c1076"],
Cell[21902, 584, 1341, 31, 87, "Input",ExpressionUUID->"62e9a3a2-87aa-445b-953b-792e3bed82e4"],
Cell[23246, 617, 11521, 233, 598, "Input",ExpressionUUID->"54ce04d5-7734-4cd7-bdc0-0b6f7dd79d6c"],
Cell[34770, 852, 3712, 79, 189, "Input",ExpressionUUID->"05a27927-5b52-4d5a-b4fb-e8db9f642268"],
Cell[38485, 933, 948, 18, 62, "Input",ExpressionUUID->"9ddfee7d-3fea-47b3-87ad-18d6659cf740"],
Cell[39436, 953, 217, 4, 36, "Input",ExpressionUUID->"ffe79914-db49-40a8-bf19-730ddece444d"],
Cell[39656, 959, 7557, 167, 649, "Input",ExpressionUUID->"2a8109da-6ef2-4502-aa8a-c3544e48c389"],
Cell[47216, 1128, 580, 14, 87, "Input",ExpressionUUID->"750065ab-8ebb-4fee-85c9-0c2f9e0a421a",
 CellID->1419443166],
Cell[47799, 1144, 4195, 102, 470, "Input",ExpressionUUID->"fc4bc048-f2f3-44e7-93e8-bdfb9f045dcc",
 CellTags->"DefaultContent",
 CellID->876320555],
Cell[51997, 1248, 6356, 151, 726, "Input",ExpressionUUID->"e3cb8e40-167c-4de9-a264-776a833b364c",
 CellTags->"DefaultContent",
 CellID->1643924747]
}, Open  ]],
Cell[CellGroupData[{
Cell[58390, 1404, 168, 3, 66, "Subsection",ExpressionUUID->"bb707182-8b96-47c3-96b1-a01e50a34dfd"],
Cell[CellGroupData[{
Cell[58583, 1411, 163, 3, 54, "Subsubsection",ExpressionUUID->"1babf96c-d0ea-4111-bba4-7d825c9034af"],
Cell[58749, 1416, 857, 21, 164, "Input",ExpressionUUID->"cb46b69c-0304-481b-a16e-43f631cad124"],
Cell[59609, 1439, 1135, 28, 189, "Input",ExpressionUUID->"c4b0ab1c-5e14-4b29-8369-cfcb4c0c57ba"]
}, Closed]],
Cell[CellGroupData[{
Cell[60781, 1472, 161, 3, 43, "Subsubsection",ExpressionUUID->"25c12eef-c5b2-4e36-b4d4-9b09a631b2a4"],
Cell[60945, 1477, 1465, 37, 215, "Input",ExpressionUUID->"46b2bcce-93d3-4c00-a630-0ea19a2af945",
 CellID->1955364472],
Cell[62413, 1516, 688, 17, 113, "Input",ExpressionUUID->"27c2cd7c-e817-4dd8-b724-2ec3ca6ba6fa",
 CellID->226046709],
Cell[63104, 1535, 1269, 27, 138, "Input",ExpressionUUID->"b9a09fde-90df-4ebb-9fc4-856132108fdd",
 CellID->1324177758],
Cell[64376, 1564, 1126, 24, 189, "Input",ExpressionUUID->"0f801b89-10b9-4d7d-b964-32484c30e4ce",
 CellID->155376249],
Cell[65505, 1590, 915, 21, 138, "Input",ExpressionUUID->"e2212360-7111-457b-963d-0f680ea95e97",
 CellID->164114770],
Cell[66423, 1613, 803, 19, 87, "Input",ExpressionUUID->"c35968c3-fa72-400c-86a7-c32e1d4f63cc",
 CellID->1415892439],
Cell[67229, 1634, 3624, 80, 394, "Input",ExpressionUUID->"4f13fece-6fdd-4b08-b0c8-2a6df40249ce",
 CellID->1108471064],
Cell[70856, 1716, 3443, 62, 113, "Input",ExpressionUUID->"cb043845-5ff3-479d-9329-65f8994642b1",
 CellID->1326935984],
Cell[74302, 1780, 6404, 136, 777, "Input",ExpressionUUID->"084c0b5e-bb96-4d30-9659-b15f9d726571",
 CellID->1446126805],
Cell[80709, 1918, 3847, 88, 470, "Input",ExpressionUUID->"e13f621b-b723-4dfa-8a9f-8328aced11dd"],
Cell[84559, 2008, 3373, 79, 394, "Input",ExpressionUUID->"f0089631-09cc-4de8-8192-86054045cbce"],
Cell[87935, 2089, 420, 10, 62, "Input",ExpressionUUID->"77cb020c-5fe5-4fe8-89b7-6224c0b05e31"],
Cell[88358, 2101, 2413, 54, 240, "Input",ExpressionUUID->"750cedb9-65af-44f0-9e66-6f6e16756356"],
Cell[90774, 2157, 1814, 39, 164, "Input",ExpressionUUID->"18956061-a6e8-4ebd-8aae-a4b56397c9b5"],
Cell[92591, 2198, 697, 18, 113, "Input",ExpressionUUID->"cc12d0fd-890c-498e-b692-bc3c6e46766e"],
Cell[93291, 2218, 5197, 99, 368, "Input",ExpressionUUID->"67253802-9c58-4224-9421-a8bd31553ecb"],
Cell[98491, 2319, 3551, 83, 292, "Input",ExpressionUUID->"41835e23-ca6c-439f-b510-3b47b1e67943"]
}, Open  ]],
Cell[CellGroupData[{
Cell[102079, 2407, 155, 3, 54, "Subsubsection",ExpressionUUID->"9d7cbb13-dfd7-4fd4-9b56-5a1762fd68fc"],
Cell[102237, 2412, 198, 3, 36, "Input",ExpressionUUID->"caeb8563-132f-4505-83da-0d5728ed5efe"]
}, Open  ]]
}, Open  ]]
}
]
*)

