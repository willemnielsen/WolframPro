(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 14.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    306360,       7045]
NotebookOptionsPosition[    293371,       6869]
NotebookOutlinePosition[    293791,       6886]
CellTagsIndexPosition[    293748,       6883]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Utility", "Section",
 CellChangeTimes->{{3.945269141310281*^9, 
  3.945269143024324*^9}},ExpressionUUID->"d4dfd321-d1da-46f2-945d-\
01c197224088"],

Cell[BoxData[
 RowBox[{
  RowBox[{"colorrules", " ", "=", "  ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0", "\[Rule]", 
      TemplateBox[<|"color" -> GrayLevel[1]|>,
       "GrayLevelColorSwatchTemplate"]}], ",", 
     RowBox[{"1", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"2", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"3", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"4", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 0]|>,
       "RGBColorSwatchTemplate"]}], ",", 
     RowBox[{"5", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 1]|>,
       "RGBColorSwatchTemplate"]}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.945383690085331*^9, 3.945383708057497*^9}},
 CellLabel->
  "In[258]:=",ExpressionUUID->"1c5640c8-bf97-408b-93c0-7bdc8d41518e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getca", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"steps_", ":", "200"}], ",", " ", 
    RowBox[{"width_", ":", "All"}], ",", " ", 
    RowBox[{"init_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}]}], "]"}], ":=", " ", 
  
  RowBox[{"CellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", 
    RowBox[{"{", 
     RowBox[{"steps", ",", " ", "width"}], "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9438057708089046`*^9, 3.9438058553028383`*^9}, {
  3.943805908764364*^9, 3.943805909425609*^9}, {3.943811606071961*^9, 
  3.94381164307044*^9}, {3.94443216895649*^9, 3.944432169162304*^9}, {
  3.945269152995685*^9, 3.945269158924448*^9}, {3.945269677382701*^9, 
  3.945269722891138*^9}, {3.945270171684901*^9, 3.945270173269108*^9}, {
  3.945270644654645*^9, 3.94527064593688*^9}, {3.945299575005775*^9, 
  3.945299576746839*^9}, {3.945464325870778*^9, 3.94546432662716*^9}},
 CellLabel->
  "In[259]:=",ExpressionUUID->"66586bd6-1558-4922-8781-dbbf32d27029"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getca", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"steps_", ":", "200"}], ",", " ", 
      RowBox[{"width_", ":", "All"}]}], "}"}], ",", " ", 
    RowBox[{"init_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}]}], "]"}], ":=", " ", 
  
  RowBox[{"CellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", 
    RowBox[{"{", 
     RowBox[{"steps", ",", " ", "width"}], "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945647264805366*^9, 3.9456473230092*^9}},
 CellLabel->
  "In[260]:=",ExpressionUUID->"f2ed4b2f-28b1-4d2d-ad0d-5329f8a7f701"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestLifetime", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}], ",", " ", 
    RowBox[{"init_List", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"array", "=", 
      RowBox[{"getca", "[", 
       RowBox[{"rule", ",", " ", "steps", ",", " ", "All", ",", " ", "init"}],
        "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "==", "0"}], ",", 
        RowBox[{"-", "Infinity"}], ",", 
        RowBox[{"steps", "-", "#", "+", "1"}]}], "]"}], "&"}], "[", 
     "\[IndentingNewLine]", 
     RowBox[{"LengthWhile", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", "array", "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.9452694920503683`*^9, 3.945269492465472*^9}, {
   3.945269541492546*^9, 3.945269612518456*^9}, 3.94526965986334*^9, {
   3.945269780474712*^9, 3.945269829949349*^9}},
 CellLabel->
  "In[261]:=",ExpressionUUID->"bb525146-aa8f-419c-b339-76ae1d0a2ebf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifeTime", "[", 
   RowBox[{"{", 
    RowBox[{"ca_List", ",", " ", "perturbation_Association"}], "}"}], "]"}], ":=",
   " ", 
  RowBox[{"TestCALifeTime", "[", "ca", "]"}]}]], "Code",
 CellChangeTimes->{{3.943106462055011*^9, 3.943106524282854*^9}, {
   3.943106554858834*^9, 3.943106617417737*^9}, {3.943457965776842*^9, 
   3.943457976864903*^9}, {3.943458102665765*^9, 3.943458104020798*^9}, {
   3.94449110560067*^9, 3.944491144856763*^9}, {3.945289812844039*^9, 
   3.9452898494002037`*^9}, {3.945294974293565*^9, 3.945294974670261*^9}, {
   3.945295083814666*^9, 3.9452950870331173`*^9}, 3.9454643533939047`*^9, {
   3.946494603618849*^9, 3.946494605201844*^9}},
 CellLabel->
  "In[262]:=",ExpressionUUID->"7824730d-64c5-443c-ad56-0f01495e77b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifeTime", "[", "ca_List", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", "==", "0"}], ",", 
      RowBox[{"-", "Infinity"}], ",", 
      RowBox[{
       RowBox[{"Length", "[", "ca", "]"}], "-", "#"}]}], "]"}], "&"}], "[", 
   RowBox[{"LengthWhile", "[", 
    RowBox[{
     RowBox[{"Reverse", "[", "ca", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943106462055011*^9, 3.943106524282854*^9}, {
  3.943106554858834*^9, 3.943106617417737*^9}, {3.943457965776842*^9, 
  3.943457976864903*^9}, {3.943458102665765*^9, 3.943458104020798*^9}, {
  3.94449110560067*^9, 3.944491144856763*^9}, {3.945289812844039*^9, 
  3.945289814678841*^9}, {3.94552603587239*^9, 3.945526036468112*^9}, {
  3.945544826684551*^9, 3.945544827400023*^9}},
 CellLabel->
  "In[263]:=",ExpressionUUID->"efc2a93a-0cc6-424f-badf-dd4c458a951e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allperts", "[", 
   RowBox[{"ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", 
    RowBox[{"pertspec_", ":", 
     RowBox[{"<|", "|>"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ca", " ", "=", " ", 
       RowBox[{"PerturbedCellularAutomaton", "[", 
        RowBox[{
        "ru", ",", " ", "init", ",", " ", "txspec", ",", " ", "pertspec"}], 
        "]"}]}], ",", "vals"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "j"}], "}"}], ",", " ", 
         RowBox[{
          RowBox[{"vals", " ", "=", " ", 
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"0", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"interpretrule", "[", "ru", "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", "1"}]}], 
              "]"}], ",", " ", 
             RowBox[{
              RowBox[{"ca", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", " ", "j"}], "]"}], "]"}], " ", "+", " ", 
              "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"i", " ", "-", " ", "1"}], ",", " ", "j"}], "}"}], "->",
               "#"}], "|>"}], "&"}], "/@", " ", "vals"}]}]}], "]"}], "@@@", 
       " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"bodyidxs", "[", "ca", "]"}], ",", " ", "1"}], "]"}]}], ",", 
      " ", "1"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945700321129901*^9, 3.9457004217284307`*^9}, {
  3.945700466326242*^9, 3.945700661374217*^9}, {3.945700776319529*^9, 
  3.945700818563569*^9}, {3.945700882391898*^9, 3.945700988042378*^9}, {
  3.946391998319795*^9, 3.9463921082887783`*^9}, {3.946400607856407*^9, 
  3.946400614138886*^9}, {3.946568477136295*^9, 3.946568488206184*^9}},
 CellLabel->
  "In[264]:=",ExpressionUUID->"7d0fbefc-1a71-4802-a737-9e7311b37685"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allperts", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"k_", ":", "4"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", " ", "j"}], "}"}], ",", " ", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"i", " ", "-", " ", "1"}], ",", " ", "j"}], "}"}], "->", 
           "#"}], "|>"}], "&"}], "/@", " ", 
        RowBox[{"Delete", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"ca", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", " ", "j"}], "]"}], "]"}], " ", "+", " ", 
           "1"}]}], "]"}]}]}], "]"}], "\n", "@@@", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"bodyidxs", "[", "ca", "]"}], ",", " ", "1"}], "]"}]}], ",", 
    " ", "1"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945700321129901*^9, 3.9457004217284307`*^9}, {
  3.945700466326242*^9, 3.945700661374217*^9}, {3.945700776319529*^9, 
  3.945700818563569*^9}, {3.945700882391898*^9, 3.945700988042378*^9}, {
  3.945742702509109*^9, 3.945742781167693*^9}, {3.945742834603734*^9, 
  3.945742883711704*^9}, {3.94640059853621*^9, 3.946400598922114*^9}},
 CellLabel->
  "In[265]:=",ExpressionUUID->"9985e728-9e9f-4f3a-aaa3-0a9164867c31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bodyidxs", "[", "ca_List", "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ranges", " ", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"nonzeroRange", "/@", " ", "ca"}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], "/@", " ", 
       RowBox[{"Range", "@@", 
        RowBox[{"ranges", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "ranges", "]"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.945628002040225*^9, 3.945628012752407*^9}, {
  3.9456280878494*^9, 3.945628088328771*^9}, {3.946399992166339*^9, 
  3.946400000519692*^9}, {3.946400092218977*^9, 3.946400098048021*^9}, {
  3.9464005651350517`*^9, 3.946400565303549*^9}},
 CellLabel->
  "In[266]:=",ExpressionUUID->"fa7b4e01-4c18-4917-a999-1bda8b185149"],

Cell[BoxData[
 RowBox[{
  RowBox[{"bodyidxs", "[", 
   RowBox[{"ca_List", ",", " ", "row_Integer"}], "]"}], ":=", " ", 
  RowBox[{"Range", "@@", 
   RowBox[{"nonzeroRange", "[", 
    RowBox[{"ca", "[", 
     RowBox[{"[", "row", "]"}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943632118618299*^9, 3.943632121236794*^9}, {
  3.943632273714582*^9, 3.943632311012732*^9}, {3.943632585740198*^9, 
  3.943632678535552*^9}, {3.9436327332728233`*^9, 3.943632790858907*^9}, {
  3.943632895677493*^9, 3.943632899631958*^9}, {3.943633042190752*^9, 
  3.943633062478084*^9}, {3.945620607024163*^9, 3.945620644726312*^9}, {
  3.945621264337801*^9, 3.945621277817107*^9}, {3.9456214051099243`*^9, 
  3.945621478799623*^9}, {3.945621601355903*^9, 3.945621607527651*^9}, {
  3.945622128066242*^9, 3.945622189631709*^9}, {3.945622241095796*^9, 
  3.945622262981054*^9}, {3.945622334225562*^9, 3.945622348252345*^9}, {
  3.945627962507595*^9, 3.945627963432331*^9}, {3.945627999316888*^9, 
  3.9456280273278503`*^9}, {3.945628085495865*^9, 3.945628086074493*^9}, {
  3.945657744863701*^9, 3.945657746530706*^9}},
 CellLabel->
  "In[267]:=",ExpressionUUID->"de12be9f-307b-4708-9976-4bee3746cc52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcoloridxs", "[", "ca_", "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"GatherBy", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"SparseArray", "[", "ca", "]"}], "[", "\"\<NonzeroPositions\>\"",
      "]"}], ",", " ", "First"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943828486452312*^9, 3.943828538205599*^9}, {
  3.943829890163829*^9, 3.9438299806650476`*^9}, {3.943830016776329*^9, 
  3.943830019677407*^9}, {3.943830626699462*^9, 3.943830628464438*^9}, {
  3.943830804970452*^9, 3.943830807035177*^9}},
 CellLabel->
  "In[268]:=",ExpressionUUID->"f7a36137-a1fb-499c-9888-f233a7dc896a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getflatcoloridxs", "[", "ca_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"SparseArray", "[", "ca", "]"}], "[", "\"\<NonzeroPositions\>\"", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943835654954757*^9, 3.943835661600816*^9}, 
   3.9438364730841513`*^9},
 CellLabel->
  "In[269]:=",ExpressionUUID->"0cbe98b9-5d15-4e25-aea5-9f81b98a8f78"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcolorrules", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"pertbitfunc_", ":", "\"\<Random\>\""}]}], "]"}], ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "->", 
         RowBox[{"{", 
          RowBox[{
          "#2", ",", " ", "\"\<Enumerate\>\"", ",", " ", "pertbitfunc"}], 
          "}"}]}], "&"}], ",", " ", "#"}], "]"}], "&"}], "/@", 
    RowBox[{"getcoloridxs", "[", "ca", "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943830633816234*^9, 3.943830648823629*^9}, {
  3.943830679368305*^9, 3.943830702474283*^9}, {3.943830739526439*^9, 
  3.94383074632425*^9}, {3.943830824601147*^9, 3.9438308263492827`*^9}, {
  3.943830861474888*^9, 3.943830944969814*^9}, {3.943831477583398*^9, 
  3.943831480973905*^9}},
 CellLabel->
  "In[270]:=",ExpressionUUID->"5a97706c-555b-42d3-b8c3-5f2eb8316a29"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualizations", "Section",
 CellChangeTimes->{{3.942889350592349*^9, 3.942889353963724*^9}, {
  3.944521604299152*^9, 
  3.9445216062320557`*^9}},ExpressionUUID->"cf0c77fd-76e4-44d5-911f-\
081db9d3cd97"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbedArrayPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "pert_"}], "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"ArrayPlot", "[", 
   RowBox[{"ca", ",", "ops", ",", " ", 
    RowBox[{"Epilog", "->", 
     RowBox[{"(", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Arrowheads", "[", "Large", "]"}], ",", " ", "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{
                RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "#1", " ", 
                "+", " ", ".5"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#2", "-", ".5"}], " ", ",", 
               RowBox[{
                RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "#1", " ", 
                "+", ".5"}]}], "}"}]}], "}"}], "]"}], "&"}], "@@@", 
         RowBox[{"Keys", "[", "pert", "]"}]}]}], "}"}], ")"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.946069968774268*^9, 3.946070024039197*^9}, {
  3.946070066202227*^9, 3.946070073455491*^9}, {3.9460701099963017`*^9, 
  3.946070178538649*^9}, {3.946070265427083*^9, 3.946070272494901*^9}, {
  3.9460704020578337`*^9, 3.946070434245559*^9}, {3.9460705396583147`*^9, 
  3.9460705925553293`*^9}, {3.946070713753205*^9, 3.9460707345179462`*^9}, {
  3.946071865371168*^9, 3.946071879364648*^9}},
 CellLabel->"In[271]:=",
 CellID->1804130915,ExpressionUUID->"a4a97538-7d00-4ff9-a50b-d7344da05bab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gettrimoffsets", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"trimwidth_", ",", " ", "trimheight_"}], "}"}]}], "]"}], ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"left", ",", " ", "right", ",", " ", "bottom"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left", ",", " ", "right"}], "}"}], " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"bodyidxs", "[", "ca", "]"}], ",", " ", "1"}], "]"}], ",",
           " ", "trimwidth"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_", ",", " ", "None"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], ",", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{
              RowBox[{"2", "width"}], "+", "1"}]}], "}"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"idxs_", ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{"1", ",", " ", 
                  RowBox[{"#1", " ", "-", " ", "width"}]}], "]"}], ",", " ", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"ca", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
                  RowBox[{"#2", "+", "width"}]}], "]"}]}], "}"}], "&"}], 
             ")"}], "@@", 
            RowBox[{"MinMax", "[", 
             RowBox[{"idxs", "[", 
              RowBox[{"[", " ", 
               RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}]}]}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bottom", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"trimheight", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"None", "->", 
           RowBox[{"Length", "[", "ca", "]"}]}], ",", " ", 
          RowBox[{"h_", ":>", " ", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Replace", "[", 
               RowBox[{
                RowBox[{"TestCALifeTime", "[", "ca", "]"}], ",", " ", 
                RowBox[{
                 RowBox[{"-", "Infinity"}], "->", "0"}]}], "]"}], " ", "+", 
              " ", "trimheight"}], ",", " ", 
             RowBox[{"Length", "[", "ca", "]"}]}], "]"}]}]}], "}"}]}], 
       "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
      "}"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945293194658641*^9, 3.9452932867187643`*^9}, {
   3.945293322355928*^9, 3.945293357136991*^9}, {3.945293421873876*^9, 
   3.945293494229478*^9}, 3.945293534644459*^9, {3.945293588253034*^9, 
   3.9452935924197893`*^9}, {3.945293681304782*^9, 3.94529380369692*^9}, 
   3.945293850614188*^9, {3.945293882011123*^9, 3.945293886715385*^9}, {
   3.9452974644331837`*^9, 3.945297561725452*^9}, {3.94529761593769*^9, 
   3.945297618749472*^9}, {3.945297691265308*^9, 3.945297722631607*^9}, {
   3.945297787180779*^9, 3.945297789483876*^9}, {3.945298172886071*^9, 
   3.945298316467525*^9}, {3.9452984588534603`*^9, 3.945298461589884*^9}, {
   3.945300077631274*^9, 3.945300078042661*^9}, {3.945383439210944*^9, 
   3.945383440606598*^9}, {3.945656331796973*^9, 3.9456563345873947`*^9}, {
   3.946690665789307*^9, 3.946690676760977*^9}},
 CellLabel->
  "In[272]:=",ExpressionUUID->"dc2050e0-8d63-4cc7-b717-093004985c57"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{"width_", ",", "height_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr", ",", " ", 
    RowBox[{"gettrimoffsets", "[", 
     RowBox[{"arr", ",", " ", 
      RowBox[{"{", 
       RowBox[{"width", ",", " ", "height"}], "}"}]}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294624188524*^9}, {
   3.945294671884531*^9, 3.945294699185649*^9}, {3.945298321348089*^9, 
   3.945298332825746*^9}, {3.946403856292363*^9, 3.946403860952742*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"236f1f6b-ae32-4891-93eb-46abd3e368cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left_", ",", " ", "right_"}], "}"}], ",", "bottom_"}], 
     "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "[", 
     RowBox[{"[", 
      RowBox[{"left", ";;", " ", "right"}], "]"}], "]"}], "&"}], "/@", " ", 
   RowBox[{"arr", "[", 
    RowBox[{"[", 
     RowBox[{";;", "bottom"}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294664969989*^9}, 
   3.9452946951882153`*^9, 3.945297648752054*^9, {3.945297917133191*^9, 
   3.945297952805462*^9}, {3.945297983947146*^9, 3.945297988951889*^9}, {
   3.945298338937427*^9, 3.945298354347632*^9}, {3.945299225211084*^9, 
   3.945299226614546*^9}, {3.945384135842697*^9, 3.945384136410026*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"a1ac0263-c9ed-44b1-89a4-a9f6a28dbc40"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{"ca_List", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"PlotCA", ",", " ", "ArrayPlot"}], "}"}], "]"}]}]}], "]"}], ":=",
   " ", 
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", 
      RowBox[{"<|", "|>"}]}], "}"}], ",", "\n", 
    RowBox[{"Normal", "[", 
     RowBox[{"Merge", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ops", ",", " ", 
         RowBox[{"\"\<PerturbationArrows\>\"", "->", "False"}]}], "}"}], ",", 
       " ", "Last"}], "]"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945294845624233*^9, 3.945294873786907*^9}, {
   3.945294983499583*^9, 3.9452950510281057`*^9}, {3.945296909754796*^9, 
   3.945296950145707*^9}, 3.945298866189291*^9, {3.945300447162889*^9, 
   3.945300448193713*^9}, {3.945302689272188*^9, 3.945302773782592*^9}, {
   3.94530282174085*^9, 3.945302870957955*^9}, {3.9453029277364283`*^9, 
   3.945302980666069*^9}, {3.945303027226782*^9, 3.945303060146553*^9}, 
   3.945526057656592*^9, {3.945635294326138*^9, 3.945635294929057*^9}, {
   3.945641100353385*^9, 3.945641100702373*^9}, {3.945656565229887*^9, 
   3.9456565690322723`*^9}},
 CellLabel->
  "In[275]:=",ExpressionUUID->"bc482545-8a99-4e13-a439-ea9bdf712480"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorRules", " ", "->", " ", "colorrules"}], ",", " ", 
     RowBox[{"\"\<Trim\>\"", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "None"}], "}"}]}], ",", " ", "\n", 
     RowBox[{"Mesh", "->", "False"}], ",", " ", 
     RowBox[{"MeshStyle", " ", "->", " ", 
      RowBox[{"Opacity", "[", "0.1", "]"}]}], ",", " ", 
     RowBox[{"\"\<PerturbationArrows\>\"", "->", "True"}], ",", " ", 
     RowBox[{"\"\<ArrowSize\>\"", "->", "Medium"}], ",", " ", 
     RowBox[{"\"\<MaxWidth\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "All"}], "}"}]}], ",", " ", 
     RowBox[{"\"\<ArrowDirection\>\"", "->", "Automatic"}], ",", "\n", 
     RowBox[{"\"\<Graphics\>\"", "->", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotCA", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ca_", ",", "perts_Association"}], "}"}], ",", " ", 
     RowBox[{"ops", ":", 
      RowBox[{"OptionsPattern", "[", 
       RowBox[{"{", 
        RowBox[{"PlotCA", ",", " ", "ArrayPlot"}], "}"}], "]"}]}]}], "]"}], 
   " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"allops", " ", "=", " ", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", "ops"}], "}"}], ",",
           "Last"}], "]"}]}], ",", " ", "left", ",", " ", "right", ",", " ", 
       "bottom", ",", " ", "capped"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"capped", " ", "=", " ", 
       RowBox[{"ca", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ";;", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
        "}"}], " ", "=", " ", 
       RowBox[{"gettrimoffsets", "[", 
        RowBox[{"capped", ",", " ", 
         RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", " ", 
      "\n", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ArrayPlot", "[", 
         RowBox[{
          RowBox[{"TrimArray", "[", 
           RowBox[{"capped", ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", 
              "bottom"}], "}"}]}], "]"}], ",", " ", "##"}], "]"}], "&"}], "[",
        "\[IndentingNewLine]", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], " ", "||",
             " ", 
            RowBox[{
             RowBox[{"allops", "[", "\"\<Graphics\>\"", "]"}], " ", "=!=", 
             " ", 
             RowBox[{"{", "}"}]}]}], ",", " ", "\n", 
           RowBox[{"Epilog", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Sequence", "@@", 
               RowBox[{"allops", "[", "\"\<Graphics\>\"", "]"}]}], ",", 
              RowBox[{"Arrowheads", "[", 
               RowBox[{"{", 
                RowBox[{"allops", "[", "\"\<ArrowSize\>\"", "]"}], "}"}], 
               "]"}], ",", "\n", 
              RowBox[{
               RowBox[{
                RowBox[{"getarrow", "[", 
                 RowBox[{"capped", ",", " ", "#", ",", " ", 
                  RowBox[{"left", " ", "+", " ", 
                   RowBox[{"First", "[", 
                    RowBox[{"allops", "[", "\"\<MaxWidth\>\"", "]"}], "]"}], 
                   " ", "-", " ", "1"}], ",", " ", "bottom", ",", " ", 
                  RowBox[{"allops", "[", "\"\<ArrowDirection\>\"", "]"}]}], 
                 "]"}], "&"}], "/@", " ", 
               RowBox[{"Keys", "[", "perts", "]"}]}]}], "}"}]}], ",", " ", 
           "\n", "Nothing"}], "]"}]}], "]"}], "]"}]}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "  ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Steps\>\"", "->", 
            RowBox[{"{", 
             RowBox[{"200", ",", " ", "All"}], "}"}]}], "}"}], ",", "ops"}], 
         "}"}], ",", "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"PlotCA", "[", 
     RowBox[{
      RowBox[{"getca", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<Steps\>\"", "]"}]}], "]"}], ",", " ", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}], "]"}]}]}], "Code",\

 CellChangeTimes->{{3.943106358688594*^9, 3.943106375048778*^9}, {
   3.943106979531597*^9, 3.943106988235869*^9}, {3.94310786010571*^9, 
   3.943107865349316*^9}, {3.94311390218522*^9, 3.943113916165694*^9}, 
   3.943114206799518*^9, {3.943364337468414*^9, 3.943364356291*^9}, {
   3.94336439171276*^9, 3.9433644005207233`*^9}, {3.943364472464894*^9, 
   3.943364473040235*^9}, {3.94337218900583*^9, 3.943372193858235*^9}, {
   3.943372227748727*^9, 3.943372229008975*^9}, {3.943377838524406*^9, 
   3.943377844722754*^9}, {3.943455471192767*^9, 3.943455542176583*^9}, {
   3.943455637493842*^9, 3.943455685260359*^9}, {3.943455721343861*^9, 
   3.943455769714992*^9}, {3.943456396435326*^9, 3.943456432408684*^9}, {
   3.94353834209827*^9, 3.943538367957181*^9}, {3.943566345930059*^9, 
   3.943566351208854*^9}, {3.943566468830921*^9, 3.943566469091758*^9}, {
   3.943566841883333*^9, 3.943566842042541*^9}, {3.943567082571121*^9, 
   3.943567100426882*^9}, 3.943799420615381*^9, {3.943800726099045*^9, 
   3.94380074188017*^9}, {3.9438008034312897`*^9, 3.943800813658866*^9}, {
   3.943800844862834*^9, 3.943800902396796*^9}, {3.943800958948412*^9, 
   3.943800963102242*^9}, {3.943801200441373*^9, 3.943801282513608*^9}, {
   3.943801312748512*^9, 3.943801328887786*^9}, {3.9438020059305143`*^9, 
   3.9438020148781543`*^9}, 3.94380264751248*^9, {3.943802684760384*^9, 
   3.943802687214029*^9}, {3.944432031546154*^9, 3.944432032264789*^9}, {
   3.944493423584108*^9, 3.94449343416045*^9}, {3.945295199439509*^9, 
   3.945295221703529*^9}, {3.945295311298005*^9, 3.945295361190892*^9}, {
   3.945295397137776*^9, 3.945295450027227*^9}, {3.945295487660928*^9, 
   3.94529571318329*^9}, {3.945295849347142*^9, 3.945295872323279*^9}, {
   3.94529590487897*^9, 3.945296022782197*^9}, {3.945296486934933*^9, 
   3.945296503346024*^9}, 3.945296847269151*^9, {3.945296898097121*^9, 
   3.945296898658659*^9}, {3.945298369086669*^9, 3.945298485925401*^9}, {
   3.94529866756955*^9, 3.945298683712995*^9}, {3.945299631267777*^9, 
   3.945299634545657*^9}, {3.9453001790861607`*^9, 3.94530018039613*^9}, {
   3.945300334249873*^9, 3.9453003343238573`*^9}, {3.945303088195676*^9, 
   3.945303088996951*^9}, 3.945349703961798*^9, {3.94536369904582*^9, 
   3.945363717297109*^9}, 3.945363839510446*^9, 3.945379146293873*^9, {
   3.945383374631634*^9, 3.9453833794638863`*^9}, {3.945383718796687*^9, 
   3.945383725704792*^9}, {3.94552528404148*^9, 3.945525289542871*^9}, 
   3.945526051899728*^9, {3.945533790223825*^9, 3.945533800552722*^9}, {
   3.94563495520962*^9, 3.945634968299815*^9}, {3.945634999044939*^9, 
   3.945635032143476*^9}, {3.945647176059946*^9, 3.945647208017284*^9}, {
   3.945647493698488*^9, 3.945647538372767*^9}, 3.945656574061282*^9, {
   3.945657863909787*^9, 3.945657864956173*^9}, {3.945658108797264*^9, 
   3.945658121326334*^9}, 3.945660491379346*^9, {3.945660909367015*^9, 
   3.94566091016302*^9}, {3.9456613765511*^9, 3.9456614081585827`*^9}, {
   3.9456615103833714`*^9, 3.945661512498241*^9}, {3.945661629111843*^9, 
   3.9456616307049427`*^9}, {3.945661720077988*^9, 3.945661729966634*^9}, {
   3.945661761897276*^9, 3.945661762840654*^9}, {3.945661883775737*^9, 
   3.945661923089397*^9}, {3.945662036644912*^9, 3.9456620796553307`*^9}, {
   3.9464012769439*^9, 3.946401287994206*^9}, {3.946401396558921*^9, 
   3.946401402890257*^9}, {3.946401452631402*^9, 3.946401492653789*^9}, {
   3.946401991083851*^9, 3.946402045579023*^9}, 3.946403095129546*^9, {
   3.946403407334115*^9, 3.946403489672303*^9}, {3.946404190006364*^9, 
   3.946404190680002*^9}, {3.946404226666936*^9, 3.946404265332048*^9}, {
   3.946404840847248*^9, 3.946404849598381*^9}, {3.94640565712808*^9, 
   3.946405664323269*^9}, {3.946405847885517*^9, 3.946405848686509*^9}, {
   3.946406060594774*^9, 3.946406060781722*^9}, {3.946406275387241*^9, 
   3.946406293063033*^9}, 3.9464063547659883`*^9, {3.946414707200455*^9, 
   3.946414781969375*^9}, {3.946414819710042*^9, 3.9464148216942787`*^9}, {
   3.9464148572512283`*^9, 3.946414859681031*^9}, {3.9464148992397947`*^9, 
   3.946414903182425*^9}, {3.946414944854201*^9, 3.9464149812347183`*^9}, {
   3.9464150519677*^9, 3.946415053239094*^9}, {3.9464151610623407`*^9, 
   3.9464151666288767`*^9}, {3.946415236367476*^9, 3.9464152539082127`*^9}, {
   3.946415285666033*^9, 3.94641529413087*^9}, {3.9464155856255198`*^9, 
   3.946415619744156*^9}, {3.946415655890505*^9, 3.946415660595259*^9}, {
   3.946416626703637*^9, 3.9464166588834047`*^9}, 3.946416865188572*^9, {
   3.9464170259351597`*^9, 3.946417041968081*^9}, {3.946423705040704*^9, 
   3.946423759012779*^9}, {3.946424379552889*^9, 3.946424385317236*^9}, {
   3.946424441834894*^9, 3.946424445567153*^9}, {3.946426113376052*^9, 
   3.946426118625676*^9}, {3.946426314118448*^9, 3.946426339357868*^9}, {
   3.946426513534689*^9, 3.946426532523633*^9}, {3.9465661693390923`*^9, 
   3.946566170841405*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"0a278221-ec8e-4818-a10d-902b323e33f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getarrow", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"i_", ",", " ", "j_"}], "}"}], ",", " ", "left_", ",", " ", 
    "bottom_", ",", " ", 
    RowBox[{"direction_", ":", "Automatic"}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Haloing", "[", 
     RowBox[{"Lighter", "[", 
      RowBox[{"Cyan", ",", " ", ".85"}], "]"}], "]"}], ",", 
    RowBox[{"GrayLevel", "[", "0.35", "]"}], ",", "\n", 
    RowBox[{"Arrow", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"direction", " ", "===", " ", "Automatic"}], ",", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"j", "-", "left"}], "<", 
              RowBox[{"Ceiling", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Length", "[", 
                  RowBox[{"ca", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ")"}], "/", "2"}], 
               "]"}]}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", " ", "0"}], "]"}], 
           ",", " ", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"direction", " ", "===", " ", "\"\<Right\>\""}], ",", 
             " ", "0", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], "\n", 
         ",", 
         RowBox[{"bottom", "-", "i", " ", "-", "0.5"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"j", "+", ".5", "-", "left"}], ",", 
         RowBox[{"bottom", "-", "i", "-", "0.5"}]}], "}"}]}], "}"}], "]"}]}], 
   "}"}]}]], "Code",
 CellChangeTimes->{{3.945634907821689*^9, 3.945634937648013*^9}, {
   3.9456578721408243`*^9, 3.945657993641839*^9}, {3.945658041164122*^9, 
   3.94565804139354*^9}, {3.9456580780167*^9, 3.945658139931852*^9}, {
   3.945658173827106*^9, 3.945658184044565*^9}, {3.945658221489928*^9, 
   3.945658223412406*^9}, {3.94565831147316*^9, 3.945658330192912*^9}, {
   3.946404722040398*^9, 3.946404728693056*^9}, {3.946406188612273*^9, 
   3.946406206851822*^9}, {3.946406487953494*^9, 3.94640649569016*^9}, {
   3.946409552293276*^9, 3.946409575324222*^9}, {3.946414153742974*^9, 
   3.946414164147415*^9}, {3.9464142342885447`*^9, 3.94641425127284*^9}, {
   3.946414866250152*^9, 3.946414872334289*^9}, {3.946414990474228*^9, 
   3.946414996242106*^9}, {3.946415061065434*^9, 3.946415061696402*^9}, {
   3.946415102138871*^9, 3.946415104837607*^9}, 3.946415648616823*^9, {
   3.946416185199712*^9, 3.946416378046973*^9}, 3.946416453024721*^9, {
   3.94641650884992*^9, 3.9464165250419893`*^9}, {3.946416596068718*^9, 
   3.946416598815462*^9}, {3.9464170635984173`*^9, 3.946417066686971*^9}, {
   3.946417239925265*^9, 3.94641724285909*^9}, {3.946425974845911*^9, 
   3.94642597621773*^9}, {3.946426051262994*^9, 3.94642605169182*^9}, {
   3.946430926082719*^9, 3.946430957801482*^9}, {3.946480594617242*^9, 
   3.9464805974426622`*^9}, {3.946480627873939*^9, 3.94648065758916*^9}},
 CellLabel->
  "In[279]:=",ExpressionUUID->"9b014647-0901-4c26-91a1-98130b47cbf3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotCAs", "[", 
   RowBox[{"cas_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PlotCA", "]"}], ",", "ops"}], "}"}], ",", 
        "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ArrayPlot", "[", 
       RowBox[{
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"TrimArray", "[", 
             RowBox[{"#", ",", " ", 
              RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}], "&"}], "/@",
            " ", "cas"}], "}"}], "]"}], ",", " ", "##"}], "]"}], "&"}], "[", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Normal", "[", "allops", "]"}], ",", "\n", " ", 
       RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945526076049056*^9, 3.945526080001117*^9}},
 CellLabel->
  "In[280]:=",ExpressionUUID->"1215da87-9b66-4944-8205-67d788d9054a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LocationDifferences", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_", ",", " ", 
    RowBox[{"levelspec_", ":", "2"}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Position", "[", 
   RowBox[{
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", " ", "#2"}], "}"}], " ", "&"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"arr1", ",", " ", "arr2"}], "}"}], ",", " ", "2"}], "]"}], ",",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_", ",", " ", "y_"}], "}"}], " ", "/;", " ", 
     RowBox[{"x", " ", "!=", " ", "y"}]}], ",", " ", "levelspec"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.94284109345717*^9, 3.942841123199259*^9}, {
   3.942841245628819*^9, 3.9428412530122347`*^9}, 3.942841464181205*^9, {
   3.9428415042017107`*^9, 3.942841570648151*^9}, {3.942841603752768*^9, 
   3.942841605973318*^9}, {3.942841685917691*^9, 3.942841716147069*^9}, {
   3.942947182267355*^9, 3.942947182459833*^9}, {3.943105711024732*^9, 
   3.943105738718268*^9}, {3.943105784418694*^9, 3.943105787791119*^9}, {
   3.943374484112621*^9, 3.943374530822165*^9}, 3.944307889143518*^9},
 CellLabel->
  "In[281]:=",ExpressionUUID->"00820d1f-bba9-49cf-9118-7a39c77588ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotDifferences", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", "\n", 
    RowBox[{"ColorRules", " ", "->", " ", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0", " ", "->", " ", "White"}], ",", " ", 
         RowBox[{
          RowBox[{"-", "100"}], " ", "->", " ", 
          RowBox[{"GrayLevel", "[", ".8", "]"}]}]}], "}"}], ",", " ", "\n", 
       " ", "colorrules", ",", "\n", "    ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"-", "#1"}], " ", ":>", " ", 
          RowBox[{"Lighter", "[", 
           RowBox[{"#2", ",", " ", ".7"}], "]"}]}], " ", "&"}], " ", "@@@", 
        " ", "colorrules"}]}], "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"PlotDifferences", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"pertspec_", ":", "1"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locs", ",", " ", "vals", ",", " ", "rus", ",", " ", "highlighted", ",", 
      " ", "trimmed", ",", " ", "allops", ",", "ca1", ",", " ", "ca2", ",", 
      " ", "perts", ",", " ", "left", ",", "\n", "right", ",", " ", 
      "bottom"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Options", "[", "PerturbCA", "]"}], ",", 
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", " ", 
            RowBox[{"Options", "[", "PlotDifferences", "]"}]}], "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"ca1", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{"ru", ",", " ", 
        RowBox[{"allops", "[", "\"\<Steps\>\"", "]"}]}], "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ca2", ",", " ", "perts"}], "}"}], " ", "=", " ", 
      RowBox[{"PerturbCA", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ca1", ",", " ", "ru"}], "}"}], ",", " ", "pertspec", ",", 
        " ", "\n", "\t", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "PerturbCA", "]"}]}], "]"}]}]}], "]"}]}], 
     ";", "\n", "    ", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"LocationDifferences", "[", 
       RowBox[{"ca1", ",", " ", "ca2"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"vals", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ca2", "[", 
         RowBox[{"[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "]"}], " ", "&"}], " ", "@@@",
        " ", "locs"}]}], ";", "\n", "    ", 
     RowBox[{"rus", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "->", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", " ", "==", " ", "0"}], ",", " ", 
            RowBox[{"-", "100"}], ",", " ", 
            RowBox[{"-", "#2"}]}], "]"}]}], " ", "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"locs", ",", " ", "vals"}], "}"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ca1", ",", " ", "rus"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"ca2", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"trimmed", " ", "=", " ", 
      RowBox[{"TrimArray", "[", 
       RowBox[{"highlighted", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
         "}"}]}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"trimmed", ",", " ", "##"}], "]"}], "&"}], "[", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
          RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], ",", 
          " ", "\n", 
          RowBox[{"Epilog", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Arrowheads", "[", 
              RowBox[{"{", 
               RowBox[{"allops", "[", "\"\<ArrowSize\>\"", "]"}], "}"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"getarrow", "[", 
                RowBox[{"ca2", ",", " ", "#", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", 
                   "bottom"}], "}"}]}], "]"}], "&"}], "/@", " ", 
              RowBox[{"Keys", "[", "perts", "]"}]}]}], "}"}]}], ",", " ", 
          "\n", "Nothing"}], "]"}]}], "]"}], "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.943140779972243*^9, 3.943140829408785*^9}, {
   3.943140887462928*^9, 3.943140898149803*^9}, {3.9433721303152437`*^9, 
   3.943372147354694*^9}, 3.943377852602972*^9, 3.943379790272509*^9, {
   3.943537959725543*^9, 3.943537993795289*^9}, {3.943538264100615*^9, 
   3.943538273295963*^9}, {3.94355225625259*^9, 3.943552259024941*^9}, {
   3.943799896063838*^9, 3.943799902262787*^9}, {3.943799987363011*^9, 
   3.943800037817508*^9}, {3.943800374543797*^9, 3.9438003801044*^9}, {
   3.943800431351125*^9, 3.9438004710455093`*^9}, {3.9438005227218447`*^9, 
   3.943800524474503*^9}, {3.943800626121389*^9, 3.943800633785177*^9}, {
   3.943801173008723*^9, 3.943801193393601*^9}, 3.943801249712264*^9, 
   3.943802737450279*^9, {3.943802781851212*^9, 3.943802782996443*^9}, {
   3.943802818648016*^9, 3.943802838269998*^9}, {3.945384041816818*^9, 
   3.945384048001148*^9}, {3.945658635748845*^9, 3.945658898852055*^9}, {
   3.945658938296267*^9, 3.945658968322533*^9}, 3.945659217695423*^9, {
   3.9456593823394423`*^9, 3.94565941357098*^9}, {3.945659451538164*^9, 
   3.945659456358239*^9}, {3.945659557279435*^9, 3.945659567562809*^9}, {
   3.945659832680685*^9, 3.945659865763013*^9}, {3.945660598792308*^9, 
   3.945660648742975*^9}, {3.945660689474099*^9, 3.945660894125504*^9}, {
   3.945660924924346*^9, 3.945660929778511*^9}, {3.945661124448642*^9, 
   3.945661124825705*^9}, {3.945661229655545*^9, 3.945661269283289*^9}, {
   3.945662262187432*^9, 3.945662271187779*^9}, 3.945662401521862*^9, {
   3.945662446593384*^9, 3.945662452204391*^9}, 3.945662512927724*^9, {
   3.945662834556205*^9, 3.945662834832768*^9}, 3.945664469738006*^9, {
   3.945664500105354*^9, 3.945664501053206*^9}, {3.945739232159182*^9, 
   3.945739238397667*^9}},
 CellLabel->
  "In[282]:=",ExpressionUUID->"76bdfc43-21d3-481f-8938-b7c7683e246e"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotDifferences"}]], "Input",
 CellChangeTimes->{{3.946513376883418*^9, 3.946513380816863*^9}},
 CellLabel->
  "In[677]:=",ExpressionUUID->"e0baae1a-dcee-4077-8f0a-d3608e60773c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotDifferences", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", "\n", 
    RowBox[{"ColorRules", " ", "->", " ", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0", " ", "->", " ", "White"}], ",", " ", 
         RowBox[{
          RowBox[{"-", "100"}], " ", "->", " ", 
          RowBox[{"GrayLevel", "[", ".8", "]"}]}]}], "}"}], ",", " ", "\n", 
       " ", "colorrules", ",", "\n", "    ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"-", "#1"}], " ", ":>", " ", 
          RowBox[{"Lighter", "[", 
           RowBox[{"#2", ",", " ", ".7"}], "]"}]}], " ", "&"}], " ", "@@@", 
        " ", "colorrules"}]}], "]"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"PlotDifferences", "[", 
   RowBox[{"ca1_", ",", " ", "ca2_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locs", ",", " ", "vals", ",", " ", "rus", ",", " ", "highlighted", ",", 
      " ", "trimmed", ",", " ", "allops", ",", "perts", ",", " ", "left", ",",
       "\n", "right", ",", " ", "bottom"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Options", "[", "PerturbedCellularAutomaton", "]"}], ",", 
            
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", " ", 
            RowBox[{"Options", "[", "PlotDifferences", "]"}]}], "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"LocationDifferences", "[", 
       RowBox[{"ca1", ",", " ", "ca2"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"vals", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ca2", "[", 
         RowBox[{"[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "]"}], " ", "&"}], " ", "@@@",
        " ", "locs"}]}], ";", "\n", "    ", 
     RowBox[{"rus", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "->", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", " ", "==", " ", "0"}], ",", " ", 
            RowBox[{"-", "100"}], ",", " ", 
            RowBox[{"-", "#2"}]}], "]"}]}], " ", "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"locs", ",", " ", "vals"}], "}"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ca1", ",", " ", "rus"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"ca2", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"trimmed", " ", "=", " ", 
      RowBox[{"TrimArray", "[", 
       RowBox[{"highlighted", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
         "}"}]}], "]"}]}], ";", "\n", "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"trimmed", ",", " ", "##"}], "]"}], "&"}], "[", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
        RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], "]"}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.943140779972243*^9, 3.943140829408785*^9}, {
   3.943140887462928*^9, 3.943140898149803*^9}, {3.9433721303152437`*^9, 
   3.943372147354694*^9}, 3.943377852602972*^9, 3.943379790272509*^9, {
   3.943537959725543*^9, 3.943537993795289*^9}, {3.943538264100615*^9, 
   3.943538273295963*^9}, {3.94355225625259*^9, 3.943552259024941*^9}, {
   3.943799896063838*^9, 3.943799902262787*^9}, {3.943799987363011*^9, 
   3.943800037817508*^9}, {3.943800374543797*^9, 3.9438003801044*^9}, {
   3.943800431351125*^9, 3.9438004710455093`*^9}, {3.9438005227218447`*^9, 
   3.943800524474503*^9}, {3.943800626121389*^9, 3.943800633785177*^9}, {
   3.943801173008723*^9, 3.943801193393601*^9}, 3.943801249712264*^9, 
   3.943802737450279*^9, {3.943802781851212*^9, 3.943802782996443*^9}, {
   3.943802818648016*^9, 3.943802838269998*^9}, {3.945384041816818*^9, 
   3.945384048001148*^9}, {3.945658635748845*^9, 3.945658898852055*^9}, {
   3.945658938296267*^9, 3.945658968322533*^9}, 3.945659217695423*^9, {
   3.9456593823394423`*^9, 3.94565941357098*^9}, {3.945659451538164*^9, 
   3.945659456358239*^9}, {3.945659557279435*^9, 3.945659567562809*^9}, {
   3.945659832680685*^9, 3.945659865763013*^9}, {3.945660598792308*^9, 
   3.945660648742975*^9}, {3.945660689474099*^9, 3.945660894125504*^9}, {
   3.945660924924346*^9, 3.945660929778511*^9}, {3.945661124448642*^9, 
   3.945661124825705*^9}, {3.945661229655545*^9, 3.945661269283289*^9}, {
   3.945662262187432*^9, 3.945662271187779*^9}, 3.945662401521862*^9, {
   3.945662446593384*^9, 3.945662452204391*^9}, 3.945662512927724*^9, {
   3.945662834556205*^9, 3.945662834832768*^9}, 3.945664469738006*^9, {
   3.945664500105354*^9, 3.945664501053206*^9}, {3.945739232159182*^9, 
   3.945739238397667*^9}, {3.946513256755281*^9, 3.9465132952748537`*^9}, {
   3.946513367920168*^9, 3.9465133722387657`*^9}, {3.946513583877543*^9, 
   3.9465135874220476`*^9}, {3.946516671238366*^9, 3.946516711993268*^9}},
 CellLabel->
  "In[284]:=",ExpressionUUID->"490e47d5-e5d0-4a8c-a100-0a62ff6c7f65"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HighlightPerturbations", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorRules", "->", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", "->", "White"}], "}"}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", " ", "->", " ", 
           RowBox[{"GrayLevel", "[", "0.8", "]"}]}], " ", "&"}], " ", "@@@", 
         " ", "colorrules"}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", "#1"}], " ", "->", " ", "#2"}], "&"}], " ", "@@@", 
         " ", "colorrules"}]}], "]"}]}], ",", " ", 
     RowBox[{"\"\<Span\>\"", "->", "All"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HighlightPerturbations", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "perts_"}], "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
     "highlighted", ",", " ", "allops", ",", " ", "left", ",", " ", "right", 
      ",", " ", "bottom", ",", " ", "trimmed"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", 
            RowBox[{"Options", "[", "HighlightPerturbations", "]"}]}], "]"}], 
          ",", "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"ca", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "->", 
            RowBox[{"-", "#2"}]}], "&"}], " ", "@@@", 
          RowBox[{"Normal", "[", "perts", "]"}]}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"allops", "[", "\"\<Span\>\"", "]"}], "]"}], "]"}]}], ";", 
     "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"ca", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"trimmed", " ", "=", " ", 
      RowBox[{"TrimArray", "[", 
       RowBox[{"highlighted", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
         "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"trimmed", ",", " ", "##"}], "]"}], "&"}], "[", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
          RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], ",", 
          " ", "\n", 
          RowBox[{"Epilog", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Arrowheads", "[", 
              RowBox[{"{", 
               RowBox[{"allops", "[", "\"\<ArrowSize\>\"", "]"}], "}"}], 
              "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"getarrow", "[", 
                RowBox[{"ca", ",", " ", "#", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", 
                   "bottom"}], "}"}]}], "]"}], "&"}], "/@", " ", 
              RowBox[{"Keys", "[", "perts", "]"}]}]}], "}"}]}], ",", " ", 
          "\n", "Nothing"}], "]"}]}], "]"}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]}], "Code",
 CellChangeTimes->{{3.943106685517144*^9, 3.94310677904241*^9}, 
   3.943106870352314*^9, {3.943107599822666*^9, 3.94310773548406*^9}, {
   3.94310779502401*^9, 3.943107812275255*^9}, 3.943107902392624*^9, {
   3.9431079903214*^9, 3.943108001961671*^9}, {3.943117565625243*^9, 
   3.94311760767655*^9}, {3.943118261634057*^9, 3.943118264127614*^9}, {
   3.943118310387644*^9, 3.943118338561084*^9}, {3.943118501698257*^9, 
   3.943118514665153*^9}, {3.943119032917924*^9, 3.943119046038877*^9}, 
   3.943119127604664*^9, {3.943119296902045*^9, 3.943119339979965*^9}, {
   3.943119560372925*^9, 3.943119592441654*^9}, {3.943119954020553*^9, 
   3.943120075695915*^9}, {3.943120126861842*^9, 3.943120148915618*^9}, {
   3.943120193550227*^9, 3.94312019625139*^9}, {3.943120244135589*^9, 
   3.943120244294791*^9}, {3.943369750018495*^9, 3.943369750909212*^9}, {
   3.9433697832791233`*^9, 3.943369830073592*^9}, {3.943369873282905*^9, 
   3.943369887355904*^9}, {3.943369984394773*^9, 3.9433699845053*^9}, 
   3.943377856878038*^9, {3.943380021841707*^9, 3.943380032187724*^9}, {
   3.943537932634395*^9, 3.943537952520741*^9}, {3.9436463581738358`*^9, 
   3.9436463593952503`*^9}, {3.943814028903208*^9, 3.943814107429339*^9}, {
   3.9438141696089687`*^9, 3.94381421192414*^9}, {3.944405684349122*^9, 
   3.944405739058359*^9}, {3.94440579937637*^9, 3.944406079766323*^9}, 
   3.944420599808983*^9, {3.9444206322689*^9, 3.944420641207638*^9}, {
   3.944420676870726*^9, 3.944420694453733*^9}, {3.944421216241522*^9, 
   3.94442132628037*^9}, {3.944424523376267*^9, 3.944424567268689*^9}, {
   3.94442460127194*^9, 3.9444246136162987`*^9}, {3.944427378392194*^9, 
   3.944427387851761*^9}, {3.944522647617392*^9, 3.944522701760391*^9}, {
   3.945384095830322*^9, 3.945384106590083*^9}, {3.9456628720001583`*^9, 
   3.945662874400648*^9}, {3.94566332508942*^9, 3.945663418500539*^9}, {
   3.9456634499125557`*^9, 3.9456634765759172`*^9}, {3.94566352466411*^9, 
   3.945663530445005*^9}, {3.945663634646159*^9, 3.945663706811124*^9}, {
   3.945663742913786*^9, 3.945663786882972*^9}, {3.9456638218337317`*^9, 
   3.945663861337218*^9}, {3.945664030646152*^9, 3.945664032426483*^9}, {
   3.945664152411584*^9, 3.945664156013639*^9}, 3.94566423210784*^9, {
   3.945664313731479*^9, 3.945664330813746*^9}, {3.94566459122963*^9, 
   3.94566459286037*^9}, {3.945664625686434*^9, 3.945664631393455*^9}, {
   3.945664766656722*^9, 3.945664792875109*^9}, 3.945664860366918*^9, {
   3.945664938940698*^9, 3.945664964778101*^9}, {3.94573666581114*^9, 
   3.94573667477476*^9}},
 CellLabel->
  "In[286]:=",ExpressionUUID->"e5721ff3-e4b7-47dc-bde0-27b33fda6738"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "DiseasePropagationPlot"}]], "Input",
 CellChangeTimes->{{3.946514205559841*^9, 3.9465142097883577`*^9}},
 CellLabel->
  "In[655]:=",ExpressionUUID->"ecfee036-990d-4b7f-90fe-c7bb776881aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DiseasePropagationPlot", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "5"}], ",", " ", "50"}], "}"}]}], ",", " ", 
     RowBox[{"PlotHighlighting", "->", "None"}], ",", " ", 
     RowBox[{"\"\<LineStyle\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"Red", ",", " ", "Thick"}], "}"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DiseasePropogationPlot", "[", 
   RowBox[{
   "ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", "row_", ",", " ", 
    "nperts_", ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcasperts", ",", " ", "lt"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "DiseasePropogationPlot", "]"}], ",", " ", 
          "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pcasperts", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"PerturbedCellularAutomaton", "[", 
         RowBox[{"ru", ",", "init", ",", "txspec", ",", " ", 
          RowBox[{"{", 
           RowBox[{"row", ",", " ", "RandomChoice"}], "}"}]}], "]"}], ",", 
        " ", "nperts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DiseasePropogationPlot", "[", 
      RowBox[{
       RowBox[{"CellularAutomaton", "[", 
        RowBox[{"ru", ",", " ", "init", ",", " ", "txspec"}], "]"}], ",", " ",
        "pcasperts", ",", " ", "ops"}], "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.9442257261890907`*^9, 3.9442257990828953`*^9}, {
   3.944225887831559*^9, 3.944225903424333*^9}, {3.944225950715973*^9, 
   3.944225965794786*^9}, {3.9442260257882137`*^9, 3.9442260829631233`*^9}, {
   3.9442262867732887`*^9, 3.944226350407386*^9}, {3.944226386340079*^9, 
   3.944226458491509*^9}, {3.944226560265594*^9, 3.9442266254154997`*^9}, {
   3.944226690273789*^9, 3.944226698858684*^9}, {3.944226751746167*^9, 
   3.944226767725651*^9}, {3.944226807488984*^9, 3.9442269438234663`*^9}, {
   3.94422701601368*^9, 3.944227043036899*^9}, 3.9442271346617317`*^9, {
   3.944227278830962*^9, 3.94422738168391*^9}, {3.944227452006888*^9, 
   3.944227460029377*^9}, 3.944227509551169*^9, {3.944227544000881*^9, 
   3.944227544392918*^9}, 3.944227602087277*^9, {3.9442277297702208`*^9, 
   3.944227749510415*^9}, {3.944227857419705*^9, 3.944227857752283*^9}, {
   3.944227917479233*^9, 3.944227917619583*^9}, {3.944513457034573*^9, 
   3.9445136395240183`*^9}, {3.944513677092892*^9, 3.944513757292581*^9}, {
   3.944513794768525*^9, 3.944513804030795*^9}, {3.944513834357344*^9, 
   3.944514040078794*^9}, {3.944514081972793*^9, 3.944514519265048*^9}, {
   3.944514551973295*^9, 3.944514685901204*^9}, 3.944514749340536*^9, {
   3.944515011259468*^9, 3.944515019828166*^9}, {3.944515099801543*^9, 
   3.9445151236839*^9}, {3.944515215418655*^9, 3.944515240348115*^9}, {
   3.94451540421021*^9, 3.944515416204427*^9}, {3.9445155641337433`*^9, 
   3.9445155666582203`*^9}, {3.944516124319501*^9, 3.944516126444302*^9}, {
   3.944516467982931*^9, 3.944516777236442*^9}, {3.944516956311542*^9, 
   3.944516956531832*^9}, {3.944517020504977*^9, 3.944517065620974*^9}, {
   3.94451787222213*^9, 3.944517959206838*^9}, {3.944518065707601*^9, 
   3.944518067246185*^9}, {3.944518105492508*^9, 3.944518112866763*^9}, {
   3.944518216176889*^9, 3.944518229074774*^9}, {3.944519030761211*^9, 
   3.944519064138102*^9}, {3.944519239143301*^9, 3.944519251667643*^9}, {
   3.944520875331632*^9, 3.944520878421109*^9}, 3.944521550848152*^9, {
   3.94452548157586*^9, 3.94452548255165*^9}, {3.944768547125078*^9, 
   3.944768550716289*^9}, {3.945361205943533*^9, 3.945361206124344*^9}, {
   3.945384084268691*^9, 3.945384084728002*^9}, {3.945652742747711*^9, 
   3.945652748166785*^9}, {3.946513972678568*^9, 3.94651404688856*^9}, {
   3.946514182228158*^9, 3.946514240021245*^9}, {3.946514309216181*^9, 
   3.9465143398844957`*^9}, {3.946514370835895*^9, 3.946514430295424*^9}},
 CellLabel->
  "In[288]:=",ExpressionUUID->"1aad2baa-0495-436d-95f2-af44da44fb73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiseasePropagationPlot", "[", 
   RowBox[{"ca_List", ",", " ", "pcasperts_List", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", ",", " ", "diffstepcountslist", ",", " ", 
      RowBox[{"lt", " ", "=", " ", 
       RowBox[{"TestCALifeTime", "[", "ca", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "DiseasePropogationPlot", "]"}], ",", " ", 
          "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffstepcountslist", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"PadLeft", "[", 
         RowBox[{
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"countstepdiffs", "[", 
             RowBox[{"ca", ",", " ", "#1"}], "]"}], ",", " ", "\n", 
            RowBox[{
             RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "\"\<rowidx\>\"", 
              "]"}]}]}], "]"}], ",", " ", 
          RowBox[{"Length", "[", "ca", "]"}]}], "]"}], "&"}], "@@@", " ", 
       "pcasperts"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"diffstepcountslist", ",", "\n", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
            RowBox[{"Options", "@", "ListLinePlot"}]}], "]"}]}]}], "]"}], ",",
        "\n", 
       RowBox[{"Graphics", "[", 
        RowBox[{"Style", "[", 
         RowBox[{
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lt", ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"lt", ",", " ", "50"}], "}"}]}], "}"}], "]"}], ",", " ", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"allops", "[", "\"\<LineStyle\>\"", "]"}]}]}], "]"}], 
        "]"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944517653871515*^9, 3.944517818989222*^9}, {
   3.944517982155702*^9, 3.944517985149261*^9}, 3.944518046887535*^9, 
   3.944518220024178*^9, 3.944518306785303*^9, {3.944518849995941*^9, 
   3.944518851253766*^9}, {3.944519131225924*^9, 3.944519137406631*^9}, {
   3.944519177805513*^9, 3.944519223420328*^9}, {3.944519260479782*^9, 
   3.944519268661899*^9}, {3.944519317722184*^9, 3.944519332640952*^9}, {
   3.9445215160675*^9, 3.944521535009185*^9}, {3.945361202827179*^9, 
   3.945361202967128*^9}},
 CellLabel->
  "In[290]:=",ExpressionUUID->"3e4c1673-a209-481f-8807-8508bf6ca7d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CAMask", "[", 
   RowBox[{"caspec_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Color\>\"", "->", "Black"}], ",", "ops"}], "}"}], ",", 
        " ", "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cas", ",", " ", "dims"}], "}"}], " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Dimensions", "[", "caspec", "]"}], "]"}], " ", "==", " ", 
         "2"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "caspec", "}"}], ",", " ", 
          RowBox[{"Dimensions", "[", "caspec", "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"caspec", ",", " ", 
          RowBox[{"Dimensions", "[", 
           RowBox[{"First", "[", "caspec", "]"}], "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PlotCA", "[", 
      RowBox[{
       RowBox[{"Normal", "[", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"bodyidxs", "[", "#", "]"}], ",", " ", "1"}], "]"}], 
               "->", "1"}], "]"}], ",", " ", "dims"}], "]"}], "&"}], "/@", 
          " ", "cas"}], "]"}], "]"}], ",", 
       RowBox[{"ColorRules", "->", "None"}], ",", " ", 
       RowBox[{"ColorFunction", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Blend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"White", ",", " ", 
              RowBox[{"allops", "[", "\"\<Color\>\"", "]"}]}], "}"}], ",", 
            "#"}], "]"}], "&"}], ")"}]}], ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945735827663903*^9, 3.945735854163924*^9}, {
   3.94573612058687*^9, 3.945736204899493*^9}, {3.945736254969167*^9, 
   3.945736282785199*^9}, {3.945736413492496*^9, 3.945736435669447*^9}, {
   3.945736476524037*^9, 3.945736577117764*^9}, {3.9457371012087603`*^9, 
   3.945737129019669*^9}, {3.945737195863595*^9, 3.945737255762477*^9}, {
   3.945737857433801*^9, 3.945737873255891*^9}, {3.945737918467053*^9, 
   3.945738059326247*^9}, {3.94573818119514*^9, 3.945738228139231*^9}, {
   3.9457382874196444`*^9, 3.945738357488632*^9}, 3.945738405120159*^9, {
   3.945739125011757*^9, 3.945739125893588*^9}, {3.945739165992743*^9, 
   3.94573916767379*^9}, {3.945743241781191*^9, 3.945743243779094*^9}, {
   3.945743891301496*^9, 3.945743985955874*^9}},
 CellLabel->
  "In[291]:=",ExpressionUUID->"3400f618-dcf3-4b13-a393-083977ae1616"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ShowSilhouette", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Opacity\>\"", "->", "0.25"}], ",", 
          RowBox[{"\"\<Color\>\"", "->", 
           RowBox[{"Lighter", "@", "Blue"}]}], ",", "ops"}], "}"}], ",", " ", 
        "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coords", " ", "=", " ", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<left\>\"", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], ",", 
           RowBox[{"\"\<right\>\"", "->", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}]}], "|>"}], "&"}], 
        ",", " ", 
        RowBox[{"TakeWhile", "[", 
         RowBox[{
          RowBox[{"nonzeroRange", "/@", "ca"}], ",", " ", 
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"points", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "\"\<left\>\""}], "]"}], "]"}], ",", " ", 
        RowBox[{"Reverse", "[", 
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "\"\<right\>\""}], "]"}], "]"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Opacity", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Opacity\>\"", "]"}], ",", " ", 
          RowBox[{"allops", "[", "\"\<Color\>\"", "]"}]}], "]"}], ",", 
        RowBox[{"Polygon", "[", "points", "]"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], " "}]], "Code",
 CellChangeTimes->{{3.945706656239897*^9, 3.945706665448127*^9}, {
   3.9457067034366*^9, 3.945706705755614*^9}, {3.9457067532382383`*^9, 
   3.945706789766719*^9}, {3.945706936147888*^9, 3.945706966442313*^9}, {
   3.945728672094096*^9, 3.945728676799097*^9}, 3.945733103694798*^9, {
   3.945733168019871*^9, 3.945733293323498*^9}, {3.945733329750662*^9, 
   3.945733394679002*^9}, {3.9457335660722*^9, 3.945733739488207*^9}, {
   3.9457338200781*^9, 3.945733910761564*^9}, {3.945733944856778*^9, 
   3.945733945355929*^9}, {3.945734010630609*^9, 3.94573408764926*^9}, {
   3.945734188421773*^9, 3.945734204452782*^9}, {3.945735782995775*^9, 
   3.945735787879803*^9}, {3.945736920939543*^9, 3.945736934780781*^9}, {
   3.945744408818396*^9, 3.945744409321233*^9}, {3.945744487885826*^9, 
   3.945744494117784*^9}, {3.9457445420202*^9, 3.945744542338766*^9}, {
   3.945744673028083*^9, 3.94574467996231*^9}, {3.945744715059937*^9, 
   3.945744718429005*^9}, {3.945744913577353*^9, 3.945744918634297*^9}, 
   3.945747038516181*^9},
 CellLabel->
  "In[292]:=",ExpressionUUID->"8b456d75-7800-4707-8a81-af938e4ed276"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CAPolygon", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"z_", ":", "None"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "coords", "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"coords", " ", "=", " ", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<left\>\"", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], ",", 
           RowBox[{"\"\<right\>\"", "->", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}]}], "|>"}], "&"}], 
        ",", " ", 
        RowBox[{"TakeWhile", "[", 
         RowBox[{
          RowBox[{"nonzeroRange", "/@", "ca"}], ",", " ", 
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"points", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "\"\<left\>\""}], "]"}], "]"}], ",", " ", 
        RowBox[{"Reverse", "[", 
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "\"\<right\>\""}], "]"}], "]"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Polygon", "[", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"z", " ", "===", " ", "None"}], ",", " ", "points", ",", " ", 
        
        RowBox[{
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{"#", ",", " ", "z"}], "]"}], "&"}], "/@", "points"}]}], 
       "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.945744831924307*^9, 3.945744840362073*^9}, {
  3.945744871924444*^9, 3.9457449114901114`*^9}, {3.945744965771405*^9, 
  3.945745032813649*^9}, {3.945745066550909*^9, 3.94574508153551*^9}, {
  3.945745255472953*^9, 3.945745257802269*^9}, {3.946511352513284*^9, 
  3.94651137870137*^9}, {3.946511492832424*^9, 3.946511495361601*^9}},
 CellLabel->
  "In[293]:=",ExpressionUUID->"eabae733-cad1-49bd-b660-550d5daa91cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ShowOutline", "[", 
   RowBox[{"ru_", ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "coords", ",", " ", "leftlines", ",", " ", "rightlines", ",", " ", "ca", 
      ",", " ", "allops"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<Steps\>\"", "->", "200"}], ",", " ", 
            RowBox[{"\"\<Perturbation\>\"", "->", "None"}], ",", " ", 
            RowBox[{"\"\<Color\>\"", "->", "Black"}]}], "}"}], ",", " ", 
          "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], " ", "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"PerturbCA", "[", 
         RowBox[{"ru", ",", " ", 
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"Normal", "[", "allops", "]"}], ",", 
             RowBox[{"Options", "[", "PerturbCA", "]"}]}], "]"}]}]}], "]"}], 
        ",", 
        RowBox[{"getca", "[", 
         RowBox[{"ru", ",", 
          RowBox[{"allops", "[", "\"\<Steps\>\"", "]"}]}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"coords", " ", "=", " ", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<left\>\"", "->", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], ",", 
           RowBox[{"\"\<right\>\"", "->", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}]}], "|>"}], "&"}], 
        ",", " ", 
        RowBox[{"TakeWhile", "[", 
         RowBox[{
          RowBox[{"nonzeroRange", "/@", "ca"}], ",", " ", 
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], "]"}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"leftlines", " ", "=", " ", 
      RowBox[{"Line", "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "\"\<left\>\""}], "]"}], "]"}], ",", " ", 
         "2", ",", " ", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rightlines", " ", "=", " ", 
      RowBox[{"Line", "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "\"\<right\>\""}], "]"}], "]"}], ",", " ",
          "2", ",", " ", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{"Thick", ",", " ", 
        RowBox[{"allops", "[", "\"\<Color\>\"", "]"}], ",", " ", "leftlines", 
        ",", " ", "rightlines"}], "}"}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945729081093933*^9, 3.945729081726697*^9}, {
   3.945729112245399*^9, 3.945729276749132*^9}, {3.945729324138149*^9, 
   3.945729450268693*^9}, {3.945729511228953*^9, 3.94572955488807*^9}, {
   3.945729850155202*^9, 3.945729930150075*^9}, {3.945729962782752*^9, 
   3.945730012258929*^9}, {3.945730109622468*^9, 3.945730148374419*^9}, {
   3.9457301834501133`*^9, 3.94573026860685*^9}, {3.94573030958622*^9, 
   3.945730440283462*^9}, {3.945730497878462*^9, 3.945730498173025*^9}, {
   3.945730672555506*^9, 3.945730680230145*^9}, {3.945730769595306*^9, 
   3.945730820276444*^9}, {3.945730869327408*^9, 3.945730870801984*^9}, 
   3.945730925357628*^9, {3.945731092092215*^9, 3.945731104555622*^9}, {
   3.945731152380892*^9, 3.945731156165577*^9}, {3.945731297608451*^9, 
   3.9457314061186666`*^9}, 3.945731458427512*^9, {3.945731507269926*^9, 
   3.945731623570175*^9}, {3.945731661372219*^9, 3.945731690129507*^9}, {
   3.945731849649918*^9, 3.945732036437199*^9}, {3.945732078891801*^9, 
   3.945732081589557*^9}, {3.945732387955454*^9, 3.945732388422957*^9}, {
   3.9457357991511717`*^9, 3.945735802325714*^9}, {3.945742209024681*^9, 
   3.945742210184125*^9}},
 CellLabel->
  "In[294]:=",ExpressionUUID->"96cb2af5-052b-4986-a402-473a39d13c58"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perturbation Function", "Section",
 CellChangeTimes->{{3.942889340094302*^9, 3.942889343808528*^9}, {
  3.942943963284713*^9, 
  3.942943965416974*^9}},ExpressionUUID->"0d54c013-5695-4af7-a5d8-\
526052a920b4"],

Cell[CellGroupData[{

Cell["Low level", "Subsubsection",
 CellChangeTimes->{{3.943808132743845*^9, 
  3.943808133973564*^9}},ExpressionUUID->"f9337781-00ed-4cf6-b7d6-\
15b108cb404b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nonzeroRange", "[", "list_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"SparseArray", "[", "list", "]"}], "[", 
    "\"\<NonzeroPositions\>\"", "]"}], " ", "//", " ", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], " ", "==", " ", "0"}], ",", " ", 
      "#", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], ",", " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", " ", "1"}], "]"}], "]"}]}], "}"}]}], 
     "]"}], "&"}]}]}]], "Code",
 CellChangeTimes->{{3.943634765875016*^9, 3.94363476741509*^9}, {
   3.943634828026243*^9, 3.943634828706764*^9}, {3.943634873613714*^9, 
   3.943634952247225*^9}, {3.943635004008057*^9, 3.943635007241334*^9}, {
   3.943635081426149*^9, 3.943635107496182*^9}, {3.943635157819008*^9, 
   3.943635161013969*^9}, {3.94363521039839*^9, 3.943635252222834*^9}, {
   3.94363533449787*^9, 3.943635880394552*^9}, {3.9436359307451773`*^9, 
   3.943635995708077*^9}, 3.943636166156807*^9, {3.944493572078703*^9, 
   3.944493583911049*^9}, {3.945621036427002*^9, 3.9456210394939947`*^9}, {
   3.945624404493595*^9, 3.945624407438113*^9}},
 CellLabel->"In[295]:=",
 CellID->2093550075,ExpressionUUID->"28df7aef-fff4-4559-b797-414e7dee1c93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tofunc", "[", 
   RowBox[{"bitfuncspec_", ",", " ", "k_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Which", "[", "\n", 
   RowBox[{
    RowBox[{"IntegerQ", "[", "bitfuncspec", "]"}], ",", " ", 
    RowBox[{"bitfuncspec", "&"}], ",", "\[IndentingNewLine]", 
    RowBox[{"bitfuncspec", " ", "===", "\"\<Random\>\""}], ",", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"RandomChoice", "[", 
       RowBox[{"Delete", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
         RowBox[{"#", "+", "1"}]}], "]"}], "]"}], "&"}], ")"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bitfuncspec", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "===", "\"\<AddValue\>\""}], ",", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", " ", "+", " ", 
          RowBox[{"bitfuncspec", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}], ",", " ", "k"}], "]"}], 
      " ", "&"}], ")"}], ",", "\[IndentingNewLine]", "True", ",", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"bitfuncspec", "[", 
       RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], ")"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9453614924208517`*^9, 3.945361622175321*^9}, {
  3.9453616609286633`*^9, 3.945361767712916*^9}, {3.945877682480416*^9, 
  3.945877688083214*^9}, {3.94598587061668*^9, 3.945985903250106*^9}, {
  3.945995580883376*^9, 3.945995581491375*^9}},
 CellLabel->"In[296]:=",
 CellID->1726971227,ExpressionUUID->"347745f7-cee9-499d-91cd-b4ed01243b3d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interprettspec", "[", "tspec_", "]"}], ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"tspec", ",", " ", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t_Integer", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", "All"}], "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "t_Integer", "}"}], ":>", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", 
         RowBox[{"{", 
          RowBox[{"t", " ", "+", " ", "1"}], "}"}]}], "}"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", "t_Integer", "}"}], "}"}], ":>", " ", 
       RowBox[{"{", 
        RowBox[{"t", ",", " ", 
         RowBox[{"t", " ", "+", " ", "1"}]}], "}"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t1_Integer", ",", " ", "t2_Integer"}], "}"}], ":>", " ", 
       RowBox[{"{", 
        RowBox[{"t2", ",", " ", 
         RowBox[{
          RowBox[{"t1", " ", "+", " ", "1"}], ";;", 
          RowBox[{"t2", " ", "+", " ", "1"}]}]}], "}"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "t1_Integer", ",", " ", "t2_Integer", ",", " ", "dt_Integer"}], "}"}],
        ":>", " ", 
       RowBox[{"{", 
        RowBox[{"t2", ",", " ", 
         RowBox[{
          RowBox[{"t1", " ", "+", " ", "1"}], ";;", 
          RowBox[{"t2", " ", "+", " ", "1"}], ";;", "dt"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9461833175292*^9, 3.946183453417712*^9}, {
  3.946431927727075*^9, 3.94643195057854*^9}, {3.946433398037158*^9, 
  3.946433405539648*^9}},
 CellLabel->"In[297]:=",
 CellID->651132542,ExpressionUUID->"219a2aa2-cb6c-4c3b-98d2-da08394390d9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interpretxspec", "[", "xspec___", "]"}], ":=", " ", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"xspec", " ", "===", " ", 
      RowBox[{"Nothing", " ", "xspec"}], " ", "===", " ", "Automatic"}], " ", 
     "||", " ", 
     RowBox[{"xspec", " ", "===", " ", "All"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "25"}], ",", " ", "25"}], "}"}], ",", " ", "xspec"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.946183330990664*^9, 3.9461833365767193`*^9}, {
  3.9461834670502243`*^9, 3.946183472608314*^9}, {3.9461835182891617`*^9, 
  3.9461835185092487`*^9}, {3.946183688945549*^9, 3.946183693357554*^9}, {
  3.946183743027657*^9, 3.9461837829798403`*^9}},
 CellLabel->"In[298]:=",
 CellID->201266207,ExpressionUUID->"6f4da41a-65fe-42e4-b976-64947aa0fa7a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interprettxspec", "[", "txspec_", "]"}], ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"txspec", ",", 
    RowBox[{"{", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t_Integer", " ", ":>", " ", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"interprettspec", "[", "t", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "25"}], ",", " ", "25"}], "}"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ts_", ",", " ", "xs___"}], "}"}], ":>", " ", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"interprettspec", "[", "ts", "]"}], ",", " ", 
         RowBox[{"interpretxspec", "[", "xs", "]"}]}], "]"}]}]}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.946144738668741*^9, 3.946144745323369*^9}, {
   3.9461453057255583`*^9, 3.946145346907213*^9}, {3.946145568275429*^9, 
   3.94614562334881*^9}, {3.946150706225065*^9, 3.946150779201581*^9}, {
   3.94615081914487*^9, 3.9461508237173038`*^9}, {3.94615089815753*^9, 
   3.946150903438021*^9}, {3.946150955314368*^9, 3.946150957278764*^9}, {
   3.946151184925393*^9, 3.946151189049234*^9}, {3.946156621915888*^9, 
   3.9461566296620407`*^9}, {3.9461573078092823`*^9, 3.946157375764061*^9}, {
   3.946157612406724*^9, 3.946157612756859*^9}, {3.946157773763062*^9, 
   3.946157778586995*^9}, {3.94616111182379*^9, 3.946161148222164*^9}, {
   3.946161195392544*^9, 3.946161323169023*^9}, {3.946161504947806*^9, 
   3.946161507272572*^9}, {3.946181778203472*^9, 3.946181786331966*^9}, {
   3.946183186957528*^9, 3.946183215384836*^9}, {3.946183279175763*^9, 
   3.94618327949693*^9}, {3.946183351828659*^9, 3.946183352691519*^9}, {
   3.946183480028716*^9, 3.946183500174834*^9}, {3.946183538715415*^9, 
   3.946183589110979*^9}, {3.946183648397125*^9, 3.946183654829617*^9}, 
   3.946183862545632*^9},
 CellLabel->"In[299]:=",
 CellID->1596562746,ExpressionUUID->"bb80d0b7-babf-4b33-a1bc-62c0cb2ef33a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interpretrule", "[", "rule_", "]"}], " ", ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"rule", ",", " ", 
    RowBox[{"{", "\n", "   ", 
     RowBox[{
      RowBox[{"n_Integer", " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "2", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer"}], "]"}], " ", ":>", "  ", 
       
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}]}], "]"}], " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}], ",", " ", "s_Integer"}], "]"}], " ", 
       ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", 
         RowBox[{"List", "[", 
          RowBox[{"k_Integer", ",", " ", "1"}], "]"}]}], "]"}], " ", ":>", 
       " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", 
         RowBox[{"List", "[", 
          RowBox[{"k_Integer", ",", " ", "1"}], "]"}], ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}]}], "]"}], " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}]}], "\n", "   ", 
     "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943306327490436*^9, 3.94330641756797*^9}, {
  3.943306573704802*^9, 3.943306674496083*^9}, {3.943306705362965*^9, 
  3.943306855240611*^9}, {3.943307010998331*^9, 3.943307011293704*^9}, {
  3.943307045470796*^9, 3.943307074880732*^9}, {3.9433071284836483`*^9, 
  3.943307270220673*^9}, {3.943377871784828*^9, 3.943377872038154*^9}, {
  3.943545128893005*^9, 3.9435451384052277`*^9}, {3.943545334276613*^9, 
  3.943545342616293*^9}, {3.943545476272172*^9, 3.9435454847219048`*^9}, {
  3.943545836929001*^9, 3.943545874910882*^9}, {3.943545907560986*^9, 
  3.943545916385167*^9}},
 CellLabel->"In[300]:=",
 CellID->829937698,ExpressionUUID->"7eca9cad-21b4-45d0-83f5-1e145ae13584"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "expandrange"}]], "Input",
 CellChangeTimes->{{3.9465678626060753`*^9, 3.9465678697448378`*^9}},
 CellLabel->
  "In[971]:=",ExpressionUUID->"e5123221-7716-4d07-9b4f-77a5f655e1f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expandrange", "[", 
   RowBox[{"idxspec_", ",", " ", "t_", ",", " ", 
    RowBox[{"start_", ":", "1"}]}], "]"}], ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"idxspec", ",", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i_Integer", ":>", " ", 
       RowBox[{"{", "i", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "is__", "}"}], " ", ":>", " ", 
       RowBox[{"{", "is", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Span", "[", 
        RowBox[{"s_", ",", " ", "e_"}], "]"}], " ", ":>", " ", 
       RowBox[{"Range", "[", 
        RowBox[{"s", ",", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"e", " ", "===", " ", "All"}], ",", " ", "t", ",", " ", 
           "e"}], "]"}]}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{"f_", ":>", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"IntegerQ", "[", "#", "]"}], ",", " ", 
            RowBox[{"{", "#", "}"}], ",", " ", "#"}], "]"}], "&"}], ")"}], 
        "[", 
        RowBox[{"f", "[", 
         RowBox[{"Range", "[", 
          RowBox[{"start", ",", " ", "t"}], "]"}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJwdxVsoQ3EAB+AzDA8UIjGMDGEiRBkxRVmI4zKhrImRTIliRNbSCGGjSGya
O40SiaZ5kFxCyIPLPE3J5BIlhf/vPHx9QdIGusqOoqggAlfH1PnkVduEvyJ/
X9zp9J2A6Qh+En4rTKUx+26jCOvSq+TY3cXYjHdMIQr8YtvvwFrNoQp/3Ux2
Y+nt5zA+EZlHMHdltT6fvFBmkOPbz0QuTX5n7/Hw9BgdjWd5lnh8yZcIMCtY
l4mzXwdEzDnGWux2LVDgv92Mdjz6k9KF1VINc405Xo2t5pBBfPV0cV9Apoob
LTiN28MuJMcevzhhaZPHYAlZrM0dxo5eAaoy8muvjJnKnouqIJ8HesbgZXl4
Au5tuWe+s0jmsZI1v4idA0pVEvKB33g/brjeHcILT5EazGrdW8Oeuol13Hlc
PllJ5li9p3DfUfLmEnlG/8isNYunt8hr6kADHo3zbdsmh5kimJP1rkosPhUw
W7t6+vCZ8rAfO3BWU01kQ5ZWiO2fH94UMpswlG/3gf8BJX4D6A==
  "],
 CellLabel->"In[301]:=",
 CellID->749686386,ExpressionUUID->"83501654-c1f4-4a8a-b177-b98d15f5c419"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifeTime", "[", "ca_List", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", "==", "0"}], ",", " ", 
      RowBox[{"-", "Infinity"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "ca", "]"}], "-", "#"}]}], "]"}], "&"}], "[", 
   RowBox[{"LengthWhile", "[", 
    RowBox[{
     RowBox[{"Reverse", "[", "ca", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943106462055011*^9, 3.943106524282854*^9}, {
  3.943106554858834*^9, 3.943106617417737*^9}, {3.943457965776842*^9, 
  3.943457976864903*^9}, {3.943458102665765*^9, 3.943458104020798*^9}, {
  3.94449110560067*^9, 3.944491144856763*^9}, {3.945289812844039*^9, 
  3.945289814678841*^9}, {3.94552603587239*^9, 3.945526036468112*^9}, {
  3.945544826684551*^9, 3.945544827400023*^9}, {3.946163651177885*^9, 
  3.946163658063177*^9}, {3.94616954251236*^9, 3.946169545469195*^9}},
 CellLabel->"In[302]:=",
 CellID->1409920688,ExpressionUUID->"60d5bb48-9a1e-4a70-a84b-cd7a129709a9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tosingle", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"is_", ",", " ", "j_"}], "}"}], "->", "r_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"#", ",", " ", "j"}], "}"}], "->", "r"}], "&"}], "/@", 
   "is"}]}]], "Code",
 CellChangeTimes->{{3.9459791127972097`*^9, 3.945979130878134*^9}, 
   3.945979184010693*^9},
 CellLabel->"In[303]:=",
 CellID->692532553,ExpressionUUID->"aa52e2ef-57c4-4450-aded-a5a2b68db2c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tofullform", "[", 
   RowBox[{"idxspec_", ",", " ", "t_"}], "]"}], " ", ":=", " ", "\n", " ", 
  RowBox[{
   RowBox[{"Composition", "[", "\n", "   ", 
    RowBox[{
     RowBox[{
      RowBox[{"Catenate", "[", 
       RowBox[{"tosingle", "/@", "#"}], "]"}], "&"}], ",", "\n", "   ", 
     RowBox[{
      RowBox[{"MapAt", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"expandrange", "[", 
          RowBox[{"#", ",", " ", "t", ",", " ", "0"}], "]"}], " ", "&"}], ",",
         " ", "#", ",", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "1", ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", 
            RowBox[{"Length", "[", "#", "]"}]}], "}"}]}], "]"}]}], "]"}], " ",
       "&"}], ",", "\n", "   ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", " ", 
           RowBox[{"MatchQ", "[", 
            RowBox[{"#", ",", " ", "_Rule"}], "]"}]}], ",", " ", 
          RowBox[{"#", " ", "->", " ", "\"\<Random\>\""}], ",", " ", "#"}], 
         "]"}], " ", "&"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", "\n",
      "   ", 
     RowBox[{
      RowBox[{"Replace", "[", 
       RowBox[{"#", ",", " ", 
        RowBox[{
         RowBox[{"Rule", "[", 
          RowBox[{"idxs_", ",", " ", "val_"}], "]"}], " ", ":>", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", " ", "->", " ", "val"}], " ", "&"}], " ", "/@", " ", 
           "idxs"}], ")"}]}]}], "]"}], " ", "&"}], ",", "\n", "   ", 
     RowBox[{
      RowBox[{"Replace", "[", 
       RowBox[{"#", ",", " ", 
        RowBox[{"{", "\n", "      ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ispec_", ",", " ", "jspec_"}], "}"}], " ", "/;", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"ListQ", "[", "ispec", "]"}]}], "&&", 
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"ispec", ",", " ", "_Rule"}], "]"}]}]}], ")"}]}], " ",
            ":>", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"ispec", ",", " ", "jspec"}], "}"}], "}"}]}], ",", "\n", 
          "      ", 
          RowBox[{
           RowBox[{
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ispec_", ",", " ", "jspec_"}], "}"}], ",", " ", 
              "b_"}], "]"}], " ", "/;", " ", 
            RowBox[{"(", 
             RowBox[{"!", " ", 
              RowBox[{"ListQ", "[", "ispec", "]"}]}], ")"}]}], " ", ":>", " ", 
           RowBox[{"(", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ispec", ",", " ", "jspec"}], "}"}], " ", "->", " ", 
              "b"}], "}"}], ")"}]}]}], "\n", "      ", "}"}]}], "]"}], " ", 
      "&"}]}], "]"}], "[", "idxspec", "]"}]}]], "Code",
 CellChangeTimes->{{3.945965335955739*^9, 3.9459655669756603`*^9}, {
   3.9459656057658567`*^9, 3.94596560839567*^9}, {3.945965647649691*^9, 
   3.945965663171432*^9}, {3.945965702593849*^9, 3.945965702837867*^9}, {
   3.945965822319288*^9, 3.945965824032654*^9}, {3.945972586974916*^9, 
   3.945972654020731*^9}, {3.9459731768633432`*^9, 3.945973177766283*^9}, {
   3.945973218383348*^9, 3.945973237312745*^9}, {3.945973316387176*^9, 
   3.945973325049215*^9}, {3.945976032952442*^9, 3.945976039122938*^9}, 
   3.9459762834906893`*^9, {3.945976379060482*^9, 3.945976379757921*^9}, 
   3.9459768536850357`*^9, {3.945977169583667*^9, 3.945977289081301*^9}, {
   3.945977325152865*^9, 3.945977430693564*^9}, {3.945978357565381*^9, 
   3.945978436271504*^9}, {3.9459789686075*^9, 3.945978969969175*^9}, {
   3.9459790342255077`*^9, 3.945979074678514*^9}, {3.945979111564921*^9, 
   3.945979148372497*^9}, {3.945993863172447*^9, 3.945993921521391*^9}, 
   3.945993958448521*^9, 3.945993998827099*^9, {3.946063817849854*^9, 
   3.946063821692799*^9}, {3.9460640999607964`*^9, 3.946064105631814*^9}, {
   3.946064182225891*^9, 3.9460642248235397`*^9}, {3.946072355810805*^9, 
   3.94607235616791*^9}, 3.946168085688933*^9, {3.946168229921286*^9, 
   3.946168231556159*^9}, {3.946168300251487*^9, 3.946168340114693*^9}, {
   3.946181184111516*^9, 3.946181184980519*^9}, 3.946222383991489*^9, {
   3.946222437202747*^9, 3.946222471851318*^9}},
 CellLabel->"In[304]:=",
 CellID->512733297,ExpressionUUID->"4a4cc2a1-e847-4463-8f8c-c33185acd6d8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["High level", "Subsubsection",
 CellChangeTimes->{{3.945564847425189*^9, 3.945564852676676*^9}, {
  3.94621326241999*^9, 
  3.946213262928296*^9}},ExpressionUUID->"1bd5b1e8-f0cc-4125-9b09-\
7d63843f5002"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PerturbAll", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ca_", ",", " ", 
       RowBox[{"{", 
        RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
        "}"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"i_Integer", ",", " ", "j_Integer"}], "}"}], ",", " ", "\n", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<ReturnPerturbations\>\"", " ", "->", " ", "False"}], ",",
         " ", "PerturbedCellularAutomaton"}], "}"}], "]"}]}], "]"}], " ", ":=",
    "  ", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cas", ",", " ", "newbits", ",", " ", "newrows"}], "}"}], ",", 
     "\n", "  ", 
     RowBox[{
      RowBox[{"newbits", " ", "=", " ", 
       RowBox[{"Delete", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"ca", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", "j"}], "]"}], "]"}], " ", "+", " ", 
          "1"}]}], "]"}]}], ";", "\n", "  ", 
      RowBox[{"newrows", " ", "=", " ", 
       RowBox[{"Tuples", "[", 
        RowBox[{"ReplacePart", "[", 
         RowBox[{
          RowBox[{"List", " ", "/@", " ", 
           RowBox[{"ca", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", " ", 
          RowBox[{"j", " ", "->", " ", "newbits"}]}], "]"}], "]"}]}], ";", 
      "\n", "  ", 
      RowBox[{"cas", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"ca", "[", 
            RowBox[{"[", 
             RowBox[{";;", " ", 
              RowBox[{"i", " ", "-", " ", "1"}]}], "]"}], "]"}], ",", " ", 
           RowBox[{"CellularAutomaton", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
             "#", ",", " ", 
             RowBox[{
              RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "i"}]}], 
            "]"}]}], "]"}], " ", "&"}], " ", "/@", " ", "newrows"}]}], ";", 
      "\n", "  ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ReturnPerturbations\>\"", "]"}], ",",
         " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", " ", 
             RowBox[{"<|", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"i", ",", " ", "j"}], "}"}], "->", "#2"}], "|>"}]}], 
            "}"}], "&"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"cas", ",", " ", "newbits"}], "}"}]}], "]"}], ",", " ", 
        "cas"}], "]"}]}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQvcPi58fa1LeOVj8XfgHRl9df+QuiJ2V/ANOdWyYx
1QHpjr4LYJq5ndkCRP9v32ENorM/K7qB6Ht/fcH0weRubxA9q3uGL4je8O1p
MIgOV10eBqJn8nBVguiKLBkwLdcb2FoP0h/1G0wzZnPOAdGT8/kXgOh590WX
gGi7GW2XQHRX77LHIDpgntlLEB12w/s9iN5Xdf8TiJ6xp4OlAUhPWPcBTB8s
mHYCRBvoO58C0Z9q5j/bCaSPfr72HET7zBQt2wWk0wRUwbSVTlU1iN5nurAZ
RNtcv9QNokMi1/eC6BirirkgOrTCeBmI7rpWuAZEO3zzXguiJzjM2Qiij859
thtE6/yrzHoBpP8su5INondfaft2Ng3Iv78eTAMABOvSlA==
  "],
 CellLabel->
  "In[305]:=",ExpressionUUID->"d58fdab0-ea42-4924-a385-218028c56fa3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbedCellularAutomaton", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ReturnPerturbations\>\"", "->", "True"}], ",", " ", 
     RowBox[{"\"\<Body\>\"", "->", "False"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.946223459064588*^9, 3.946223494821115*^9}},
 CellLabel->
  "In[306]:=",ExpressionUUID->"025156d3-4e73-4d0a-a1fe-e6b1332d08e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", 
    RowBox[{"<|", "|>"}], ",", " ", "ops___"}], "]"}], ":=", " ", 
  RowBox[{"CellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", "txspec"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", 
    RowBox[{"{", "}"}], ",", " ", "ops___"}], "]"}], ":=", " ", 
  RowBox[{"CellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", "txspec"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "PerturbedCellularAutomaton", "]"}]}]}], 
   "]"}], ":=", " ", "\n", "  ", 
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{
   "ru", ",", " ", "init", ",", " ", "txspec", ",", " ", "1", ",", " ", 
    "ops"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{
   "ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", "idxspec_Integer",
     ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", "  ", 
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", "txspec", ",", " ", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"RandomChoice", "[", 
         RowBox[{"#", ",", " ", "idxspec"}], "]"}], " ", "&"}], ",", " ", 
       "RandomChoice"}], "}"}], "}"}], ",", " ", "\n", "  ", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Normal", "[", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Body\>\"", "->", "True"}], "}"}], ",", " ", "ops"}], 
         "}"}], ",", " ", "Last"}], "]"}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", 
    RowBox[{"idxspec_Integer", "->", "b_"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", "  ", 
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", "init", ",", " ", "txspec", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"RandomChoice", "[", 
          RowBox[{"#", ",", " ", "idxspec"}], "]"}], " ", "&"}], ",", " ", 
        "RandomChoice"}], "}"}], " ", "->", " ", "b"}], "}"}], ",", " ", "\n",
     "  ", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Normal", "[", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Body\>\"", "->", "True"}], "}"}], ",", " ", "ops"}], 
         "}"}], ",", " ", "Last"}], "]"}], "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.9460718415956*^9, 3.946071843851215*^9}, {
  3.946071889185918*^9, 3.946071919898172*^9}, {3.946071954501865*^9, 
  3.946072156947014*^9}, {3.9460722495226088`*^9, 3.946072249961039*^9}, {
  3.946072285576694*^9, 3.946072316675511*^9}, {3.946072615862463*^9, 
  3.946072629834423*^9}, {3.946179558379966*^9, 3.946179569063106*^9}, {
  3.946179749995074*^9, 3.9461798128932953`*^9}, {3.946180482502071*^9, 
  3.946180521974565*^9}, {3.946394081302047*^9, 3.946394088299378*^9}},
 CellLabel->"In[307]:=",
 CellID->171383505,ExpressionUUID->"bbaa5d85-f19b-4a78-9106-d91216c142e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbedCellularAutomaton", "[", 
   RowBox[{"ru_", ",", 
    RowBox[{"init_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}], ",", " ", 
    RowBox[{"txspec_", ":", 
     RowBox[{"{", 
      RowBox[{"10", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "25"}], ",", " ", "25"}], "}"}]}], "}"}]}], ",", " ", 
    RowBox[{"idxspec_", ":", "1"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "PerturbedCellularAutomaton", "]"}]}], 
   "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ca", ",", " ", "k", ",", " ", "tmax", ",", " ", "trange", ",", " ", 
      "xspec", ",", " ", "tpert", ",", " ", "fullidxs", ",", " ", "pre", ",", 
      " ", "ts", ",", " ", "indexfunc", ",", " ", "evoca", ",", " ", "row", 
      ",", " ", "rowidxs", ",", " ", "rowinrange", ",", " ", "caperts", ",", 
      " ", "pca"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"k", " ", "=", " ", 
      RowBox[{
       RowBox[{"interpretrule", "[", "ru", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmax", ",", " ", "trange", ",", " ", "xspec"}], "}"}], " ", 
      "=", " ", 
      RowBox[{"interprettxspec", "[", "txspec", "]"}]}], ";", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"tpert", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Body\>\"", "]"}], ",", 
        RowBox[{
         RowBox[{"ca", " ", "=", " ", 
          RowBox[{"CellularAutomaton", "[", 
           RowBox[{"ru", ",", " ", "init", ",", " ", 
            RowBox[{"{", 
             RowBox[{"tmax", ",", " ", "xspec"}], "}"}]}], "]"}]}], ";", " ", 
         "\n", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#", " ", "==", " ", 
              RowBox[{"-", "Infinity"}]}], ",", " ", 
             RowBox[{
              RowBox[{"Length", "[", "ca", "]"}], "-", "1"}], ",", " ", "#"}],
             "]"}], "&"}], "[", 
          RowBox[{
           RowBox[{"TestCALifeTime", "[", "ca", "]"}], "-", "1"}], "]"}]}], 
        ",", " ", "tmax"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullidxs", " ", "=", " ", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"tofullform", "[", 
         RowBox[{
          RowBox[{"Normal", "[", "idxspec", "]"}], ",", " ", "tpert"}], "]"}],
         ",", " ", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pre", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Body\>\"", "]"}], ",", " ", 
        RowBox[{"ca", "[", 
         RowBox[{"[", 
          RowBox[{";;", 
           RowBox[{
            RowBox[{"fullidxs", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}], "+", 
            "1"}]}], "]"}], "]"}], ",", 
        RowBox[{"CellularAutomaton", "[", 
         RowBox[{"ru", ",", " ", "init", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"fullidxs", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}], ",", 
            " ", "xspec"}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ts", " ", "=", " ", 
      RowBox[{"Differences", "[", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"fullidxs", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}], ",", 
         "  ", 
         RowBox[{"tmax", " ", "+", " ", "1"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"indexfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Body\>\"", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#", " ", "==", " ", 
              RowBox[{"{", "}"}]}], ",", " ", 
             RowBox[{"{", "}"}], ",", " ", 
             RowBox[{"Range", "@@", "#"}]}], "]"}], "&"}], "[", 
          RowBox[{"nonzeroRange", "[", "#", "]"}], "]"}], "&"}], ",", " ", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evoca", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"preca_", ",", " ", "prepert_"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1_", ",", " ", "j1_"}], "}"}], "->", "bitfunc_"}], ",", 
          "tcurr_"}], "}"}]}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"row", " ", "=", " ", 
          RowBox[{"Last", "[", "preca", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rowidxs", " ", "=", " ", 
          RowBox[{"indexfunc", "[", "row", "]"}]}], ";", "\n", 
         RowBox[{"expanded", " ", "=", " ", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"expandrange", "[", 
             RowBox[{"j1", ",", " ", 
              RowBox[{"Length", "[", "rowidxs", "]"}]}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"#", "<=", " ", 
              RowBox[{"Length", "[", "rowidxs", "]"}]}], "&"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"rowinrange", " ", "=", " ", 
          RowBox[{"rowidxs", "[", 
           RowBox[{"[", "expanded", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"CellularAutomaton", "[", 
            RowBox[{"ru", ",", " ", 
             RowBox[{"replaced", " ", "=", " ", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"row", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "->", 
                   RowBox[{
                    RowBox[{"tofunc", "[", 
                    RowBox[{"bitfunc", ",", " ", "k"}], "]"}], "[", 
                    RowBox[{"row", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "]"}]}], "&"}], "/@", 
                 "rowinrange"}]}], "]"}]}], ",", "tcurr"}], "]"}], ",", "\n", 
           
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{"i1", ",", "rowinrange"}], "}"}], "]"}], "->", " ", 
             RowBox[{"replaced", "[", 
              RowBox[{"[", "rowinrange", "]"}], "]"}]}], "]"}]}], "}"}]}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"caperts", " ", "=", " ", 
      RowBox[{"FoldList", "[", 
       RowBox[{"evoca", ",", " ", 
        RowBox[{"{", 
         RowBox[{"pre", ",", " ", 
          RowBox[{"{", "}"}]}], "}"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"fullidxs", ",", " ", "ts"}], "}"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pca", " ", "=", " ", 
      RowBox[{"Join", "@@", 
       RowBox[{"(", 
        RowBox[{"Most", "/@", 
         RowBox[{"caperts", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<ReturnPerturbations\>\"", "]"}], ",", 
       
       RowBox[{"{", 
        RowBox[{
         RowBox[{"pca", "[", 
          RowBox[{"[", "trange", "]"}], "]"}], ",", "  ", 
         RowBox[{"Association", "[", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"caperts", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"2", ";;"}], ",", " ", "2"}], "]"}], "]"}], ",", " ", 
            "_Rule", ",", " ", "2"}], "]"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", " ", 
       RowBox[{"pca", "[", 
        RowBox[{"[", "trange", "]"}], "]"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945564854387958*^9, 3.9455649209907303`*^9}, {
   3.945565064662647*^9, 3.945565092077922*^9}, {3.945565142190632*^9, 
   3.9455651934105377`*^9}, {3.945565389808919*^9, 3.945565426351673*^9}, 
   3.945565597663636*^9, 3.94556586297538*^9, {3.945565939005967*^9, 
   3.94556594304769*^9}, {3.945566001035863*^9, 3.945566003168552*^9}, {
   3.945566101093194*^9, 3.9455661099710617`*^9}, {3.945566232209316*^9, 
   3.9455662353172607`*^9}, {3.945566363850244*^9, 3.945566472518067*^9}, {
   3.9455665195085993`*^9, 3.945566521794959*^9}, {3.945566567466765*^9, 
   3.945566664530416*^9}, {3.945566695313137*^9, 3.945566722911668*^9}, {
   3.945566773151082*^9, 3.945566859576585*^9}, {3.9455669089646053`*^9, 
   3.945566993166974*^9}, {3.945567055301301*^9, 3.945567161944401*^9}, {
   3.945567213307018*^9, 3.945567266570752*^9}, {3.945567304547831*^9, 
   3.9455673649582043`*^9}, {3.945567436501055*^9, 3.945567677884582*^9}, {
   3.945567899991283*^9, 3.9455679730604267`*^9}, {3.945568242529466*^9, 
   3.945568252218586*^9}, {3.9455684446031027`*^9, 3.945568446154142*^9}, {
   3.945568629378972*^9, 3.945568653303083*^9}, {3.9455686993915577`*^9, 
   3.945568758128219*^9}, {3.945568915252228*^9, 3.945568916557683*^9}, {
   3.945569035914846*^9, 3.945569040243853*^9}, {3.945569095352459*^9, 
   3.945569096948833*^9}, {3.945569188120613*^9, 3.945569209793717*^9}, {
   3.945569260338842*^9, 3.945569270002475*^9}, {3.945569344891751*^9, 
   3.945569346086515*^9}, 3.945569378689702*^9, {3.945569548422887*^9, 
   3.945569574832016*^9}, {3.945569644942238*^9, 3.945569649843801*^9}, {
   3.9456108922004843`*^9, 3.945610913775126*^9}, {3.945611373326125*^9, 
   3.945611538139295*^9}, {3.94561161049885*^9, 3.945611643117488*^9}, {
   3.945611720538444*^9, 3.945611753931011*^9}, {3.945613414282668*^9, 
   3.945613414481608*^9}, {3.945617343247187*^9, 3.945617343505967*^9}, {
   3.945618750798959*^9, 3.9456187913806047`*^9}, {3.94561882501226*^9, 
   3.945618865864017*^9}, {3.945620113403321*^9, 3.94562011374802*^9}, {
   3.945620252658791*^9, 3.945620255651802*^9}, 3.945620358590395*^9, {
   3.945626762854234*^9, 3.945626769516276*^9}, {3.9456268187302322`*^9, 
   3.945626822135152*^9}, {3.9456295319236183`*^9, 3.9456295791661873`*^9}, {
   3.945629734988823*^9, 3.9456298012983522`*^9}, {3.945629838829083*^9, 
   3.945629842055011*^9}, {3.945629929150675*^9, 3.9456299501143417`*^9}, {
   3.945630319824434*^9, 3.945630321925333*^9}, {3.945630476006742*^9, 
   3.9456304917199907`*^9}, {3.9456308540541*^9, 3.945630854724384*^9}, {
   3.9456331811094522`*^9, 3.945633271754642*^9}, 3.945634364158344*^9, {
   3.945634410179576*^9, 3.94563444150272*^9}, {3.945635058803431*^9, 
   3.9456351026467113`*^9}, {3.945636023224997*^9, 3.945636051778284*^9}, {
   3.945636123574259*^9, 3.9456361259043922`*^9}, {3.945636168185083*^9, 
   3.945636171932963*^9}, {3.945636699505157*^9, 3.945636858055952*^9}, {
   3.945636907338262*^9, 3.945636933832975*^9}, {3.945637003244535*^9, 
   3.945637005942765*^9}, {3.945637072835722*^9, 3.945637360312528*^9}, {
   3.945637431243556*^9, 3.945637557528727*^9}, {3.945637626606348*^9, 
   3.94563762930323*^9}, {3.94563766570674*^9, 3.945637780655936*^9}, {
   3.945637824876812*^9, 3.945637886456723*^9}, {3.945638718256763*^9, 
   3.945638719063764*^9}, {3.94564032555943*^9, 3.945640426559726*^9}, {
   3.94564062106589*^9, 3.945640642306943*^9}, {3.945640680110565*^9, 
   3.945640720716984*^9}, {3.945640754253708*^9, 3.945640768034375*^9}, {
   3.945640831055541*^9, 3.9456408360851107`*^9}, 3.945641016006737*^9, {
   3.945641252942339*^9, 3.945641263279813*^9}, {3.945641324650139*^9, 
   3.945641347254607*^9}, 3.945641641277536*^9, {3.945641734055994*^9, 
   3.945641735883544*^9}, {3.945641788145612*^9, 3.945641802875277*^9}, {
   3.945641876850329*^9, 3.94564187775984*^9}, {3.945641953092898*^9, 
   3.9456420237899523`*^9}, {3.945642267009985*^9, 3.945642268378473*^9}, {
   3.945642315005647*^9, 3.9456424772070923`*^9}, {3.94564251351525*^9, 
   3.945642529914897*^9}, 3.945642609516411*^9, {3.945642821848054*^9, 
   3.945642832943038*^9}, {3.945642905563719*^9, 3.945643000782466*^9}, {
   3.945643064875382*^9, 3.945643082355438*^9}, {3.945643199510627*^9, 
   3.945643208074139*^9}, 3.94564328519401*^9, {3.945643407290581*^9, 
   3.945643423613723*^9}, {3.945643464784686*^9, 3.945643508130039*^9}, {
   3.945643586638302*^9, 3.945643591591855*^9}, 3.945643720400498*^9, {
   3.945644091395174*^9, 3.945644095043854*^9}, 3.945644275308377*^9, 
   3.9456444417133713`*^9, {3.9456445993664627`*^9, 3.945644627204362*^9}, {
   3.9456447299845963`*^9, 3.945644733767869*^9}, {3.945644885314126*^9, 
   3.945644885810425*^9}, {3.945644937415226*^9, 3.945644959801022*^9}, {
   3.945645037027165*^9, 3.945645048693818*^9}, {3.945645079561424*^9, 
   3.945645080177339*^9}, {3.9456451471213913`*^9, 3.945645172544615*^9}, {
   3.945645223409771*^9, 3.94564522648722*^9}, {3.945645356676486*^9, 
   3.9456453572214746`*^9}, {3.945645484133642*^9, 3.945645545749918*^9}, {
   3.945645590909075*^9, 3.945645708667966*^9}, 3.9456457420965843`*^9, {
   3.945646237287916*^9, 3.945646244935281*^9}, {3.945646356522284*^9, 
   3.945646358354308*^9}, 3.945653718135929*^9, 3.945656237858609*^9, {
   3.945660329826086*^9, 3.9456603302658567`*^9}, {3.9458878816484013`*^9, 
   3.945887882050497*^9}, {3.945887950750848*^9, 3.945887955542006*^9}, {
   3.945899470360111*^9, 3.945899470889515*^9}, {3.945899501639595*^9, 
   3.945899519117752*^9}, {3.945899652866143*^9, 3.945899671447626*^9}, 
   3.945899728958289*^9, {3.945899921397027*^9, 3.94589993321021*^9}, {
   3.945900183684778*^9, 3.945900222287728*^9}, 3.945901231389453*^9, {
   3.94590128264411*^9, 3.945901284409274*^9}, {3.945910289433428*^9, 
   3.945910347571181*^9}, {3.945949932474243*^9, 3.945950001400909*^9}, {
   3.945951702053653*^9, 3.945951721633325*^9}, {3.945954275658063*^9, 
   3.945954360256893*^9}, {3.9459544012900248`*^9, 3.945954419356032*^9}, {
   3.945954480119594*^9, 3.945954504725897*^9}, {3.945954611983808*^9, 
   3.945954700009926*^9}, {3.94595483055954*^9, 3.945954860291252*^9}, {
   3.945954915063428*^9, 3.9459549250425034`*^9}, {3.945954977982039*^9, 
   3.9459549813618593`*^9}, {3.9459551434760723`*^9, 3.945955181719782*^9}, {
   3.945955260255157*^9, 3.945955283001497*^9}, {3.945978591349657*^9, 
   3.945978624293531*^9}, {3.945979309484518*^9, 3.945979319017934*^9}, {
   3.945979365517386*^9, 3.945979399047859*^9}, {3.945979433554727*^9, 
   3.945979438920322*^9}, {3.945979909976758*^9, 3.945979912136489*^9}, {
   3.945980024086074*^9, 3.945980058816512*^9}, {3.945980090484645*^9, 
   3.945980223250351*^9}, {3.945980288817212*^9, 3.945980389160634*^9}, {
   3.945980424327888*^9, 3.945980455184745*^9}, {3.945980501047874*^9, 
   3.945980572407316*^9}, {3.9459806171296463`*^9, 3.945980658233486*^9}, {
   3.945980777981628*^9, 3.945980877565237*^9}, {3.945980920651031*^9, 
   3.945980994785961*^9}, {3.945981027535656*^9, 3.945981043516881*^9}, {
   3.945981154084898*^9, 3.94598128009009*^9}, {3.945981493331264*^9, 
   3.945981493973534*^9}, {3.945981582246415*^9, 3.945981650450899*^9}, {
   3.945981706719965*^9, 3.945981751227412*^9}, {3.94598179541354*^9, 
   3.945981803231414*^9}, {3.945981849777975*^9, 3.945981872791196*^9}, {
   3.945981935688718*^9, 3.945981936352383*^9}, {3.945982094937886*^9, 
   3.945982135039751*^9}, {3.9459825225806847`*^9, 3.945982533457672*^9}, {
   3.945982570153918*^9, 3.945982605198462*^9}, {3.94598289110137*^9, 
   3.945982891624757*^9}, {3.9459829523098507`*^9, 3.945982955172619*^9}, {
   3.945983121217964*^9, 3.945983122581058*^9}, {3.94598408659284*^9, 
   3.945984108271386*^9}, {3.94598419142025*^9, 3.945984229952263*^9}, {
   3.945984264670665*^9, 3.945984279035056*^9}, {3.9459845113292*^9, 
   3.945984607918695*^9}, {3.945984702871541*^9, 3.9459847316802*^9}, {
   3.945991246075955*^9, 3.945991279681704*^9}, {3.945991332203476*^9, 
   3.945991380393558*^9}, {3.945993003310892*^9, 3.945993017640567*^9}, 
   3.945993113662118*^9, {3.94599315446382*^9, 3.945993155400598*^9}, {
   3.945993277973955*^9, 3.945993279702696*^9}, {3.945993342398526*^9, 
   3.945993388863004*^9}, {3.9459934645242767`*^9, 3.945993516980267*^9}, {
   3.945993591597203*^9, 3.945993604647334*^9}, {3.945993657735557*^9, 
   3.945993658916209*^9}, {3.94599380987108*^9, 3.945993829246912*^9}, {
   3.945994105630556*^9, 3.945994154159828*^9}, {3.945994419094791*^9, 
   3.9459944246890593`*^9}, {3.945994545648909*^9, 3.945994548589602*^9}, {
   3.945994677148686*^9, 3.945994678226427*^9}, {3.9459953377047863`*^9, 
   3.9459953382927*^9}, {3.945995590920783*^9, 3.945995591546712*^9}, {
   3.945995664461948*^9, 3.945995698197419*^9}, {3.945995916906798*^9, 
   3.945995917269504*^9}, {3.945996083114585*^9, 3.945996084725947*^9}, {
   3.945996318039239*^9, 3.945996320316819*^9}, {3.946033981113184*^9, 
   3.946033981520111*^9}, {3.946034104080377*^9, 3.946034146597061*^9}, {
   3.946034180795663*^9, 3.946034191043227*^9}, {3.946064251436506*^9, 
   3.946064252755916*^9}, {3.946064432740367*^9, 3.946064434627742*^9}, {
   3.946064760367833*^9, 3.946064837463447*^9}, {3.946066382704019*^9, 
   3.946066383731625*^9}, {3.94606644931458*^9, 3.946066451927668*^9}, {
   3.946066488330406*^9, 3.946066490212941*^9}, {3.946071467163835*^9, 
   3.946071479312889*^9}, {3.946134693389347*^9, 3.946134714413784*^9}, {
   3.946152734532546*^9, 3.946152757020159*^9}, {3.946155723096078*^9, 
   3.946155765042006*^9}, {3.946155874493668*^9, 3.946155926285573*^9}, {
   3.946156126333436*^9, 3.946156134099635*^9}, {3.946156169388645*^9, 
   3.946156200213213*^9}, 3.946156479482671*^9, {3.946156745100921*^9, 
   3.946156749717506*^9}, {3.946157124418914*^9, 3.946157127769731*^9}, {
   3.9461610609015436`*^9, 3.946161061172872*^9}, {3.9461616078337507`*^9, 
   3.946161615855894*^9}, {3.946162161119635*^9, 3.946162162976255*^9}, {
   3.946162789914358*^9, 3.946162791773041*^9}, {3.946163361128784*^9, 
   3.946163361280663*^9}, {3.9461635189245443`*^9, 3.946163519343185*^9}, {
   3.946163679620331*^9, 3.946163695298393*^9}, {3.946163802961725*^9, 
   3.946163803547845*^9}, {3.946164014759865*^9, 3.946164025089123*^9}, {
   3.946164866180666*^9, 3.946164867589972*^9}, {3.946164901752612*^9, 
   3.946164915707404*^9}, {3.946164955922978*^9, 3.9461649581157084`*^9}, {
   3.94616499938936*^9, 3.946165000200625*^9}, {3.946165080203477*^9, 
   3.946165084261224*^9}, {3.946169597318919*^9, 3.94616965367192*^9}, {
   3.946175930944998*^9, 3.9461759429990053`*^9}, 3.946178973052822*^9, {
   3.94617901772355*^9, 3.946179046884939*^9}, {3.946179489788151*^9, 
   3.946179492359894*^9}, {3.946179725784432*^9, 3.946179727766074*^9}, {
   3.946180608140894*^9, 3.946180647141325*^9}, {3.946181104546417*^9, 
   3.946181110323604*^9}, {3.946183980882976*^9, 3.946183997346745*^9}, {
   3.946184156553396*^9, 3.946184158491613*^9}, {3.946184200882712*^9, 
   3.946184248949012*^9}, {3.94622251312263*^9, 3.946222576561921*^9}, {
   3.946504668522339*^9, 3.946504697825506*^9}, {3.946566380090914*^9, 
   3.946566383777483*^9}, {3.946566453989181*^9, 3.946566464262829*^9}, 
   3.946575207808757*^9},
 CellLabel->"In[312]:=",
 CellID->1222021125,ExpressionUUID->"a8e0db7b-b97f-448c-b184-05bde6a0546b"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysis Functions", "Section",
 CellChangeTimes->{{3.943103306870668*^9, 
  3.943103310441294*^9}},ExpressionUUID->"c0def580-a913-4d5e-a53d-\
54a25ec47976"],

Cell[CellGroupData[{

Cell["PerturbationSensitivities", "Subsection",
 CellChangeTimes->{{3.945540252407796*^9, 3.945540267419267*^9}, {
  3.9455447868155212`*^9, 3.945544787091506*^9}, {3.945659926108226*^9, 
  3.945659931398574*^9}},ExpressionUUID->"50d9c160-8288-4bb0-9e5b-\
2b84d07f431b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"absdeltalt", "[", 
   RowBox[{"ca_", ",", " ", "pca_"}], "]"}], ":=", " ", 
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"TestCALifeTime", "[", "pca", "]"}], " ", "-", " ", 
    RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.94449081794423*^9, 3.9444909094177628`*^9}, {
  3.944490959322697*^9, 3.944490993340799*^9}, {3.94449106774311*^9, 
  3.944491076349791*^9}, {3.944491170777509*^9, 3.9444912813137217`*^9}, {
  3.944491363048721*^9, 3.944491366658052*^9}, {3.9444923081545258`*^9, 
  3.944492345557996*^9}, {3.9444926213548927`*^9, 3.944492621477656*^9}, {
  3.944493742156652*^9, 3.944493743773632*^9}, {3.94450727168178*^9, 
  3.944507277086361*^9}, {3.944507341580439*^9, 3.944507368077084*^9}, {
  3.94450746055916*^9, 3.9445074636883783`*^9}, {3.944507732861686*^9, 
  3.944507753281385*^9}, {3.944759752554522*^9, 3.944759793343004*^9}, {
  3.945540561309663*^9, 3.9455405972853813`*^9}},
 CellLabel->
  "In[313]:=",ExpressionUUID->"0b23d3e2-0338-4e49-8bb1-477458e606df"],

Cell[BoxData[
 RowBox[{
  RowBox[{"maxdeltalt", "[", 
   RowBox[{"ca_", ",", " ", "pcas_"}], "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"absdeltalt", "[", 
      RowBox[{"ca", ",", " ", "#"}], "]"}], "&"}], "/@", " ", "pcas"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945544516921167*^9, 3.945544535754789*^9}},
 CellLabel->
  "In[314]:=",ExpressionUUID->"9bd0d211-f111-4848-bb4f-5dc8732b5d6e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"absdeltanorm", "[", 
   RowBox[{"ca_", ",", " ", "sense_"}], "]"}], ":=", " ", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"sense", " ", "==", " ", 
     RowBox[{"-", "Infinity"}]}], ",", " ", "1", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"sense", " ", "==", " ", "0"}], ",", " ", 
      RowBox[{"-", "1"}], ",", " ", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"lt", " ", "=", 
          RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], "}"}], ",", "  ", 
        RowBox[{"sense", " ", "/", " ", 
         RowBox[{"Max", "[", 
          RowBox[{"lt", ",", " ", 
           RowBox[{
            RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "lt"}]}], 
          "]"}]}]}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945540987419342*^9, 3.9455410355027943`*^9}, {
  3.94554108656793*^9, 3.945541193539502*^9}, {3.945541239785759*^9, 
  3.9455412505284*^9}},
 CellLabel->
  "In[315]:=",ExpressionUUID->"b2510a1a-df91-45cd-904f-a22e4094597b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbationSensitivities", "]"}], " ", "=", " ", 
   
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Steps\>\"", "->", "200"}], ",", " ", 
     RowBox[{"\"\<SensitivityFunction\>\"", "->", "absdeltalt"}], ",", " ", 
     RowBox[{"\"\<IndexFunction\>\"", "->", "bodyidxs"}], ",", " ", "\n", 
     RowBox[{
     "\"\<PerturbationFunction\>\"", "->", "PerturbedCellularAutomaton"}], 
     ",", " ", 
     RowBox[{"\"\<BitFunction\>\"", "->", "\"\<Random\>\""}], ",", " ", 
     RowBox[{"\"\<InitialPerturbation\>\"", "->", "None"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbationSensitivities", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", "\n", 
    RowBox[{"OptionsPattern", "[", "PerturbationSensitivities", "]"}]}], 
   "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<InitialPerturbation\>\"", "]"}], 
         " ", "===", " ", "None"}], ",", " ", 
        RowBox[{"getca", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Steps\>\"", "]"}]}], "]"}], ",", 
        " ", "\n", 
        RowBox[{"PerturbedCellularAutomaton", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<InitialPerturbation\>\"", "]"}], 
          ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Steps\>\"", "]"}]}], "]"}]}], 
       "]"}]}], "}"}], ",", "\n", 
    RowBox[{"AssociationMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<SensitivityFunction\>\"", "]"}], "[", 
        RowBox[{"ca", ",", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<PerturbationFunction\>\"", "]"}], 
          "[", "\n", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", 
             RowBox[{"{", 
              RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], "}"}], 
           ",", " ", "#", ",", " ", 
           RowBox[{"\"\<BitFunction\>\"", "->", 
            RowBox[{"OptionValue", "[", "\"\<BitFunction\>\"", "]"}]}], ",", 
           " ", 
           RowBox[{"\"\<Body\>\"", "->", "False"}], ",", " ", 
           RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}]}], "]"}]}], 
        "]"}], "&"}], ",", " ", "\n", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<IndexFunction\>\"", "]"}], "[", 
         "ca", "]"}], ",", " ", "1"}], "]"}]}], "]"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487237621695*^9, 3.9444872744506893`*^9}, {
   3.944487375767552*^9, 3.944487380970046*^9}, {3.944490432127099*^9, 
   3.94449051359888*^9}, {3.94449059426232*^9, 3.9444905952149887`*^9}, {
   3.944490634237767*^9, 3.94449068604597*^9}, {3.9444908596183853`*^9, 
   3.944490859990075*^9}, {3.944491887938538*^9, 3.9444918895325212`*^9}, 
   3.944492070172682*^9, {3.944492875221411*^9, 3.944492883040357*^9}, {
   3.944493032971727*^9, 3.9444930365891867`*^9}, {3.944493081901815*^9, 
   3.944493082908987*^9}, {3.944506683516601*^9, 3.9445066848150873`*^9}, {
   3.944507424435897*^9, 3.944507484003048*^9}, {3.944507763271254*^9, 
   3.944507770322781*^9}, 3.944511707317666*^9, {3.944512046217747*^9, 
   3.944512052374105*^9}, {3.944759437364381*^9, 3.944759474250016*^9}, {
   3.9447597142051687`*^9, 3.944759715368204*^9}, {3.944760396736481*^9, 
   3.944760401740182*^9}, {3.944768110953274*^9, 3.944768144015161*^9}, {
   3.944768196796276*^9, 3.94476820794529*^9}, {3.944768652340193*^9, 
   3.944768653383917*^9}, {3.9455307042596493`*^9, 3.945530721970703*^9}, {
   3.945530752299985*^9, 3.945530765651554*^9}, {3.9455333329651*^9, 
   3.945533344969485*^9}, {3.945533695155109*^9, 3.945533766503653*^9}, {
   3.945533813725759*^9, 3.9455339334465647`*^9}, {3.945539400082763*^9, 
   3.945539410812356*^9}, {3.945539684776298*^9, 3.945539785637553*^9}, {
   3.9455407385754232`*^9, 3.945540762072873*^9}, 3.945541780295742*^9, {
   3.945547155464478*^9, 3.9455473159312077`*^9}, {3.945609255725046*^9, 
   3.945609269073526*^9}, {3.9456480281994553`*^9, 3.945648048424395*^9}, {
   3.945648089143779*^9, 3.94564811158888*^9}, {3.945648157380201*^9, 
   3.945648162630842*^9}, {3.945648285033061*^9, 3.945648286285751*^9}, {
   3.945648472081294*^9, 3.945648475653928*^9}, {3.94564886738975*^9, 
   3.945648874112725*^9}, 3.94564971311404*^9, {3.945650324906981*^9, 
   3.945650325643325*^9}, {3.946213401892294*^9, 3.946213410634062*^9}},
 CellLabel->
  "In[316]:=",ExpressionUUID->"ed8fa20c-135e-4bb7-9658-cc5b070ea7cb"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PerturbationSensitivityPlot"}]], "Input",
 CellChangeTimes->{{3.945531629194338*^9, 3.945531647271728*^9}, {
  3.945544188146636*^9, 3.94554418969355*^9}, {3.945650065464342*^9, 
  3.945650069065601*^9}},
 CellLabel->
  "In[512]:=",ExpressionUUID->"d8bb5dd4-ea88-4998-8752-f08502cdf390"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotSensitivities", "]"}], " ", "=", " ", 
   RowBox[{"{", "\n", 
    RowBox[{
     RowBox[{"ColorFunction", "->", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "==", 
           RowBox[{"-", "1"}]}], ",", "Gray", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#", "==", "1"}], ",", 
            RowBox[{"Darker", "[", "Red", "]"}], ",", 
            RowBox[{"Blend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"LightBlue", ",", "Blue"}], "}"}], ",", " ", "#"}], 
             "]"}]}], "]"}]}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"\"\<NormalizationFunction\>\"", "->", "absdeltanorm"}], ",", 
     "\n", 
     RowBox[{"\"\<BackgroundColor\>\"", "->", "White"}], ",", " ", 
     RowBox[{"\"\<Steps\>\"", "->", "200"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotSensitivities", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", "sensitivities_Association", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", "allops", ",", " ", "idxs", ",", " ", "calts"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PlotSensitivities", "]"}], ",", "ops"}], 
         "}"}], ",", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"normalized", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"absdeltanorm", "[", 
         RowBox[{"ca", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
       "sensitivities"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"replaced", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ca", ",", 
        RowBox[{"Normal", "[", "normalized", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotCA", "[", 
      RowBox[{
       RowBox[{"replaced", "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"allops", "[", "\"\<Steps\>\"", "]"}]}], "]"}], "]"}], ",", 
       " ", "\n", 
       RowBox[{"ColorFunctionScaling", "->", "False"}], ",", "\n", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "->", 
           RowBox[{
            RowBox[{"allops", "[", "ColorFunction", "]"}], "[", "0", "]"}]}], 
          ",", " ", 
          RowBox[{"0", "->", 
           RowBox[{"allops", "[", "\"\<BackgroundColor\>\"", "]"}]}]}], 
         "}"}]}], ",", " ", "\n", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487237621695*^9, 3.9444872744506893`*^9}, {
   3.944487375767552*^9, 3.944487380970046*^9}, {3.944490432127099*^9, 
   3.94449051359888*^9}, {3.94449059426232*^9, 3.9444905952149887`*^9}, {
   3.944490634237767*^9, 3.94449068604597*^9}, {3.9444908596183853`*^9, 
   3.944490859990075*^9}, {3.944491887938538*^9, 3.9444918895325212`*^9}, 
   3.944492070172682*^9, {3.944492875221411*^9, 3.944492883040357*^9}, {
   3.944493942089341*^9, 3.944494007317971*^9}, {3.944494038237578*^9, 
   3.944494040048719*^9}, {3.944512093176009*^9, 3.944512108084495*^9}, {
   3.944512729671383*^9, 3.944512732767447*^9}, {3.944512930408449*^9, 
   3.944512931286265*^9}, {3.944513040124568*^9, 3.944513040278975*^9}, {
   3.944767498636023*^9, 3.944767504711857*^9}, {3.944768402829117*^9, 
   3.9447684100913143`*^9}, {3.944768518764978*^9, 3.9447685264411297`*^9}, 
   3.9451073768192997`*^9, {3.9455408344771957`*^9, 3.945540898123932*^9}, {
   3.945540938659734*^9, 3.945540953963854*^9}, {3.945541233091652*^9, 
   3.945541255389922*^9}, {3.945541286705964*^9, 3.945541354404351*^9}, {
   3.945541956256894*^9, 3.945542060514563*^9}, 3.945542326696133*^9, {
   3.945544177779934*^9, 3.945544183677325*^9}, {3.945544228294546*^9, 
   3.945544229823065*^9}, 3.945544318756554*^9, 3.945544466439392*^9, {
   3.945544751920841*^9, 3.94554475933426*^9}, {3.945666823794183*^9, 
   3.945666855000097*^9}, {3.946502123941042*^9, 3.946502124922147*^9}},
 CellLabel->
  "In[318]:=",ExpressionUUID->"3b50bac8-1bb5-436c-957e-bb81d052d4da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbationSensitivityPlot", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "allops", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PerturbationSensitivities", "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"PlotSensitivities", "[", 
      RowBox[{"ru", ",", " ", 
       RowBox[{"PerturbationSensitivities", "[", 
        RowBox[{"ru", ",", "\n", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
            RowBox[{"Options", "[", "PerturbationSensitivities", "]"}]}], 
           "]"}]}]}], "]"}], ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487234449445*^9, 3.944487249741836*^9}, {
   3.944487289642845*^9, 3.94448733463884*^9}, {3.944487624595282*^9, 
   3.944487648149055*^9}, {3.944488738735078*^9, 3.944488757916947*^9}, {
   3.9444899596631527`*^9, 3.9444899855434837`*^9}, {3.944490417629325*^9, 
   3.944490418853786*^9}, {3.944490622862787*^9, 3.944490626143667*^9}, {
   3.9444906958000917`*^9, 3.944490718187745*^9}, {3.944491899797738*^9, 
   3.944491901578408*^9}, {3.944494456563126*^9, 3.9444944633900414`*^9}, {
   3.944494619554298*^9, 3.944494664681058*^9}, {3.94449471551963*^9, 
   3.944494730231015*^9}, {3.944494768338414*^9, 3.944494786811378*^9}, {
   3.944494834981859*^9, 3.944494836775361*^9}, {3.944494871342134*^9, 
   3.944494918851764*^9}, {3.944494957815713*^9, 3.944494961981246*^9}, {
   3.94449500405479*^9, 3.944495049459453*^9}, {3.944495095288765*^9, 
   3.944495140999696*^9}, {3.944495190270718*^9, 3.944495193097069*^9}, {
   3.94449524973536*^9, 3.944495259911443*^9}, {3.944495294077693*^9, 
   3.944495437419049*^9}, {3.94451211763026*^9, 3.944512128622864*^9}, {
   3.9445127868558702`*^9, 3.944512789833928*^9}, {3.944512940746048*^9, 
   3.944512941625601*^9}, {3.944513037738683*^9, 3.944513037949251*^9}, {
   3.94475964861346*^9, 3.944759660912164*^9}, {3.944760377493174*^9, 
   3.944760381453443*^9}, 3.944766223627833*^9, {3.945531580843669*^9, 
   3.945531587683104*^9}, {3.945541523813892*^9, 3.945541583730515*^9}, {
   3.945650045070356*^9, 3.945650045159443*^9}, {3.945666420923435*^9, 
   3.94566642400524*^9}, {3.945666484682631*^9, 3.94566648503578*^9}},
 CellLabel->
  "In[320]:=",ExpressionUUID->"96fd15f1-3639-4ccc-98ca-b22def45415c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other", "Subsection",
 CellChangeTimes->{{3.945540336575057*^9, 
  3.94554033767337*^9}},ExpressionUUID->"6e8e5439-3e8c-4912-85e9-\
1dca1a23c8a3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CountSame", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "sa", "}"}], ",", 
    RowBox[{
     RowBox[{"sa", " ", "=", " ", "\n", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"arr1", "-", "arr2"}], "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"Times", "@@", 
       RowBox[{"Dimensions", "[", "sa", "]"}]}], " ", "-", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"sa", "[", "\"\<NonzeroValues\>\"", "]"}], "]"}]}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943105653145685*^9, 3.943105700669275*^9}, {
   3.943106430212906*^9, 3.943106443869117*^9}, {3.943374573951805*^9, 
   3.9433746050982857`*^9}, 3.943381343379084*^9, {3.9433813844652853`*^9, 
   3.943381403318468*^9}, {3.943381439817117*^9, 3.943381495759122*^9}, {
   3.943382147699435*^9, 3.943382215612746*^9}, {3.943394135733881*^9, 
   3.9433941368258057`*^9}, 3.943395370941695*^9, {3.94364309903135*^9, 
   3.943643099930312*^9}, {3.943643255012763*^9, 3.943643257552268*^9}, {
   3.943643839887081*^9, 3.943643943749331*^9}, 3.944307747587144*^9},
 CellLabel->
  "In[321]:=",ExpressionUUID->"914e413a-3638-490f-aca9-493735b3966c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CountDifferences", "[", 
   RowBox[{"arr1_", ",", "arr2_"}], "]"}], ":=", 
  RowBox[{"Length", "[", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{"arr1", "-", "arr2"}], "]"}], "[", "\"\<NonzeroValues\>\"", 
    "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943642656048552*^9, 3.943642658020051*^9}, 
   3.94364269636675*^9, 3.943642850731148*^9, {3.94364290879478*^9, 
   3.943642924981742*^9}, {3.943643190064183*^9, 3.943643224486829*^9}, 
   3.943643303926519*^9, 3.943643835515625*^9},
 CellLabel->
  "In[322]:=",ExpressionUUID->"fb87530d-1647-4eac-8404-f0e8157f5a49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"meanfragility", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"pertbitfunc_", ":", "\"\<Random\>\""}], ",", " ", 
    RowBox[{"lt_", ":", 
     RowBox[{"-", "1"}]}], ",", " ", 
    RowBox[{"cr_", ":", "True"}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"clt", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"lt", "==", " ", 
         RowBox[{"-", "1"}]}], ",", " ", 
        RowBox[{"TestCALifeTime", "[", "ca", "]"}], ",", " ", "lt"}], "]"}]}],
      " ", "}"}], ",", " ", "\n", 
    RowBox[{"Mean", "[", 
     RowBox[{"PerturbationSensitivities", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "pertbitfunc", ",", 
       " ", "clt"}], "]"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943810123780548*^9, 3.943810154519761*^9}, {
   3.943810218736228*^9, 3.943810284550947*^9}, {3.943810323363736*^9, 
   3.943810368488123*^9}, 3.943810578558991*^9, {3.943810649677017*^9, 
   3.943810655945159*^9}, {3.94383115874373*^9, 3.943831164471401*^9}, {
   3.944307732012402*^9, 3.944307733992714*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"010986f6-6641-4c6a-9859-d5bc0c5ed0c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newltblend", "[", "value_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"LightGray", ",", "Blue"}], "}"}], ",", "value"}], "]"}], 
       ",", 
       RowBox[{"value", "<=", "0.975"}]}], "}"}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Blue", ",", " ", "Red"}], "}"}], ",", "value"}], "]"}], 
       ",", 
       RowBox[{"value", ">", "0.975"}]}], "}"}]}], "}"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944150216546483*^9, 3.9441502393608437`*^9}, 
   3.944150300480433*^9, {3.94415036425091*^9, 3.944150365272736*^9}, {
   3.944150402738605*^9, 3.9441504123284597`*^9}, {3.944150463644236*^9, 
   3.94415046385846*^9}, {3.944150548041984*^9, 3.944150626147049*^9}, {
   3.944150765698477*^9, 3.944150820410365*^9}, {3.944150971159443*^9, 
   3.944150996382962*^9}, {3.944151084181592*^9, 3.944151086223316*^9}, {
   3.944151133027474*^9, 3.944151171875409*^9}, {3.944307705805352*^9, 
   3.9443077219657*^9}, {3.944512549743142*^9, 3.944512631456539*^9}, {
   3.94451302657828*^9, 3.944513027597559*^9}, {3.944513067609299*^9, 
   3.944513069838722*^9}},
 CellLabel->
  "In[324]:=",ExpressionUUID->"bd0ce26c-8793-41ce-9d99-a5fe0cc40a54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"countstepdiffs", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_"}], "]"}], ":=", " ", "\n", 
  RowBox[{"Length", "/@", 
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SparseArray", "[", 
       RowBox[{"arr1", " ", "-", " ", "arr2"}], "]"}], "[", 
      "\"\<NonzeroPositions\>\"", "]"}], ",", " ", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "&"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.944306888140517*^9, 3.9443069873158083`*^9}, 
   3.944307405180588*^9},
 CellLabel->
  "In[325]:=",ExpressionUUID->"e9675c57-8c37-4554-b4d9-64de01f118e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcancerperts", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Steps\>\"", "->", "200"}], "}"}], "]"}]}], "]"}], ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "perts", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"perts", " ", "=", 
      RowBox[{"allperts", "[", 
       RowBox[{
        RowBox[{"CellularAutomaton", "[", 
         RowBox[{"ru", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<Steps\>\"", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "50"}], ",", " ", "50"}], "}"}]}], "}"}]}], "]"}], 
        ",", " ", 
        RowBox[{"ru", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Select", "[", 
      RowBox[{"perts", ",", " ", "\n", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"TestCALifeTime", "[", 
           RowBox[{"PerturbedCellularAutomaton", "[", 
            RowBox[{"ru", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<Steps\>\"", "]"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "50"}], ",", " ", "50"}], "}"}]}], "}"}], ",", 
             " ", "#", ",", " ", 
             RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}]}], "]"}], 
           "]"}], " ", "==", " ", 
          RowBox[{"-", "Infinity"}]}], "&"}], ")"}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.9451183683981247`*^9, 3.945118487727295*^9}, {
   3.945118755251984*^9, 3.945118757010066*^9}, {3.945118793825553*^9, 
   3.9451188487981853`*^9}, {3.9451191181040077`*^9, 3.945119138047632*^9}, {
   3.945119393259388*^9, 3.94511940251574*^9}, {3.945119450171067*^9, 
   3.945119513776975*^9}, {3.945119545488598*^9, 3.945119547329953*^9}, {
   3.945120312216143*^9, 3.945120314053685*^9}, {3.945120519349265*^9, 
   3.9451205296186*^9}, {3.945120587171876*^9, 3.945120589712695*^9}, {
   3.945120652265414*^9, 3.945120658083557*^9}, {3.945120739775329*^9, 
   3.945120739925272*^9}, {3.945653249736024*^9, 3.9456532750541773`*^9}, {
   3.945701326998122*^9, 3.945701331118793*^9}, {3.945701396727569*^9, 
   3.945701410187202*^9}, {3.945701736023038*^9, 3.945701743630467*^9}, 
   3.945701880388506*^9, {3.945701928908922*^9, 3.945701929617415*^9}, {
   3.945705002318081*^9, 3.945705002591833*^9}, {3.946213782131207*^9, 
   3.9462138260947523`*^9}, {3.94621388456251*^9, 3.946213975983157*^9}, {
   3.946223398712873*^9, 3.9462234406781797`*^9}},
 CellLabel->
  "In[326]:=",ExpressionUUID->"57294f1b-a5b9-4720-99cf-4822c83dcf9b"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Population", "Section",
 CellChangeTimes->{{3.945124905426052*^9, 
  3.945124906681363*^9}},ExpressionUUID->"9833750c-2556-43b1-b3be-\
7cb6bb80404d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getallmutations", "[", 
   RowBox[{"{", 
    RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
    "}"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"getallmutations", "[", 
    RowBox[{"{", 
     RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], " ", "=", " ",
    "\n", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"digits", " ", "=", " ", 
        RowBox[{"List", "/@", 
         RowBox[{"IntegerDigits", "[", 
          RowBox[{"n", ",", " ", "k", ",", " ", 
           RowBox[{"k", "^", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}]}], ",", " ", 
       "mudigs"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mudigs", " ", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"digits", ",", " ", 
              RowBox[{"#", "->", 
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", " ", 
                   RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
                 RowBox[{"digits", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}], "]"}]}]}], "]"}], "]"}], 
           "&"}], "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"Length", "[", "digits", "]"}], "-", "1"}], "]"}]}], " ", 
         ")"}], "//", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", " ", "1"}], "]"}], "&"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", " ", "k", ",", " ", "r"}], "}"}], "&"}], "/@", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"FromDigits", "[", 
           RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], "/@", " ", "mudigs"}], 
        ")"}]}]}]}], "\n", "  ", "]"}]}]}]], "Code",
 CellChangeTimes->{
  3.944327090570977*^9, {3.944327133666074*^9, 3.944327135650968*^9}, {
   3.944327282418949*^9, 3.944327321100698*^9}, {3.944327433549917*^9, 
   3.944327846827814*^9}, {3.94432795115841*^9, 3.944328005643941*^9}, {
   3.944328124354177*^9, 3.9443281258076687`*^9}, {3.944328169541747*^9, 
   3.944328196182477*^9}, {3.94432826882672*^9, 3.944328312163135*^9}, {
   3.944328524631875*^9, 3.944328535635455*^9}, {3.944328749923945*^9, 
   3.944328751417588*^9}, {3.944329012054535*^9, 3.944329019822937*^9}, {
   3.944751278766341*^9, 3.944751285160718*^9}, 3.944751326891244*^9, {
   3.944751389120824*^9, 3.944751453347126*^9}, 3.945017137389016*^9},
 CellLabel->
  "In[327]:=",ExpressionUUID->"87343c1c-81c4-4008-9ef2-649f897b7b84"],

Cell[BoxData[
 RowBox[{
  RowBox[{"exhaustiveneutral", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"cut_", ":", "200"}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"lt", " ", "=", " ", 
      RowBox[{"TestLifetime", "[", 
       RowBox[{"ru", ",", " ", "cut"}], "]"}]}], "}"}], ",", " ", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"getallmutations", "[", "ru", "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"TestLifetime", "[", 
         RowBox[{"#", ",", " ", "cut"}], "]"}], " ", "==", " ", "lt"}], 
       "&"}]}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944751067575765*^9, 3.944751189698888*^9}, {
   3.944751477114224*^9, 3.944751500538378*^9}, {3.944751659623405*^9, 
   3.944751664508668*^9}, 3.944751736701893*^9, {3.944751783432912*^9, 
   3.944751791480487*^9}, {3.945017148242858*^9, 3.9450171602550983`*^9}, 
   3.945112288915782*^9, {3.945118947832473*^9, 3.945118952412799*^9}, 
   3.945526246933545*^9, {3.9455262835201283`*^9, 3.945526295018798*^9}},
 CellLabel->
  "In[328]:=",ExpressionUUID->"7133c0ef-2767-46cc-b759-35a901e7a5eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"quickneutral", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", "k_Integer", ",", "r_Integer"}], "}"}], ",", 
    RowBox[{"cut_", ":", "200"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"mask", "=", 
       RowBox[{"RuleMask", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n", ",", "k", ",", "r"}], "}"}], ",", 
         RowBox[{"TestLifetime", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", ",", "k", ",", "r"}], "}"}], ",", "cut"}], "]"}]}], 
        "]"}]}], ",", 
      RowBox[{"digs", "=", 
       RowBox[{"IntegerDigits", "[", 
        RowBox[{"n", ",", "k", ",", 
         RowBox[{"k", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", " ", "r"}], "+", "1"}], ")"}]}]}], "]"}]}]}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"#", ",", "k", ",", "r"}], "}"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"FromDigits", "[", 
         RowBox[{"#", ",", "k"}], "]"}], "&"}], "\[IndentingNewLine]", "/@", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"index", ",", "digit"}], "}"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"mask", "[", 
                 RowBox[{"[", "index", "]"}], "]"}], "==", "0"}], ",", 
               RowBox[{"Range", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"k", "-", "1"}]}], "]"}], ",", 
               RowBox[{"{", "digit", "}"}]}], "]"}]}], "]"}], "[", 
           RowBox[{"#", ",", 
            RowBox[{"digs", "[", 
             RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], 
         "\[IndentingNewLine]", "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "digs", "]"}], "]"}]}], "]"}]}], ")"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945115813120508*^9, 3.945115813125668*^9}, {
   3.945119004132131*^9, 3.9451190062337713`*^9}, {3.945123859496854*^9, 
   3.945123923478093*^9}, {3.945123984708405*^9, 3.94512402749656*^9}, 
   3.945124129009829*^9},
 CellLabel->
  "In[329]:=",ExpressionUUID->"3f9495ca-95d8-4e4a-a37d-408683ffc6b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"samplefunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"UpTo", "[", "10", "]"}]}], "]"}], "]"}], "&"}], ")"}]}], 
    ",", " ", 
    RowBox[{"pertspec_", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<Random\>\"", "->", "1"}], ")"}]}], ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"rus", " ", "=", 
       RowBox[{"quickneutral", "[", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}]}], ",", 
      " ", "s"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"PerturbPopulation", "[", 
     RowBox[{
      RowBox[{"samplefunc", "[", 
       RowBox[{"quickneutral", "[", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], "]"}], 
      ",", "  ", "pertspec", ",", " ", "steps"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121406635539*^9}, {3.945122178602026*^9, 3.945122189784541*^9}, {
   3.945122283576271*^9, 3.945122308166499*^9}, {3.945122713630536*^9, 
   3.945122731023986*^9}, {3.9451227846445293`*^9, 3.94512280007278*^9}, {
   3.945122841437958*^9, 3.945122913746992*^9}, {3.945122971624249*^9, 
   3.945122973325691*^9}, {3.945123492271601*^9, 3.945123496615378*^9}, {
   3.945123537584054*^9, 3.945123538285596*^9}, {3.945123612248053*^9, 
   3.945123623671673*^9}, {3.945123760495822*^9, 3.945123766861141*^9}, {
   3.945124245265932*^9, 3.945124246581737*^9}, 3.945124678953227*^9, {
   3.945126890913911*^9, 3.945126892349599*^9}, {3.945127182609988*^9, 
   3.945127224617054*^9}, {3.945127261327314*^9, 3.945127263958499*^9}, {
   3.945127569240232*^9, 3.945127570220824*^9}, 3.945128559298685*^9, {
   3.945129550748648*^9, 3.945129585996633*^9}, {3.945129636415519*^9, 
   3.9451296367844553`*^9}, {3.945129693501587*^9, 3.945129705398319*^9}},
 CellLabel->
  "In[330]:=",ExpressionUUID->"2c64da26-4ed6-479d-a657-a6c14a89bd13"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{"rus_List", ",", " ", 
    RowBox[{"pertspec_Rule", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<Random\>\"", "->", "1"}], ")"}]}], ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"getca", "[", 
       RowBox[{"#", ",", " ", "steps"}], "]"}], "&"}], "/@", " ", "rus"}], 
    ",", " ", "rus", ",", " ", "pertspec"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121388431172*^9}, {3.9451214244278717`*^9, 3.945121442525996*^9}, {
   3.945122646508793*^9, 3.945122648495297*^9}, {3.945122711066759*^9, 
   3.945122752758585*^9}, {3.945122975840968*^9, 3.945122977635197*^9}, {
   3.945127230233573*^9, 3.945127239092495*^9}, {3.94512758731314*^9, 
   3.945127627793437*^9}, {3.945127931310405*^9, 3.945127932212486*^9}, 
   3.945128562895161*^9, {3.94512865166099*^9, 3.945128652085614*^9}},
 CellLabel->
  "In[331]:=",ExpressionUUID->"96687295-1def-49bb-8675-468fe0e90892"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{"cas_List", ",", " ", "rus_List", ",", " ", "pertspec_"}], "]"}], ":=",
   " ", "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ps", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pertspec", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", "\"\<Random\>\""}], 
        ",", " ", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"getbodyrules", "[", 
          RowBox[{
           RowBox[{"cas", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"\"\<AddValue\>\"", "->", "1"}]}], "]"}], "]"}], ",", " ", 
        "pertspec"}], "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"PerturbCA", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#1", ",", " ", "#2"}], "}"}], ",", " ", "ps"}], "]"}], 
      "&"}], "@@@", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"cas", ",", " ", "rus"}], "}"}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121388431172*^9}, {3.9451214244278717`*^9, 3.9451214747866497`*^9}, {
   3.945122334287568*^9, 3.945122404193021*^9}, {3.9451225382342*^9, 
   3.945122621580563*^9}, {3.9451227388348293`*^9, 3.945122744081846*^9}, {
   3.945123119077734*^9, 3.945123120904056*^9}, {3.945124458028131*^9, 
   3.945124464225045*^9}, 3.945124520296139*^9, {3.945127630179598*^9, 
   3.945127635425282*^9}, 3.945128564962919*^9},
 CellLabel->
  "In[332]:=",ExpressionUUID->"5658bfaa-3608-4231-9ca2-7a7502e6aa61"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Therapy", "Section",
 CellChangeTimes->{{3.943554524259576*^9, 3.943554526486482*^9}, {
  3.945107085664616*^9, 3.945107086562048*^9}, {3.945124763762751*^9, 
  3.9451247644956923`*^9}},ExpressionUUID->"bc7b5f81-b8b3-411d-99af-\
77f90d1a1f1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptTherapy", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"initpat_", ",", " ", "initru_"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "currdiff_", ",", " ", "mca_", ",", " ", "i_"}],
      "}"}]}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pca", ",", " ", "nca", ",", " ", "nmca", ",", " ", "newdiff"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nmca", " ", "=", " ", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"pca", " ", "=", 
         RowBox[{"PerturbCA", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "initru"}], "}"}], ",", " ", 
           RowBox[{"Floor", "[", 
            RowBox[{"11", "+", "i"}], "]"}]}], "]"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", " ", "1", ",", " ", "1", ",", " ", "1"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newdiff", " ", "=", " ", 
      RowBox[{"CountDifferences", "[", 
       RowBox[{"initpat", ",", "pca"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nca", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"newdiff", "<=", " ", "currdiff"}], ",", " ", "pca", ",", 
        "ca"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"nca", ",", " ", 
       RowBox[{"Min", "[", 
        RowBox[{"newdiff", ",", " ", "currdiff"}], "]"}], ",", " ", "nmca", 
       ",", " ", 
       RowBox[{"i", "+", 
        RowBox[{"(", 
         RowBox[{"1", "/", "5"}], ")"}]}]}], "}"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943395880405551*^9, 3.943396006639639*^9}, {
   3.943396218619499*^9, 3.943396229368534*^9}, {3.94339631463708*^9, 
   3.943396317100731*^9}, {3.94339639749044*^9, 3.94339641031278*^9}, {
   3.943397186398964*^9, 3.943397207418297*^9}, {3.94339727297303*^9, 
   3.943397282031959*^9}, {3.943397349388679*^9, 3.943397388988446*^9}, {
   3.943397465757667*^9, 3.943397466172511*^9}, {3.943397618764945*^9, 
   3.943397655011775*^9}, {3.943397696483054*^9, 3.943397811985132*^9}, {
   3.9433979190037403`*^9, 3.943397929599284*^9}, {3.943397966384178*^9, 
   3.943397966711248*^9}, {3.943398097168415*^9, 3.943398132944777*^9}, {
   3.943398163085023*^9, 3.943398170426689*^9}, 3.943398258527637*^9, {
   3.94339834684286*^9, 3.943398361580974*^9}, {3.943398416061253*^9, 
   3.943398477545807*^9}, {3.943400030738473*^9, 3.943400050938936*^9}, 
   3.943400340942998*^9, {3.9434004869038477`*^9, 3.9434004999217777`*^9}, {
   3.943400535477778*^9, 3.9434005355668507`*^9}, {3.943400680781386*^9, 
   3.943400728214313*^9}, 3.94340081913684*^9, {3.943400867462179*^9, 
   3.943400880148367*^9}, {3.943400937796553*^9, 3.943400972124466*^9}, 
   3.943401039749408*^9, 3.943401085015738*^9, 3.943401142060587*^9, {
   3.943553202708556*^9, 3.943553205486194*^9}, 3.943553741459091*^9, {
   3.943553887357324*^9, 3.943553890174745*^9}, {3.943553936062168*^9, 
   3.9435539696667423`*^9}, {3.943554018724535*^9, 3.943554021334249*^9}, {
   3.943554085668019*^9, 3.943554145977961*^9}, {3.943554221562248*^9, 
   3.943554354391051*^9}},
 CellLabel->
  "In[333]:=",ExpressionUUID->"5abfbed9-f83e-4006-a93c-e32bc3f9495b"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "HealCA"}]], "Input",
 CellChangeTimes->{{3.946408118809504*^9, 3.946408123459606*^9}},
 CellLabel->
  "In[1530]:=",ExpressionUUID->"06e02745-5149-4a04-a119-5aac7162d61c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HealCA", "[", 
   RowBox[{"ru_", ",", 
    RowBox[{"init_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}], ",", 
    RowBox[{"txspec_", ":", 
     RowBox[{"{", 
      RowBox[{"200", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "200"}], ",", " ", "200"}], "}"}]}], "}"}]}], ",", "  ",
     "pert_Association", ",", " ", 
    RowBox[{"n_", ":", "1"}], ",", " ", 
    RowBox[{"healfunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "!=", 
        RowBox[{"-", "Infinity"}]}], "&"}], ")"}]}], ",", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<Steps\>\"", "->", "200"}], ",", " ", 
       RowBox[{"\"\<Order\>\"", "->", "\"\<First\>\""}]}], "}"}], "]"}]}], 
   "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ca", ",", " ", "perts", ",", " ", "psorted", ",", " ", "found", ",", 
      " ", "aps", ",", " ", "i", ",", " ", "max"}], "}"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"PerturbedCellularAutomaton", "[", 
       RowBox[{
       "ru", ",", " ", "init", ",", " ", "txspec", ",", " ", "pert", ",", " ", 
        RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"perts", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"aps", " ", "=", " ", 
         RowBox[{"allperts", "[", 
          RowBox[{"ca", ",", " ", 
           RowBox[{
            RowBox[{"interpretrule", "[", "ru", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Keys", "[", "#", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], ">", " ", 
          RowBox[{
           RowBox[{"Keys", "[", "pert", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", " ", "1"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
     ";", " ", "\[IndentingNewLine]", 
     RowBox[{"psorted", " ", "=", " ", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Order\>\"", "]"}], " ", "==", " ", 
          "\"\<First\>\""}], ",", " ", "Identity", ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<Order\>\"", "]"}], " ", "==", 
            " ", "\"\<Last\>\""}], ",", " ", "Reverse", ",", " ", 
           "RandomSample"}], "]"}]}], "]"}], "[", "perts", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"found", " ", "=", " ", 
      RowBox[{"{", "}"}]}], ";", " ", 
     RowBox[{"i", " ", "=", " ", "1"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"max", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", " ", "===", " ", "All"}], ",", " ", 
        RowBox[{"Length", "[", "perts", "]"}], ",", " ", "n"}], "]"}]}], ";", 
     
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "found", "]"}], " ", "<", " ", "max"}], " ", "&&",
         " ", 
        RowBox[{"i", " ", "<", " ", 
         RowBox[{"Length", "[", "perts", "]"}]}]}], ",", " ", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"healfunc", "[", 
           RowBox[{"TestCALifeTime", "[", 
            RowBox[{"pca", " ", "=", " ", 
             RowBox[{"PerturbedCellularAutomaton", "[", 
              RowBox[{"ru", ",", "init", ",", " ", "txspec", ",", " ", 
               RowBox[{"Join", "[", 
                RowBox[{"pert", ",", " ", 
                 RowBox[{"psorted", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", " ", 
               RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}]}], 
              "]"}]}], "]"}], "]"}], ",", " ", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"found", ",", " ", 
            RowBox[{"psorted", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}], ";", " ", 
        RowBox[{"i", " ", "+=", "  ", "1"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "found"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451191847745*^9, 3.945119444372617*^9}, {
   3.94511955142013*^9, 3.945119628740043*^9}, {3.945119668343119*^9, 
   3.945119675612154*^9}, {3.945119745244145*^9, 3.945119824144596*^9}, {
   3.945120204639851*^9, 3.945120232816122*^9}, {3.945120304032649*^9, 
   3.945120304892949*^9}, {3.9451273212157993`*^9, 3.945127324228445*^9}, {
   3.945127430702441*^9, 3.945127432189741*^9}, 3.945128101473031*^9, {
   3.945547096329152*^9, 3.945547106534934*^9}, {3.945608613579886*^9, 
   3.945608614005372*^9}, {3.945608925701435*^9, 3.945608928912286*^9}, {
   3.9456528777251987`*^9, 3.945652918678259*^9}, {3.945653113499507*^9, 
   3.94565312710362*^9}, {3.945702116617474*^9, 3.945702195352232*^9}, {
   3.945702227984547*^9, 3.945702584357367*^9}, {3.9457026259223146`*^9, 
   3.945702689557318*^9}, {3.945702720907929*^9, 3.94570273992575*^9}, {
   3.945702783142737*^9, 3.94570292989657*^9}, 3.945703030237057*^9, {
   3.94570306480057*^9, 3.945703065062009*^9}, {3.945703265303306*^9, 
   3.945703283284389*^9}, {3.945703377700892*^9, 3.945703430041501*^9}, {
   3.945703515140817*^9, 3.945703582569285*^9}, {3.945703636871813*^9, 
   3.945703645768406*^9}, {3.945703774493022*^9, 3.9457038033086357`*^9}, {
   3.9457038917818823`*^9, 3.945703900565548*^9}, {3.945703974293365*^9, 
   3.945703983300021*^9}, {3.9458205909299088`*^9, 3.945820591489964*^9}, {
   3.945822342686748*^9, 3.9458223578697987`*^9}, {3.946407248109583*^9, 
   3.946407267555167*^9}, {3.946407384978135*^9, 3.946407390933806*^9}, {
   3.946407425861401*^9, 3.946407450456554*^9}, 3.946407532182637*^9, {
   3.946407566671421*^9, 3.946407648516808*^9}, {3.946408135905139*^9, 
   3.946408136419673*^9}, {3.946408234553084*^9, 3.946408236605494*^9}, {
   3.946408421320196*^9, 3.946408428968034*^9}, {3.9464085219314404`*^9, 
   3.946408528071485*^9}, {3.946408707742983*^9, 3.946408709437258*^9}, {
   3.946409434455683*^9, 3.946409438237912*^9}, {3.946645725331329*^9, 
   3.946645754388591*^9}, {3.946645793846539*^9, 3.946645915013744*^9}, {
   3.946646395362421*^9, 3.946646425731506*^9}, {3.9466840659147387`*^9, 
   3.946684072902844*^9}},
 CellLabel->
  "In[334]:=",ExpressionUUID->"55fa00ea-a9f3-404e-afc8-aa0fa7289c2c"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "TherapySensitivityPlot"}]], "Input",
 CellChangeTimes->{{3.946592862708241*^9, 3.946592867687392*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"f2de3602-c43d-465c-8bba-994a985cdda8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TherapySensitivityPlot", "[", 
   RowBox[{
   "ru_", ",", " ", "init_", ",", " ", "txspec_", ",", " ", "pertspec_", ",", 
    " ", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<MaxLength\>\"", "->", "200"}], "}"}], ",", " ", 
       "ArrayPlot"}], "}"}], "]"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
      "ca", ",", " ", "pca", ",", " ", "rowidx", ",", " ", "pertsenserus", 
       ",", " ", "replaced"}], "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"PerturbedCellularAutomaton", "[", 
       RowBox[{"ru", ",", " ", "init", ",", " ", "txspec", ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pca", " ", "=", " ", 
      RowBox[{"First", "[", 
       RowBox[{"PerturbedCellularAutomaton", "[", 
        RowBox[{
        "ru", ",", " ", "init", ",", " ", "txspec", ",", " ", "pertspec"}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rowidx", " ", "=", " ", 
      RowBox[{
       RowBox[{"Normal", "[", "pertspec", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}]}], " ", ";",
      "\[IndentingNewLine]", 
     RowBox[{"pertsenserus", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"#", " ", "==", " ", "0"}], ",", " ", 
              RowBox[{"-", "1"}], ",", " ", "#"}], "]"}], "&"}], "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"TestCALifeTime", "[", 
               RowBox[{"pcap", " ", "=", " ", 
                RowBox[{"PerturbedCellularAutomaton", "[", 
                 RowBox[{
                 "ru", ",", " ", "init", ",", " ", "txspec", ",", " ", "\n", 
                  RowBox[{"Append", "[", 
                   RowBox[{
                    RowBox[{"Normal", "[", "pertspec", "]"}], ",", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", " ", "-", " ", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", " ", "0"}], "}"}]}], ")"}], "->", 
                    RowBox[{"{", 
                    RowBox[{"\"\<AddValue\>\"", ",", " ", "1"}], "}"}]}]}], 
                   "]"}], ",", " ", 
                  RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}]}], 
                 "]"}]}], "]"}], " ", "-", " ", "rowidx"}], ")"}], " ", "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"TestCALifeTime", "[", "ca", "]"}], " ", "-", " ", 
              "rowidx"}], ")"}]}], "]"}], ")"}]}], "&"}], "/@", "  ", 
       RowBox[{"Catenate", "[", 
        RowBox[{
         RowBox[{"bodyidxs", "[", "pca", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"rowidx", " ", "+", " ", "1"}], ";;"}], "]"}], "]"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"replaced", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"pca", ",", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#1", " ", "+", " ", "1"}], ",", " ", "#2"}], "}"}], 
               "&"}], "@@@", 
              RowBox[{"Keys", "[", "pertspec", "]"}]}], ")"}], "->", "Red"}], 
           "]"}], ",", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Catenate", "[", 
              RowBox[{
               RowBox[{"bodyidxs", "[", "pca", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", 
                 RowBox[{"UpTo", "[", 
                  RowBox[{"rowidx", "+", "1"}], "]"}]}], "]"}], "]"}], "]"}], 
             ")"}], "->", "LightGray"}], "]"}], ",", "pertsenserus"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PlotCA", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"replaced", "[", 
          RowBox[{"[", 
           RowBox[{";;", 
            RowBox[{"OptionValue", "[", "\"\<MaxLength\>\"", "]"}]}], "]"}], 
          "]"}], ",", " ", "pertspec"}], "}"}], ",", " ", 
       RowBox[{"ColorFunctionScaling", "->", "False"}], ",", " ", "\n", 
       RowBox[{"ColorFunction", "->", 
        RowBox[{"(", "\n", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", " ", ">", " ", "1"}], " ", "||", " ", 
             RowBox[{"#", " ", "==", " ", 
              RowBox[{"-", "Infinity"}]}]}], ",", 
            RowBox[{"Darker", "[", "Red", "]"}], ",", 
            RowBox[{"Blend", "[", 
             RowBox[{
              RowBox[{"Reverse", "@", 
               RowBox[{"{", 
                RowBox[{"Orange", ",", " ", 
                 RowBox[{"Lighter", "[", 
                  RowBox[{"Orange", ",", " ", ".5"}], "]"}], ",", " ", 
                 RowBox[{"Lighter", "[", 
                  RowBox[{"Orange", ",", " ", ".7"}], "]"}], ",", "  ", 
                 RowBox[{"Lighter", "[", 
                  RowBox[{"Yellow", ",", " ", ".7"}], "]"}]}], 
                RowBox[{"(*", 
                 RowBox[{",", 
                  TemplateBox[<|"color" -> RGBColor[0.73, 0.8, 0]|>,
                   "RGBColorSwatchTemplate"], ",", " ", 
                  TemplateBox[<|"color" -> RGBColor[0.73, 0.8, 0]|>,
                   "RGBColorSwatchTemplate"]}], "*)"}], "}"}]}], ",", " ", 
              "#"}], "]"}]}], "]"}], "&"}], ")"}]}], ",", " ", 
       RowBox[{"Mesh", "->", 
        RowBox[{"OptionValue", "[", "Mesh", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", "->", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.9451158501617002`*^9, 3.945115856796356*^9}, {
   3.945115979217936*^9, 3.945116030053803*^9}, {3.945116064524947*^9, 
   3.945116064937901*^9}, {3.945116098087596*^9, 3.945116129061755*^9}, {
   3.945116164387346*^9, 3.945116277062486*^9}, {3.945116345330906*^9, 
   3.945116392433114*^9}, {3.945116496557994*^9, 3.9451165630566893`*^9}, {
   3.945116629119066*^9, 3.945116630649734*^9}, {3.945116710867177*^9, 
   3.945116761473799*^9}, {3.945116852233283*^9, 3.945116944068643*^9}, {
   3.945117006499408*^9, 3.945117042890435*^9}, {3.94511708855098*^9, 
   3.94511709071708*^9}, 3.945117143564231*^9, {3.945117220851111*^9, 
   3.945117252830714*^9}, 3.945117283836012*^9, {3.945117369206193*^9, 
   3.945117422521552*^9}, {3.945117473246016*^9, 3.94511753821803*^9}, {
   3.945117579008676*^9, 3.945117631089662*^9}, {3.945117661207172*^9, 
   3.945117663210318*^9}, {3.945118550203525*^9, 3.945118617468432*^9}, {
   3.945118671958097*^9, 3.945118672270591*^9}, 3.945120349874535*^9, {
   3.94512730138868*^9, 3.945127306812495*^9}, 3.9464996594824657`*^9, 
   3.946499846722321*^9, {3.94649994542479*^9, 3.946500043957458*^9}, {
   3.946501822939386*^9, 3.9465018267691603`*^9}, {3.946501891706642*^9, 
   3.946501943589706*^9}, {3.946502042371712*^9, 3.946502073353706*^9}, {
   3.94650221235441*^9, 3.946502280104648*^9}, {3.946502874556447*^9, 
   3.946503180767468*^9}, {3.946503219156554*^9, 3.946503337828011*^9}, {
   3.946503368967023*^9, 3.946503389986709*^9}, {3.946503440783571*^9, 
   3.946503500930881*^9}, {3.946503697017591*^9, 3.94650384731342*^9}, {
   3.9465038816991453`*^9, 3.946504055268939*^9}, {3.9465040894857073`*^9, 
   3.946504116252881*^9}, {3.946504162114171*^9, 3.946504165700321*^9}, {
   3.9465042231863422`*^9, 3.9465042265642157`*^9}, {3.946504279959848*^9, 
   3.946504280153117*^9}, {3.946504312040674*^9, 3.946504315871072*^9}, {
   3.946504448488952*^9, 3.946504451134788*^9}, {3.946504621508376*^9, 
   3.946504623486974*^9}, {3.946504706923454*^9, 3.946504736641679*^9}, {
   3.946504781364949*^9, 3.946504787338529*^9}, {3.946504832533935*^9, 
   3.9465048903962193`*^9}, {3.946504953939077*^9, 3.9465050390755367`*^9}, {
   3.946505091708849*^9, 3.946505092001225*^9}, {3.946505124128327*^9, 
   3.946505148192566*^9}, {3.946505226575831*^9, 3.946505243561818*^9}, {
   3.9465052774582977`*^9, 3.94650528026091*^9}, {3.946505412426873*^9, 
   3.946505450593554*^9}, {3.9465055599280863`*^9, 3.946505585841876*^9}, {
   3.946505717756518*^9, 3.9465057530102863`*^9}, {3.94650579654282*^9, 
   3.9465058010601683`*^9}, {3.946505907085425*^9, 3.946505915662471*^9}, {
   3.946506042734947*^9, 3.946506064378738*^9}, {3.946506196217579*^9, 
   3.946506254462992*^9}, {3.946506363630959*^9, 3.94650636883148*^9}, {
   3.9465064270495663`*^9, 3.946506472301673*^9}, {3.946507268557349*^9, 
   3.946507280623946*^9}, {3.946513818634859*^9, 3.946513824874166*^9}, {
   3.946513890903495*^9, 3.9465139345322313`*^9}, {3.94657438931352*^9, 
   3.946574406975502*^9}, 3.9465744436036787`*^9, {3.946575082407759*^9, 
   3.946575086037555*^9}, {3.946575312115685*^9, 3.946575351229129*^9}, {
   3.946575409795043*^9, 3.946575450168668*^9}, {3.946575510045395*^9, 
   3.946575533705764*^9}, {3.946575610457417*^9, 3.946575619810213*^9}, 
   3.946575650694725*^9, {3.9465758946677647`*^9, 3.946575911430176*^9}, {
   3.946579030339736*^9, 3.946579036414859*^9}, {3.946579080174659*^9, 
   3.946579116468589*^9}, {3.9465791513827357`*^9, 3.946579157833617*^9}, {
   3.9465888171130133`*^9, 3.946588819063894*^9}, {3.9465896845289307`*^9, 
   3.946589684974963*^9}, {3.946590009282387*^9, 3.9465900729011602`*^9}, {
   3.946590167784295*^9, 3.946590196087147*^9}, {3.946590261524328*^9, 
   3.946590273130642*^9}, {3.94659036356768*^9, 3.946590367126392*^9}, {
   3.94659062452991*^9, 3.94659072003612*^9}, {3.946591008181376*^9, 
   3.946591012850637*^9}, {3.946591082775003*^9, 3.94659109359298*^9}, 
   3.94659117947327*^9, 3.946591492460133*^9, {3.946591591438083*^9, 
   3.946591622765873*^9}, {3.946591653863421*^9, 3.94659170909152*^9}, {
   3.946591778308717*^9, 3.946591821576159*^9}, {3.946592304598556*^9, 
   3.946592307438401*^9}, {3.946592363971403*^9, 3.9465923659732723`*^9}, 
   3.946592404260668*^9, {3.946592831331444*^9, 3.946592831638164*^9}, {
   3.946593166206394*^9, 3.946593176736567*^9}, {3.946593239499257*^9, 
   3.946593239674019*^9}, {3.946593330066244*^9, 3.94659333077291*^9}, {
   3.946593404985257*^9, 3.946593563922289*^9}, {3.946593602041966*^9, 
   3.946593636738861*^9}, {3.946593933883259*^9, 3.94659393436521*^9}, {
   3.946593991324337*^9, 3.9465939945849867`*^9}, {3.946594058789536*^9, 
   3.9465940722889442`*^9}, {3.946595054714177*^9, 3.946595066877742*^9}, 
   3.946595314052413*^9, {3.946595786236356*^9, 3.946595787443941*^9}, {
   3.9466838385289307`*^9, 3.9466838657690783`*^9}, {3.946683939693543*^9, 
   3.9466839603756313`*^9}, {3.946684000538904*^9, 3.946684003401215*^9}, {
   3.946684079389092*^9, 3.946684122440704*^9}, {3.9466841722985153`*^9, 
   3.946684173274029*^9}, 3.946684308767538*^9, {3.946684340287443*^9, 
   3.946684414357376*^9}, {3.946684564532541*^9, 3.946684567426136*^9}, {
   3.946685288919464*^9, 3.9466852892424297`*^9}, {3.946686353664692*^9, 
   3.946686376536427*^9}, {3.9466864955129423`*^9, 3.946686505592374*^9}, {
   3.946686568510527*^9, 3.946686602683757*^9}, {3.946686660701411*^9, 
   3.946686682033368*^9}, {3.946686716395593*^9, 3.946686717095029*^9}, {
   3.946686747976068*^9, 3.946686761167452*^9}, {3.946686792751234*^9, 
   3.946686799170938*^9}, {3.946686835038665*^9, 3.946686877750201*^9}, {
   3.946687073302637*^9, 3.9466870800691757`*^9}, {3.946687138080889*^9, 
   3.946687143913146*^9}, {3.946687211589388*^9, 3.946687216027154*^9}},
 CellLabel->
  "In[335]:=",ExpressionUUID->"3efc5258-6132-49ff-b70c-54ec1fc0f2de"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Micro ", "Section",
 CellChangeTimes->{{3.943563483255291*^9, 
  3.943563542404564*^9}},ExpressionUUID->"d6852212-b3fa-464d-9fd5-\
2873ef55d3c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleTuples", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"RuleTuples", "[", 
    RowBox[{"k", ",", "r"}], "]"}], "=", 
   RowBox[{"Tuples", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Reverse", "[", 
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{"k", "-", "1"}]}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"2", "r"}], "+", "1"}]}], "]"}]}]}]], "Code",
 CellLabel->
  "In[336]:=",ExpressionUUID->"7f2be1c5-0353-4225-917f-f2d50cea3add"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleMask", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ru_", ",", "k_", ",", "r_"}], "}"}], ",", "lt_"}], "]"}], ":=", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "mask", ",", "canonical"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Catenate", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"2", "r"}], "+", "1"}], ",", "1"}], "]"}], "&"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"CellularAutomaton", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ru", ",", "k", ",", "r"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"CenterArray", "[", 
             RowBox[{"1", ",", 
              RowBox[{
               RowBox[{"2", " ", "r", "*", 
                RowBox[{"(", 
                 RowBox[{"lt", "+", "4"}], ")"}]}], "+", "1"}]}], "]"}], ",", 
            
            RowBox[{"lt", "+", "2"}]}], "]"}]}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", "=", 
      RowBox[{"Lookup", "[", 
       RowBox[{
        RowBox[{"Association", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"data", "->", "1"}], "]"}], "]"}], ",", 
        RowBox[{"RuleTuples", "[", 
         RowBox[{"k", ",", "r"}], "]"}], ",", "0"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{
  3.943495176443308*^9, {3.943495345241512*^9, 3.943495349595083*^9}, {
   3.944307190155628*^9, 3.9443071903703814`*^9}},
 CellLabel->
  "In[337]:=",ExpressionUUID->"1167ac24-28bb-42eb-8554-f1fe6819b441"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getperts", "[", 
   RowBox[{"tup_", ",", " ", "k_"}], "]"}], ":=", " ", 
  RowBox[{"Tuples", "[", 
   RowBox[{"Replace", "[", 
    RowBox[{
     RowBox[{"ReplacePart", "[", 
      RowBox[{"tup", ",", " ", "\n", 
       RowBox[{
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"Length", "[", "tup", "]"}], " ", "/", " ", "2"}], "]"}], "->", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
          RowBox[{"tup", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Length", "[", "tup", "]"}], " ", "/", " ", "2"}], 
              "]"}], "}"}], "]"}], "]"}]}], "]"}]}]}], "]"}], ",", "\n", 
     RowBox[{"i_Integer", ":>", " ", 
      RowBox[{"{", "i", "}"}]}], ",", " ", "1"}], "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943481041012143*^9, 3.94348106878887*^9}, {
   3.9434811994872713`*^9, 3.943481228521406*^9}, {3.9434858604672*^9, 
   3.94348586808162*^9}, {3.943485911648578*^9, 3.943485916385562*^9}, {
   3.94348595601386*^9, 3.943485956927729*^9}, 3.943486046578634*^9, {
   3.9434861197226343`*^9, 3.943486123627069*^9}, {3.943533598323098*^9, 
   3.943533599047058*^9}, {3.94442167294912*^9, 3.944421688556637*^9}},
 CellLabel->
  "In[338]:=",ExpressionUUID->"bee9e125-9c08-4ab3-a081-a2ef8ee2c10c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertrus", "[", 
   RowBox[{"i_", ",", " ", "perts_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], "/@", " ", 
   "perts"}]}]], "Code",
 CellChangeTimes->{{3.943481258535507*^9, 3.943481290450325*^9}, {
  3.944008891576692*^9, 3.944008897328699*^9}},
 CellLabel->
  "In[339]:=",ExpressionUUID->"09adc84a-a279-4018-bdd1-53ae96dc4b48"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getsubs", "[", 
   RowBox[{"{", 
    RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#1", "->", "#2"}], "&"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Reverse", "[", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
         RowBox[{"1", " ", "+", " ", 
          RowBox[{"2", "r"}]}]}], "]"}], "]"}], ",", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943483958204916*^9, 3.943484006288759*^9}, {
  3.943484099831672*^9, 3.94348418620397*^9}, {3.943484228964634*^9, 
  3.943484261754797*^9}, {3.943484359580515*^9, 3.9434843610687838`*^9}, {
  3.943484394980937*^9, 3.943484398643656*^9}, {3.943564397404496*^9, 
  3.943564405331441*^9}, {3.9442598259949913`*^9, 3.944259830483087*^9}},
 CellLabel->
  "In[340]:=",ExpressionUUID->"61c09f1a-6996-44c1-abac-9ee339ea646e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertedges", "[", 
   RowBox[{"k_", ",", " ", "r_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"getpertrus", "[", 
     RowBox[{"#", ",", " ", 
      RowBox[{"getperts", "[", 
       RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", 
   RowBox[{"Tuples", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", " ", 
       RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", 
     RowBox[{
      RowBox[{"4", "r"}], "+", " ", "1"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943484525252606*^9, 3.943484561684527*^9}, {
  3.94348465663787*^9, 3.94348467675038*^9}, {3.94348618784658*^9, 
  3.943486190643013*^9}, {3.943533638615285*^9, 3.943533642912948*^9}, {
  3.9435337165538893`*^9, 3.943533717681363*^9}, {3.94400893256437*^9, 
  3.94400895215824*^9}},
 CellLabel->
  "In[341]:=",ExpressionUUID->"0fddcb93-8a52-4500-9fa7-9dc78c741d04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getruparts", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"arr1_", ",", " ", "arr2_"}], "}"}], ",", " ", 
    RowBox[{"r_", ":", "1"}]}], "]"}], ":=", " ", 
  RowBox[{"Transpose", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Partition", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{
        RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
    " ", 
    RowBox[{"{", 
     RowBox[{"arr1", ",", " ", "arr2"}], "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943486507302359*^9, 3.943486622832364*^9}, {
  3.9434883556367273`*^9, 3.943488361513817*^9}, {3.9440091589862843`*^9, 
  3.944009165314611*^9}},
 CellLabel->
  "In[342]:=",ExpressionUUID->"2ec127b0-b6c5-4950-9519-4c65d04e32ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{"{", 
    RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", 
        RowBox[{"getpertedges", "[", 
         RowBox[{"k", ",", " ", "r"}], "]"}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
       "stepped", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943488276493325*^9, 3.94348829421737*^9}, {
  3.943488325075017*^9, 3.943488329551101*^9}, {3.943488368693169*^9, 
  3.943488506657982*^9}, {3.943488573217678*^9, 3.943488578991692*^9}, {
  3.943488657430828*^9, 3.943488674631031*^9}, {3.943488905555903*^9, 
  3.943488969705639*^9}, {3.9435336648038673`*^9, 3.943533666445611*^9}, {
  3.943534525315949*^9, 3.943534529032213*^9}, {3.944005946498619*^9, 
  3.944005948184443*^9}},
 CellLabel->
  "In[343]:=",ExpressionUUID->"89b85e4d-4802-4b40-b6e5-d9d5f1138b38"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertpairs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "active_"}], "]"}], ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"getpertrus", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"getperts", "[", 
        RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", "active"}],
    ")"}], " "}]], "Code",
 CellChangeTimes->{{3.944004893875792*^9, 3.944004897345372*^9}, {
   3.944005058399239*^9, 3.9440050617568283`*^9}, {3.944005092743585*^9, 
   3.944005102983451*^9}, {3.944005327678811*^9, 3.9440053321178637`*^9}, {
   3.944005407103117*^9, 3.944005423682027*^9}, {3.944006005850071*^9, 
   3.944006006699265*^9}, {3.944007338237412*^9, 3.944007339278685*^9}, {
   3.944007509512716*^9, 3.94400754891026*^9}, 3.944008435691231*^9, 
   3.944008691246401*^9, 3.944009069951805*^9, {3.944048269647918*^9, 
   3.944048272157452*^9}, {3.944048316528047*^9, 3.944048320330218*^9}},
 CellLabel->
  "In[344]:=",ExpressionUUID->"41e0f7db-104a-4846-bdc6-82e8613020dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "pertpairs_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", "pertpairs", 
        ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
       "stepped", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9440059825918207`*^9, 3.944006012901524*^9}, 
   3.944009134480545*^9, {3.9440482631478033`*^9, 3.944048295191884*^9}, {
   3.944307174341209*^9, 3.944307177739485*^9}},
 CellLabel->
  "In[345]:=",ExpressionUUID->"70ee3023-4f28-426d-bd63-82fecb8f1e5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"totalpertdiffs", "[", "ru_", "]"}], ":=", " ", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{"pertdiffs", "[", "ru", "]"}], ",", " ", "3"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943488999175635*^9, 3.943489031675508*^9}},
 CellLabel->
  "In[346]:=",ExpressionUUID->"98769222-0260-425b-9432-156479b78447"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getruleloc", "[", 
   RowBox[{"bits_", ",", " ", "k_", ",", " ", "r_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"FirstPosition", "[", 
    RowBox[{
     RowBox[{"RuleTuples", "[", 
      RowBox[{"k", ",", " ", "r"}], "]"}], ",", " ", "bits"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943536225135035*^9, 3.943536268422502*^9}, {
  3.943536312907648*^9, 3.943536341524619*^9}, {3.943536877478697*^9, 
  3.943536882177637*^9}, {3.943630428601265*^9, 3.943630429778505*^9}},
 CellLabel->
  "In[347]:=",ExpressionUUID->"47522f53-f4f0-4f5a-a80d-879102e4a018"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotrule", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Trim\>\"", "->", 
         RowBox[{"{", 
          RowBox[{"None", ",", " ", "None"}], "}"}]}], ",", " ", 
        RowBox[{"ColorRules", "->", "colorrules"}], ",", 
        RowBox[{"Mesh", "->", "True"}], ",", " ", 
        RowBox[{"MeshStyle", "->", "Gray"}], ",", " ", "ArrayPlot"}], "}"}], 
      "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"digits", ",", " ", "n", ",", " ", "k", ",", " ", "r"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", 
      RowBox[{"interpretrule", "[", "rule", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"digits", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{
       RowBox[{"{", "digits", "}"}], ",", " ", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"OptionValue", "[", "ColorRules", "]"}]}], ",", "\n", "   ", 
       RowBox[{"Mesh", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Mesh", "]"}]}], ",", " ", 
       RowBox[{"MeshStyle", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "MeshStyle", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQ7f6VL3Jz4lvHGYukE0H05Ll3U0G0z3S+dBC9QEI2
G0T3bdpYCqJ3P6quAtEsC83rQPSpgucPQbTQofxHIPpQjtNPEL1czA1M89bf
+AuilVYqM28B0q8clr8C0Z80GF6D6Gsth9+DaJeNmZ9B9L4LwT9AtNcHn98g
+sbXJP6tQNpxp4UAiL5ot04ORAvLMSiC6LL8BnMQ3VJXawGiZeJL5LYB6StW
p8D0FgduVbPUt47elhEaINpeq0EfRG+4NAtMNxSwWYBoiY3GliB60YNPU0D0
++Sq6WB5E8FXFkD6yiVbMP2IbVlvHZDWm3UZTAMAI3KkOA==
  "],
 CellLabel->
  "In[348]:=",ExpressionUUID->"11e9a943-ffa8-4d87-8acf-7ac334323613"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotmaskedrule", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Overlap\>\"", "->", "False"}], ",", 
        RowBox[{"\"\<Trim\>\"", "->", 
         RowBox[{"{", 
          RowBox[{"None", ",", " ", "None"}], "}"}]}], ",", " ", 
        RowBox[{"ColorRules", "->", "withmask"}], ",", 
        RowBox[{"Mesh", "->", "True"}], ",", " ", 
        RowBox[{"MeshStyle", "->", "Gray"}], ",", " ", "ArrayPlot"}], "}"}], 
      "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "mult", ",", " ", "mask", 
      ",", " ", "masked", ",", "digits"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", 
      RowBox[{"interpretrule", "[", "rule", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"digits", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mult", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Overlap\>\"", "]"}], ",", " ", 
        RowBox[{"-", "1"}], ",", " ", "100"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", " ", "=", " ", 
      RowBox[{
       RowBox[{"RuleMask", "[", 
        RowBox[{"rule", ",", " ", 
         RowBox[{"TestLifetime", "[", 
          RowBox[{"rule", ",", " ", "200"}], "]"}]}], "]"}], "*", "mult"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"masked", " ", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"mask", "/.", " ", 
         RowBox[{"0", ":>", " ", "1"}]}], ")"}], " ", "*", " ", 
       RowBox[{"ReplaceAll", "[", 
        RowBox[{"digits", ",", " ", 
         RowBox[{"0", ":>", " ", "100"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Overlap\>\"", "]"}], ",", " ", 
         RowBox[{"{", "masked", "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"digits", ",", " ", "mask"}], "}"}]}], "]"}], ",", " ", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"OptionValue", "[", "ColorRules", "]"}]}], ",", "\n", "   ", 
       RowBox[{"Mesh", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Mesh", "]"}]}], ",", " ", 
       RowBox[{"MeshStyle", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "MeshStyle", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], "\n", 
   "]"}], " "}]], "Code",
 CellChangeTimes->{{3.943543018520018*^9, 3.943543024925357*^9}, {
   3.943543056712764*^9, 3.943543086078494*^9}, {3.943543188883298*^9, 
   3.943543212356685*^9}, {3.943543467538574*^9, 3.943543469967079*^9}, {
   3.943544014779114*^9, 3.94354408055616*^9}, {3.943544118060804*^9, 
   3.94354413717463*^9}, {3.9435442207317657`*^9, 3.943544222286158*^9}, {
   3.943544898663068*^9, 3.943544899783491*^9}, {3.943565120332209*^9, 
   3.943565120715345*^9}, {3.943565232240555*^9, 3.943565248193024*^9}, {
   3.943571648337151*^9, 3.943571649091946*^9}, {3.945378293559987*^9, 
   3.945378299576045*^9}, 3.94537841066947*^9},
 CellLabel->
  "In[349]:=",ExpressionUUID->"8ca4d791-001e-4ff9-92cb-df43c5aa6a93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getgenelocs", "[", 
   RowBox[{"{", 
    RowBox[{"pca_", ",", " ", "ru_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "pidxs", ",", " ", 
      "windows", ",", " ", "oldwindows", ",", " ", "newwindows", ",", " ", 
      "oldrulesets", ",", " ", "newrulesets", ",", " ", "genepairs", ",", " ",
       "locs"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pidxs", " ", "=", " ", 
      RowBox[{"Position", "[", 
       RowBox[{"pca", ",", " ", 
        RowBox[{"perturb", "[", 
         RowBox[{"_", ",", "_"}], "]"}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"windows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"pca", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", " ", 
             RowBox[{"2", "r"}]}], ";;", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
             RowBox[{"2", "r"}]}]}]}], "]"}], "]"}], "&"}], "/@", " ", 
       "pidxs"}]}], ";", "\n", 
     RowBox[{"oldwindows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "/.", " ", 
         RowBox[{
          RowBox[{"perturb", "[", 
           RowBox[{"old_Integer", ",", " ", "new_Integer"}], "]"}], ":>", " ",
           "old"}]}], "&"}], "/@", "windows"}]}], ";", "\n", 
     RowBox[{"newwindows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "/.", " ", 
         RowBox[{
          RowBox[{"perturb", "[", 
           RowBox[{"old_Integer", ",", " ", "new_Integer"}], "]"}], ":>", " ",
           "new"}]}], "&"}], "/@", "windows"}]}], ";", "\n", 
     RowBox[{"oldrulesets", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@",
        " ", "oldwindows"}]}], ";", "\n", 
     RowBox[{"newrulesets", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@",
        " ", "newwindows"}]}], ";", "\n", 
     RowBox[{"genepairs", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#1", ",", " ", "#2"}], "}"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"oldrulesets", ",", " ", "newrulesets"}], "}"}], ",", " ", 
        "2"}], "]"}]}], ";", "\n", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruleloc", "[", 
          RowBox[{"#", ",", " ", "k", ",", " ", "r"}], "]"}], "&"}], ",", " ",
         "genepairs", ",", " ", 
        RowBox[{"{", "3", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellOpen->False,
 CellChangeTimes->{{3.943535216934062*^9, 3.943535289748008*^9}, {
   3.943535408793947*^9, 3.943535462250216*^9}, {3.9435355220241146`*^9, 
   3.943535724103119*^9}, {3.943535840870116*^9, 3.943535901265486*^9}, {
   3.943535938187645*^9, 3.943536096169996*^9}, {3.943536151455696*^9, 
   3.943536172251875*^9}, {3.943536215521476*^9, 3.943536220496792*^9}, {
   3.943536363713807*^9, 3.943536364420107*^9}, {3.943537059843223*^9, 
   3.943537106041222*^9}, {3.943544859224308*^9, 3.943544860767973*^9}, {
   3.943567713933944*^9, 3.9435677560368*^9}, 3.943630348821065*^9, 
   3.943632168039295*^9, {3.943806688629696*^9, 3.943806694542572*^9}, {
   3.943988225981876*^9, 3.943988233116807*^9}, 3.9439883884248953`*^9, {
   3.943988618058452*^9, 3.943988658585402*^9}},
 CellLabel->
  "In[350]:=",ExpressionUUID->"5776f0b4-ff49-4d9e-ad5d-921e615769e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"withmask", " ", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"colorrules", ",", " ", 
     RowBox[{"{", 
      RowBox[{"100", "->", 
       RowBox[{"GrayLevel", "[", "0.2", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.943541004391426*^9, 3.943541042345522*^9}, {
   3.9435411183138027`*^9, 3.943541131214537*^9}, {3.943544093893063*^9, 
   3.943544094051305*^9}, 3.943544191718172*^9, {3.945379045205536*^9, 
   3.945379049763938*^9}, {3.945383769485014*^9, 3.945383777880656*^9}},
 CellLabel->
  "In[351]:=",ExpressionUUID->"cda64b35-4644-476c-b214-c3a22c1cc08f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getmidx", "[", 
   RowBox[{"x1_", ",", " ", "x2_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"x1", " ", "-", " ", "x2"}], ")"}], "/", " ", "2"}], "+", 
   "x2"}]}]], "Code",
 CellLabel->
  "In[352]:=",ExpressionUUID->"5b91306a-5235-432f-8739-e5cdb7a6bcab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcurves", "[", 
   RowBox[{"locs_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    RowBox[{"y_", ":", "2"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "digs", ",", " ", "cols", ",", " ", "withmid", ",", " ", "pts", ",", " ",
       "curves", ",", " ", "styled"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"digs", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cols", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"digs", "[", 
            RowBox[{"[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], " ", "==", " ", 
           RowBox[{"digs", "[", 
            RowBox[{"[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
          TemplateBox[<|"color" -> RGBColor[0.36, 0.8300000000000001, 0]|>,
           "RGBColorSwatchTemplate"], ",", " ", 
          TemplateBox[<|"color" -> RGBColor[1., 0.63, 0.1]|>,
           "RGBColorSwatchTemplate"]}], "]"}], "&"}], "/@", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"locs", ",", " ", "1"}], "]"}]}]}], ";", "\n", 
     RowBox[{"withmid", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"getmidx", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], ",", " ", 
        RowBox[{"locs", " ", "-", " ", 
         RowBox[{"1", "/", "2"}]}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pts", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", "y"}], "}"}], ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "-", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "+", " ", 
                    "1"}], ")"}], "/", "2"}], ",", " ", 
                 RowBox[{"y", "+", "3"}]}], "]"}], ",", " ", "10"}], "]"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", "y"}], "}"}]}], "}"}],
          " ", "&"}], ",", " ", "withmid", ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"curves", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"BezierCurve", ",", " ", "pts", ",", " ", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", " ", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"styled", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrow", "/@", " ", "curves"}], ",", " ", "cols"}], "}"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Arrowheads", "[", "0.025", "]"}], ",", 
        RowBox[{"GrayLevel", "[", "0.4", "]"}], ",", " ", "styled"}], "}"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.943544795102071*^9, 3.943544838624312*^9}, {
   3.943544935265343*^9, 3.943544959621169*^9}, {3.943545013723435*^9, 
   3.9435450398428383`*^9}, {3.943546537026382*^9, 3.943546537139508*^9}, {
   3.943547863810707*^9, 3.9435478761548643`*^9}, {3.943564805141321*^9, 
   3.943564811748916*^9}, {3.943565199196966*^9, 3.943565206167427*^9}, {
   3.943986434658898*^9, 3.94398645798109*^9}, {3.943986494590817*^9, 
   3.943986520034356*^9}, {3.943986552387456*^9, 3.943986596681422*^9}, {
   3.943986939334586*^9, 3.943986981320734*^9}, {3.943987025957817*^9, 
   3.943987026062334*^9}, 3.943987077967525*^9, {3.943987388459023*^9, 
   3.943987404067129*^9}, {3.94398745275674*^9, 3.943987457919425*^9}, {
   3.943987529289364*^9, 3.943987567336049*^9}, {3.943987613937373*^9, 
   3.943987619026284*^9}, {3.943987650353419*^9, 3.943987663181628*^9}, {
   3.943987696403656*^9, 3.943987819599753*^9}, 3.94398786923733*^9, {
   3.943988043867075*^9, 3.94398804864673*^9}, {3.943988082476531*^9, 
   3.943988119566781*^9}, {3.94398824687779*^9, 3.94398824817213*^9}, {
   3.9439882855613832`*^9, 3.943988305778015*^9}, {3.943988386444175*^9, 
   3.9439884643267803`*^9}, {3.943988532267455*^9, 3.943988561178733*^9}, {
   3.9439886242932577`*^9, 3.943988632768743*^9}, {3.944307213996324*^9, 
   3.94430722298189*^9}},
 CellLabel->
  "In[353]:=",ExpressionUUID->"f561a8ee-a541-4829-8d20-5d76e4cc776a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbedRulePlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Mask\>\"", "->", "False"}], ",", " ", "ops"}], "}"}], 
        ",", "Last"}], "]"}]}], "}"}], ",", "\n", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"allops", "[", "\"\<Mask\>\"", "]"}], ",", " ", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"plotmaskedrule", "[", "ru", "]"}], ",", 
        RowBox[{"getcurves", "[", 
         RowBox[{
          RowBox[{"getgenelocs", "[", 
           RowBox[{"{", 
            RowBox[{"pca", ",", " ", "ru"}], "}"}], " ", "]"}], ",", "ru", 
          ",", " ", "2"}], "]"}], ",", " ", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}]}], "]"}], ",",
       " ", "\n", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"plotrule", "[", "ru", "]"}], ",", 
        RowBox[{"getcurves", "[", 
         RowBox[{
          RowBox[{"getgenelocs", "[", 
           RowBox[{"{", 
            RowBox[{"pca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "ru", 
          ",", " ", "1"}], "]"}], ",", " ", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}]}], "]"}]}], 
     "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943546585830142*^9, 3.943546700959848*^9}, {
   3.943546733696267*^9, 3.943546783376753*^9}, {3.943565687127426*^9, 
   3.943565771163789*^9}, {3.943565808630843*^9, 3.943565815624713*^9}, {
   3.943566678352837*^9, 3.943566703834824*^9}, {3.943985383402685*^9, 
   3.943985451836494*^9}, {3.943985520761273*^9, 3.943985555021875*^9}, {
   3.943985585476218*^9, 3.943985599967126*^9}, {3.943985650309591*^9, 
   3.943985660710388*^9}, {3.943985700989663*^9, 3.943985776525967*^9}, {
   3.943985878536968*^9, 3.943985879537179*^9}, 3.943985972164542*^9, {
   3.943986035077784*^9, 3.943986038393976*^9}, {3.943986141046876*^9, 
   3.94398617546957*^9}, {3.943986295225086*^9, 3.943986295366105*^9}, {
   3.943988675757477*^9, 3.943988684293489*^9}},
 CellLabel->
  "In[354]:=",ExpressionUUID->"4ef5c2fd-2540-4840-b4bc-d647e18d6feb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"activebodytups", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"tupfunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"4", "#"}], "+", "1"}], "&"}], ")"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "lt", ",", " ", 
      "bodytups"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lt", " ", "=", " ", 
      RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bodytups", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{"tupfunc", "[", "r", "]"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
              RowBox[{"2", "r"}]}], ";;", " ", 
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
              RowBox[{"2", "r"}]}]}], "]"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ca", "[", 
            RowBox[{"[", 
             RowBox[{";;", "lt"}], "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nonzeroRange", "/@", "ca"}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{";;", "lt"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.9440046799197903`*^9, 3.944004692765506*^9}, {
  3.944004752693272*^9, 3.944004757086856*^9}, {3.944004857547843*^9, 
  3.94400489237796*^9}, {3.9440049467986803`*^9, 3.944005039118494*^9}, {
  3.944005171248589*^9, 3.944005188081563*^9}, {3.944010919817169*^9, 
  3.944010920742443*^9}, {3.944012827562276*^9, 3.944013017745034*^9}, {
  3.944013129031476*^9, 3.94401315476455*^9}, {3.944013392552102*^9, 
  3.944013392887691*^9}, {3.94424869201299*^9, 3.944248734874711*^9}, {
  3.944307227705228*^9, 3.944307231034797*^9}},
 CellLabel->
  "In[355]:=",ExpressionUUID->"5c2cfaa5-916d-44f1-9ae1-a17fffaa374f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertpairs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "active_"}], "]"}], ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"getpertrus", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"getperts", "[", 
        RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", "active"}],
    ")"}], " "}]], "Code",
 CellChangeTimes->{{3.944004893875792*^9, 3.944004897345372*^9}, {
   3.944005058399239*^9, 3.9440050617568283`*^9}, {3.944005092743585*^9, 
   3.944005102983451*^9}, {3.944005327678811*^9, 3.9440053321178637`*^9}, {
   3.944005407103117*^9, 3.944005423682027*^9}, {3.944006005850071*^9, 
   3.944006006699265*^9}, {3.944007338237412*^9, 3.944007339278685*^9}, {
   3.944007509512716*^9, 3.94400754891026*^9}, 3.944008435691231*^9, 
   3.944008691246401*^9, 3.944009069951805*^9, {3.944048269647918*^9, 
   3.944048272157452*^9}, {3.944048316528047*^9, 3.944048320330218*^9}},
 CellLabel->
  "In[356]:=",ExpressionUUID->"8954d162-4f8e-420b-9308-3ece81ecba04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "pertpairs_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped", ",", " ", "mask"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", "pertpairs", 
        ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"Except", "[", "0", "]"}], "->", "1"}]}], "]"}], "&"}], 
        ",", " ", "stepped", ",", " ", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{"mask", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9440059825918207`*^9, 3.944006012901524*^9}, 
   3.944009134480545*^9, {3.9440482631478033`*^9, 3.944048295191884*^9}, {
   3.944057877395526*^9, 3.944057901187666*^9}, {3.944057948755806*^9, 
   3.944058039270236*^9}, {3.944058180582039*^9, 3.944058247245678*^9}, {
   3.944058289014187*^9, 3.944058312282283*^9}, {3.9440583575057793`*^9, 
   3.944058364152249*^9}, {3.94430723420575*^9, 3.944307241522789*^9}},
 CellLabel->
  "In[357]:=",ExpressionUUID->"8993189a-b736-449c-a026-a7fc5825985f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"meanmicrofragility", "[", 
   RowBox[{"{", 
    RowBox[{"ca_", ",", " ", "ru_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", ",", "k", ",", " ", "r", ",", "counts", ",", " ", "pd"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"counts", " ", "=", " ", 
      RowBox[{"ReverseSort", "[", 
       RowBox[{"Counts", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"activebodytups", "[", 
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
         "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pd", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", " ", 
        RowBox[{"getpertpairs", "[", 
         RowBox[{"ru", ",", " ", 
          RowBox[{"Keys", "[", "counts", "]"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"N", "@", 
      RowBox[{"Mean", "[", 
       RowBox[{"WeightedData", "[", 
        RowBox[{
         RowBox[{"Mean", "/@", " ", "pd"}], ",", " ", 
         RowBox[{"Values", "[", "counts", "]"}]}], "]"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944089470000523*^9, 3.944089567444223*^9}, {
  3.944089610819311*^9, 3.944089612627388*^9}, {3.944089651309394*^9, 
  3.944089728204438*^9}, {3.94408980953834*^9, 3.944089835320683*^9}, {
  3.94409000278721*^9, 3.944090044832939*^9}, {3.94409032329638*^9, 
  3.9440903345896797`*^9}, {3.944090367357248*^9, 3.944090446261436*^9}, {
  3.944091572228297*^9, 3.94409157774517*^9}},
 CellLabel->
  "In[358]:=",ExpressionUUID->"76d73aa6-a494-4450-9c21-505a85a21ed7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbationSensitivityGraphs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"size_", ":", "1"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"counts", " ", "=", 
       RowBox[{
        RowBox[{"Rest", "[", 
         RowBox[{"Counts", "[", 
          RowBox[{"Sort", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"activebodytups", "[", 
              RowBox[{"{", 
               RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
            "]"}], "]"}], "]"}], "]"}], "*", "size"}]}], ",", " ", "\n", 
      "pairs", ",", " ", "diffs", ",", " ", "edges", ",", " ", "cols", ",", 
      " ", "styled", ",", " ", "cg", ",", " ", "cgs", ",", " ", "gps"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pairs", " ", "=", " ", 
      RowBox[{"getpertpairs", "[", 
       RowBox[{"ru", ",", 
        RowBox[{"Keys", "[", "counts", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffs", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", "pairs"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"edges", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[DirectedEdge]", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", " ", "pairs", ",", 
        " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cols", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{"#", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"0", ":>", 
              TemplateBox[<|"color" -> RGBColor[0, 0.77, 0]|>,
               "RGBColorSwatchTemplate"]}], ",", 
             RowBox[{"1", ":>", 
              TemplateBox[<|"color" -> RGBColor[0.88, 0.84, 0]|>,
               "RGBColorSwatchTemplate"]}], ",", " ", 
             RowBox[{"2", ":>", " ", "Orange"}], ",", 
             RowBox[{"3", ":>", " ", "Red"}]}], "}"}]}], "]"}], "&"}], ",", 
        " ", "diffs", ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"styled", "  ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"#1", ",", "#2"}], " ", "]"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"edges", ",", "cols"}], "}"}], ",", " ", "2"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"cg", " ", "=", " ", 
      RowBox[{"WeaklyConnectedGraphComponents", "[", 
       RowBox[{"Flatten", "[", "styled", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cgs", " ", "=", " ", 
      RowBox[{"ReverseSortBy", "[", 
       RowBox[{"cg", ",", " ", 
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"counts", "[", "#", "]"}], "&"}], "/@", 
           RowBox[{
            RowBox[{"EdgeList", "[", "#", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "]"}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gps", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"cw", " ", "=", 
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"counts", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{
                RowBox[{"EdgeList", "[", "#", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "]"}]}], ",",
             " ", 
            RowBox[{"vws", " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "->", 
                RowBox[{
                 RowBox[{"counts", "[", "#", "]"}], "/", "20"}]}], "&"}], "/@", 
              RowBox[{"VertexList", "[", "#", "]"}]}]}]}], "}"}], ",", " ", 
          "\n", 
          RowBox[{"GraphPlot", "[", 
           RowBox[{"#", ",", 
            RowBox[{"ImageSize", "->", 
             RowBox[{"cw", "*", ".75"}]}], ",", 
            RowBox[{"EdgeShapeFunction", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "\"\<FilledArrow\>\"", "}"}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Arrow", "[", "#1", "]"}], ",", "\n", 
                   RowBox[{"Arrowheads", "[", 
                    RowBox[{
                    RowBox[{"counts", "[", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "200"}], 
                    "]"}], ",", " ", 
                   RowBox[{"Thickness", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"counts", "[", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"cw", "*", "5"}], ")"}]}], ")"}], "]"}]}], "]"}], 
                 "&"}], ")"}]}], "}"}]}], ",", " ", "\n", 
            RowBox[{"VertexLabels", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x_", "/;", 
                RowBox[{
                 RowBox[{"counts", "[", "x", "]"}], ">=", "8"}]}], ":>", 
               RowBox[{"Placed", "[", 
                RowBox[{
                 RowBox[{"ArrayPlot", "[", 
                  RowBox[{
                   RowBox[{"{", "x", "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Mesh", "->", "True"}], ",", 
                   RowBox[{"ImageSize", "->", 
                    RowBox[{"1.25", 
                    RowBox[{"counts", "[", "x", "]"}]}]}], ",", " ", 
                   RowBox[{"ColorRules", "->", "colorrules"}]}], "]"}], ",", 
                 "Center"}], "]"}]}], "}"}]}]}], "]"}]}], "]"}], "&"}], "/@", 
       " ", "cgs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Multicolumn", "[", 
      RowBox[{"gps", ",", " ", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", " ", 
         RowBox[{"Floor", "[", 
          RowBox[{
           RowBox[{"Length", "[", "counts", "]"}], "/", "12"}], "]"}]}], 
        "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944238420450803*^9, 3.944238467737119*^9}, {
   3.944238520618046*^9, 3.944238543749881*^9}, {3.944238579950418*^9, 
   3.9442387151492653`*^9}, 3.944238868297678*^9, {3.944238924562327*^9, 
   3.944238927340978*^9}, {3.944238963429169*^9, 3.944238964090165*^9}, {
   3.944239185557859*^9, 3.944239222900076*^9}, {3.944239355581547*^9, 
   3.944239357277615*^9}, {3.944239488113841*^9, 3.944239504221046*^9}, {
   3.944239547623726*^9, 3.944239547721741*^9}, 3.94423972060432*^9, {
   3.94430725336372*^9, 3.944307290711181*^9}, {3.944307328092708*^9, 
   3.944307347568986*^9}, {3.945383828611046*^9, 3.945383830126903*^9}},
 CellLabel->
  "In[359]:=",ExpressionUUID->"9227b1b7-0d7b-48e5-ac25-014980542ee9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbationSensitivityChart", "]"}], " ", "=", 
   " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<NumBars\>\"", "->", "100"}], ",", " ", 
     RowBox[{"\"\<ShowSequences\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<TuplesFunction\>\"", "->", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"4", "#"}], "+", "1"}], "&"}], ")"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbationSensitivityChart", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "PerturbationSensitivityChart", "]"}]}], 
   "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"counts", " ", "=", 
       RowBox[{"Rest", "[", 
        RowBox[{"Counts", "[", 
         RowBox[{"Sort", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"activebodytups", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
              RowBox[{"OptionValue", "[", "\"\<TuplesFunction\>\"", "]"}]}], 
             "]"}], ",", " ", "1"}], "]"}], "]"}], "]"}], "]"}]}], ",", " ", 
      "n", ",", " ", "k", ",", " ", "r", ",", " ", "pp", ",", " ", "pd", ",", 
      "\n", "withcols", ",", " ", "labfunc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pp", " ", "=", " ", 
      RowBox[{"getpertpairs", "[", 
       RowBox[{"ru", ",", 
        RowBox[{"Keys", "[", 
         RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pd", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", "pp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"withcols", " ", "=", "  ", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"Blend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                TemplateBox[<|"color" -> RGBColor[0, 0.77, 0]|>,
                 "RGBColorSwatchTemplate"], ",", 
                TemplateBox[<|"color" -> RGBColor[0.88, 0.84, 0]|>,
                 "RGBColorSwatchTemplate"], ",", " ", "Orange", ",", "Red"}], 
               "}"}], ",", 
              RowBox[{
               RowBox[{"Total", "[", "#2", "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"k", " ", "-", " ", "1"}], ")"}], " ", "*", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", "r"}], "+", "1"}], ")"}]}], ")"}]}]}], 
             "]"}]}], "]"}], "&"}], ",", " ", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], ",", " ", 
           "pd"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{";;", 
         RowBox[{"UpTo", "[", 
          RowBox[{"Replace", "[", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<NumBars\>\"", "]"}], ",", " ", 
            RowBox[{"All", ":>", " ", 
             RowBox[{"Length", "[", "pd", "]"}]}]}], "]"}], "]"}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"labfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ShowSequences\>\"", "]"}], ",", " ", 
        
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"PlotCA", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Keys", "[", 
                  RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"#2", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "}"}]}], ",",
               " ", 
              RowBox[{"ImageSize", "->", 
               RowBox[{"{", 
                RowBox[{"20", ",", " ", "30"}], "}"}]}]}], "]"}], ",", 
            "Below"}], "]"}], "&"}], ")"}], ",", " ", "Automatic"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"BarChart", "[", 
      RowBox[{"withcols", ",", " ", 
       RowBox[{"LabelingFunction", "->", " ", "labfunc"}]}], "]"}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.944241249383291*^9, 3.944241260816337*^9}, {
  3.944241295763332*^9, 3.944241382921158*^9}, {3.944241459928853*^9, 
  3.944241851170583*^9}, {3.944241923484763*^9, 3.944241947731597*^9}, {
  3.944242011537417*^9, 3.944242011751195*^9}, {3.944242998362563*^9, 
  3.944243009829999*^9}, {3.944307309202841*^9, 3.944307315017668*^9}, {
  3.944307358924268*^9, 3.944307369369523*^9}, {3.9453829097961683`*^9, 
  3.9453829224291687`*^9}, {3.945382965722271*^9, 3.945382976473565*^9}},
 CellLabel->
  "In[360]:=",ExpressionUUID->"687166cd-9349-4a64-af9d-54599751fe14"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleFrequencyChart", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "PerturbationSensitivityChart", "]"}]}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"counts", " ", "=", 
       RowBox[{"Counts", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"activebodytups", "[", 
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
         "]"}], "]"}]}], ",", " ", "n", ",", " ", "k", ",", " ", "r", ",", 
      " ", "pp", ",", " ", "pd", ",", "\n", "withcols", ",", " ", "labfunc"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"counts", " ", "=", 
      RowBox[{"Counts", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"activebodytups", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<TuplesFunction\>\"", "]"}]}], 
          "]"}], ",", " ", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pp", " ", "=", " ", 
      RowBox[{"getpertpairs", "[", 
       RowBox[{"ru", ",", 
        RowBox[{"Keys", "[", 
         RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pd", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", "pp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"labfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ShowSequences\>\"", "]"}], ",", " ", 
        "\n", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"ArrayPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Keys", "[", 
                  RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"#2", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "}"}]}], ",",
               " ", 
              RowBox[{"ImageSize", "->", 
               RowBox[{"{", 
                RowBox[{"20", ",", " ", "20"}], "}"}]}], ",", " ", 
              RowBox[{"ColorRules", "->", "colorrules"}]}], "]"}], ",", 
            "Below"}], "]"}], "&"}], ")"}], ",", " ", "Automatic"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"BarChart", "[", 
      RowBox[{
       RowBox[{"Values", "[", 
        RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], ",", " ", 
       RowBox[{"LabelingFunction", "->", " ", "labfunc"}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945382743071206*^9, 3.945382882980315*^9}, {
   3.9453830339230623`*^9, 3.945383088405328*^9}, {3.945383138134822*^9, 
   3.945383145198866*^9}, {3.945383215752412*^9, 3.945383238676326*^9}, {
   3.945383289052498*^9, 3.945383290413406*^9}, {3.945383863700986*^9, 
   3.945383899194386*^9}, {3.945383933081987*^9, 3.945383935825959*^9}, 
   3.945384315649118*^9},
 CellLabel->
  "In[362]:=",ExpressionUUID->"cece8040-3c79-43f7-af08-d97ac1d642ee"]
}, Closed]],

Cell[CellGroupData[{

Cell["Adaptive Cellular Automaton", "Section",
 CellChangeTimes->{{3.945266329376746*^9, 
  3.945266342090605*^9}},ExpressionUUID->"4fc1db56-03ee-46e3-b8fa-\
bf546a73f757"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "AdaptCA"}]], "Input",
 CellChangeTimes->{{3.945288805599286*^9, 3.945288812776019*^9}},
 CellLabel->
  "In[306]:=",ExpressionUUID->"64c1bb36-84e9-41c7-962a-588dfa935683"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymIndexMap", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymIndexMap", "[", 
    RowBox[{"k", ",", "r"}], "]"}], "=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tups", "=", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{"k", "-", "1"}]}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"2", "r"}], "+", "1"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Sort", "[", 
      RowBox[{"Catenate", "[", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"tups", ",", "#"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"tups", ",", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{"Reverse", "[", "#", "]"}]}], "}"}], "]"}], "&"}]}], 
          "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Code",
 CellChangeTimes->{{3.921276552687866*^9, 3.921276580328933*^9}, {
  3.9216710929557953`*^9, 3.921671100676935*^9}},
 CellLabel->
  "In[363]:=",ExpressionUUID->"0a23268f-a11c-439d-a0e2-59a24b67a0a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymUp", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymUp", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{
    RowBox[{"SymIndexMap", "[", 
     RowBox[{"k", ",", "r"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.921276384975207*^9, 3.921276649760997*^9}},
 CellLabel->
  "In[364]:=",ExpressionUUID->"0b0e8d19-9312-4197-9836-619b59ac8dc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymDown", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymDown", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{"Values", "[", 
    RowBox[{"KeySort", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"First", ",", "\[IndentingNewLine]", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"SymIndexMap", "[", 
          RowBox[{"k", ",", "r"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Last", "->", "First"}]}], "]"}]}], "]"}], "]"}], 
    "]"}]}]}]], "Code",
 CellChangeTimes->{{3.9212766561634283`*^9, 3.921276659673758*^9}, {
  3.9212767190156803`*^9, 3.921276735250161*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"26fc0ac2-e7a8-4c94-a4bd-abc4d2e33646"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RandomRuleMutation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rn_", ",", "k_", ",", "r_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"many_Integer", ":", "1"}], ",", "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Symmetric\>\"", "->", "False"}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"up", ",", "down", ",", "cases"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"up", ",", "down"}], "}"}], "=", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Symmetric\>\"", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"SymUp", "[", 
           RowBox[{"k", ",", "r"}], "]"}], ",", 
          RowBox[{"SymDown", "[", 
           RowBox[{"k", ",", "r"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"All", ",", "All"}], "}"}]}], "\[IndentingNewLine]", "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"cases", "=", 
      RowBox[{
       RowBox[{"IntegerDigits", "[", 
        RowBox[{"rn", ",", "k", ",", 
         RowBox[{"k", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}], "[", 
       RowBox[{"[", "down", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FromDigits", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "up", "]"}], "]"}], ",", "k"}], "]"}], ",", "k", ",",
          "r"}], "}"}], "&"}], "[", "\[IndentingNewLine]", 
      RowBox[{"MapAt", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}], "]"}]}], ",", "k"}], "]"}], 
         "&"}], ",", "\[IndentingNewLine]", "cases", ",", 
        RowBox[{"List", "/@", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"1", ";;", 
            RowBox[{
             RowBox[{"Length", "[", "cases", "]"}], "-", "1"}]}], ",", 
           "many"}], "]"}]}]}], "]"}], "\[IndentingNewLine]", "]"}]}]}], " ", 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellLabel->
  "In[366]:=",ExpressionUUID->"1c06dd49-3956-4c69-9d3d-46b071ea723a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getevofunc", "[", 
   RowBox[{"pertfunc_", ",", " ", "nperts_", ",", " ", "allops_Association"}],
    "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"Function", "[", 
   RowBox[{"evoobject", ",", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"nru", " ", "=", " ", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<VariationFunction\>\"", "]"}], "[", 
          RowBox[{"evoobject", "[", "\"\<rule\>\"", "]"}], "]"}]}], ",", " ", 
        "nca", ",", "ncas", ",", "  ", "ffit", ",", " ", "nfit", ",", "nfits",
         ",", " ", "nobject"}], "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nca", " ", "=", " ", 
        RowBox[{
         RowBox[{"allops", "[", "\"\<AutomatonFunction\>\"", "]"}], "[", 
         "nru", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ffit", "  ", "=", " ", 
        RowBox[{
         RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "[", "nca", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<FitnessDeathValue\>\"", "]"}], " ", "==",
           "  ", "ffit"}], ",", " ", "evoobject", ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"ncas", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "nca", "}"}], ",", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"pertfunc", "[", 
                RowBox[{"{", 
                 RowBox[{"nca", ",", " ", "nru"}], "}"}], "]"}], ",", " ", 
               "nperts"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nfits", " ", "=", " ", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "/@", 
            "ncas"}]}], ";", " ", "\[IndentingNewLine]", 
          RowBox[{"nfit", " ", "=", " ", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<CombinationFunction\>\"", "]"}], "[", 
            "nfits", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nobject", " ", "=", " ", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<rule\>\"", "->", " ", "nru"}], ",", " ", 
             RowBox[{"\"\<fitness\>\"", "->", "nfit"}], ",", " ", 
             RowBox[{"\"\<cas\>\"", "->", " ", "ncas"}]}], "|>"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Merge", "[", 
           RowBox[{
            RowBox[{"KeyIntersection", "[", 
             RowBox[{"{", 
              RowBox[{"evoobject", ",", " ", "nobject"}], "}"}], "]"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"allops", "[", "\"\<SelectionFunction\>\"", "]"}], "[", 
               RowBox[{
                RowBox[{"evoobject", "[", "\"\<fitness\>\"", "]"}], ",", " ", 
                "nfit"}], "]"}], ",", " ", "Last", ",", " ", "First"}], 
             "]"}]}], "]"}]}]}], " ", "\[IndentingNewLine]", "]"}]}]}], 
     "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945447215478972*^9, 3.945447321729787*^9}, 
   3.945447395588907*^9, {3.945447429001214*^9, 3.94544743046972*^9}, {
   3.945447478534067*^9, 3.945447487248889*^9}, {3.945448299817816*^9, 
   3.945448315181275*^9}, {3.945464029623768*^9, 3.945464075391758*^9}},
 CellLabel->
  "In[367]:=",ExpressionUUID->"9b036818-9af7-4239-b0e3-f9f4afcfa338"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getevofunc", "[", 
   RowBox[{"pertfunc_", ",", " ", "nperts_", ",", " ", "allops_Association"}],
    "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"Function", "[", 
   RowBox[{"evoobject", ",", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"nru", " ", "=", " ", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<VariationFunction\>\"", "]"}], "[", 
          RowBox[{"evoobject", "[", "\"\<rule\>\"", "]"}], "]"}]}], ",", " ", 
        "nca", ",", "ncas", ",", "  ", "ffit", ",", " ", "nfit", ",", "nfits",
         ",", " ", "nobject"}], "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nca", " ", "=", " ", 
        RowBox[{
         RowBox[{"allops", "[", "\"\<AutomatonFunction\>\"", "]"}], "[", 
         "nru", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ffit", "  ", "=", " ", 
        RowBox[{
         RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "[", "nca", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<FitnessDeathValue\>\"", "]"}], " ", "==",
           "  ", "ffit"}], ",", " ", "evoobject", ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"ncas", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "nca", "}"}], ",", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"pertfunc", "[", 
                RowBox[{"{", 
                 RowBox[{"nca", ",", " ", "nru"}], "}"}], "]"}], ",", " ", 
               "nperts"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nfits", " ", "=", " ", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "/@", 
            "ncas"}]}], ";", " ", "\[IndentingNewLine]", 
          RowBox[{"nfit", " ", "=", " ", 
           RowBox[{
            RowBox[{"allops", "[", "\"\<CombinationFunction\>\"", "]"}], "[", 
            "nfits", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nobject", " ", "=", " ", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<rule\>\"", "->", " ", "nru"}], ",", " ", 
             RowBox[{"\"\<fitness\>\"", "->", "nfit"}]}], "|>"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Merge", "[", 
           RowBox[{
            RowBox[{"KeyIntersection", "[", 
             RowBox[{"{", 
              RowBox[{"evoobject", ",", " ", "nobject"}], "}"}], "]"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"allops", "[", "\"\<SelectionFunction\>\"", "]"}], "[", 
               RowBox[{
                RowBox[{"evoobject", "[", "\"\<fitness\>\"", "]"}], ",", " ", 
                "nfit"}], "]"}], ",", " ", "Last", ",", " ", "First"}], 
             "]"}]}], "]"}]}]}], " ", "\[IndentingNewLine]", "]"}]}]}], 
     "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945447215478972*^9, 3.945447321729787*^9}, 
   3.945447395588907*^9, {3.945447429001214*^9, 3.94544743046972*^9}, {
   3.945447478534067*^9, 3.945447487248889*^9}, {3.945448299817816*^9, 
   3.945448315181275*^9}, {3.945464029623768*^9, 3.945464088804923*^9}},
 CellLabel->
  "In[368]:=",ExpressionUUID->"a0edf564-a0b8-4bc1-8fea-113b64b18b8a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getinitobject", "[", 
   RowBox[{
   "initrule_", ",", " ", "pertfunc_", ",", "nperts_", ",", " ", 
    "allops_Association"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ca", ",", " ", "pcaops", ",", " ", "initcas", ",", " ", "initfits", ",",
       " ", "initobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{
       RowBox[{"allops", "[", "\"\<AutomatonFunction\>\"", "]"}], "[", 
       "initrule", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"initcas", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "ca", "}"}], ",", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"pertfunc", "[", 
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "initrule"}], "}"}], "]"}], ",", " ", 
          "nperts"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"initfits", " ", "=", " ", 
      RowBox[{
       RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "/@", 
       "initcas"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"initobject", " ", "=", "  ", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<rule\>\"", "->", " ", "initrule"}], ",", " ", 
        RowBox[{"\"\<fitness\>\"", "->", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<CombinationFunction\>\"", "]"}], "[", 
          "initfits", "]"}]}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<ReturnCAs\>\"", "]"}], ",", 
          RowBox[{"\"\<cas\>\"", "->", " ", "initcas"}], ",", "Nothing"}], 
         "]"}]}], "|>"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.945447363981943*^9, 3.945447401375894*^9}, {
  3.9454474409867077`*^9, 3.945447511479883*^9}, {3.9454475605723352`*^9, 
  3.945447562020033*^9}, {3.945447873168528*^9, 3.945447875706834*^9}, {
  3.945448031456316*^9, 3.945448043294574*^9}, {3.945460244044112*^9, 
  3.945460251180218*^9}, {3.945462683557873*^9, 3.9454626844304233`*^9}},
 CellLabel->
  "In[369]:=",ExpressionUUID->"52493db3-29ba-47cb-8cce-e9563a6a30b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "AdaptCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<VariationFunction\>\"", "->", "RandomRuleMutation"}], ",", 
     RowBox[{"\"\<AutomatonFunction\>\"", "->", "getca"}], ",", " ", 
     RowBox[{"\"\<FitnessFunction\>\"", "->", "TestCALifeTime"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<FitnessDeathValue\>\"", "->", 
      RowBox[{"-", "Infinity"}]}], ",", 
     RowBox[{"\"\<Perturbation\>\"", "->", "None"}], ",", 
     RowBox[{"\"\<NPerturbations\>\"", "->", "1"}], ",", 
     RowBox[{"\"\<CombinationFunction\>\"", "->", "Min"}], ",", " ", 
     RowBox[{"\"\<SelectionFunction\>\"", "->", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"fit1", ",", " ", "fit2"}], "}"}], ",", " ", 
        RowBox[{"fit2", ">=", "fit1"}]}], "]"}]}], ",", " ", 
     RowBox[{"\"\<ReturnCAs\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<PerturbationFunction\>\"", "->", "None"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"AdaptCA", "[", 
   RowBox[{
    RowBox[{"initrule_List", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "3", ",", " ", "1"}], "}"}]}], ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcaops", ",", " ", "pertfunc", ",", 
      " ", "initcas", ",", " ", "initfits", ",", " ", "initobject", ",", " ", 
      "nperts", ",", " ", "evofunc", ",", " ", "ncas", ",", " ", "nfits", ",",
       " ", "nobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"initobject", " ", "=", " ", 
      RowBox[{"getinitobject", "[", 
       RowBox[{
       "initrule", ",", " ", "pertfunc", ",", "nperts", ",", " ", "allops"}], 
       "]"}]}], ";", "\n", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"NestList", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.945266347298204*^9, 3.945266510611971*^9}, {
   3.945266548825857*^9, 3.945266550410791*^9}, {3.945268016078183*^9, 
   3.945268032142717*^9}, {3.945269107272526*^9, 3.94526911449774*^9}, {
   3.945269279580195*^9, 3.9452692938640947`*^9}, {3.945271810557001*^9, 
   3.945272218099633*^9}, {3.945273385911368*^9, 3.945273436835957*^9}, {
   3.945273506952347*^9, 3.945273560819565*^9}, {3.9452735910394588`*^9, 
   3.945274203127338*^9}, {3.945274237522272*^9, 3.945274343950425*^9}, {
   3.945274506234223*^9, 3.945274562658798*^9}, {3.945274616503378*^9, 
   3.9452746603173656`*^9}, {3.945274698429175*^9, 3.945274783319426*^9}, {
   3.945274848605851*^9, 3.9452749606025352`*^9}, {3.945275029070685*^9, 
   3.945275135733245*^9}, {3.945275182863851*^9, 3.945275221946412*^9}, {
   3.945275262417237*^9, 3.945275596744805*^9}, {3.945275738704367*^9, 
   3.945276013867606*^9}, 3.945276058551349*^9, 3.945276651635416*^9, {
   3.945276699749899*^9, 3.945276711552902*^9}, {3.945276792387329*^9, 
   3.9452768229580507`*^9}, {3.945277094229609*^9, 3.945277103309697*^9}, 
   3.945278579486566*^9, {3.945278684328342*^9, 3.945278777648252*^9}, {
   3.945283207433051*^9, 3.94528322304812*^9}, {3.945286751130001*^9, 
   3.945286967127088*^9}, {3.94528703938305*^9, 3.9452871136798*^9}, {
   3.945287144861001*^9, 3.945287157454178*^9}, {3.945287343138464*^9, 
   3.945287405517154*^9}, {3.945287451123786*^9, 3.94528751497371*^9}, {
   3.94528876852215*^9, 3.945288773503803*^9}, {3.94528926679877*^9, 
   3.945289335808309*^9}, {3.945289406537052*^9, 3.945289407270677*^9}, {
   3.94528950551687*^9, 3.945289510055008*^9}, {3.945291265390485*^9, 
   3.945291266776462*^9}, {3.945297202206361*^9, 3.945297251261252*^9}, {
   3.945299500736367*^9, 3.9452995337161303`*^9}, {3.945304908454424*^9, 
   3.945304913598891*^9}, {3.9453051411135817`*^9, 3.945305152655653*^9}, {
   3.945305457248176*^9, 3.945305457646864*^9}, 3.9453059174390373`*^9, 
   3.945352393400782*^9, {3.9453525156122513`*^9, 3.945352549273878*^9}, {
   3.94535285315694*^9, 3.945352856079548*^9}, {3.945353982277117*^9, 
   3.945353990091741*^9}, {3.945362901544997*^9, 3.94536291249011*^9}, 
   3.945363008943507*^9, {3.945363352880908*^9, 3.945363375695158*^9}, {
   3.945446735263548*^9, 3.94544673911515*^9}, {3.9454468264216337`*^9, 
   3.945446826670126*^9}, 3.945446923977113*^9, {3.94544708592466*^9, 
   3.945447102909171*^9}, {3.945447139870059*^9, 3.945447199327375*^9}, {
   3.945447772503014*^9, 3.945447832502127*^9}, {3.945447884839051*^9, 
   3.945447890618701*^9}, {3.9454479862228947`*^9, 3.9454480110229683`*^9}, {
   3.945448064874631*^9, 3.945448112337237*^9}, {3.945449561694101*^9, 
   3.945449569219738*^9}, {3.945449620409198*^9, 3.945449642254697*^9}, 
   3.945460073247253*^9},
 CellLabel->
  "In[370]:=",ExpressionUUID->"a732ee15-b599-4761-a230-33dd80415b6f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "AdaptCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<VariationFunction\>\"", "->", "RandomRuleMutation"}], ",", 
     RowBox[{"\"\<AutomatonFunction\>\"", "->", "getca"}], ",", " ", 
     RowBox[{"\"\<FitnessFunction\>\"", "->", "TestCALifeTime"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<FitnessDeathValue\>\"", "->", 
      RowBox[{"-", "Infinity"}]}], ",", 
     RowBox[{"\"\<Perturbation\>\"", "->", "None"}], ",", 
     RowBox[{"\"\<NPerturbations\>\"", "->", "1"}], ",", 
     RowBox[{"\"\<CombinationFunction\>\"", "->", "Min"}], ",", " ", 
     RowBox[{"\"\<SelectionFunction\>\"", "->", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"fit1", ",", " ", "fit2"}], "}"}], ",", " ", 
        RowBox[{"fit2", ">=", "fit1"}]}], "]"}]}], ",", " ", 
     RowBox[{"\"\<ReturnCAs\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<PerturbationFunction\>\"", "->", "None"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"AdaptCA", "[", 
   RowBox[{
    RowBox[{"initrule_List", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "3", ",", " ", "1"}], "}"}]}], ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcaops", ",", " ", "pertfunc", ",", 
      " ", "initcas", ",", " ", "initfits", ",", " ", "initobject", ",", " ", 
      "nperts", ",", " ", "evofunc", ",", " ", "ncas", ",", " ", "nfits", ",",
       " ", "nobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"initobject", " ", "=", " ", 
      RowBox[{"getinitobject", "[", 
       RowBox[{
       "initrule", ",", " ", "pertfunc", ",", "nperts", ",", " ", "allops"}], 
       "]"}]}], ";", "\n", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"NestList", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.945266347298204*^9, 3.945266510611971*^9}, {
   3.945266548825857*^9, 3.945266550410791*^9}, {3.945268016078183*^9, 
   3.945268032142717*^9}, {3.945269107272526*^9, 3.94526911449774*^9}, {
   3.945269279580195*^9, 3.9452692938640947`*^9}, {3.945271810557001*^9, 
   3.945272218099633*^9}, {3.945273385911368*^9, 3.945273436835957*^9}, {
   3.945273506952347*^9, 3.945273560819565*^9}, {3.9452735910394588`*^9, 
   3.945274203127338*^9}, {3.945274237522272*^9, 3.945274343950425*^9}, {
   3.945274506234223*^9, 3.945274562658798*^9}, {3.945274616503378*^9, 
   3.9452746603173656`*^9}, {3.945274698429175*^9, 3.945274783319426*^9}, {
   3.945274848605851*^9, 3.9452749606025352`*^9}, {3.945275029070685*^9, 
   3.945275135733245*^9}, {3.945275182863851*^9, 3.945275221946412*^9}, {
   3.945275262417237*^9, 3.945275596744805*^9}, {3.945275738704367*^9, 
   3.945276013867606*^9}, 3.945276058551349*^9, 3.945276651635416*^9, {
   3.945276699749899*^9, 3.945276711552902*^9}, {3.945276792387329*^9, 
   3.9452768229580507`*^9}, {3.945277094229609*^9, 3.945277103309697*^9}, 
   3.945278579486566*^9, {3.945278684328342*^9, 3.945278777648252*^9}, {
   3.945283207433051*^9, 3.94528322304812*^9}, {3.945286751130001*^9, 
   3.945286967127088*^9}, {3.94528703938305*^9, 3.9452871136798*^9}, {
   3.945287144861001*^9, 3.945287157454178*^9}, {3.945287343138464*^9, 
   3.945287405517154*^9}, {3.945287451123786*^9, 3.94528751497371*^9}, {
   3.94528876852215*^9, 3.945288773503803*^9}, {3.94528926679877*^9, 
   3.945289335808309*^9}, {3.945289406537052*^9, 3.945289407270677*^9}, {
   3.94528950551687*^9, 3.945289510055008*^9}, {3.945291265390485*^9, 
   3.945291266776462*^9}, {3.945297202206361*^9, 3.945297251261252*^9}, {
   3.945299500736367*^9, 3.9452995337161303`*^9}, {3.945304908454424*^9, 
   3.945304913598891*^9}, {3.9453051411135817`*^9, 3.945305152655653*^9}, {
   3.945305457248176*^9, 3.945305457646864*^9}, 3.9453059174390373`*^9, 
   3.945352393400782*^9, {3.9453525156122513`*^9, 3.945352549273878*^9}, {
   3.94535285315694*^9, 3.945352856079548*^9}, {3.945353982277117*^9, 
   3.945353990091741*^9}, {3.945362901544997*^9, 3.94536291249011*^9}, 
   3.945363008943507*^9, {3.945363352880908*^9, 3.945363375695158*^9}, {
   3.945446735263548*^9, 3.94544673911515*^9}, {3.9454468264216337`*^9, 
   3.945446826670126*^9}, 3.945446923977113*^9, {3.94544708592466*^9, 
   3.945447102909171*^9}, {3.945447139870059*^9, 3.945447199327375*^9}, {
   3.945447772503014*^9, 3.945447832502127*^9}, {3.945447884839051*^9, 
   3.945447890618701*^9}, {3.9454479862228947`*^9, 3.9454480110229683`*^9}, {
   3.945448064874631*^9, 3.945448112337237*^9}, {3.945449561694101*^9, 
   3.945449569219738*^9}, {3.945449620409198*^9, 3.945449642254697*^9}, 
   3.945460073247253*^9},
 CellLabel->
  "In[372]:=",ExpressionUUID->"fa33823a-2844-4518-9881-509120d89bef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptCAFinal", "[", 
   RowBox[{
    RowBox[{"initrule_List", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "4", ",", " ", "1"}], "}"}]}], ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcaops", ",", " ", "pertfunc", ",", 
      " ", "initcas", ",", " ", "initfits", ",", " ", "initobject", ",", " ", 
      "nperts", ",", " ", "evofunc", ",", " ", "ncas", ",", " ", "nfits", ",",
       " ", "nobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"initobject", " ", "=", " ", 
      RowBox[{"getinitobject", "[", 
       RowBox[{
       "initrule", ",", " ", "pertfunc", ",", "nperts", ",", " ", "allops"}], 
       "]"}]}], ";", "\n", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Nest", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945266347298204*^9, 3.945266510611971*^9}, {
   3.945266548825857*^9, 3.945266550410791*^9}, {3.945268016078183*^9, 
   3.945268032142717*^9}, {3.945269107272526*^9, 3.94526911449774*^9}, {
   3.945269279580195*^9, 3.9452692938640947`*^9}, {3.945271810557001*^9, 
   3.945272218099633*^9}, {3.945273385911368*^9, 3.945273436835957*^9}, {
   3.945273506952347*^9, 3.945273560819565*^9}, {3.9452735910394588`*^9, 
   3.945274203127338*^9}, {3.945274237522272*^9, 3.945274343950425*^9}, {
   3.945274506234223*^9, 3.945274562658798*^9}, {3.945274616503378*^9, 
   3.9452746603173656`*^9}, {3.945274698429175*^9, 3.945274783319426*^9}, {
   3.945274848605851*^9, 3.9452749606025352`*^9}, {3.945275029070685*^9, 
   3.945275135733245*^9}, {3.945275182863851*^9, 3.945275221946412*^9}, {
   3.945275262417237*^9, 3.945275596744805*^9}, {3.945275738704367*^9, 
   3.945276013867606*^9}, 3.945276058551349*^9, 3.945276651635416*^9, {
   3.945276699749899*^9, 3.945276711552902*^9}, {3.945276792387329*^9, 
   3.9452768229580507`*^9}, {3.945277094229609*^9, 3.945277103309697*^9}, 
   3.945278579486566*^9, {3.945278684328342*^9, 3.945278777648252*^9}, {
   3.945283207433051*^9, 3.94528322304812*^9}, {3.945286751130001*^9, 
   3.945286967127088*^9}, {3.94528703938305*^9, 3.9452871136798*^9}, {
   3.945287144861001*^9, 3.945287157454178*^9}, {3.945287343138464*^9, 
   3.945287405517154*^9}, {3.945287451123786*^9, 3.94528751497371*^9}, {
   3.94528876852215*^9, 3.945288773503803*^9}, {3.94528926679877*^9, 
   3.945289335808309*^9}, {3.945289406537052*^9, 3.945289407270677*^9}, {
   3.94528950551687*^9, 3.945289510055008*^9}, {3.945291265390485*^9, 
   3.945291266776462*^9}, {3.945297202206361*^9, 3.945297251261252*^9}, {
   3.945299500736367*^9, 3.9452995337161303`*^9}, {3.945304908454424*^9, 
   3.945304913598891*^9}, {3.9453051411135817`*^9, 3.945305152655653*^9}, {
   3.945305457248176*^9, 3.945305457646864*^9}, 3.9453059174390373`*^9, 
   3.945352393400782*^9, {3.9453525156122513`*^9, 3.945352549273878*^9}, {
   3.94535285315694*^9, 3.945352856079548*^9}, {3.945353982277117*^9, 
   3.945353990091741*^9}, {3.945362901544997*^9, 3.94536291249011*^9}, 
   3.945363008943507*^9, {3.945363352880908*^9, 3.945363375695158*^9}, {
   3.945446735263548*^9, 3.94544673911515*^9}, {3.9454468264216337`*^9, 
   3.945446826670126*^9}, 3.945446923977113*^9, {3.94544708592466*^9, 
   3.945447102909171*^9}, {3.945447139870059*^9, 3.945447199327375*^9}, {
   3.945447772503014*^9, 3.945447832502127*^9}, {3.945447884839051*^9, 
   3.945447890618701*^9}, {3.9454479862228947`*^9, 3.9454480110229683`*^9}, {
   3.945448064874631*^9, 3.945448112337237*^9}, {3.945449561694101*^9, 
   3.945449569219738*^9}, {3.945449620409198*^9, 3.945449642254697*^9}, 
   3.945460073247253*^9, {3.945467669607753*^9, 3.945467731035282*^9}, 
   3.945468163650099*^9},
 CellLabel->
  "In[374]:=",ExpressionUUID->"452c74e1-e15e-41c7-9a5a-7db5449f4f64"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptCA", "[", 
   RowBox[{"initobject_Association", ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "evofunc", ",", " ", "nperts", ",", " ", "pertfunc", 
      ",", " ", "pcaops"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pcaops", " ", "=", " ", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "PerturbCA", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", "\n", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", "\n", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"NestList", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.945447206415959*^9, 3.945447208397376*^9}, {
   3.945448135312339*^9, 3.945448154772767*^9}, {3.945448186726029*^9, 
   3.94544827118985*^9}, {3.945448393194347*^9, 3.945448426825012*^9}, {
   3.945460076503439*^9, 3.9454600895467997`*^9}, 3.945462408334048*^9, 
   3.945462478536715*^9, {3.945462693207561*^9, 3.945462694348099*^9}, {
   3.94546273901925*^9, 3.945462743256021*^9}},
 CellLabel->
  "In[375]:=",ExpressionUUID->"6a539ecd-6a54-48de-b819-7f6e48e40efb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptCAFinal", "[", 
   RowBox[{"initobject_Association", ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\n", 
     RowBox[{"pcaops", " ", "=", " ", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "PerturbCA", "]"}]}], "]"}]}]}], ";", "\n", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", "\n", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", "\n", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Nest", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.945447206415959*^9, 3.945447208397376*^9}, {
   3.945448135312339*^9, 3.945448154772767*^9}, {3.945448186726029*^9, 
   3.94544827118985*^9}, {3.945448393194347*^9, 3.945448426825012*^9}, {
   3.945460076503439*^9, 3.9454600895467997`*^9}, 3.9454624083340483`*^9, 
   3.945462478536715*^9, {3.945462693207561*^9, 3.945462712919696*^9}, {
   3.945463928873149*^9, 3.94546394171272*^9}, {3.945464009114686*^9, 
   3.9454640096940613`*^9}},
 CellLabel->
  "In[318]:=",ExpressionUUID->"1020a0f8-44ff-4d16-85ea-44b991670cc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptCAWhile", "[", 
   RowBox[{"initrule_List", ",", " ", "test_", ",", 
    RowBox[{"iterations_", ":", "100"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcaops", ",", " ", "pertfunc", ",", 
      " ", "initcas", ",", " ", "initfits", ",", " ", "initobject", ",", " ", 
      "nperts", ",", " ", "evofunc", ",", " ", "ncas", ",", " ", "nfits", ",",
       " ", "nobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{"#", "&"}], ")"}]}], ",", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
     RowBox[{"initobject", " ", "=", " ", 
      RowBox[{"getinitobject", "[", 
       RowBox[{
       "initrule", ",", " ", "pertfunc", ",", "nperts", ",", " ", "allops"}], 
       "]"}]}], ";", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"getevofunc", "[", 
       RowBox[{"pertfunc", ",", " ", "nperts", ",", " ", "allops"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"NestWhile", "[", 
      RowBox[{
      "evofunc", ",", " ", "initobject", ",", " ", "test", ",", "1", ",", 
       "iterations"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9454681376442204`*^9, 3.945468145819975*^9}, {
  3.9454683079780083`*^9, 3.945468376077805*^9}, {3.945468413874609*^9, 
  3.9454684304759502`*^9}, {3.945468574306836*^9, 3.945468601621319*^9}, {
  3.945468672811108*^9, 3.9454686745867*^9}, {3.945468774495246*^9, 
  3.945468778323133*^9}},
 CellLabel->
  "In[338]:=",ExpressionUUID->"6906d128-2101-4dd5-885c-7ccc0b5a72aa"]
}, Closed]]
},
WindowSize->{1920, 956},
WindowMargins->{{438, Automatic}, {Automatic, 58}},
Magnification->1.25,
FrontEndVersion->"14.0 for Mac OS X x86 (64-bit) (December 12, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"940e5b96-e9b5-4073-9edc-482c7856034a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 152, 3, 84, "Section",ExpressionUUID->"d4dfd321-d1da-46f2-945d-01c197224088"],
Cell[735, 27, 1005, 25, 65, "Code",ExpressionUUID->"1c5640c8-bf97-408b-93c0-7bdc8d41518e"],
Cell[1743, 54, 1066, 23, 65, "Code",ExpressionUUID->"66586bd6-1558-4922-8781-dbbf32d27029"],
Cell[2812, 79, 677, 19, 65, "Code",ExpressionUUID->"f2ed4b2f-28b1-4d2d-ad0d-5329f8a7f701"],
Cell[3492, 100, 1328, 35, 162, "Code",ExpressionUUID->"bb525146-aa8f-419c-b339-76ae1d0a2ebf"],
Cell[4823, 137, 791, 15, 65, "Code",ExpressionUUID->"7824730d-64c5-443c-ad56-0f01495e77b5"],
Cell[5617, 154, 1014, 25, 65, "Code",ExpressionUUID->"efc2a93a-0cc6-424f-badf-dd4c458a951e"],
Cell[6634, 181, 2295, 57, 138, "Code",ExpressionUUID->"7d0fbefc-1a71-4802-a737-9e7311b37685"],
Cell[8932, 240, 1586, 41, 138, "Code",ExpressionUUID->"9985e728-9e9f-4f3a-aaa3-0a9164867c31"],
Cell[10521, 283, 1141, 29, 114, "Code",ExpressionUUID->"fa7b4e01-4c18-4917-a999-1bda8b185149"],
Cell[11665, 314, 1185, 21, 65, "Code",ExpressionUUID->"de12be9f-307b-4708-9976-4bee3746cc52"],
Cell[12853, 337, 631, 13, 90, "Code",ExpressionUUID->"f7a36137-a1fb-499c-9888-f233a7dc896a"],
Cell[13487, 352, 371, 9, 65, "Code",ExpressionUUID->"0cbe98b9-5d15-4e25-aea5-9f81b98a8f78"],
Cell[13861, 363, 1009, 25, 65, "Code",ExpressionUUID->"5a97706c-555b-42d3-b8c3-5f2eb8316a29"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14907, 393, 210, 4, 84, "Section",ExpressionUUID->"cf0c77fd-76e4-44d5-911f-081db9d3cd97"],
Cell[15120, 399, 1692, 41, 114, "Code",ExpressionUUID->"a4a97538-7d00-4ff9-a50b-d7344da05bab",
 CellID->1804130915],
Cell[16815, 442, 4214, 103, 162, "Code",ExpressionUUID->"dc2050e0-8d63-4cc7-b717-093004985c57"],
Cell[21032, 547, 1564, 29, 65, "Code",ExpressionUUID->"236f1f6b-ae32-4891-93eb-46abd3e368cb"],
Cell[22599, 578, 1791, 35, 65, "Code",ExpressionUUID->"a1ac0263-c9ed-44b1-89a4-a9f6a28dbc40"],
Cell[24393, 615, 1340, 31, 90, "Code",ExpressionUUID->"bc482545-8a99-4e13-a439-ea9bdf712480"],
Cell[25736, 648, 10578, 215, 426, "Code",ExpressionUUID->"0a278221-ec8e-4818-a10d-902b323e33f0"],
Cell[36317, 865, 3334, 71, 186, "Code",ExpressionUUID->"9b014647-0901-4c26-91a1-98130b47cbf3"],
Cell[39654, 938, 1260, 35, 114, "Code",ExpressionUUID->"1215da87-9b66-4944-8205-67d788d9054a"],
Cell[40917, 975, 1255, 28, 90, "Code",ExpressionUUID->"00820d1f-bba9-49cf-9118-7a39c77588ec"],
Cell[42175, 1005, 7336, 170, 546, "Code",ExpressionUUID->"76bdfc43-21d3-481f-8938-b7c7683e246e"],
Cell[49514, 1177, 219, 4, 37, "Input",ExpressionUUID->"e0baae1a-dcee-4077-8f0a-d3608e60773c"],
Cell[49736, 1183, 5797, 128, 402, "Code",ExpressionUUID->"490e47d5-e5d0-4a8c-a100-0a62ff6c7f65"],
Cell[55536, 1313, 6655, 147, 378, "Code",ExpressionUUID->"e5721ff3-e4b7-47dc-bde0-27b33fda6738"],
Cell[62194, 1462, 228, 4, 37, "Input",ExpressionUUID->"ecfee036-990d-4b7f-90fe-c7bb776881aa"],
Cell[62425, 1468, 4422, 85, 162, "Code",ExpressionUUID->"1aad2baa-0495-436d-95f2-af44da44fb73"],
Cell[66850, 1555, 2967, 71, 234, "Code",ExpressionUUID->"3e4c1673-a209-481f-8807-8508bf6ca7d8"],
Cell[69820, 1628, 3094, 75, 138, "Code",ExpressionUUID->"3400f618-dcf3-4b13-a393-083977ae1616"],
Cell[72917, 1705, 3742, 87, 186, "Code",ExpressionUUID->"8b456d75-7800-4707-8a81-af938e4ed276"],
Cell[76662, 1794, 2711, 69, 162, "Code",ExpressionUUID->"eabae733-cad1-49bd-b660-550d5daa91cb"],
Cell[79376, 1865, 5062, 116, 210, "Code",ExpressionUUID->"96cb2af5-052b-4986-a402-473a39d13c58"]
}, Open  ]],
Cell[CellGroupData[{
Cell[84475, 1986, 215, 4, 84, "Section",ExpressionUUID->"0d54c013-5695-4af7-a5d8-526052a920b4"],
Cell[CellGroupData[{
Cell[84715, 1994, 160, 3, 56, "Subsubsection",ExpressionUUID->"f9337781-00ed-4cf6-b7d6-15b108cb404b"],
Cell[84878, 1999, 1431, 33, 65, "Code",ExpressionUUID->"28df7aef-fff4-4559-b797-414e7dee1c93",
 CellID->2093550075],
Cell[86312, 2034, 1668, 41, 162, "Code",ExpressionUUID->"347745f7-cee9-499d-91cd-b4ed01243b3d",
 CellID->1726971227],
Cell[87983, 2077, 1816, 48, 210, "Code",ExpressionUUID->"219a2aa2-cb6c-4c3b-98d2-da08394390d9",
 CellID->651132542],
Cell[89802, 2127, 827, 19, 65, "Code",ExpressionUUID->"6f4da41a-65fe-42e4-b976-64947aa0fa7a",
 CellID->201266207],
Cell[90632, 2148, 2028, 40, 114, "Code",ExpressionUUID->"bb80d0b7-babf-4b33-a1bc-62c0cb2ef33a",
 CellID->1596562746],
Cell[92663, 2190, 2573, 61, 234, "Code",ExpressionUUID->"7eca9cad-21b4-45d0-83f5-1e145ae13584",
 CellID->829937698],
Cell[95239, 2253, 219, 4, 37, "Input",ExpressionUUID->"e5123221-7716-4d07-9b4f-77a5f655e1f3"],
Cell[95461, 2259, 2022, 48, 186, "Code",ExpressionUUID->"83501654-c1f4-4a8a-b177-b98d15f5c419",
 CellID->749686386],
Cell[97486, 2309, 1136, 26, 65, "Code",ExpressionUUID->"60d5bb48-9a1e-4a70-a84b-cd7a129709a9",
 CellID->1409920688],
Cell[98625, 2337, 500, 15, 65, "Code",ExpressionUUID->"aa52e2ef-57c4-4450-aded-a5a2b68db2c1",
 CellID->692532553],
Cell[99128, 2354, 4615, 106, 282, "Code",ExpressionUUID->"4a4cc2a1-e847-4463-8f8c-c33185acd6d8",
 CellID->512733297]
}, Open  ]],
Cell[CellGroupData[{
Cell[103780, 2465, 209, 4, 56, "Subsubsection",ExpressionUUID->"1bd5b1e8-f0cc-4125-9b09-7d63843f5002"],
Cell[103992, 2471, 3379, 89, 210, "Code",ExpressionUUID->"d58fdab0-ea42-4924-a385-218028c56fa3"],
Cell[107374, 2562, 437, 10, 65, "Code",ExpressionUUID->"025156d3-4e73-4d0a-a1fe-e6b1332d08e6"],
Cell[107814, 2574, 3621, 83, 282, "Code",ExpressionUUID->"bbaa5d85-f19b-4a78-9106-d91216c142e3",
 CellID->171383505],
Cell[111438, 2659, 19642, 371, 546, "Code",ExpressionUUID->"a8e0db7b-b97f-448c-b184-05bde6a0546b",
 CellID->1222021125]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[131129, 3036, 163, 3, 84, "Section",ExpressionUUID->"c0def580-a913-4d5e-a53d-54a25ec47976"],
Cell[CellGroupData[{
Cell[131317, 3043, 270, 4, 67, "Subsection",ExpressionUUID->"50d9c160-8288-4bb0-9e5b-2b84d07f431b"],
Cell[131590, 3049, 1060, 19, 65, "Code",ExpressionUUID->"0b23d3e2-0338-4e49-8bb1-477458e606df"],
Cell[132653, 3070, 430, 12, 65, "Code",ExpressionUUID->"9bd0d211-f111-4848-bb4f-5dc8732b5d6e"],
Cell[133086, 3084, 1051, 27, 65, "Code",ExpressionUUID->"b2510a1a-df91-45cd-904f-a22e4094597b"],
Cell[134140, 3113, 5093, 103, 258, "Code",ExpressionUUID->"ed8fa20c-135e-4bb7-9658-cc5b070ea7cb"],
Cell[139236, 3218, 328, 6, 37, "Input",ExpressionUUID->"d8bb5dd4-ea88-4998-8752-f08502cdf390"],
Cell[139567, 3226, 4835, 109, 378, "Code",ExpressionUUID->"3b50bac8-1bb5-436c-957e-bb81d052d4da"],
Cell[144405, 3337, 2950, 56, 138, "Code",ExpressionUUID->"96fd15f1-3639-4ccc-98ca-b22def45415c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[147392, 3398, 152, 3, 67, "Subsection",ExpressionUUID->"6e8e5439-3e8c-4912-85e9-1dca1a23c8a3"],
Cell[147547, 3403, 1226, 26, 90, "Code",ExpressionUUID->"914e413a-3638-490f-aca9-493735b3966c"],
Cell[148776, 3431, 622, 14, 65, "Code",ExpressionUUID->"fb87530d-1647-4eac-8404-f0e8157f5a49"],
Cell[149401, 3447, 1312, 32, 114, "Code",ExpressionUUID->"010986f6-6641-4c6a-9859-d5bc0c5ed0c0"],
Cell[150716, 3481, 1447, 33, 138, "Code",ExpressionUUID->"bd0ce26c-8793-41ce-9d99-a5fe0cc40a54"],
Cell[152166, 3516, 638, 17, 90, "Code",ExpressionUUID->"e9675c57-8c37-4554-b4d9-64de01f118e9"],
Cell[152807, 3535, 3022, 68, 138, "Code",ExpressionUUID->"57294f1b-a5b9-4720-99cf-4822c83dcf9b"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[155878, 3609, 155, 3, 84, "Section",ExpressionUUID->"9833750c-2556-43b1-b3be-7cb6bb80404d"],
Cell[156036, 3614, 2860, 71, 162, "Code",ExpressionUUID->"87343c1c-81c4-4008-9ef2-649f897b7b84"],
Cell[158899, 3687, 1146, 26, 90, "Code",ExpressionUUID->"7133c0ef-2767-46cc-b759-35a901e7a5eb"],
Cell[160048, 3715, 2443, 67, 162, "Code",ExpressionUUID->"3f9495ca-95d8-4e4a-a37d-408683ffc6b3"],
Cell[162494, 3784, 2506, 53, 90, "Code",ExpressionUUID->"2c64da26-4ed6-479d-a657-a6c14a89bd13"],
Cell[165003, 3839, 1326, 26, 65, "Code",ExpressionUUID->"96687295-1def-49bb-8675-468fe0e90892"],
Cell[166332, 3867, 1869, 43, 90, "Code",ExpressionUUID->"5658bfaa-3608-4231-9ca2-7a7502e6aa61"]
}, Open  ]],
Cell[CellGroupData[{
Cell[168238, 3915, 249, 4, 84, "Section",ExpressionUUID->"bc7b5f81-b8b3-411d-99af-77f90d1a1f1c"],
Cell[168490, 3921, 3270, 67, 162, "Code",ExpressionUUID->"5abfbed9-f83e-4006-a93c-e32bc3f9495b"],
Cell[171763, 3990, 211, 4, 37, "Input",ExpressionUUID->"06e02745-5149-4a04-a119-5aac7162d61c"],
Cell[171977, 3996, 6539, 143, 234, "Code",ExpressionUUID->"55fa00ea-a9f3-404e-afc8-aa0fa7289c2c"],
Cell[178519, 4141, 226, 4, 37, "Input",ExpressionUUID->"f2de3602-c43d-465c-8bba-994a985cdda8"],
Cell[178748, 4147, 11993, 230, 306, "Code",ExpressionUUID->"3efc5258-6132-49ff-b70c-54ec1fc0f2de"]
}, Open  ]],
Cell[CellGroupData[{
Cell[190778, 4382, 151, 3, 84, "Section",ExpressionUUID->"d6852212-b3fa-464d-9fd5-2873ef55d3c9"],
Cell[190932, 4387, 541, 16, 90, "Code",ExpressionUUID->"7f2be1c5-0353-4225-917f-f2d50cea3add"],
Cell[191476, 4405, 1841, 51, 210, "Code",ExpressionUUID->"1167ac24-28bb-42eb-8554-f1fe6819b441"],
Cell[193320, 4458, 1501, 34, 113, "Code",ExpressionUUID->"bee9e125-9c08-4ab3-a081-a2ef8ee2c10c"],
Cell[194824, 4494, 436, 12, 65, "Code",ExpressionUUID->"09adc84a-a279-4018-bdd1-53ae96dc4b48"],
Cell[195263, 4508, 1271, 32, 65, "Code",ExpressionUUID->"61c09f1a-6996-44c1-abac-9ee339ea646e"],
Cell[196537, 4542, 914, 23, 65, "Code",ExpressionUUID->"0fddcb93-8a52-4500-9fa7-9dc78c741d04"],
Cell[197454, 4567, 752, 21, 65, "Code",ExpressionUUID->"2ec127b0-b6c5-4950-9519-4c65d04e32ab"],
Cell[198209, 4590, 2056, 51, 137, "Code",ExpressionUUID->"89b85e4d-4802-4b40-b6e5-d9d5f1138b38"],
Cell[200268, 4643, 1095, 24, 65, "Code",ExpressionUUID->"41e0f7db-104a-4846-bdc6-82e8613020dc"],
Cell[201366, 4669, 1777, 48, 137, "Code",ExpressionUUID->"70ee3023-4f28-426d-bd63-82fecb8f1e5c"],
Cell[203146, 4719, 346, 8, 65, "Code",ExpressionUUID->"98769222-0260-425b-9432-156479b78447"],
Cell[203495, 4729, 637, 14, 65, "Code",ExpressionUUID->"47522f53-f4f0-4f5a-a80d-879102e4a018"],
Cell[204135, 4745, 2249, 55, 210, "Code",ExpressionUUID->"11e9a943-ffa8-4d87-8acf-7ac334323613"],
Cell[206387, 4802, 3679, 86, 281, "Code",ExpressionUUID->"8ca4d791-001e-4ff9-92cb-df43c5aa6a93"],
Cell[210069, 4890, 4287, 105, 23, "Code",ExpressionUUID->"5776f0b4-ff49-4d9e-ad5d-921e615769e1",
 CellOpen->False],
Cell[214359, 4997, 620, 14, 65, "Code",ExpressionUUID->"cda64b35-4644-476c-b214-c3a22c1cc08f"],
Cell[214982, 5013, 324, 10, 65, "Code",ExpressionUUID->"5b91306a-5235-432f-8739-e5cdb7a6bcab"],
Cell[215309, 5025, 5846, 136, 257, "Code",ExpressionUUID->"f561a8ee-a541-4829-8d20-5d76e4cc776a"],
Cell[221158, 5163, 2696, 63, 137, "Code",ExpressionUUID->"4ef5c2fd-2540-4840-b4bc-d647e18d6feb"],
Cell[223857, 5228, 2571, 65, 137, "Code",ExpressionUUID->"5c2cfaa5-916d-44f1-9ae1-a17fffaa374f"],
Cell[226431, 5295, 1095, 24, 65, "Code",ExpressionUUID->"8954d162-4f8e-420b-9308-3ece81ecba04"],
Cell[227529, 5321, 2340, 58, 161, "Code",ExpressionUUID->"8993189a-b736-449c-a026-a7fc5825985f"],
Cell[229872, 5381, 1725, 41, 161, "Code",ExpressionUUID->"76d73aa6-a494-4450-9c21-505a85a21ed7"],
Cell[231600, 5424, 7418, 178, 473, "Code",ExpressionUUID->"9227b1b7-0d7b-48e5-ac25-014980542ee9"],
Cell[239021, 5604, 5320, 132, 305, "Code",ExpressionUUID->"687166cd-9349-4a64-af9d-54599751fe14"],
Cell[244344, 5738, 3535, 86, 281, "Code",ExpressionUUID->"cece8040-3c79-43f7-af08-d97ac1d642ee"]
}, Closed]],
Cell[CellGroupData[{
Cell[247916, 5829, 172, 3, 65, "Section",ExpressionUUID->"4fc1db56-03ee-46e3-b8fa-bf546a73f757"],
Cell[248091, 5834, 211, 4, 37, "Input",ExpressionUUID->"64c1bb36-84e9-41c7-962a-588dfa935683"],
Cell[248305, 5840, 1702, 48, 162, "Code",ExpressionUUID->"0a23268f-a11c-439d-a0e2-59a24b67a0a2"],
Cell[250010, 5890, 508, 14, 90, "Code",ExpressionUUID->"0b0e8d19-9312-4197-9836-619b59ac8dc8"],
Cell[250521, 5906, 784, 20, 138, "Code",ExpressionUUID->"26fc0ac2-e7a8-4c94-a4bd-abc4d2e33646"],
Cell[251308, 5928, 2681, 73, 426, "Code",ExpressionUUID->"1c06dd49-3956-4c69-9d3d-46b071ea723a"],
Cell[253992, 6003, 3478, 77, 306, "Code",ExpressionUUID->"9b036818-9af7-4239-b0e3-f9f4afcfa338"],
Cell[257473, 6082, 3410, 76, 306, "Code",ExpressionUUID->"a0edf564-a0b8-4bc1-8fea-113b64b18b8a"],
Cell[260886, 6160, 2185, 50, 186, "Code",ExpressionUUID->"52493db3-29ba-47cb-8cce-e9563a6a30b4"],
Cell[263074, 6212, 7052, 142, 306, "Code",ExpressionUUID->"a732ee15-b599-4761-a230-33dd80415b6f"],
Cell[270129, 6356, 7052, 142, 306, "Code",ExpressionUUID->"fa33823a-2844-4518-9881-509120d89bef"],
Cell[277184, 6500, 6018, 119, 258, "Code",ExpressionUUID->"452c74e1-e15e-41c7-9a5a-7db5449f4f64"],
Cell[283205, 6621, 3416, 81, 306, "Code",ExpressionUUID->"6a539ecd-6a54-48de-b819-7f6e48e40efb"],
Cell[286624, 6704, 3350, 79, 298, "Input",ExpressionUUID->"1020a0f8-44ff-4d16-85ea-44b991670cc8"],
Cell[289977, 6785, 3378, 81, 246, "Input",ExpressionUUID->"6906d128-2101-4dd5-885c-7ccc0b5a72aa"]
}, Closed]]
}
]
*)

