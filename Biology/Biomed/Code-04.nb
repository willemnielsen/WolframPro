(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 14.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    228787,       5335]
NotebookOptionsPosition[    216642,       5180]
NotebookOutlinePosition[    217068,       5197]
CellTagsIndexPosition[    217025,       5194]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"FrontEndExecute", "[", 
   RowBox[{"FrontEnd`AddMenuCommands", "[", 
    RowBox[{"\"\<DuplicatePreviousOutput\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"Delimiter", ",", 
       RowBox[{"MenuItem", "[", 
        RowBox[{"\"\<Delete cell\>\"", ",", 
         RowBox[{"FrontEnd`KernelExecute", "[", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", "nb", "}"}], ",", 
            RowBox[{
             RowBox[{"nb", "=", 
              RowBox[{"SelectedNotebook", "[", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"SelectionMove", "[", 
              RowBox[{"nb", ",", "Previous", ",", "Cell"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"SelectionMove", "[", 
              RowBox[{"nb", ",", "Next", ",", "Cell"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"NotebookDelete", "[", "nb", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"SelectionMove", "[", 
              RowBox[{"nb", ",", "Next", ",", "Cell"}], "]"}]}]}], "]"}], 
          "]"}], ",", 
         RowBox[{"MenuKey", "[", 
          RowBox[{"\"\<k\>\"", ",", 
           RowBox[{"Modifiers", "->", 
            RowBox[{"{", "\"\<Command\>\"", "}"}]}]}], "]"}], ",", 
         RowBox[{"System`MenuEvaluator", "->", "Automatic"}]}], "]"}]}], 
      "}"}]}], "]"}], "]"}], "\n"}]], "Code",
 CellChangeTimes->{{3.945271597897366*^9, 3.945271602132545*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"d4d55858-54bd-4a04-9121-5f28c1112ca4"],

Cell[CellGroupData[{

Cell["Utility", "Section",
 CellChangeTimes->{{3.945269141310281*^9, 
  3.945269143024324*^9}},ExpressionUUID->"d4dfd321-d1da-46f2-945d-\
01c197224088"],

Cell[BoxData[
 RowBox[{"Clear", "@", "getca"}]], "Input",
 CellChangeTimes->{{3.945270183514674*^9, 3.9452701868929863`*^9}, {
  3.945270388672765*^9, 3.94527039089721*^9}, {3.9452706097095747`*^9, 
  3.945270649434101*^9}},
 CellLabel->
  "In[167]:=",ExpressionUUID->"39566c88-cc56-4f88-9197-b94b12d65c5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getca", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"steps_", ":", "200"}], ",", " ", 
    RowBox[{"width_", ":", "All"}], ",", " ", 
    RowBox[{"init_", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}]}], "]"}], ":=", " ", 
  
  RowBox[{
   RowBox[{"getca", "[", 
    RowBox[{"ru", ",", " ", "steps", ",", " ", "width", ",", " ", "init"}], 
    "]"}], " ", "=", " ", 
   RowBox[{"CellularAutomaton", "[", 
    RowBox[{"ru", ",", " ", "init", ",", " ", 
     RowBox[{"{", 
      RowBox[{"steps", ",", " ", "width"}], "}"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.9438057708089046`*^9, 3.9438058553028383`*^9}, {
  3.943805908764364*^9, 3.943805909425609*^9}, {3.943811606071961*^9, 
  3.94381164307044*^9}, {3.94443216895649*^9, 3.944432169162304*^9}, {
  3.945269152995685*^9, 3.945269158924448*^9}, {3.945269677382701*^9, 
  3.945269722891138*^9}, {3.945270171684901*^9, 3.945270173269108*^9}, {
  3.945270644654645*^9, 3.94527064593688*^9}, {3.945299575005775*^9, 
  3.945299576746839*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"66586bd6-1558-4922-8781-dbbf32d27029"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestLifetime", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}], ",", " ", 
    RowBox[{"init_List", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"array", "=", 
      RowBox[{"getca", "[", 
       RowBox[{"rule", ",", " ", "steps", ",", " ", "All", ",", " ", "init"}],
        "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "==", "0"}], ",", 
        RowBox[{"-", "Infinity"}], ",", 
        RowBox[{"steps", "-", "#", "+", "1"}]}], "]"}], "&"}], "[", 
     "\[IndentingNewLine]", 
     RowBox[{"LengthWhile", "[", 
      RowBox[{
       RowBox[{"Reverse", "[", "array", "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.9452694920503683`*^9, 3.945269492465472*^9}, {
   3.945269541492546*^9, 3.945269612518456*^9}, 3.94526965986334*^9, {
   3.945269780474712*^9, 3.945269829949349*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"bb525146-aa8f-419c-b339-76ae1d0a2ebf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifeTime", "[", 
   RowBox[{"{", 
    RowBox[{"ca_List", ",", " ", "perturbation_List"}], "}"}], "]"}], ":=", 
  " ", 
  RowBox[{
   RowBox[{"TestCALifeTime", "[", "ca", "]"}], " ", "=", " ", 
   RowBox[{"TestCALifeTime", "[", "ca", "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943106462055011*^9, 3.943106524282854*^9}, {
  3.943106554858834*^9, 3.943106617417737*^9}, {3.943457965776842*^9, 
  3.943457976864903*^9}, {3.943458102665765*^9, 3.943458104020798*^9}, {
  3.94449110560067*^9, 3.944491144856763*^9}, {3.945289812844039*^9, 
  3.9452898494002037`*^9}, {3.945294974293565*^9, 3.945294974670261*^9}, {
  3.945295083814666*^9, 3.9452950870331173`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"7824730d-64c5-443c-ad56-0f01495e77b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestCALifeTime", "[", "ca_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"TestCALifeTime", "[", "ca", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"#", "==", "0"}], ",", 
       RowBox[{"-", "Infinity"}], ",", 
       RowBox[{
        RowBox[{"Length", "[", "ca", "]"}], "-", "#"}]}], "]"}], "&"}], "[", 
    RowBox[{"LengthWhile", "[", 
     RowBox[{
      RowBox[{"Reverse", "[", "ca", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", "#", "]"}], "==", "0"}], "&"}]}], "]"}], 
    "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943106462055011*^9, 3.943106524282854*^9}, {
  3.943106554858834*^9, 3.943106617417737*^9}, {3.943457965776842*^9, 
  3.943457976864903*^9}, {3.943458102665765*^9, 3.943458104020798*^9}, {
  3.94449110560067*^9, 3.944491144856763*^9}, {3.945289812844039*^9, 
  3.945289814678841*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"efc2a93a-0cc6-424f-badf-dd4c458a951e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualizations", "Section",
 CellChangeTimes->{{3.942889350592349*^9, 3.942889353963724*^9}, {
  3.944521604299152*^9, 
  3.9445216062320557`*^9}},ExpressionUUID->"cf0c77fd-76e4-44d5-911f-\
081db9d3cd97"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotCA"}]], "Input",
 CellChangeTimes->{{3.9452987100848923`*^9, 3.94529871510188*^9}},
 CellLabel->
  "In[329]:=",ExpressionUUID->"0e1a29cf-f8c2-464c-b17d-225d55311ae5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gettrimoffsets", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"trimwidth_", ",", " ", "trimheight_"}], "}"}]}], "]"}], ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"left", ",", " ", "right", ",", " ", "bottom"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left", ",", " ", "right"}], "}"}], " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"getbodyidxs", "[", "ca", "]"}], ",", " ", "1"}], "]"}], 
          ",", " ", "trimwidth"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_", ",", " ", "None"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"ca", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], ",", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{"{", 
            RowBox[{"1", ",", " ", 
             RowBox[{
              RowBox[{"2", "width"}], "+", "1"}]}], "}"}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"idxs_", ",", " ", "width_"}], "}"}], ":>", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{"1", ",", " ", 
                  RowBox[{"#1", " ", "-", " ", "width"}]}], "]"}], ",", " ", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"ca", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
                  RowBox[{"#2", "+", "width"}]}], "]"}]}], "}"}], "&"}], 
             ")"}], "@@", 
            RowBox[{"MinMax", "[", 
             RowBox[{"idxs", "[", 
              RowBox[{"[", " ", 
               RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}]}]}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bottom", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"trimheight", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"None", "->", 
           RowBox[{"Length", "[", "ca", "]"}]}], ",", " ", 
          RowBox[{"h_", ":>", " ", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"TestCALifeTime", "[", "ca", "]"}], " ", "+", " ", 
              "height"}], ",", " ", 
             RowBox[{"Length", "[", "ca", "]"}]}], "]"}]}]}], "}"}]}], 
       "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
      "}"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945293194658641*^9, 3.9452932867187643`*^9}, {
   3.945293322355928*^9, 3.945293357136991*^9}, {3.945293421873876*^9, 
   3.945293494229478*^9}, 3.945293534644459*^9, {3.945293588253034*^9, 
   3.9452935924197893`*^9}, {3.945293681304782*^9, 3.94529380369692*^9}, 
   3.945293850614188*^9, {3.945293882011123*^9, 3.945293886715385*^9}, {
   3.9452974644331837`*^9, 3.945297561725452*^9}, {3.94529761593769*^9, 
   3.945297618749472*^9}, {3.945297691265308*^9, 3.945297722631607*^9}, {
   3.945297787180779*^9, 3.945297789483876*^9}, {3.945298172886071*^9, 
   3.945298316467525*^9}, {3.9452984588534603`*^9, 3.945298461589884*^9}, {
   3.945300077631274*^9, 3.945300078042661*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"dc2050e0-8d63-4cc7-b717-093004985c57"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{"width_", ",", "height_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"left", ",", "right", ",", " ", "bottom"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"TrimArray", "[", 
     RowBox[{"arr", ",", " ", 
      RowBox[{"gettrimoffsets", "[", 
       RowBox[{"arr", ",", " ", 
        RowBox[{"{", 
         RowBox[{"width", ",", " ", "height"}], "}"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294624188524*^9}, {
   3.945294671884531*^9, 3.945294699185649*^9}, {3.945298321348089*^9, 
   3.945298332825746*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"236f1f6b-ae32-4891-93eb-46abd3e368cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrimArray", "[", 
   RowBox[{"arr_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"left_", ",", " ", "right_"}], "}"}], ",", "bottom_"}], 
     "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "[", 
     RowBox[{"[", 
      RowBox[{"left", ";;", " ", "right"}], "]"}], "]"}], "&"}], "/@", " ", 
   RowBox[{"arr", "[", 
    RowBox[{"[", 
     RowBox[{";;", 
      RowBox[{"bottom", " ", "-", " ", "1"}]}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943017569451321*^9, 3.9430175709684896`*^9}, {
   3.943106922113555*^9, 3.9431069310990877`*^9}, {3.943198900893907*^9, 
   3.943198901224431*^9}, {3.943373306178551*^9, 3.943373377600519*^9}, {
   3.943373423220467*^9, 3.943373424630056*^9}, {3.943459669162932*^9, 
   3.943459695627218*^9}, {3.944493476128366*^9, 3.944493516653517*^9}, 
   3.945292356243822*^9, {3.945292429192463*^9, 3.945292433938679*^9}, {
   3.945292530147868*^9, 3.945292538376861*^9}, {3.945292572343821*^9, 
   3.945292648968839*^9}, {3.94529281419796*^9, 3.945292832753424*^9}, {
   3.945292883805492*^9, 3.945292931108096*^9}, {3.9452929629217243`*^9, 
   3.945293091701778*^9}, {3.945293384723844*^9, 3.945293402742858*^9}, {
   3.945293567958729*^9, 3.945293639228851*^9}, {3.945293941315177*^9, 
   3.945294022233339*^9}, {3.945294091289926*^9, 3.945294386509444*^9}, 
   3.945294416616627*^9, {3.945294618550905*^9, 3.945294664969989*^9}, 
   3.9452946951882153`*^9, 3.945297648752054*^9, {3.945297917133191*^9, 
   3.945297952805462*^9}, {3.945297983947146*^9, 3.945297988951889*^9}, {
   3.945298338937427*^9, 3.945298354347632*^9}, {3.945299225211084*^9, 
   3.945299226614546*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"a1ac0263-c9ed-44b1-89a4-a9f6a28dbc40"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", 
      RowBox[{"{", "}"}]}], "}"}], ",", 
    RowBox[{"Normal", "[", 
     RowBox[{"Merge", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ops", ",", " ", 
         RowBox[{"\"\<PerturbationArrows\>\"", "->", "False"}]}], "}"}], ",", 
       " ", "Last"}], "]"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.945294845624233*^9, 3.945294873786907*^9}, {
   3.945294983499583*^9, 3.9452950510281057`*^9}, {3.945296909754796*^9, 
   3.945296950145707*^9}, 3.945298866189291*^9, {3.945300447162889*^9, 
   3.945300448193713*^9}, {3.945302689272188*^9, 3.945302773782592*^9}, {
   3.94530282174085*^9, 3.945302870957955*^9}, {3.9453029277364283`*^9, 
   3.945302980666069*^9}, {3.945303027226782*^9, 3.945303060146553*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"bc482545-8a99-4e13-a439-ea9bdf712480"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotCA"}]], "Input",
 CellChangeTimes->{{3.9453638531120367`*^9, 3.9453638576694183`*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"9d514693-cddc-4e38-9b54-ac1526389725"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorRules", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"0", "\[Rule]", 
         TemplateBox[<|"color" -> GrayLevel[1]|>,
          "GrayLevelColorSwatchTemplate"]}], ",", " ", 
        RowBox[{"1", "\[Rule]", 
         TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
          "HueColorSwatchTemplate"]}], ",", 
        RowBox[{"2", "\[Rule]", 
         TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
          "HueColorSwatchTemplate"]}], ",", 
        RowBox[{"3", "\[Rule]", 
         TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
          "HueColorSwatchTemplate"]}], ",", 
        RowBox[{"4", "->", 
         TemplateBox[<|"color" -> RGBColor[0, 0.56, 0]|>,
          "RGBColorSwatchTemplate"]}], ",", 
        RowBox[{"5", "->", 
         TemplateBox[<|"color" -> RGBColor[0, 0.56, 1]|>,
          "RGBColorSwatchTemplate"]}]}], "}"}]}], ",", " ", 
     RowBox[{"\"\<Trim\>\"", " ", "->", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "None"}], "}"}]}], ",", " ", "\n", 
     RowBox[{"Mesh", "->", "False"}], ",", " ", 
     RowBox[{"MeshStyle", " ", "->", " ", 
      RowBox[{"Opacity", "[", "0.1", "]"}]}], ",", " ", 
     RowBox[{"\"\<PerturbationArrows\>\"", "->", "True"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotCA", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ca_", ",", "perts_List"}], "}"}], ",", " ", 
     RowBox[{"ops", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"allops", " ", "=", " ", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", "ops"}], "}"}], ",",
           "Last"}], "]"}]}], ",", " ", "left", ",", " ", "right", ",", " ", 
       "bottom"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", "bottom"}], 
        "}"}], " ", "=", " ", 
       RowBox[{"gettrimoffsets", "[", 
        RowBox[{"ca", ",", " ", 
         RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", " ", 
      "\n", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ArrayPlot", "[", 
         RowBox[{
          RowBox[{"TrimArray", "[", 
           RowBox[{"ca", ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"left", ",", " ", "right"}], "}"}], ",", " ", 
              "bottom"}], "}"}]}], "]"}], ",", " ", "##"}], "]"}], "&"}], "[",
        "\[IndentingNewLine]", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], ",", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"allops", "[", "\"\<PerturbationArrows\>\"", "]"}], ",", 
           " ", 
           RowBox[{"Epilog", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Arrowheads", "[", 
               RowBox[{"{", ".25", "}"}], "]"}], ",", 
              RowBox[{"getarrows", "[", 
               RowBox[{"perts", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"left", ",", " ", "bottom"}], "}"}]}], "]"}]}], 
             "}"}]}], ",", " ", "Nothing"}], "]"}]}], "]"}], "]"}]}]}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlotCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ruleidx_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], "}"}],
     ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "  ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<init\>\"", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "1", "}"}], ",", " ", "0"}], "}"}]}], ",", 
            RowBox[{"\"\<steps\>\"", "->", 
             RowBox[{"{", 
              RowBox[{"200", ",", " ", "All"}], "}"}]}]}], "}"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"PlotCA", "[", 
       RowBox[{"#", ",", " ", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}], "&"}], "[", 
     "\[IndentingNewLine]", 
     RowBox[{"CellularAutomaton", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ruleidx", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
       RowBox[{"allops", "[", "\"\<init\>\"", "]"}], ",", " ", 
       RowBox[{"allops", "[", "\"\<steps\>\"", "]"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.943106358688594*^9, 3.943106375048778*^9}, {
   3.943106979531597*^9, 3.943106988235869*^9}, {3.94310786010571*^9, 
   3.943107865349316*^9}, {3.94311390218522*^9, 3.943113916165694*^9}, 
   3.943114206799518*^9, {3.943364337468414*^9, 3.943364356291*^9}, {
   3.94336439171276*^9, 3.9433644005207233`*^9}, {3.943364472464894*^9, 
   3.943364473040235*^9}, {3.94337218900583*^9, 3.943372193858235*^9}, {
   3.943372227748727*^9, 3.943372229008975*^9}, {3.943377838524406*^9, 
   3.943377844722754*^9}, {3.943455471192767*^9, 3.943455542176583*^9}, {
   3.943455637493842*^9, 3.943455685260359*^9}, {3.943455721343861*^9, 
   3.943455769714992*^9}, {3.943456396435326*^9, 3.943456432408684*^9}, {
   3.94353834209827*^9, 3.943538367957181*^9}, {3.943566345930059*^9, 
   3.943566351208854*^9}, {3.943566468830921*^9, 3.943566469091758*^9}, {
   3.943566841883333*^9, 3.943566842042541*^9}, {3.943567082571121*^9, 
   3.943567100426882*^9}, 3.943799420615381*^9, {3.943800726099045*^9, 
   3.94380074188017*^9}, {3.9438008034312897`*^9, 3.943800813658866*^9}, {
   3.943800844862834*^9, 3.943800902396796*^9}, {3.943800958948412*^9, 
   3.943800963102242*^9}, {3.943801200441373*^9, 3.943801282513608*^9}, {
   3.943801312748512*^9, 3.943801328887786*^9}, {3.9438020059305143`*^9, 
   3.9438020148781543`*^9}, 3.94380264751248*^9, {3.943802684760384*^9, 
   3.943802687214029*^9}, {3.944432031546154*^9, 3.944432032264789*^9}, {
   3.944493423584108*^9, 3.94449343416045*^9}, {3.945295199439509*^9, 
   3.945295221703529*^9}, {3.945295311298005*^9, 3.945295361190892*^9}, {
   3.945295397137776*^9, 3.945295450027227*^9}, {3.945295487660928*^9, 
   3.94529571318329*^9}, {3.945295849347142*^9, 3.945295872323279*^9}, {
   3.94529590487897*^9, 3.945296022782197*^9}, {3.945296486934933*^9, 
   3.945296503346024*^9}, 3.945296847269151*^9, {3.945296898097121*^9, 
   3.945296898658659*^9}, {3.945298369086669*^9, 3.945298485925401*^9}, {
   3.94529866756955*^9, 3.945298683712995*^9}, {3.945299631267777*^9, 
   3.945299634545657*^9}, {3.9453001790861607`*^9, 3.94530018039613*^9}, {
   3.945300334249873*^9, 3.9453003343238573`*^9}, {3.945303088195676*^9, 
   3.945303088996951*^9}, 3.945349703961798*^9, {3.94536369904582*^9, 
   3.945363717297109*^9}, 3.945363839510446*^9, 3.945379146293873*^9},
 CellLabel->"In[10]:=",ExpressionUUID->"6c3a00f3-87ac-4f9a-837a-c3df21c6267f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getarrows", "[", 
   RowBox[{"perts_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"left_", ",", " ", "bottom_"}], "}"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rowidx", ",", " ", "colidxs"}], "}"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"bottom", "-", "rowidx", " ", "-", "0.5"}]}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "+", ".5", "-", "left"}], ",", 
               RowBox[{"bottom", "-", "rowidx", "-", ".5"}]}], "}"}]}], "}"}],
            "]"}], "&"}], "/@", " ", "colidxs"}]}], "]"}], "[", 
      RowBox[{"#rowidx", ",", " ", "#colidxs"}], "]"}], "&"}], "/@", 
    "perts"}], " ", "//", " ", "Flatten"}]}]], "Code",
 CellChangeTimes->{{3.9452960477208776`*^9, 3.945296071552243*^9}, {
  3.945296201691929*^9, 3.9452963388683653`*^9}, {3.945296392743394*^9, 
  3.945296435840341*^9}, {3.94529647345783*^9, 3.945296474322368*^9}, {
  3.9452966981107597`*^9, 3.945296756383729*^9}, {3.945296791692675*^9, 
  3.945296819692018*^9}, {3.94529849206002*^9, 3.945298505043213*^9}, {
  3.945298605661831*^9, 3.945298672636999*^9}, {3.94529873826265*^9, 
  3.94529876318371*^9}, {3.945299001756591*^9, 3.945299046751328*^9}, {
  3.945299242613221*^9, 3.9452992736986313`*^9}, {3.945299642701037*^9, 
  3.945299655644641*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"62e5735f-c48a-4c83-8a06-a424b4070eb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlotCAs", "[", 
   RowBox[{"cas_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PlotCA", "]"}], ",", "ops"}], "}"}], ",", 
        "Last"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ArrayPlot", "[", 
       RowBox[{
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"TrimArray", "[", 
             RowBox[{"#", ",", " ", 
              RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}], "&"}], "/@",
            " ", "cas"}], "}"}], "]"}], ",", " ", "##"}], "]"}], "&"}], "[", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
       RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Code",
 CellLabel->"In[14]:=",ExpressionUUID->"1215da87-9b66-4944-8205-67d788d9054a"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "getca"}]], "Input",
 CellChangeTimes->{{3.943811680307803*^9, 3.943811685112699*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"963ee29d-bccb-4012-b785-eb26b4a2a079"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotDifferences"}]], "Input",
 CellChangeTimes->{{3.943106358688594*^9, 3.943106375048778*^9}, {
  3.943106979531597*^9, 3.943106988235869*^9}, {3.94310786010571*^9, 
  3.943107865349316*^9}, {3.94311390218522*^9, 3.943113902979813*^9}},
 CellLabel->
  "In[687]:=",ExpressionUUID->"44c86d15-07ce-46bb-b883-bca1c8af1b3c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotDifferences", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", "\n", 
    RowBox[{"ColorRules", " ", "->", " ", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0", " ", "->", " ", "White"}], ",", " ", 
         RowBox[{
          RowBox[{"-", "100"}], " ", "->", " ", 
          RowBox[{"GrayLevel", "[", ".8", "]"}]}]}], "}"}], ",", " ", "\n", 
       " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0", "\[Rule]", 
          TemplateBox[<|"color" -> GrayLevel[1]|>,
           "GrayLevelColorSwatchTemplate"]}], ",", 
         RowBox[{"1", "\[Rule]", 
          TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
           "HueColorSwatchTemplate"]}], ",", 
         RowBox[{"2", "\[Rule]", 
          TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
           "HueColorSwatchTemplate"]}], ",", 
         RowBox[{"3", "\[Rule]", 
          TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
           "HueColorSwatchTemplate"]}]}], "}"}], ",", "\n", "    ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"-", "#1"}], " ", ":>", " ", 
          RowBox[{"Lighter", "[", 
           RowBox[{"#2", ",", " ", ".7"}], "]"}]}], " ", "&"}], " ", "@@@", 
        " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "\[Rule]", 
           TemplateBox[<|"color" -> GrayLevel[1]|>,
            "GrayLevelColorSwatchTemplate"]}], ",", 
          RowBox[{"1", "\[Rule]", 
           TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
            "HueColorSwatchTemplate"]}], ",", 
          RowBox[{"2", "\[Rule]", 
           TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
            "HueColorSwatchTemplate"]}], ",", 
          RowBox[{"3", "\[Rule]", 
           TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
            "HueColorSwatchTemplate"]}]}], "}"}]}]}], "]"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"PlotDifferences", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "locs", ",", " ", "vals", ",", " ", "rus", ",", " ", "highlighted", ",", 
      " ", "trimmed", ",", " ", "colrules", ",", " ", "allops"}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Options", "[", "PlotCA", "]"}], ",", " ", 
            RowBox[{"Options", "[", "PlotDifferences", "]"}]}], "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"LocationDifferences", "[", 
       RowBox[{"arr1", ",", " ", "arr2"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"vals", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"arr2", "[", 
         RowBox[{"[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "]"}], " ", "&"}], " ", "@@@",
        " ", "locs"}]}], ";", "\n", "    ", 
     RowBox[{"rus", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "->", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", " ", "==", " ", "0"}], ",", " ", 
            RowBox[{"-", "100"}], ",", " ", 
            RowBox[{"-", "#2"}]}], "]"}]}], " ", "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"locs", ",", " ", "vals"}], "}"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"arr1", ",", " ", "rus"}], "]"}]}], ";", "\n", "    ", 
     RowBox[{"trimmed", " ", "=", " ", 
      RowBox[{"TrimArray", "[", 
       RowBox[{"highlighted", ",", " ", 
        RowBox[{"allops", "[", "\"\<Trim\>\"", "]"}]}], "]"}]}], ";", "\n", 
     "    ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"trimmed", ",", " ", "##"}], "]"}], "&"}], "[", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
        RowBox[{"Options", "[", "ArrayPlot", "]"}]}], "]"}], "]"}]}]}], "\n", 
   "    ", "]"}], " "}]}], "Code",
 CellChangeTimes->{{3.943140779972243*^9, 3.943140829408785*^9}, {
   3.943140887462928*^9, 3.943140898149803*^9}, {3.9433721303152437`*^9, 
   3.943372147354694*^9}, 3.943377852602972*^9, 3.943379790272509*^9, {
   3.943537959725543*^9, 3.943537993795289*^9}, {3.943538264100615*^9, 
   3.943538273295963*^9}, {3.94355225625259*^9, 3.943552259024941*^9}, {
   3.943799896063838*^9, 3.943799902262787*^9}, {3.943799987363011*^9, 
   3.943800037817508*^9}, {3.943800374543797*^9, 3.9438003801044*^9}, {
   3.943800431351125*^9, 3.9438004710455093`*^9}, {3.9438005227218447`*^9, 
   3.943800524474503*^9}, {3.943800626121389*^9, 3.943800633785177*^9}, {
   3.943801173008723*^9, 3.943801193393601*^9}, 3.943801249712264*^9, 
   3.943802737450279*^9, {3.943802781851212*^9, 3.943802782996443*^9}, {
   3.943802818648016*^9, 3.943802838269998*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"76bdfc43-21d3-481f-8938-b7c7683e246e"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PlotSensitivities"}]], "Input",
 CellChangeTimes->{{3.94311827891672*^9, 3.943118282028331*^9}, 
   3.9431201532367897`*^9, {3.944445342431557*^9, 3.9444453463239107`*^9}, {
   3.945107385007511*^9, 3.945107386533605*^9}},
 CellLabel->
  "In[308]:=",ExpressionUUID->"2e3b9bfe-7c4d-4727-9587-3b701953e93a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HighlightPerturbations", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorRules", "->", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"100", "->", "Black"}], "}"}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", " ", "->", " ", 
           RowBox[{"GrayLevel", "[", "0.9", "]"}]}], " ", "&"}], " ", "@@@", 
         " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
             "HueColorSwatchTemplate"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
             "HueColorSwatchTemplate"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
             "HueColorSwatchTemplate"]}]}], "}"}]}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", "#1"}], " ", "->", " ", "#2"}], "&"}], " ", "@@@", 
         " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            TemplateBox[<|"color" -> GrayLevel[1]|>,
             "GrayLevelColorSwatchTemplate"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            TemplateBox[<|"color" -> RGBColor[1, 0, 0]|>,
             "RGBColorSwatchTemplate"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
             "HueColorSwatchTemplate"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
             "HueColorSwatchTemplate"]}]}], "}"}]}]}], "]"}]}], ",", " ", 
     RowBox[{"\"\<Span\>\"", "->", "All"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HighlightPerturbations", "[", 
   RowBox[{"ca_", ",", " ", "perturbations_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"highlighted", ",", " ", "allops"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "HighlightPerturbations", "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\n", 
     RowBox[{"highlighted", " ", "=", " ", 
      RowBox[{
       RowBox[{"getperturbedca", "[", 
        RowBox[{"ca", ",", " ", "perturbations"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"allops", "[", "\"\<Span\>\"", "]"}], "]"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"PlotCA", "[", 
      RowBox[{"highlighted", ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.943106685517144*^9, 3.94310677904241*^9}, 
   3.943106870352314*^9, {3.943107599822666*^9, 3.94310773548406*^9}, {
   3.94310779502401*^9, 3.943107812275255*^9}, 3.943107902392624*^9, {
   3.9431079903214*^9, 3.943108001961671*^9}, {3.943117565625243*^9, 
   3.94311760767655*^9}, {3.943118261634057*^9, 3.943118264127614*^9}, {
   3.943118310387644*^9, 3.943118338561084*^9}, {3.943118501698257*^9, 
   3.943118514665153*^9}, {3.943119032917924*^9, 3.943119046038877*^9}, 
   3.943119127604664*^9, {3.943119296902045*^9, 3.943119339979965*^9}, {
   3.943119560372925*^9, 3.943119592441654*^9}, {3.943119954020553*^9, 
   3.943120075695915*^9}, {3.943120126861842*^9, 3.943120148915618*^9}, {
   3.943120193550227*^9, 3.94312019625139*^9}, {3.943120244135589*^9, 
   3.943120244294791*^9}, {3.943369750018495*^9, 3.943369750909212*^9}, {
   3.9433697832791233`*^9, 3.943369830073592*^9}, {3.943369873282905*^9, 
   3.943369887355904*^9}, {3.943369984394773*^9, 3.9433699845053*^9}, 
   3.943377856878038*^9, {3.943380021841707*^9, 3.943380032187724*^9}, {
   3.943537932634395*^9, 3.943537952520741*^9}, {3.9436463581738358`*^9, 
   3.9436463593952503`*^9}, {3.943814028903208*^9, 3.943814107429339*^9}, {
   3.9438141696089687`*^9, 3.94381421192414*^9}, {3.944405684349122*^9, 
   3.944405739058359*^9}, {3.94440579937637*^9, 3.944406079766323*^9}, 
   3.944420599808983*^9, {3.9444206322689*^9, 3.944420641207638*^9}, {
   3.944420676870726*^9, 3.944420694453733*^9}, {3.944421216241522*^9, 
   3.94442132628037*^9}, {3.944424523376267*^9, 3.944424567268689*^9}, {
   3.94442460127194*^9, 3.9444246136162987`*^9}, {3.944427378392194*^9, 
   3.944427387851761*^9}, {3.944522647617392*^9, 3.944522701760391*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"e5721ff3-e4b7-47dc-bde0-27b33fda6738"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getperturbedca", "[", 
   RowBox[{"ca_", ",", " ", "perturbations_"}], "]"}], " ", ":=", " ", "\n", 
  " ", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"ca", ",", " ", 
    RowBox[{"Flatten", "[", "\n", "   ", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"rowidx", ",", " ", "colidxs", ",", " ", "values"}], "}"}], 
        ",", " ", "\n", "   ", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"rowidx", ",", " ", "#1"}], "}"}], " ", "->", " ", 
            RowBox[{"Replace", "[", 
             RowBox[{
              RowBox[{"-", "#2"}], ",", " ", 
              RowBox[{"0", " ", "->", " ", "100"}]}], "]"}]}], " ", "&"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{"colidxs", ",", " ", "values"}], "}"}]}], "]"}]}], "]"}], 
      "\n", "    ", "@@@", " ", "perturbations"}], "]"}]}], "\n", "  ", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944427245434521*^9, 3.944427267368412*^9}, {
   3.944427304771961*^9, 3.9444273541645813`*^9}, {3.944444448445979*^9, 
   3.944444480635047*^9}, {3.944444726115431*^9, 3.944444764041444*^9}, {
   3.944444814228725*^9, 3.944444891687646*^9}, 3.944445337977504*^9},
 CellLabel->"In[19]:=",ExpressionUUID->"aebe8d83-fa83-4477-aba3-32562d14f188"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DiseasePropagationPlot", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "5"}], ",", " ", "50"}], "}"}]}], ",", " ", 
     RowBox[{"PlotHighlighting", "->", "None"}], ",", " ", 
     RowBox[{"\"\<LineStyle\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"Red", ",", " ", "Thick"}], "}"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DiseasePropogationPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", "\n", 
    RowBox[{"row_", ":", "\"\<Random\>\""}], ",", 
    RowBox[{"nperts_Integer", ":", "30"}], ",", "  ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", ",", " ", "ca", ",", " ", "pcasperts"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "DiseasePropogationPlot", "]"}], ",", " ", 
          "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{"{", 
        RowBox[{"n", ",", "k", ",", " ", "r"}], "}"}], "]"}]}], ";", " ", 
     RowBox[{"lt", " ", "=", " ", 
      RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pcasperts", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"PerturbCA", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ca", ",", " ", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], "}"}], ",",
           " ", 
          RowBox[{"row", "->", "1"}], ",", " ", 
          RowBox[{"\"\<ReturnPerturbations\>\"", "->", "True"}]}], "]"}], ",",
         " ", "nperts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DiseasePropogationPlot", "[", 
      RowBox[{"ca", ",", " ", "pcasperts", ",", " ", "ops"}], "]"}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.9442257261890907`*^9, 3.9442257990828953`*^9}, {
   3.944225887831559*^9, 3.944225903424333*^9}, {3.944225950715973*^9, 
   3.944225965794786*^9}, {3.9442260257882137`*^9, 3.9442260829631233`*^9}, {
   3.9442262867732887`*^9, 3.944226350407386*^9}, {3.944226386340079*^9, 
   3.944226458491509*^9}, {3.944226560265594*^9, 3.9442266254154997`*^9}, {
   3.944226690273789*^9, 3.944226698858684*^9}, {3.944226751746167*^9, 
   3.944226767725651*^9}, {3.944226807488984*^9, 3.9442269438234663`*^9}, {
   3.94422701601368*^9, 3.944227043036899*^9}, 3.9442271346617317`*^9, {
   3.944227278830962*^9, 3.94422738168391*^9}, {3.944227452006888*^9, 
   3.944227460029377*^9}, 3.944227509551169*^9, {3.944227544000881*^9, 
   3.944227544392918*^9}, 3.944227602087277*^9, {3.9442277297702208`*^9, 
   3.944227749510415*^9}, {3.944227857419705*^9, 3.944227857752283*^9}, {
   3.944227917479233*^9, 3.944227917619583*^9}, {3.944513457034573*^9, 
   3.9445136395240183`*^9}, {3.944513677092892*^9, 3.944513757292581*^9}, {
   3.944513794768525*^9, 3.944513804030795*^9}, {3.944513834357344*^9, 
   3.944514040078794*^9}, {3.944514081972793*^9, 3.944514519265048*^9}, {
   3.944514551973295*^9, 3.944514685901204*^9}, 3.944514749340536*^9, {
   3.944515011259468*^9, 3.944515019828166*^9}, {3.944515099801543*^9, 
   3.9445151236839*^9}, {3.944515215418655*^9, 3.944515240348115*^9}, {
   3.94451540421021*^9, 3.944515416204427*^9}, {3.9445155641337433`*^9, 
   3.9445155666582203`*^9}, {3.944516124319501*^9, 3.944516126444302*^9}, {
   3.944516467982931*^9, 3.944516777236442*^9}, {3.944516956311542*^9, 
   3.944516956531832*^9}, {3.944517020504977*^9, 3.944517065620974*^9}, {
   3.94451787222213*^9, 3.944517959206838*^9}, {3.944518065707601*^9, 
   3.944518067246185*^9}, {3.944518105492508*^9, 3.944518112866763*^9}, {
   3.944518216176889*^9, 3.944518229074774*^9}, {3.944519030761211*^9, 
   3.944519064138102*^9}, {3.944519239143301*^9, 3.944519251667643*^9}, {
   3.944520875331632*^9, 3.944520878421109*^9}, 3.944521550848152*^9, {
   3.94452548157586*^9, 3.94452548255165*^9}, {3.944768547125078*^9, 
   3.944768550716289*^9}, {3.945361205943533*^9, 3.945361206124344*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"1aad2baa-0495-436d-95f2-af44da44fb73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiseasePropagationPlot", "[", 
   RowBox[{"ca_List", ",", " ", "pcasperts_List", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", ",", " ", "diffstepcountslist", ",", " ", 
      RowBox[{"lt", " ", "=", " ", 
       RowBox[{"TestCALifeTime", "[", "ca", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "DiseasePropogationPlot", "]"}], ",", " ", 
          "ops"}], "}"}], ",", " ", "Last"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffstepcountslist", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"PadLeft", "[", 
         RowBox[{
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"countstepdiffs", "[", 
             RowBox[{"ca", ",", " ", "#1"}], "]"}], ",", " ", "\n", 
            RowBox[{
             RowBox[{"Length", "[", "ca", "]"}], " ", "-", 
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", "\"\<rowidx\>\"", 
              "]"}]}]}], "]"}], ",", " ", 
          RowBox[{"Length", "[", "ca", "]"}]}], "]"}], "&"}], "@@@", " ", 
       "pcasperts"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"diffstepcountslist", ",", "\n", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
            RowBox[{"Options", "@", "ListLinePlot"}]}], "]"}]}]}], "]"}], ",",
        "\n", 
       RowBox[{"Graphics", "[", 
        RowBox[{"Style", "[", 
         RowBox[{
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"lt", ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"lt", ",", " ", "50"}], "}"}]}], "}"}], "]"}], ",", " ", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"allops", "[", "\"\<LineStyle\>\"", "]"}]}]}], "]"}], 
        "]"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944517653871515*^9, 3.944517818989222*^9}, {
   3.944517982155702*^9, 3.944517985149261*^9}, 3.944518046887535*^9, 
   3.944518220024178*^9, 3.944518306785303*^9, {3.944518849995941*^9, 
   3.944518851253766*^9}, {3.944519131225924*^9, 3.944519137406631*^9}, {
   3.944519177805513*^9, 3.944519223420328*^9}, {3.944519260479782*^9, 
   3.944519268661899*^9}, {3.944519317722184*^9, 3.944519332640952*^9}, {
   3.9445215160675*^9, 3.944521535009185*^9}, {3.945361202827179*^9, 
   3.945361202967128*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"3e4c1673-a209-481f-8807-8508bf6ca7d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotSensitivities", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ColorFunctionScaling", "->", "False"}], ",", " ", "\n", 
     RowBox[{"ColorFunction", "->", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "==", 
           RowBox[{"-", "1"}]}], ",", "Gray", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#", "==", "1"}], ",", 
            RowBox[{"Darker", "[", "Red", "]"}], ",", 
            RowBox[{"Blend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"LightBlue", ",", "Blue"}], "}"}], ",", " ", "#"}], 
             "]"}]}], "]"}]}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\"\<IndexFunction\>\"", "->", "getbodyidxs"}], ",", " ", "\n", 
     RowBox[{"\"\<BackgroundColor\>\"", "->", "White"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotSensitivities", "[", 
   RowBox[{"ca_", ",", " ", "sensitivities_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", ",", " ", "idxs", ",", " ", "calts"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PlotSensitivities", "]"}], ",", "ops"}], 
         "}"}], ",", "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"idxs", " ", "=", " ", 
      RowBox[{
       RowBox[{"allops", "[", "\"\<IndexFunction\>\"", "]"}], "[", "ca", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"calts", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"ca", ",", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "->", "#2"}], "&"}], "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"idxs", ",", " ", "1"}], "]"}], ",", " ", 
           RowBox[{"Flatten", "[", "sensitivities", "]"}]}], "]"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PlotCA", "[", 
      RowBox[{"calts", ",", " ", "\n", 
       RowBox[{"ColorFunctionScaling", "->", 
        RowBox[{"allops", "[", "ColorFunctionScaling", "]"}]}], ",", "\n", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "->", 
           RowBox[{
            RowBox[{"allops", "[", "ColorFunction", "]"}], "[", "0", "]"}]}], 
          ",", " ", 
          RowBox[{"0", "->", 
           RowBox[{"allops", "[", "\"\<BackgroundColor\>\"", "]"}]}]}], 
         "}"}]}], ",", " ", "\n", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487237621695*^9, 3.9444872744506893`*^9}, {
   3.944487375767552*^9, 3.944487380970046*^9}, {3.944490432127099*^9, 
   3.94449051359888*^9}, {3.94449059426232*^9, 3.9444905952149887`*^9}, {
   3.944490634237767*^9, 3.94449068604597*^9}, {3.9444908596183853`*^9, 
   3.944490859990075*^9}, {3.944491887938538*^9, 3.9444918895325212`*^9}, 
   3.944492070172682*^9, {3.944492875221411*^9, 3.944492883040357*^9}, {
   3.944493942089341*^9, 3.944494007317971*^9}, {3.944494038237578*^9, 
   3.944494040048719*^9}, {3.944512093176009*^9, 3.944512108084495*^9}, {
   3.944512729671383*^9, 3.944512732767447*^9}, {3.944512930408449*^9, 
   3.944512931286265*^9}, {3.944513040124568*^9, 3.944513040278975*^9}, {
   3.944767498636023*^9, 3.944767504711857*^9}, {3.944768402829117*^9, 
   3.9447684100913143`*^9}, {3.944768518764978*^9, 3.9447685264411297`*^9}, 
   3.9451073768192997`*^9},
 CellLabel->"In[23]:=",ExpressionUUID->"2eb46e7c-52b3-4416-8da4-b23de34620c8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbationSensitivityPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"sensitivityfunc_", ":", "absdeltalt"}], ",", " ", 
    RowBox[{"bitfunc_", ":", "\"\<Random\>\""}], ",", " ", "\n", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "allops", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", "=", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "PerturbationSensitivities", "]"}], ",", 
          "ops"}], "}"}], ",", "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"PlotSensitivities", "[", 
      RowBox[{"ca", ",", " ", 
       RowBox[{"PerturbationSensitivities", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "sensitivityfunc", 
         ",", " ", "bitfunc", ",", " ", "\n", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
            RowBox[{"{", "\"\<IndexFunction\>\"", "}"}]}], "]"}]}]}], "]"}], 
       ",", " ", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"Normal", "[", "allops", "]"}]}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487234449445*^9, 3.944487249741836*^9}, {
   3.944487289642845*^9, 3.94448733463884*^9}, {3.944487624595282*^9, 
   3.944487648149055*^9}, {3.944488738735078*^9, 3.944488757916947*^9}, {
   3.9444899596631527`*^9, 3.9444899855434837`*^9}, {3.944490417629325*^9, 
   3.944490418853786*^9}, {3.944490622862787*^9, 3.944490626143667*^9}, {
   3.9444906958000917`*^9, 3.944490718187745*^9}, {3.944491899797738*^9, 
   3.944491901578408*^9}, {3.944494456563126*^9, 3.9444944633900414`*^9}, {
   3.944494619554298*^9, 3.944494664681058*^9}, {3.94449471551963*^9, 
   3.944494730231015*^9}, {3.944494768338414*^9, 3.944494786811378*^9}, {
   3.944494834981859*^9, 3.944494836775361*^9}, {3.944494871342134*^9, 
   3.944494918851764*^9}, {3.944494957815713*^9, 3.944494961981246*^9}, {
   3.94449500405479*^9, 3.944495049459453*^9}, {3.944495095288765*^9, 
   3.944495140999696*^9}, {3.944495190270718*^9, 3.944495193097069*^9}, {
   3.94449524973536*^9, 3.944495259911443*^9}, {3.944495294077693*^9, 
   3.944495437419049*^9}, {3.94451211763026*^9, 3.944512128622864*^9}, {
   3.9445127868558702`*^9, 3.944512789833928*^9}, {3.944512940746048*^9, 
   3.944512941625601*^9}, {3.944513037738683*^9, 3.944513037949251*^9}, {
   3.94475964861346*^9, 3.944759660912164*^9}, {3.944760377493174*^9, 
   3.944760381453443*^9}, 3.944766223627833*^9},
 CellLabel->"In[25]:=",ExpressionUUID->"39a76f62-7516-4258-8adc-761ad2341dbf"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perturbation Function", "Section",
 CellChangeTimes->{{3.942889340094302*^9, 3.942889343808528*^9}, {
  3.942943963284713*^9, 
  3.942943965416974*^9}},ExpressionUUID->"0d54c013-5695-4af7-a5d8-\
526052a920b4"],

Cell[CellGroupData[{

Cell["Low level", "Subsubsection",
 CellChangeTimes->{{3.943808132743845*^9, 
  3.943808133973564*^9}},ExpressionUUID->"f9337781-00ed-4cf6-b7d6-\
15b108cb404b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LocationDifferences", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_", ",", " ", 
    RowBox[{"levelspec_", ":", "2"}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Position", "[", 
   RowBox[{
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", " ", "#2"}], "}"}], " ", "&"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"arr1", ",", " ", "arr2"}], "}"}], ",", " ", "2"}], "]"}], ",",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_", ",", " ", "y_"}], "}"}], " ", "/;", " ", 
     RowBox[{"x", " ", "!=", " ", "y"}]}], ",", " ", "levelspec"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.94284109345717*^9, 3.942841123199259*^9}, {
   3.942841245628819*^9, 3.9428412530122347`*^9}, 3.942841464181205*^9, {
   3.9428415042017107`*^9, 3.942841570648151*^9}, {3.942841603752768*^9, 
   3.942841605973318*^9}, {3.942841685917691*^9, 3.942841716147069*^9}, {
   3.942947182267355*^9, 3.942947182459833*^9}, {3.943105711024732*^9, 
   3.943105738718268*^9}, {3.943105784418694*^9, 3.943105787791119*^9}, {
   3.943374484112621*^9, 3.943374530822165*^9}, 3.944307889143518*^9},
 CellLabel->"In[26]:=",ExpressionUUID->"00820d1f-bba9-49cf-9118-7a39c77588ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nonzeroRange", "[", "list_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"SparseArray", "[", "list", "]"}], "[", 
    "\"\<NonzeroPositions\>\"", "]"}], " ", "//", " ", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], " ", "==", " ", "0"}], ",", " ", 
      "#", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", " ", "1"}], "]"}], "]"}], ",", " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", " ", "1"}], "]"}], "]"}]}], "}"}]}], 
     "]"}], "&"}]}]}]], "Code",
 CellChangeTimes->{{3.943634765875016*^9, 3.94363476741509*^9}, {
   3.943634828026243*^9, 3.943634828706764*^9}, {3.943634873613714*^9, 
   3.943634952247225*^9}, {3.943635004008057*^9, 3.943635007241334*^9}, {
   3.943635081426149*^9, 3.943635107496182*^9}, {3.943635157819008*^9, 
   3.943635161013969*^9}, {3.94363521039839*^9, 3.943635252222834*^9}, {
   3.94363533449787*^9, 3.943635880394552*^9}, {3.9436359307451773`*^9, 
   3.943635995708077*^9}, 3.943636166156807*^9, {3.944493572078703*^9, 
   3.944493583911049*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"ac9a4b45-3cd6-4fc9-a1af-a205b0f0c8cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getbodyidxs", "[", "ca_", "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ranges", " ", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"nonzeroRange", "/@", " ", "ca"}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], "/@", " ", 
       RowBox[{"Range", "@@", 
        RowBox[{"ranges", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", " ", 
        RowBox[{"Length", "[", "ranges", "]"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.943632118618299*^9, 3.943632121236794*^9}, {
  3.943632273714582*^9, 3.943632311012732*^9}, {3.943632585740198*^9, 
  3.943632678535552*^9}, {3.9436327332728233`*^9, 3.943632790858907*^9}, {
  3.943632895677493*^9, 3.943632899631958*^9}, {3.943633042190752*^9, 
  3.943633062478084*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"8fdd11fb-bfc2-47ea-9605-81e667fb82c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getbodyrules", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"pertbitfunc_", ":", "\"\<Random\>\""}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ranges", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"nonzeroRange", "/@", "ca"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", "\n", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"count", "=", 
           RowBox[{
            RowBox[{"Subtract", "@@", 
             RowBox[{"Reverse", "[", 
              RowBox[{"ranges", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "+", "1"}]}], "}"}], 
         ",", "\n", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"i", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "j", "}"}], ",", "\"\<Enumerate\>\"", ",", " ", 
              "pertbitfunc"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "count"}], "}"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "ranges", "]"}]}], "}"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943795451497281*^9, 3.943795451501377*^9}, {
  3.943795497787277*^9, 3.94379553801251*^9}, {3.943795621959139*^9, 
  3.943795633573501*^9}, {3.943808176674285*^9, 3.943808192140149*^9}, {
  3.943811863239275*^9, 3.943811873574524*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"feac0734-d090-4a95-a838-948cdde9892d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcoloridxs", "[", "ca_", "]"}], ":=", " ", "\[IndentingNewLine]", 
  RowBox[{"GatherBy", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"SparseArray", "[", "ca", "]"}], "[", "\"\<NonzeroPositions\>\"",
      "]"}], ",", " ", "First"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943828486452312*^9, 3.943828538205599*^9}, {
  3.943829890163829*^9, 3.9438299806650476`*^9}, {3.943830016776329*^9, 
  3.943830019677407*^9}, {3.943830626699462*^9, 3.943830628464438*^9}, {
  3.943830804970452*^9, 3.943830807035177*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"f7a36137-a1fb-499c-9888-f233a7dc896a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getflatcoloridxs", "[", "ca_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"SparseArray", "[", "ca", "]"}], "[", "\"\<NonzeroPositions\>\"", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943835654954757*^9, 3.943835661600816*^9}, 
   3.9438364730841513`*^9},
 CellLabel->"In[31]:=",ExpressionUUID->"0cbe98b9-5d15-4e25-aea5-9f81b98a8f78"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcolorrules", "[", 
   RowBox[{"ca_", ",", " ", 
    RowBox[{"pertbitfunc_", ":", "\"\<Random\>\""}]}], "]"}], ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "->", 
         RowBox[{"{", 
          RowBox[{
          "#2", ",", " ", "\"\<Enumerate\>\"", ",", " ", "pertbitfunc"}], 
          "}"}]}], "&"}], ",", " ", "#"}], "]"}], "&"}], "/@", 
    RowBox[{"getcoloridxs", "[", "ca", "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943830633816234*^9, 3.943830648823629*^9}, {
  3.943830679368305*^9, 3.943830702474283*^9}, {3.943830739526439*^9, 
  3.94383074632425*^9}, {3.943830824601147*^9, 3.9438308263492827`*^9}, {
  3.943830861474888*^9, 3.943830944969814*^9}, {3.943831477583398*^9, 
  3.943831480973905*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"5a97706c-555b-42d3-b8c3-5f2eb8316a29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"randomcomplement", "[", 
   RowBox[{"bit_", ",", " ", "k_"}], "]"}], ":=", " ", 
  RowBox[{"RandomChoice", "[", 
   RowBox[{"Delete", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", " ", 
       RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
     RowBox[{"bit", "+", "1"}]}], "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944509979224524*^9, 3.944510063927901*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"8f501bd8-915e-4a2c-afbb-d228be7463e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"todirectfunc", "[", 
   RowBox[{"bitfuncspec_", ",", " ", "k_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Which", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bitfuncspec", " ", "===", "\"\<Random\>\""}], ",", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"randomcomplement", "[", 
       RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], ")"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bitfuncspec", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "===", "\"\<SetValue\>\""}], ",", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"bitfuncspec", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "&"}], ")"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bitfuncspec", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "===", "\"\<AddValue\>\""}], ",", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", " ", "+", " ", 
          RowBox[{"bitfuncspec", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}], ",", " ", "k"}], "]"}], 
      " ", "&"}], ")"}], ",", "\[IndentingNewLine]", "True", ",", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"bitfuncspec", "[", 
       RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], ")"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9453614924208517`*^9, 3.945361622175321*^9}, {
  3.9453616609286633`*^9, 3.945361767712916*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"46e71cfb-abac-4d3f-9522-826cc3d9f9e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tofunc", "[", 
   RowBox[{"bitfuncspec_", ",", " ", "k_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"bitfuncspec", ",", " ", 
    RowBox[{"{", "\n", "   ", 
     RowBox[{
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{"\"\<SetValue\>\"", ",", " ", "i_Integer"}], "]"}], " ", ":>",
        "  ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "[", "#", "]"}]}], "]"}], " ", "&"}], ")"}]}], 
      ",", "\n", "   ", 
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{"\"\<AddValue\>\"", ",", " ", "i_Integer"}], "]"}], " ", ":>",
        " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"#", " ", "+", " ", "i"}], ")"}], ",", " ", "k"}], 
             "]"}], " ", "&"}], ")"}], " ", "/@", " ", "#"}], " ", "&"}], 
        ")"}]}], ",", "\n", "   ", 
      RowBox[{"\"\<Random\>\"", " ", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"randomcomplement", "[", 
             RowBox[{"#", ",", " ", "k"}], "]"}], " ", "&"}], ")"}], " ", "/@",
           " ", "#"}], " ", "&"}], ")"}]}], ",", "\n", "   ", 
      RowBox[{"f_", " ", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], ")"}]}]}], "\n", "   ", 
     "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943272123101211*^9, 3.943272308414565*^9}, {
   3.94327234155481*^9, 3.943272349729585*^9}, {3.94327253714441*^9, 
   3.9432725731670647`*^9}, {3.94327393122878*^9, 3.943273933282145*^9}, {
   3.9432739645345984`*^9, 3.943274107539613*^9}, {3.943274148146153*^9, 
   3.9432742328432198`*^9}, {3.943274385872395*^9, 3.943274395680002*^9}, {
   3.943274433279478*^9, 3.94327444420741*^9}, {3.94327452192891*^9, 
   3.943274541740081*^9}, {3.943274582276461*^9, 3.943274582805805*^9}, {
   3.943294670723722*^9, 3.943294673717114*^9}, 3.94329476574574*^9, {
   3.943315325338135*^9, 3.943315329685987*^9}, {3.943377864910557*^9, 
   3.943377865154554*^9}, {3.943637690322751*^9, 3.9436377271718006`*^9}, {
   3.943637909432729*^9, 3.943637981609343*^9}, 3.944420000933543*^9, {
   3.944510207538455*^9, 3.944510212068975*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"f0aca7bf-a223-47fe-ba3b-4e1b3a0d8fcd"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"tofunc", "[", 
  RowBox[{
   RowBox[{"\"\<SetValue\>\"", "->", "1"}], ",", " ", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.9453612607539997`*^9, 3.945361269290609*^9}},
 CellLabel->
  "In[354]:=",ExpressionUUID->"f206f1f5-d424-41a8-8650-669e066d87bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{"1", ",", 
    RowBox[{"Length", "[", "#1", "]"}]}], "]"}], "&"}]], "Output",
 CellChangeTimes->{3.945361269656282*^9},
 CellLabel->
  "Out[354]=",ExpressionUUID->"efa5eecf-26f2-4187-8fb4-35e66ca2c98b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"expandrange", "[", 
   RowBox[{"range_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"ReplaceAll", "[", "\n", "  ", 
   RowBox[{
    RowBox[{"Replace", "[", 
     RowBox[{"range", ",", " ", "\n", "   ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "i_Integer", ")"}], " ", ":>", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", " ", ">=", " ", "1"}], ",", " ", 
           RowBox[{"Range", "[", "i", "]"}], ",", " ", 
           RowBox[{"Range", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", " ", "i", ",", " ", 
             RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], ",", "\n", "    ", 
        RowBox[{
         RowBox[{"List", "[", 
          RowBox[{"i_Integer", ",", " ", "o__"}], "]"}], " ", ":>", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", " ", ">=", " ", "1"}], ",", " ", 
             RowBox[{"Range", "[", "i", "]"}], ",", " ", 
             RowBox[{"Range", "[", 
              RowBox[{
               RowBox[{"-", "1"}], ",", " ", "i", ",", " ", 
               RowBox[{"-", "1"}]}], "]"}]}], "]"}], ",", " ", "o"}], 
          "}"}]}]}], "}"}]}], "]"}], ",", "\n", "  ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"All", " ", ":>", " ", 
       RowBox[{"Range", "[", "n", "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"s_Integer", ",", " ", "e_Integer"}], "}"}], "}"}], " ", ":>",
        " ", 
       RowBox[{"Range", "[", 
        RowBox[{"s", ",", " ", "e"}], "]"}]}]}], "}"}]}], "\n", "  ", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943314804259214*^9, 3.943314813916387*^9}, {
  3.943315047307898*^9, 3.943315070770369*^9}, {3.943315130239127*^9, 
  3.943315188929872*^9}, {3.943315445622134*^9, 3.943315487850592*^9}, {
  3.9433165679899*^9, 3.943316570611985*^9}, {3.943317005544421*^9, 
  3.943317036097658*^9}, {3.943324387458938*^9, 3.9433243893801813`*^9}, {
  3.943324635996648*^9, 3.943324683022292*^9}, {3.943377867463288*^9, 
  3.943377867733004*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"880fbcd0-faff-4b3d-9261-78cca0261925"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tofullform", "[", "colspec_", "]"}], " ", ":=", "\n", " ", 
   RowBox[{"Replace", "[", 
    RowBox[{"colspec", ",", " ", 
     RowBox[{"{", "\n", "   ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "js__Integer", "}"}], " ", ":>", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "js", "}"}], ",", " ", "\"\<Random\>\"", ",", " ", 
          "\"\<Random\>\""}], "}"}]}], ",", "\n", "   ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "js__Integer", "}"}], ",", " ", "s_String"}], "}"}], 
        " ", ":>", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "js", "}"}], ",", " ", "s", ",", " ", 
          "\"\<Random\>\""}], "}"}]}], ",", "\n", "   ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "js__Integer", "}"}], ",", " ", "s_String", ",", " ", 
          "f_"}], "}"}], " ", ":>", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "js", "}"}], ",", " ", "s", ",", " ", "f"}], "}"}]}]}],
       "}"}]}], "]"}]}], "\n"}]], "Code",
 CellChangeTimes->{{3.94330918649648*^9, 3.943309290947115*^9}, {
   3.943309329209721*^9, 3.943309370340704*^9}, {3.943309419426938*^9, 
   3.943309453122422*^9}, {3.943309485438581*^9, 3.943309538734017*^9}, 
   3.943309586637244*^9, {3.943309630836619*^9, 3.9433096347116413`*^9}, {
   3.94331087516789*^9, 3.943310876723132*^9}, 3.943311120906832*^9, {
   3.943314724580751*^9, 3.94331480314891*^9}, {3.943314839316426*^9, 
   3.94331503881894*^9}, 3.94337497887311*^9, {3.943377869713479*^9, 
   3.943377869901614*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"0c8cc113-f9e5-4e0e-9927-9cded33aeb2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interpretrule", "[", "rule_", "]"}], " ", ":=", " ", 
  RowBox[{"Replace", "[", 
   RowBox[{"rule", ",", " ", 
    RowBox[{"{", "\n", "   ", 
     RowBox[{
      RowBox[{"n_Integer", " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "2", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer"}], "]"}], " ", ":>", "  ", 
       
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}]}], "]"}], " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}], ",", " ", "s_Integer"}], "]"}], " ", 
       ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", 
         RowBox[{"List", "[", 
          RowBox[{"k_Integer", ",", " ", "1"}], "]"}]}], "]"}], " ", ":>", 
       " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "1"}], "}"}]}], ",", "\n", 
      "   ", 
      RowBox[{
       RowBox[{"List", "[", 
        RowBox[{"n_Integer", ",", " ", 
         RowBox[{"List", "[", 
          RowBox[{"k_Integer", ",", " ", "1"}], "]"}], ",", " ", 
         RowBox[{"r_", "?", "NumberQ"}]}], "]"}], " ", ":>", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}]}], "\n", "   ", 
     "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943306327490436*^9, 3.94330641756797*^9}, {
  3.943306573704802*^9, 3.943306674496083*^9}, {3.943306705362965*^9, 
  3.943306855240611*^9}, {3.943307010998331*^9, 3.943307011293704*^9}, {
  3.943307045470796*^9, 3.943307074880732*^9}, {3.9433071284836483`*^9, 
  3.943307270220673*^9}, {3.943377871784828*^9, 3.943377872038154*^9}, {
  3.943545128893005*^9, 3.9435451384052277`*^9}, {3.943545334276613*^9, 
  3.943545342616293*^9}, {3.943545476272172*^9, 3.9435454847219048`*^9}, {
  3.943545836929001*^9, 3.943545874910882*^9}, {3.943545907560986*^9, 
  3.943545916385167*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"eab83cc5-4fb6-4205-88f0-e49ac63024f8"]
}, Closed]],

Cell[CellGroupData[{

Cell["High level", "Subsubsection",
 CellChangeTimes->{{3.943808142626933*^9, 
  3.943808146341382*^9}},ExpressionUUID->"c3934115-dd2b-402d-95db-\
e64b1755e4c9"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PerturbCA"}]], "Input",
 CellChangeTimes->{{3.94444511727065*^9, 3.944445120882388*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"19568139-b395-4661-9473-480d45d69885"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"\"\<NRandom\>\"", "->", "nrand_Integer"}], ",", 
    RowBox[{"steps_Integer", ":", "200"}], ",", " ", "ops___"}], "]"}], ":=", 
  " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
        "steps"}], "]"}]}], "}"}], ",", " ", 
    RowBox[{"PerturbCA", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ca", ",", " ", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], "}"}], ",", 
      " ", 
      RowBox[{"NRandomPerts", "[", 
       RowBox[{"nrand", ",", " ", "ca"}], "]"}], ",", " ", "ops"}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, 3.9447528381172047`*^9, {3.944752876317912*^9, 
   3.944752878709632*^9}, {3.944752925484995*^9, 3.944752951141356*^9}, {
   3.94475298973908*^9, 3.944752990973639*^9}, {3.945353543638424*^9, 
   3.945353647000718*^9}, {3.945353686908846*^9, 3.945353721715211*^9}, {
   3.945355342402096*^9, 3.945355376851003*^9}, {3.945356026247266*^9, 
   3.945356026609149*^9}, {3.945356120073936*^9, 3.945356121832449*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"7e4575df-c6f4-4be7-91f2-5cfb605375ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"\"\<NRandom\>\"", "->", "nrand_Integer"}], ",", 
    RowBox[{"steps_Integer", ":", "200"}], ",", " ", "ops___"}], "]"}], ":=", 
  " ", "\n", 
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
    RowBox[{"NRandomPerts", "[", 
     RowBox[{"nrand", ",", " ", "ca"}], "]"}], ",", " ", "ops"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, 3.9447528381172047`*^9, {3.944752876317912*^9, 
   3.944752878709632*^9}, {3.944752925484995*^9, 3.944752951141356*^9}, {
   3.94475298973908*^9, 3.944752990973639*^9}, {3.945353543638424*^9, 
   3.945353647000718*^9}, {3.945353686908846*^9, 3.945353721715211*^9}, {
   3.9453560041040363`*^9, 3.945356024568257*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"93312ec3-2ccb-43ab-bfed-a7aca5100a95"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"pertspec_", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<Random\>\"", "->", "1"}], ")"}]}], ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}], ",", " ", "ops___"}], "]"}], ":=", 
  " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
        "steps", ",", " ", "All"}], "]"}]}], "}"}], ",", " ", 
    RowBox[{"PerturbCA", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ca", ",", " ", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}]}], "}"}], ",", 
      " ", "pertspec", ",", " ", "ops"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, 3.9447528381172047`*^9, {3.944752876317912*^9, 
   3.944752878709632*^9}, {3.944752925484995*^9, 3.944752951141356*^9}, {
   3.94475298973908*^9, 3.944752990973639*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"ae583b66-9d54-4247-a467-a8fe176680d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", "ops___"}], "]"}], ":=",
   " ", 
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{"RandomInteger", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"TestCALifeTime", "[", "ca", "]"}], " ", "//", " ", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#", " ", "==", " ", 
              RowBox[{"-", "Infinity"}]}], ",", " ", 
             RowBox[{"Length", "[", "ca", "]"}], ",", " ", "#"}], "]"}], 
           "&"}]}], ")"}]}], "}"}], "]"}], "->", " ", "1"}], ",", " ", 
    "ops"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, {3.9447528381172047`*^9, 3.944752839316883*^9}, {
   3.945013254703875*^9, 3.945013304461409*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"9c81f832-deaa-49c9-b65a-3024caef2c27"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", 
    RowBox[{"rowidx_Integer", "->", "colspec_"}], ",", " ", "ops___"}], "]"}],
   ":=", " ", 
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"rowidx", "->", "colspec"}], "}"}], ",", "ops"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, {3.9447528381172047`*^9, 3.944752840565516*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"13a70852-7b4b-403b-8ea5-d1bc82dd6d2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PerturbCA", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
     RowBox[{"\"\<Random\>\"", "->", "colspec_"}], ",", " ", "ops___"}], 
    "]"}], ":=", "  ", 
   RowBox[{"PerturbCA", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"RandomInteger", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", 
         RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], "}"}], "]"}], "->", 
      " ", "colspec"}], ",", " ", "ops"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
       "}"}]}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"i_Integer", ",", " ", "j_Integer"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "PerturbCA", "]"}]}], "]"}], ":=", "  ", 
  "\n", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"ca", "[", 
     RowBox[{"[", 
      RowBox[{";;", 
       RowBox[{"i", " ", "-", " ", "1"}]}], "]"}], "]"}], ",", " ", 
    RowBox[{"CellularAutomaton", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], ",", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"ca", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", " ", 
        RowBox[{"j", "->", 
         RowBox[{
          RowBox[{"todirectfunc", "[", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<BitFunc\>\"", "]"}], ",", " ", 
            "k"}], "]"}], "[", 
          RowBox[{
           RowBox[{"ca", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", " ", "j"}], "]"}], "]"}], ",", " ", "k"}], 
          "]"}]}]}], "]"}], ",", " ", "\n", 
      RowBox[{
       RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "i"}]}], "]"}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.944404560408435*^9, 3.9444045705863256`*^9}, {
   3.944405382820457*^9, 3.944405475030409*^9}, {3.944405517002592*^9, 
   3.944405534785362*^9}, {3.944419596722534*^9, 3.9444196014759693`*^9}, 
   3.944419738726711*^9, {3.944419848344221*^9, 3.944419858554064*^9}, 
   3.94442032670623*^9, {3.9444437360478888`*^9, 3.944443745392834*^9}, 
   3.944444078381541*^9, 3.944444202649288*^9, {3.9444449499450483`*^9, 
   3.944444967687941*^9}, {3.944445015364365*^9, 3.944445075493009*^9}, {
   3.9444451752214108`*^9, 3.944445191619742*^9}, {3.944445241706311*^9, 
   3.9444452700528517`*^9}, {3.944510470236774*^9, 3.944510491789122*^9}, {
   3.944510558987823*^9, 3.944510665721239*^9}, 3.944510702060964*^9, 
   3.944510766017393*^9, {3.944510889146906*^9, 3.944510896268654*^9}, {
   3.944510930194737*^9, 3.944510965350945*^9}, {3.944511028430007*^9, 
   3.944511028898847*^9}, {3.944511336766202*^9, 3.944511350778147*^9}, {
   3.944511530096311*^9, 3.944511549850655*^9}, {3.944511581249562*^9, 
   3.944511583564496*^9}, 3.944511620834393*^9, {3.944751981356101*^9, 
   3.944752171187394*^9}, 3.944752246048526*^9, {3.944752485256371*^9, 
   3.944752497999178*^9}, {3.944752577277535*^9, 3.944752607660623*^9}, {
   3.944752695067102*^9, 3.944752720839182*^9}, {3.944752770597846*^9, 
   3.944752773607216*^9}, {3.9447528381172047`*^9, 3.944752840565516*^9}, 
   3.9453020223078957`*^9, {3.945360713880077*^9, 3.945360725221608*^9}, {
   3.9453609232127123`*^9, 3.945360945513851*^9}, {3.945360979019068*^9, 
   3.945361088546033*^9}, {3.945361415396576*^9, 3.945361418858154*^9}, {
   3.945361916645391*^9, 3.945361921697133*^9}, {3.9453620726758623`*^9, 
   3.945362073104623*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"fea5e2fb-e273-49d4-9e3c-4248480d4226"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ReturnPerturbations\>\"", " ", "->", " ", "True"}], ",", 
     " ", 
     RowBox[{"\"\<BitFunc\>\"", " ", "->", " ", "\"\<Random\>\""}]}], "}"}]}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{"PerturbCA", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", "pertspecs_List", ",",
     " ", 
    RowBox[{"OptionsPattern", "[", "PerturbCA", "]"}]}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sortedspecs", ",", " ", "rowidxs", ",", " ", "evolengths", ",", " ", 
      "pre", ",", " ", "returbfunc"}], "}"}], ",", "\n", "  ", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\n", "  ", 
     RowBox[{"sortedspecs", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ListQ", "[", 
         RowBox[{"pertspecs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "\n", "    ", 
        RowBox[{"GatherBy", "[", 
         RowBox[{
          RowBox[{"SortBy", "[", 
           RowBox[{"pertspecs", ",", " ", "First"}], "]"}], ",", " ", 
          "First"}], "]"}], ",", " ", 
        RowBox[{"SortBy", "[", 
         RowBox[{"pertspecs", ",", " ", "First"}], "]"}]}], "]"}]}], ";", 
     "\n", "  ", 
     RowBox[{"rowidxs", " ", "=", " ", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ListQ", "[", 
           RowBox[{"pertspecs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
          RowBox[{"sortedspecs", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}], ",", 
          " ", "\n", "  ", 
          RowBox[{"sortedspecs", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Length", "[", "ca", "]"}], "+", "1"}]}], "]"}]}], ";", "\n",
      "  ", 
     RowBox[{"evolengths", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], " ", "/@", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{"rowidxs", ",", " ", "2", ",", " ", "1"}], "]"}]}]}], ";", 
     "\n", "  ", 
     RowBox[{"pre", " ", "=", " ", 
      RowBox[{"ca", "[", 
       RowBox[{"[", 
        RowBox[{";;", " ", 
         RowBox[{"rowidxs", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", "\n", "  ", 
     RowBox[{"returnfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ReturnPerturbations\>\"", "]"}], ",",
         " ", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Join", " ", "@@", " ", 
            RowBox[{"Most", "/@", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}]}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", " ", ";;"}], ",", " ", "2"}], "]"}], "]"}]}], 
          "}"}], " ", "&"}], ",", " ", 
        RowBox[{
         RowBox[{"Join", " ", "@@", " ", 
          RowBox[{"Most", "/@", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}]}], " ", "&"}]}], 
       "]"}]}], ";", "\n", "  ", 
     RowBox[{"returnfunc", "@", 
      RowBox[{"FoldList", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "===", " ", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", 
             RowBox[{"<|", "|>"}]}], "}"}], ",", " ", "\n", "    ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CellularAutomaton", "[", 
              RowBox[{"ru", ",", " ", "\n", "    ", 
               RowBox[{"replaceperturbation", "[", 
                RowBox[{
                 RowBox[{"#1", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", " ", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], ",", " ", 
                 RowBox[{"pert", " ", "=", " ", 
                  RowBox[{"getrowperturbation", "[", 
                   RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", " ", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], ",", " ", "k", ",", 
                    " ", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"OptionValue", "[", "\"\<BitFunc\>\"", "]"}]}], 
                   "]"}]}]}], "]"}], ",", " ", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", "pert"}], 
            "}"}]}], "]"}], " ", "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"pre", ",", " ", 
          RowBox[{"<|", "|>"}]}], "}"}], ",", " ", "\n", "    ", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"sortedspecs", ",", " ", "evolengths"}], "}"}], "]"}]}], 
       "]"}]}]}]}], "\n", "  ", "]"}]}]}], "Code",
 CellChangeTimes->{{3.944434746118541*^9, 3.944434866709287*^9}, {
   3.94443492659265*^9, 3.944434987173049*^9}, {3.94443762880793*^9, 
   3.944437630072924*^9}, {3.944438261780216*^9, 3.944438261883554*^9}, {
   3.944438434783922*^9, 3.9444386479236097`*^9}, {3.944438925071637*^9, 
   3.944439016020056*^9}, {3.944439057478928*^9, 3.944439059072003*^9}, {
   3.9444393216698*^9, 3.944439354794155*^9}, {3.944439869880945*^9, 
   3.944440066488909*^9}, {3.944440386815773*^9, 3.944440410550395*^9}, {
   3.944440444461227*^9, 3.944440449433117*^9}, {3.944440527887636*^9, 
   3.944440535911251*^9}, {3.944440571192792*^9, 3.944440604564672*^9}, {
   3.944440890296878*^9, 3.944440997182732*^9}, {3.944441031313175*^9, 
   3.944441085896178*^9}, {3.944441157733574*^9, 3.944441159181782*^9}, {
   3.94444120380133*^9, 3.944441205463979*^9}, {3.9444414442403197`*^9, 
   3.944441444956107*^9}, {3.944441518020523*^9, 3.94444152017671*^9}, {
   3.944441565235278*^9, 3.944441566644498*^9}, {3.944441741777363*^9, 
   3.944441848582889*^9}, 3.944441919328869*^9, {3.944442106288557*^9, 
   3.944442122315627*^9}, {3.944442188890781*^9, 3.944442198128233*^9}, 
   3.944442258367231*^9, {3.944442294434658*^9, 3.944442298393242*^9}, {
   3.944443053231902*^9, 3.944443071552998*^9}, {3.944443235738044*^9, 
   3.944443311299178*^9}, {3.944443367081709*^9, 3.944443400739763*^9}, {
   3.944443820543092*^9, 3.944443887270937*^9}, 3.944444008886673*^9, {
   3.944444293776346*^9, 3.944444303982256*^9}, 3.9444443667190228`*^9, {
   3.944445640742647*^9, 3.944445641251989*^9}, {3.94444570191532*^9, 
   3.9444457021699557`*^9}, {3.944483369657428*^9, 3.944483434399609*^9}, {
   3.944483599511112*^9, 3.944483600147819*^9}, {3.9444839631189823`*^9, 
   3.944484000055624*^9}, {3.944508468389539*^9, 3.944508492431265*^9}, {
   3.944508537463366*^9, 3.944508574196076*^9}, 3.944509610687783*^9, {
   3.9445097699705276`*^9, 3.944509812226396*^9}, {3.944509843561304*^9, 
   3.944509857361952*^9}, {3.944509904483391*^9, 3.9445099359316874`*^9}, {
   3.94451024950724*^9, 3.944510348728596*^9}, {3.944510391651875*^9, 
   3.944510463269631*^9}, {3.944511293090032*^9, 3.944511293470052*^9}, {
   3.944763055688991*^9, 3.944763178788054*^9}, {3.94476584102009*^9, 
   3.944765842709216*^9}, {3.944765878234457*^9, 3.944765903525643*^9}, {
   3.944765935901888*^9, 3.944766006987164*^9}, {3.944766065752748*^9, 
   3.944766066065798*^9}, {3.945271762685489*^9, 3.945271769500264*^9}, {
   3.945353971862843*^9, 3.945353972299912*^9}, {3.9453790652105927`*^9, 
   3.945379075357683*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"5ca3128a-7227-459a-9f6b-b2ee308f500d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EvolvePerturbation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    "perturbation_Association", ",", " ", "steps_"}], "]"}], ":=", "\n", 
  RowBox[{"CellularAutomaton", "[", 
   RowBox[{"ru", ",", " ", 
    RowBox[{"replaceperturbation", "[", 
     RowBox[{
      RowBox[{"ca", "[", 
       RowBox[{"[", 
        RowBox[{"perturbation", "[", "\"\<rowidx\>\"", "]"}], "]"}], "]"}], 
      ",", " ", "perturbation"}], "]"}], ",", "steps"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944757621673994*^9, 3.944757645638876*^9}, {
   3.944759340224999*^9, 3.944759349004862*^9}, {3.944761240783392*^9, 
   3.944761250326497*^9}, {3.9447634745568*^9, 3.944763745830612*^9}, {
   3.9447637881551456`*^9, 3.9447638334071074`*^9}, {3.9447639053573112`*^9, 
   3.9447641812682943`*^9}, 3.944766089245843*^9, {3.944766159034811*^9, 
   3.944766177049444*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"91cabbb1-3e5f-418a-8b1a-364f9395504c"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "getrowperturbation"}]], "Input",
 CellChangeTimes->{{3.944438040287565*^9, 3.9444380596791697`*^9}},
 CellLabel->
  "In[435]:=",ExpressionUUID->"fd7dfa2c-f86c-4b3f-a1dd-c2e180e5bb89"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getrowperturbation", "[", 
   RowBox[{"row_", ",", " ", "k_", ",", " ", 
    RowBox[{"rowidx_", "->", "colspec_"}], ",", " ", "idxbitfunc_"}], "]"}], ":=",
   "  ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "bodyidxs", ",", " ", "rangespec", ",", " ", "\n", "order", ",", " ", 
      "bitfunc", ",", " ", "sorted", ",", " ", "inbodyrange", ",", " ", 
      "pertbitfunc", ",", " ", "vals"}], "}"}], ",", "\n", "  ", 
    RowBox[{
     RowBox[{"bodyidxs", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"nonzeroRange", "[", "row", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", "}"}], " ", ":>", " ", 
           RowBox[{"{", "}"}]}], ",", " ", 
          RowBox[{"g_", " ", ":>", " ", 
           RowBox[{"Range", " ", "@@", " ", "g"}]}]}], "}"}]}], "]"}]}], ";", 
     "\n", "  ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"rangespec", ",", " ", "order", ",", " ", "bitfunc"}], "}"}], 
      " ", "=", " ", 
      RowBox[{"tofullform", "[", 
       RowBox[{"expandrange", "[", 
        RowBox[{"colspec", ",", " ", 
         RowBox[{"Length", "[", "bodyidxs", "]"}]}], "]"}], "]"}]}], ";", 
     "\n", "  ", 
     RowBox[{"sorted", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"order", " ", "===", " ", "\"\<Random\>\""}], ",", " ", 
        RowBox[{"RandomSample", "[", 
         RowBox[{"bodyidxs", ",", " ", 
          RowBox[{"UpTo", "@", 
           RowBox[{"Length", "[", "rangespec", "]"}]}]}], "]"}], ",", " ", 
        "bodyidxs"}], "]"}]}], ";", "\n", "  ", 
     RowBox[{"inbodyrange", " ", "=", " ", 
      RowBox[{"sorted", "[", 
       RowBox[{"[", 
        RowBox[{"Select", "[", 
         RowBox[{"rangespec", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", " ", ">=", " ", 
             RowBox[{"-", 
              RowBox[{"Length", "[", "sorted", "]"}]}]}], " ", "&&", " ", 
            RowBox[{"#", " ", "<=", " ", 
             RowBox[{"Length", "[", "sorted", "]"}]}]}], " ", "&"}]}], "]"}], 
        "]"}], "]"}]}], ";", "\n", "  ", 
     RowBox[{"pertbitfunc", " ", "=", " ", 
      RowBox[{"tofunc", "[", 
       RowBox[{"bitfunc", ",", " ", "k"}], "]"}]}], ";", "\n", "  ", 
     RowBox[{"vals", " ", "=", " ", 
      RowBox[{"pertbitfunc", "[", 
       RowBox[{"row", "[", 
        RowBox[{"[", "inbodyrange", "]"}], "]"}], "]"}]}], ";", "\n", "  ", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<rowidx\>\"", "->", "rowidx"}], ",", 
       RowBox[{"\"\<colidxs\>\"", "->", "inbodyrange"}], ",", " ", 
       RowBox[{"\"\<values\>\"", "->", "vals"}]}], "|>"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944398709524399*^9, 3.944398719893635*^9}, {
   3.944398788314987*^9, 3.944398794174851*^9}, {3.944398850033525*^9, 
   3.944398854441798*^9}, {3.944398901019615*^9, 3.944398914159252*^9}, {
   3.944398954052419*^9, 3.944398973457897*^9}, {3.944399024053154*^9, 
   3.944399048325629*^9}, {3.944399859681148*^9, 3.944399864518668*^9}, {
   3.944401633323432*^9, 3.944401727179887*^9}, 3.944401831050124*^9, {
   3.944401866102364*^9, 3.9444019092052717`*^9}, {3.944401967616002*^9, 
   3.944401998203155*^9}, {3.944402038608568*^9, 3.944402178098238*^9}, {
   3.944407464697427*^9, 3.944407469748894*^9}, {3.944407505047376*^9, 
   3.944407513853385*^9}, {3.944407590212996*^9, 3.944407590765017*^9}, 
   3.944415852153249*^9, {3.944419548781468*^9, 3.944419554073433*^9}, 
   3.944420010491609*^9, {3.944422545484366*^9, 3.94442257753626*^9}, {
   3.94443764414747*^9, 3.944437661072908*^9}, {3.944437722463068*^9, 
   3.944437747619247*^9}, 3.944438058027833*^9, {3.944438344476006*^9, 
   3.944438345991034*^9}, {3.94443922197621*^9, 3.944439228211755*^9}, {
   3.944441162699277*^9, 3.9444411642500467`*^9}, {3.944441462955439*^9, 
   3.9444414651385517`*^9}, {3.9444443490408278`*^9, 3.944444350152931*^9}, {
   3.9447630002298183`*^9, 3.944763012638769*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"dd2def3d-7d35-44cf-a24a-f73d80d1056e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getrowperturbation", "[", 
   RowBox[{"row_", ",", " ", "k_", ",", " ", "idxs_List", ",", " ", 
    RowBox[{"bitfunc_", " ", ":", " ", "\"\<Random\>\""}]}], "]"}], " ", ":=",
   "\n", "   ", 
  RowBox[{"<|", 
   RowBox[{
    RowBox[{"\"\<rowidx\>\"", " ", "->", " ", 
     RowBox[{"idxs", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", " ", "1"}], "]"}], "]"}]}], ",", " ", 
    RowBox[{"\"\<colidxs\>\"", " ", "->", " ", 
     RowBox[{"idxs", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ",", " ", "\n", "   ", 
    
    RowBox[{"\"\<values\>\"", " ", "->", " ", 
     RowBox[{
      RowBox[{"tofunc", "[", 
       RowBox[{"bitfunc", ",", " ", "k"}], "]"}], "[", 
      RowBox[{"row", "[", 
       RowBox[{"[", 
        RowBox[{"idxs", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}], "]"}], 
      "]"}]}]}], "|>"}]}]], "Code",
 CellChangeTimes->{{3.944441588232404*^9, 3.9444416967543783`*^9}, {
   3.944441860076026*^9, 3.94444189094416*^9}, 3.944441942989818*^9, {
   3.94444258826232*^9, 3.944442590082858*^9}, 3.944442655164341*^9, {
   3.944442794412453*^9, 3.944442803253564*^9}, {3.9444443546418867`*^9, 
   3.944444355087516*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"1036ea8a-45c1-4b55-8abe-80832ca01bbc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"replaceperturbation", "[", 
   RowBox[{"row_", ",", " ", "perturbation_Association"}], "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ReplacePart", "[", 
     RowBox[{"row", ",", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#1", " ", "->", " ", "#2"}], " ", "&"}], ")"}], "[", 
        RowBox[{"#colidxs", ",", " ", "#values"}], "]"}], "]"}]}], "]"}], " ",
     "&"}], "@", " ", "perturbation"}]}]], "Code",
 CellChangeTimes->{{3.944437756106401*^9, 3.944437960529663*^9}, {
  3.94443820172711*^9, 3.944438207515005*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"b56dbf97-9ff2-45c6-b5f2-96e02646739b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NRandomPerts", "[", 
   RowBox[{"n_", ",", " ", "lt_Integer"}], "]"}], ":=", " ", 
  RowBox[{"Normal", "@", 
   RowBox[{"KeySort", "@", 
    RowBox[{"Counts", "@", 
     RowBox[{"RandomInteger", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "lt"}], "}"}], ",", " ", "n"}], 
      "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"NRandomPerts", "[", 
   RowBox[{"n_", ",", " ", "ca_List"}], "]"}], ":=", " ", 
  RowBox[{"Normal", "@", 
   RowBox[{"KeySort", "@", 
    RowBox[{"Counts", "@", 
     RowBox[{"RandomInteger", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", " ", 
         RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], "}"}], ",", " ", "n"}],
       "]"}]}]}]}]}]}], "Code",
 CellChangeTimes->{{3.944399227541326*^9, 3.9443992387138*^9}, {
   3.944399273148977*^9, 3.944399318575328*^9}, {3.944399363343272*^9, 
   3.944399383486019*^9}, 3.9443994164008417`*^9, {3.944399670155365*^9, 
   3.944399670401984*^9}, {3.94439991937348*^9, 3.944399950235643*^9}, {
   3.944399993210393*^9, 3.944400005220916*^9}, {3.944400168295532*^9, 
   3.944400240996255*^9}, {3.944400273930849*^9, 3.944400277741935*^9}, {
   3.944400320599969*^9, 3.944400376383061*^9}, {3.944400662940554*^9, 
   3.944400668257813*^9}, {3.944400797832574*^9, 3.94440083304471*^9}, {
   3.944432265927956*^9, 3.944432285286237*^9}, {3.944443645907744*^9, 
   3.944443648603844*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"4f8b6eaa-2edc-44db-9a2b-eaffe256f8bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbedCAEvolution", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", "pertspec_"}], "]"}], 
  ":=", " ", 
  RowBox[{"FoldList", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"PerturbCA", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", " ", "ru"}], "}"}], ",", " ", "#2"}], "]"}], "&"}],
     ",", " ", "ca", ",", " ", "pertspec"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944419205223613*^9, 3.944419261957252*^9}, {
   3.944419352797088*^9, 3.944419383664208*^9}, {3.94441950124764*^9, 
   3.944419517307039*^9}, 3.9444201540344057`*^9},
 CellLabel->"In[54]:=",ExpressionUUID->"ecc43957-24ef-44e1-8558-3c233858326d"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysis Functions", "Section",
 CellChangeTimes->{{3.943103306870668*^9, 
  3.943103310441294*^9}},ExpressionUUID->"c0def580-a913-4d5e-a53d-\
54a25ec47976"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "absdeltalt"}]], "Input",
 CellChangeTimes->{{3.943642697955091*^9, 3.9436427009111357`*^9}, {
  3.943643228795806*^9, 3.943643230244085*^9}, {3.94364395066821*^9, 
  3.943643954419182*^9}, {3.944309951478701*^9, 3.944309963331411*^9}, {
  3.944507413664729*^9, 3.9445074146818047`*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"78f72f05-bdc5-4221-9640-323bd721da42"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newlt", "[", 
   RowBox[{"ca_", ",", " ", "pca_"}], "]"}], ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"plt", " ", "=", " ", 
      RowBox[{"TestCALifeTime", "[", "pca", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"plt", " ", "/", " ", 
       RowBox[{"Length", "[", "ca", "]"}]}], ")"}], "//", 
     RowBox[{
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{"#", "==", 
         RowBox[{"-", "Infinity"}]}], ",", " ", "1", ",", 
        RowBox[{"#", "==", "0"}], ",", " ", 
        RowBox[{"-", "1"}], ",", " ", "True", ",", " ", "#"}], "]"}], 
      "&"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944491286196488*^9, 3.944491294235258*^9}, {
   3.94449132942134*^9, 3.944491343850526*^9}, {3.944491397520747*^9, 
   3.944491398705849*^9}, {3.944491546072514*^9, 3.944491547207543*^9}, {
   3.944491639092217*^9, 3.944491641073769*^9}, {3.944491753992049*^9, 
   3.944491794348637*^9}, {3.94449186537988*^9, 3.944491869526366*^9}, {
   3.944492005938557*^9, 3.944492016231702*^9}, {3.9444938695140047`*^9, 
   3.944493906749136*^9}, 3.944507293756145*^9, {3.944759757138789*^9, 
   3.94475975931752*^9}, {3.944759803806303*^9, 3.944759804352972*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"c84488ca-30e8-4ef8-a260-ba6d0411bb08"],

Cell[BoxData[
 RowBox[{
  RowBox[{"absdeltalt", "[", 
   RowBox[{"ca_", ",", " ", "pca_"}], "]"}], ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"lt", " ", "=", " ", 
       RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], ",", " ", 
      RowBox[{"plt", " ", "=", " ", 
       RowBox[{"TestCALifeTime", "[", "pca", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"plt", " ", "==", " ", 
         RowBox[{"-", "Infinity"}]}], ",", " ", "1", ",", " ", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"plt", " ", "-", " ", "lt"}], "]"}], " ", "/", " ", 
         RowBox[{"Max", "[", 
          RowBox[{"lt", ",", " ", 
           RowBox[{
            RowBox[{"Length", "[", "ca", "]"}], " ", "-", " ", "lt"}]}], 
          "]"}]}]}], "]"}], ")"}], "//", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "==", "0"}], ",", " ", 
        RowBox[{"-", "1"}], ",", " ", "#"}], "]"}], "&"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.94449081794423*^9, 3.9444909094177628`*^9}, {
  3.944490959322697*^9, 3.944490993340799*^9}, {3.94449106774311*^9, 
  3.944491076349791*^9}, {3.944491170777509*^9, 3.9444912813137217`*^9}, {
  3.944491363048721*^9, 3.944491366658052*^9}, {3.9444923081545258`*^9, 
  3.944492345557996*^9}, {3.9444926213548927`*^9, 3.944492621477656*^9}, {
  3.944493742156652*^9, 3.944493743773632*^9}, {3.94450727168178*^9, 
  3.944507277086361*^9}, {3.944507341580439*^9, 3.944507368077084*^9}, {
  3.94450746055916*^9, 3.9445074636883783`*^9}, {3.944507732861686*^9, 
  3.944507753281385*^9}, {3.944759752554522*^9, 3.944759793343004*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"031a155b-fcaf-41b6-9dcc-5435b2aba328"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbationSensitivities", "]"}], " ", "=", " ", 
   
   RowBox[{"{", 
    RowBox[{"\"\<IndexFunction\>\"", "->", "getbodyidxs"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbationSensitivities", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"sensitivityfunc_", ":", "absdeltalt"}], ",", " ", 
    RowBox[{"bitfunc_", ":", "\"\<Random\>\""}], ",", " ", "\n", 
    RowBox[{"OptionsPattern", "[", "PerturbationSensitivities", "]"}]}], 
   "]"}], ":=", "  ", "\n", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"sensitivityfunc", "[", 
      RowBox[{"ca", ",", " ", 
       RowBox[{"PerturbCA", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "#", ",", " ", 
         RowBox[{"\"\<BitFunc\>\"", "->", "bitfunc"}]}], "]"}]}], "]"}], 
     "&"}], ",", " ", "\n", 
    RowBox[{
     RowBox[{"OptionValue", "[", "\"\<IndexFunction\>\"", "]"}], "[", "ca", 
     "]"}], ",", " ", 
    RowBox[{"{", "2", "}"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.944486915866929*^9, 3.944487005355361*^9}, {
   3.944487039577426*^9, 3.944487056554845*^9}, {3.944487087828568*^9, 
   3.944487199630529*^9}, {3.944487237621695*^9, 3.9444872744506893`*^9}, {
   3.944487375767552*^9, 3.944487380970046*^9}, {3.944490432127099*^9, 
   3.94449051359888*^9}, {3.94449059426232*^9, 3.9444905952149887`*^9}, {
   3.944490634237767*^9, 3.94449068604597*^9}, {3.9444908596183853`*^9, 
   3.944490859990075*^9}, {3.944491887938538*^9, 3.9444918895325212`*^9}, 
   3.944492070172682*^9, {3.944492875221411*^9, 3.944492883040357*^9}, {
   3.944493032971727*^9, 3.9444930365891867`*^9}, {3.944493081901815*^9, 
   3.944493082908987*^9}, {3.944506683516601*^9, 3.9445066848150873`*^9}, {
   3.944507424435897*^9, 3.944507484003048*^9}, {3.944507763271254*^9, 
   3.944507770322781*^9}, 3.944511707317666*^9, {3.944512046217747*^9, 
   3.944512052374105*^9}, {3.944759437364381*^9, 3.944759474250016*^9}, {
   3.9447597142051687`*^9, 3.944759715368204*^9}, {3.944760396736481*^9, 
   3.944760401740182*^9}, {3.944768110953274*^9, 3.944768144015161*^9}, {
   3.944768196796276*^9, 3.94476820794529*^9}, {3.944768652340193*^9, 
   3.944768653383917*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"e4f03766-0993-49fa-96b0-e51767b27f35"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CountSame", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "sa", "}"}], ",", 
    RowBox[{
     RowBox[{"sa", " ", "=", " ", "\n", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"arr1", "-", "arr2"}], "]"}]}], ";", " ", 
     RowBox[{
      RowBox[{"Times", "@@", 
       RowBox[{"Dimensions", "[", "sa", "]"}]}], " ", "-", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"sa", "[", "\"\<NonzeroValues\>\"", "]"}], "]"}]}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943105653145685*^9, 3.943105700669275*^9}, {
   3.943106430212906*^9, 3.943106443869117*^9}, {3.943374573951805*^9, 
   3.9433746050982857`*^9}, 3.943381343379084*^9, {3.9433813844652853`*^9, 
   3.943381403318468*^9}, {3.943381439817117*^9, 3.943381495759122*^9}, {
   3.943382147699435*^9, 3.943382215612746*^9}, {3.943394135733881*^9, 
   3.9433941368258057`*^9}, 3.943395370941695*^9, {3.94364309903135*^9, 
   3.943643099930312*^9}, {3.943643255012763*^9, 3.943643257552268*^9}, {
   3.943643839887081*^9, 3.943643943749331*^9}, 3.944307747587144*^9},
 CellLabel->"In[59]:=",ExpressionUUID->"914e413a-3638-490f-aca9-493735b3966c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CountDifferences", "[", 
   RowBox[{"arr1_", ",", "arr2_"}], "]"}], ":=", 
  RowBox[{"Length", "[", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{"arr1", "-", "arr2"}], "]"}], "[", "\"\<NonzeroValues\>\"", 
    "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943642656048552*^9, 3.943642658020051*^9}, 
   3.94364269636675*^9, 3.943642850731148*^9, {3.94364290879478*^9, 
   3.943642924981742*^9}, {3.943643190064183*^9, 3.943643224486829*^9}, 
   3.943643303926519*^9, 3.943643835515625*^9},
 CellLabel->"In[60]:=",ExpressionUUID->"fb87530d-1647-4eac-8404-f0e8157f5a49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"meanfragility", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"pertbitfunc_", ":", "\"\<Random\>\""}], ",", " ", 
    RowBox[{"lt_", ":", 
     RowBox[{"-", "1"}]}], ",", " ", 
    RowBox[{"cr_", ":", "True"}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"clt", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"lt", "==", " ", 
         RowBox[{"-", "1"}]}], ",", " ", 
        RowBox[{"TestCALifeTime", "[", "ca", "]"}], ",", " ", "lt"}], "]"}]}],
      " ", "}"}], ",", " ", "\n", 
    RowBox[{"Mean", "[", 
     RowBox[{"PerturbationSensitivities", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "pertbitfunc", ",", 
       " ", "clt"}], "]"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943810123780548*^9, 3.943810154519761*^9}, {
   3.943810218736228*^9, 3.943810284550947*^9}, {3.943810323363736*^9, 
   3.943810368488123*^9}, 3.943810578558991*^9, {3.943810649677017*^9, 
   3.943810655945159*^9}, {3.94383115874373*^9, 3.943831164471401*^9}, {
   3.944307732012402*^9, 3.944307733992714*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"010986f6-6641-4c6a-9859-d5bc0c5ed0c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newltblend", "[", "value_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"LightGray", ",", "Blue"}], "}"}], ",", "value"}], "]"}], 
       ",", 
       RowBox[{"value", "<=", "0.975"}]}], "}"}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Blend", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Blue", ",", " ", "Red"}], "}"}], ",", "value"}], "]"}], 
       ",", 
       RowBox[{"value", ">", "0.975"}]}], "}"}]}], "}"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.944150216546483*^9, 3.9441502393608437`*^9}, 
   3.944150300480433*^9, {3.94415036425091*^9, 3.944150365272736*^9}, {
   3.944150402738605*^9, 3.9441504123284597`*^9}, {3.944150463644236*^9, 
   3.94415046385846*^9}, {3.944150548041984*^9, 3.944150626147049*^9}, {
   3.944150765698477*^9, 3.944150820410365*^9}, {3.944150971159443*^9, 
   3.944150996382962*^9}, {3.944151084181592*^9, 3.944151086223316*^9}, {
   3.944151133027474*^9, 3.944151171875409*^9}, {3.944307705805352*^9, 
   3.9443077219657*^9}, {3.944512549743142*^9, 3.944512631456539*^9}, {
   3.94451302657828*^9, 3.944513027597559*^9}, {3.944513067609299*^9, 
   3.944513069838722*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"bd0ce26c-8793-41ce-9d99-a5fe0cc40a54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"countstepdiffs", "[", 
   RowBox[{"arr1_", ",", " ", "arr2_"}], "]"}], ":=", " ", "\n", 
  RowBox[{"Length", "/@", 
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SparseArray", "[", 
       RowBox[{"arr1", " ", "-", " ", "arr2"}], "]"}], "[", 
      "\"\<NonzeroPositions\>\"", "]"}], ",", " ", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "&"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.944306888140517*^9, 3.9443069873158083`*^9}, 
   3.944307405180588*^9},
 CellLabel->"In[63]:=",ExpressionUUID->"e9675c57-8c37-4554-b4d9-64de01f118e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcancerperts", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"bitfunc_", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<AddValue\>\"", "->", "1"}], ")"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ca", " ", "=", 
       RowBox[{"getca", "[", "ru", "]"}]}], ",", " ", "perts"}], "}"}], ",", 
    " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"perts", " ", "=", 
      RowBox[{"getbodyrules", "[", 
       RowBox[{"ca", ",", " ", "bitfunc"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Select", "[", 
      RowBox[{"perts", ",", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"TestCALifeTime", "[", 
           RowBox[{"PerturbCA", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "#"}], "]"}], 
           "]"}], " ", "==", " ", 
          RowBox[{"-", "Infinity"}]}], "&"}], ")"}]}], "]"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.9451183683981247`*^9, 3.945118487727295*^9}, {
  3.945118755251984*^9, 3.945118757010066*^9}, {3.945118793825553*^9, 
  3.9451188487981853`*^9}, {3.9451191181040077`*^9, 3.945119138047632*^9}, {
  3.945119393259388*^9, 3.94511940251574*^9}, {3.945119450171067*^9, 
  3.945119513776975*^9}, {3.945119545488598*^9, 3.945119547329953*^9}, {
  3.945120312216143*^9, 3.945120314053685*^9}, {3.945120519349265*^9, 
  3.9451205296186*^9}, {3.945120587171876*^9, 3.945120589712695*^9}, {
  3.945120652265414*^9, 3.945120658083557*^9}, {3.945120739775329*^9, 
  3.945120739925272*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"57294f1b-a5b9-4720-99cf-4822c83dcf9b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Population", "Section",
 CellChangeTimes->{{3.945124905426052*^9, 
  3.945124906681363*^9}},ExpressionUUID->"9833750c-2556-43b1-b3be-\
7cb6bb80404d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getallmutations", "[", 
   RowBox[{"{", 
    RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
    "}"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"getallmutations", "[", 
    RowBox[{"{", 
     RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], " ", "=", " ",
    "\n", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"digits", " ", "=", " ", 
        RowBox[{"List", "/@", 
         RowBox[{"IntegerDigits", "[", 
          RowBox[{"n", ",", " ", "k", ",", " ", 
           RowBox[{"k", "^", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}]}], ",", " ", 
       "mudigs"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mudigs", " ", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"ReplacePart", "[", 
             RowBox[{"digits", ",", " ", 
              RowBox[{"#", "->", 
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", " ", 
                   RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
                 RowBox[{"digits", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}], "]"}]}]}], "]"}], "]"}], 
           "&"}], "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"Length", "[", "digits", "]"}], "-", "1"}], "]"}]}], " ", 
         ")"}], "//", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"#", ",", " ", "1"}], "]"}], "&"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", " ", "k", ",", " ", "r"}], "}"}], "&"}], "/@", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"FromDigits", "[", 
           RowBox[{"#", ",", " ", "k"}], "]"}], "&"}], "/@", " ", "mudigs"}], 
        ")"}]}]}]}], "\n", "  ", "]"}]}]}]], "Code",
 CellChangeTimes->{
  3.944327090570977*^9, {3.944327133666074*^9, 3.944327135650968*^9}, {
   3.944327282418949*^9, 3.944327321100698*^9}, {3.944327433549917*^9, 
   3.944327846827814*^9}, {3.94432795115841*^9, 3.944328005643941*^9}, {
   3.944328124354177*^9, 3.9443281258076687`*^9}, {3.944328169541747*^9, 
   3.944328196182477*^9}, {3.94432826882672*^9, 3.944328312163135*^9}, {
   3.944328524631875*^9, 3.944328535635455*^9}, {3.944328749923945*^9, 
   3.944328751417588*^9}, {3.944329012054535*^9, 3.944329019822937*^9}, {
   3.944751278766341*^9, 3.944751285160718*^9}, 3.944751326891244*^9, {
   3.944751389120824*^9, 3.944751453347126*^9}, 3.945017137389016*^9},
 CellLabel->"In[65]:=",ExpressionUUID->"87343c1c-81c4-4008-9ef2-649f897b7b84"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "PerturbPopulation"}]], "Input",
 CellChangeTimes->{{3.944751176864271*^9, 3.944751179949933*^9}, {
  3.94512405722161*^9, 3.945124057987259*^9}, {3.945127248129321*^9, 
  3.945127249922661*^9}},
 CellLabel->
  "In[576]:=",ExpressionUUID->"9cd621fb-6046-44fb-ba5d-e0a6774cc4a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"exhaustiveneutral", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"cut_", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"getallneutral", "[", 
    RowBox[{"ru", ",", " ", "cut"}], "]"}], " ", "=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lt", " ", "=", " ", 
       RowBox[{"TestLifetime", "[", 
        RowBox[{"ru", ",", " ", "cut"}], "]"}]}], "}"}], ",", " ", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"getallmutations", "[", "ru", "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"TestLifetime", "[", 
          RowBox[{"#", ",", " ", "cut"}], "]"}], " ", "==", " ", "lt"}], 
        "&"}]}], "]"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.944751067575765*^9, 3.944751189698888*^9}, {
   3.944751477114224*^9, 3.944751500538378*^9}, {3.944751659623405*^9, 
   3.944751664508668*^9}, 3.944751736701893*^9, {3.944751783432912*^9, 
   3.944751791480487*^9}, {3.945017148242858*^9, 3.9450171602550983`*^9}, 
   3.945112288915782*^9, {3.945118947832473*^9, 3.945118952412799*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"7133c0ef-2767-46cc-b759-35a901e7a5eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"quickneutral", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", "k_Integer", ",", "r_Integer"}], "}"}], ",", 
    RowBox[{"cut_", ":", "200"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"mask", "=", 
       RowBox[{"RuleMask", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n", ",", "k", ",", "r"}], "}"}], ",", 
         RowBox[{"TestLifetime", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", ",", "k", ",", "r"}], "}"}], ",", "cut"}], "]"}]}], 
        "]"}]}], ",", 
      RowBox[{"digs", "=", 
       RowBox[{"IntegerDigits", "[", 
        RowBox[{"n", ",", "k", ",", 
         RowBox[{"k", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", " ", "r"}], "+", "1"}], ")"}]}]}], "]"}]}]}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"#", ",", "k", ",", "r"}], "}"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"FromDigits", "[", 
         RowBox[{"#", ",", "k"}], "]"}], "&"}], "\[IndentingNewLine]", "/@", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"index", ",", "digit"}], "}"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"mask", "[", 
                 RowBox[{"[", "index", "]"}], "]"}], "==", "0"}], ",", 
               RowBox[{"Range", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"k", "-", "1"}]}], "]"}], ",", 
               RowBox[{"{", "digit", "}"}]}], "]"}]}], "]"}], "[", 
           RowBox[{"#", ",", 
            RowBox[{"digs", "[", 
             RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], 
         "\[IndentingNewLine]", "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "digs", "]"}], "]"}]}], "]"}]}], ")"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.945115813120508*^9, 3.945115813125668*^9}, {
   3.945119004132131*^9, 3.9451190062337713`*^9}, {3.945123859496854*^9, 
   3.945123923478093*^9}, {3.945123984708405*^9, 3.94512402749656*^9}, 
   3.945124129009829*^9},
 CellLabel->"In[67]:=",ExpressionUUID->"3f9495ca-95d8-4e4a-a37d-408683ffc6b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_Integer", ",", " ", "k_Integer", ",", " ", "r_Integer"}], 
     "}"}], ",", " ", 
    RowBox[{"samplefunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"UpTo", "[", "10", "]"}]}], "]"}], "]"}], "&"}], ")"}]}], 
    ",", " ", 
    RowBox[{"pertspec_", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<Random\>\"", "->", "1"}], ")"}]}], ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"rus", " ", "=", 
       RowBox[{"quickneutral", "[", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}]}], ",", 
      " ", "s"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"PerturbPopulation", "[", 
     RowBox[{
      RowBox[{"samplefunc", "[", 
       RowBox[{"quickneutral", "[", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], "]"}], 
      ",", "  ", "pertspec", ",", " ", "steps"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121406635539*^9}, {3.945122178602026*^9, 3.945122189784541*^9}, {
   3.945122283576271*^9, 3.945122308166499*^9}, {3.945122713630536*^9, 
   3.945122731023986*^9}, {3.9451227846445293`*^9, 3.94512280007278*^9}, {
   3.945122841437958*^9, 3.945122913746992*^9}, {3.945122971624249*^9, 
   3.945122973325691*^9}, {3.945123492271601*^9, 3.945123496615378*^9}, {
   3.945123537584054*^9, 3.945123538285596*^9}, {3.945123612248053*^9, 
   3.945123623671673*^9}, {3.945123760495822*^9, 3.945123766861141*^9}, {
   3.945124245265932*^9, 3.945124246581737*^9}, 3.945124678953227*^9, {
   3.945126890913911*^9, 3.945126892349599*^9}, {3.945127182609988*^9, 
   3.945127224617054*^9}, {3.945127261327314*^9, 3.945127263958499*^9}, {
   3.945127569240232*^9, 3.945127570220824*^9}, 3.945128559298685*^9, {
   3.945129550748648*^9, 3.945129585996633*^9}, {3.945129636415519*^9, 
   3.9451296367844553`*^9}, {3.945129693501587*^9, 3.945129705398319*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"2c64da26-4ed6-479d-a657-a6c14a89bd13"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{"rus_List", ",", " ", 
    RowBox[{"pertspec_Rule", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<Random\>\"", "->", "1"}], ")"}]}], ",", " ", 
    RowBox[{"steps_Integer", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"getca", "[", 
       RowBox[{"#", ",", " ", "steps"}], "]"}], "&"}], "/@", " ", "rus"}], 
    ",", " ", "rus", ",", " ", "pertspec"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121388431172*^9}, {3.9451214244278717`*^9, 3.945121442525996*^9}, {
   3.945122646508793*^9, 3.945122648495297*^9}, {3.945122711066759*^9, 
   3.945122752758585*^9}, {3.945122975840968*^9, 3.945122977635197*^9}, {
   3.945127230233573*^9, 3.945127239092495*^9}, {3.94512758731314*^9, 
   3.945127627793437*^9}, {3.945127931310405*^9, 3.945127932212486*^9}, 
   3.945128562895161*^9, {3.94512865166099*^9, 3.945128652085614*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"96687295-1def-49bb-8675-468fe0e90892"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbPopulation", "[", 
   RowBox[{"cas_List", ",", " ", "rus_List", ",", " ", "pertspec_"}], "]"}], ":=",
   " ", "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ps", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pertspec", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "==", " ", "\"\<Random\>\""}], 
        ",", " ", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"getbodyrules", "[", 
          RowBox[{
           RowBox[{"cas", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"\"\<AddValue\>\"", "->", "1"}]}], "]"}], "]"}], ",", " ", 
        "pertspec"}], "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"PerturbCA", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#1", ",", " ", "#2"}], "}"}], ",", " ", "ps"}], "]"}], 
      "&"}], "@@@", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"cas", ",", " ", "rus"}], "}"}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451207953818808`*^9, 3.945120853804368*^9}, {
   3.94512089321872*^9, 3.94512089328799*^9}, {3.945121004211645*^9, 
   3.945121081718935*^9}, {3.945121166239255*^9, 3.945121187845364*^9}, {
   3.945121291290398*^9, 3.945121325611682*^9}, {3.945121387981635*^9, 
   3.945121388431172*^9}, {3.9451214244278717`*^9, 3.9451214747866497`*^9}, {
   3.945122334287568*^9, 3.945122404193021*^9}, {3.9451225382342*^9, 
   3.945122621580563*^9}, {3.9451227388348293`*^9, 3.945122744081846*^9}, {
   3.945123119077734*^9, 3.945123120904056*^9}, {3.945124458028131*^9, 
   3.945124464225045*^9}, 3.945124520296139*^9, {3.945127630179598*^9, 
   3.945127635425282*^9}, 3.945128564962919*^9},
 CellLabel->"In[70]:=",ExpressionUUID->"5658bfaa-3608-4231-9ca2-7a7502e6aa61"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "TherapySensitivityPlot"}]], "Input",
 CellChangeTimes->{{3.944758737288364*^9, 3.944758739807434*^9}, {
  3.944767856609617*^9, 3.944767863235683*^9}},
 CellLabel->
  "In[472]:=",ExpressionUUID->"e64beb7b-4dac-4bbf-9245-42397f2fce87"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TherapySensitivityPlot", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"rowidx_", "->", "colspec_"}], ",", " ", 
    RowBox[{"steps_", ":", "200"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{"getca", "[", 
       RowBox[{"ru", ",", " ", "steps"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pca", " ", "=", " ", 
      RowBox[{"PerturbCA", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", 
        RowBox[{"rowidx", "->", "colspec"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"idxs", " ", "=", " ", 
      RowBox[{"getbodyidxs", "[", "pca", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"idxfunc", " ", "=", "  ", 
      RowBox[{
       RowBox[{"idxs", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"rowidx", "+", "1"}], ";;"}], "]"}], "]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sensitivities", " ", "=", " ", 
      RowBox[{"PerturbationSensitivities", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pca", ",", " ", "ru"}], "}"}], ",", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"absdeltalt", "[", 
           RowBox[{"ca", ",", " ", "#2"}], "]"}], "&"}], ")"}], ",", " ", 
        RowBox[{"(", 
         RowBox[{"\"\<AddValue\>\"", "->", "1"}], ")"}], ",", " ", 
        RowBox[{"\"\<IndexFunction\>\"", "->", "idxfunc"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pertreps", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rowidx", ",", " ", "#"}], "}"}], "->", "Red"}], "&"}], "/@", 
       RowBox[{
        RowBox[{"tofullform", "[", 
         RowBox[{"expandrange", "[", 
          RowBox[{"colspec", ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"idxs", "[", 
             RowBox[{"[", "rowidx", "]"}], "]"}], "]"}]}], "]"}], "]"}], "[", 
        
        RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"marked", " ", "=", " ", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"idxs", "[", 
            RowBox[{"[", 
             RowBox[{";;", "rowidx"}], "]"}], "]"}], "/.", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], "->", 
            "LightGray"}]}], ",", "sensitivities"}], "]"}], ",", " ", 
        "pertreps"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PlotSensitivities", "[", 
      RowBox[{"pca", ",", " ", "marked"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.9451158501617002`*^9, 3.945115856796356*^9}, {
   3.945115979217936*^9, 3.945116030053803*^9}, {3.945116064524947*^9, 
   3.945116064937901*^9}, {3.945116098087596*^9, 3.945116129061755*^9}, {
   3.945116164387346*^9, 3.945116277062486*^9}, {3.945116345330906*^9, 
   3.945116392433114*^9}, {3.945116496557994*^9, 3.9451165630566893`*^9}, {
   3.945116629119066*^9, 3.945116630649734*^9}, {3.945116710867177*^9, 
   3.945116761473799*^9}, {3.945116852233283*^9, 3.945116944068643*^9}, {
   3.945117006499408*^9, 3.945117042890435*^9}, {3.94511708855098*^9, 
   3.94511709071708*^9}, 3.945117143564231*^9, {3.945117220851111*^9, 
   3.945117252830714*^9}, 3.945117283836012*^9, {3.945117369206193*^9, 
   3.945117422521552*^9}, {3.945117473246016*^9, 3.94511753821803*^9}, {
   3.945117579008676*^9, 3.945117631089662*^9}, {3.945117661207172*^9, 
   3.945117663210318*^9}, {3.945118550203525*^9, 3.945118617468432*^9}, {
   3.945118671958097*^9, 3.945118672270591*^9}, 3.945120349874535*^9, {
   3.94512730138868*^9, 3.945127306812495*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"f3faa165-d5e1-4e4c-a285-88710b1dddcf"]
}, Closed]],

Cell[CellGroupData[{

Cell["Therapy", "Section",
 CellChangeTimes->{{3.943554524259576*^9, 3.943554526486482*^9}, {
  3.945107085664616*^9, 3.945107086562048*^9}, {3.945124763762751*^9, 
  3.9451247644956923`*^9}},ExpressionUUID->"bc7b5f81-b8b3-411d-99af-\
77f90d1a1f1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AdaptTherapy", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"initpat_", ",", " ", "initru_"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "currdiff_", ",", " ", "mca_", ",", " ", "i_"}],
      "}"}]}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pca", ",", " ", "nca", ",", " ", "nmca", ",", " ", "newdiff"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nmca", " ", "=", " ", 
      RowBox[{
       RowBox[{"Reap", "[", 
        RowBox[{"pca", " ", "=", 
         RowBox[{"PerturbCA", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "initru"}], "}"}], ",", " ", 
           RowBox[{"Floor", "[", 
            RowBox[{"11", "+", "i"}], "]"}]}], "]"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", " ", "1", ",", " ", "1", ",", " ", "1"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newdiff", " ", "=", " ", 
      RowBox[{"CountDifferences", "[", 
       RowBox[{"initpat", ",", "pca"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nca", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"newdiff", "<=", " ", "currdiff"}], ",", " ", "pca", ",", 
        "ca"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"nca", ",", " ", 
       RowBox[{"Min", "[", 
        RowBox[{"newdiff", ",", " ", "currdiff"}], "]"}], ",", " ", "nmca", 
       ",", " ", 
       RowBox[{"i", "+", 
        RowBox[{"(", 
         RowBox[{"1", "/", "5"}], ")"}]}]}], "}"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943395880405551*^9, 3.943396006639639*^9}, {
   3.943396218619499*^9, 3.943396229368534*^9}, {3.94339631463708*^9, 
   3.943396317100731*^9}, {3.94339639749044*^9, 3.94339641031278*^9}, {
   3.943397186398964*^9, 3.943397207418297*^9}, {3.94339727297303*^9, 
   3.943397282031959*^9}, {3.943397349388679*^9, 3.943397388988446*^9}, {
   3.943397465757667*^9, 3.943397466172511*^9}, {3.943397618764945*^9, 
   3.943397655011775*^9}, {3.943397696483054*^9, 3.943397811985132*^9}, {
   3.9433979190037403`*^9, 3.943397929599284*^9}, {3.943397966384178*^9, 
   3.943397966711248*^9}, {3.943398097168415*^9, 3.943398132944777*^9}, {
   3.943398163085023*^9, 3.943398170426689*^9}, 3.943398258527637*^9, {
   3.94339834684286*^9, 3.943398361580974*^9}, {3.943398416061253*^9, 
   3.943398477545807*^9}, {3.943400030738473*^9, 3.943400050938936*^9}, 
   3.943400340942998*^9, {3.9434004869038477`*^9, 3.9434004999217777`*^9}, {
   3.943400535477778*^9, 3.9434005355668507`*^9}, {3.943400680781386*^9, 
   3.943400728214313*^9}, 3.94340081913684*^9, {3.943400867462179*^9, 
   3.943400880148367*^9}, {3.943400937796553*^9, 3.943400972124466*^9}, 
   3.943401039749408*^9, 3.943401085015738*^9, 3.943401142060587*^9, {
   3.943553202708556*^9, 3.943553205486194*^9}, 3.943553741459091*^9, {
   3.943553887357324*^9, 3.943553890174745*^9}, {3.943553936062168*^9, 
   3.9435539696667423`*^9}, {3.943554018724535*^9, 3.943554021334249*^9}, {
   3.943554085668019*^9, 3.943554145977961*^9}, {3.943554221562248*^9, 
   3.943554354391051*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"5abfbed9-f83e-4006-a93c-e32bc3f9495b"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "gethealers"}]], "Input",
 CellChangeTimes->{{3.945120416879099*^9, 3.945120421843424*^9}, {
  3.9451235118860197`*^9, 3.945123513553383*^9}, {3.945126021434471*^9, 
  3.9451260226587973`*^9}},
 CellLabel->
  "In[476]:=",ExpressionUUID->"387b6e43-db66-4b94-9d23-d3b5a400acb2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gethealers", "[", 
   RowBox[{"ru_", ",", " ", 
    RowBox[{"rowidx_", "->", "colspec_"}], ",", " ", 
    RowBox[{"healfunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "!=", 
        RowBox[{"-", "Infinity"}]}], "&"}], ")"}]}], ",", 
    RowBox[{"steps_", ":", "200"}], ",", " ", 
    RowBox[{"bitfunc_", ":", 
     RowBox[{"(", 
      RowBox[{"\"\<AddValue\>\"", "->", "1"}], ")"}]}]}], "]"}], ":=", " ", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ca", " ", "=", " ", 
       RowBox[{"PerturbCA", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"getca", "[", 
            RowBox[{"ru", ",", " ", "steps"}], "]"}], ",", "ru"}], "}"}], ",",
          " ", 
         RowBox[{"rowidx", "->", "colspec"}]}], "]"}]}], ",", " ", "rules"}], 
     "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rules", " ", "=", " ", 
      RowBox[{"getbodyrules", "[", 
       RowBox[{"ca", ",", " ", "bitfunc"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"rules", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ">", "rowidx"}], "&"}]}], "]"}], 
       ",", " ", 
       RowBox[{
        RowBox[{"healfunc", "[", 
         RowBox[{"TestCALifeTime", "[", 
          RowBox[{"PerturbCA", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ca", ",", " ", "ru"}], "}"}], ",", " ", "#"}], "]"}], 
          "]"}], "]"}], "&"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9451191847745*^9, 3.945119444372617*^9}, {
   3.94511955142013*^9, 3.945119628740043*^9}, {3.945119668343119*^9, 
   3.945119675612154*^9}, {3.945119745244145*^9, 3.945119824144596*^9}, {
   3.945120204639851*^9, 3.945120232816122*^9}, {3.945120304032649*^9, 
   3.945120304892949*^9}, {3.9451273212157993`*^9, 3.945127324228445*^9}, {
   3.945127430702441*^9, 3.945127432189741*^9}, 3.945128101473031*^9},
 CellLabel->"In[73]:=",ExpressionUUID->"55fa00ea-a9f3-404e-afc8-aa0fa7289c2c"]
}, Closed]],

Cell[CellGroupData[{

Cell["Micro ", "Section",
 CellChangeTimes->{{3.943563483255291*^9, 
  3.943563542404564*^9}},ExpressionUUID->"d6852212-b3fa-464d-9fd5-\
2873ef55d3c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleTuples", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"RuleTuples", "[", 
    RowBox[{"k", ",", "r"}], "]"}], "=", 
   RowBox[{"Tuples", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Reverse", "[", 
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", 
        RowBox[{"k", "-", "1"}]}], "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"2", "r"}], "+", "1"}]}], "]"}]}]}]], "Code",
 CellLabel->"In[74]:=",ExpressionUUID->"7f2be1c5-0353-4225-917f-f2d50cea3add"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleMask", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ru_", ",", "k_", ",", "r_"}], "}"}], ",", "lt_"}], "]"}], ":=", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"data", ",", "mask", ",", "canonical"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Catenate", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"2", "r"}], "+", "1"}], ",", "1"}], "]"}], "&"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"CellularAutomaton", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ru", ",", "k", ",", "r"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"CenterArray", "[", 
             RowBox[{"1", ",", 
              RowBox[{
               RowBox[{"2", " ", "r", "*", 
                RowBox[{"(", 
                 RowBox[{"lt", "+", "4"}], ")"}]}], "+", "1"}]}], "]"}], ",", 
            
            RowBox[{"lt", "+", "2"}]}], "]"}]}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", "=", 
      RowBox[{"Lookup", "[", 
       RowBox[{
        RowBox[{"Association", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"data", "->", "1"}], "]"}], "]"}], ",", 
        RowBox[{"RuleTuples", "[", 
         RowBox[{"k", ",", "r"}], "]"}], ",", "0"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{
  3.943495176443308*^9, {3.943495345241512*^9, 3.943495349595083*^9}, {
   3.944307190155628*^9, 3.9443071903703814`*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"1167ac24-28bb-42eb-8554-f1fe6819b441"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getperts", "[", 
   RowBox[{"tup_", ",", " ", "k_"}], "]"}], ":=", " ", 
  RowBox[{"Tuples", "[", 
   RowBox[{"Replace", "[", 
    RowBox[{
     RowBox[{"ReplacePart", "[", 
      RowBox[{"tup", ",", " ", "\n", 
       RowBox[{
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"Length", "[", "tup", "]"}], " ", "/", " ", "2"}], "]"}], "->", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
          RowBox[{"tup", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Length", "[", "tup", "]"}], " ", "/", " ", "2"}], 
              "]"}], "}"}], "]"}], "]"}]}], "]"}]}]}], "]"}], ",", "\n", 
     RowBox[{"i_Integer", ":>", " ", 
      RowBox[{"{", "i", "}"}]}], ",", " ", "1"}], "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943481041012143*^9, 3.94348106878887*^9}, {
   3.9434811994872713`*^9, 3.943481228521406*^9}, {3.9434858604672*^9, 
   3.94348586808162*^9}, {3.943485911648578*^9, 3.943485916385562*^9}, {
   3.94348595601386*^9, 3.943485956927729*^9}, 3.943486046578634*^9, {
   3.9434861197226343`*^9, 3.943486123627069*^9}, {3.943533598323098*^9, 
   3.943533599047058*^9}, {3.94442167294912*^9, 3.944421688556637*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"bee9e125-9c08-4ab3-a081-a2ef8ee2c10c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertrus", "[", 
   RowBox[{"i_", ",", " ", "perts_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], "/@", " ", 
   "perts"}]}]], "Code",
 CellChangeTimes->{{3.943481258535507*^9, 3.943481290450325*^9}, {
  3.944008891576692*^9, 3.944008897328699*^9}},
 CellLabel->"In[77]:=",ExpressionUUID->"09adc84a-a279-4018-bdd1-53ae96dc4b48"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getsubs", "[", 
   RowBox[{"{", 
    RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#1", "->", "#2"}], "&"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Reverse", "[", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", " ", 
         RowBox[{"1", " ", "+", " ", 
          RowBox[{"2", "r"}]}]}], "]"}], "]"}], ",", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943483958204916*^9, 3.943484006288759*^9}, {
  3.943484099831672*^9, 3.94348418620397*^9}, {3.943484228964634*^9, 
  3.943484261754797*^9}, {3.943484359580515*^9, 3.9434843610687838`*^9}, {
  3.943484394980937*^9, 3.943484398643656*^9}, {3.943564397404496*^9, 
  3.943564405331441*^9}, {3.9442598259949913`*^9, 3.944259830483087*^9}},
 CellLabel->"In[78]:=",ExpressionUUID->"61c09f1a-6996-44c1-abac-9ee339ea646e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertedges", "[", 
   RowBox[{"k_", ",", " ", "r_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"getpertrus", "[", 
     RowBox[{"#", ",", " ", 
      RowBox[{"getperts", "[", 
       RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", 
   RowBox[{"Tuples", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", " ", 
       RowBox[{"k", " ", "-", " ", "1"}]}], "]"}], ",", 
     RowBox[{
      RowBox[{"4", "r"}], "+", " ", "1"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.943484525252606*^9, 3.943484561684527*^9}, {
  3.94348465663787*^9, 3.94348467675038*^9}, {3.94348618784658*^9, 
  3.943486190643013*^9}, {3.943533638615285*^9, 3.943533642912948*^9}, {
  3.9435337165538893`*^9, 3.943533717681363*^9}, {3.94400893256437*^9, 
  3.94400895215824*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"0fddcb93-8a52-4500-9fa7-9dc78c741d04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getruparts", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"arr1_", ",", " ", "arr2_"}], "}"}], ",", " ", 
    RowBox[{"r_", ":", "1"}]}], "]"}], ":=", " ", 
  RowBox[{"Transpose", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Partition", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{
        RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
    " ", 
    RowBox[{"{", 
     RowBox[{"arr1", ",", " ", "arr2"}], "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943486507302359*^9, 3.943486622832364*^9}, {
  3.9434883556367273`*^9, 3.943488361513817*^9}, {3.9440091589862843`*^9, 
  3.944009165314611*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"2ec127b0-b6c5-4950-9519-4c65d04e32ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{"{", 
    RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", 
        RowBox[{"getpertedges", "[", 
         RowBox[{"k", ",", " ", "r"}], "]"}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
       "stepped", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943488276493325*^9, 3.94348829421737*^9}, {
  3.943488325075017*^9, 3.943488329551101*^9}, {3.943488368693169*^9, 
  3.943488506657982*^9}, {3.943488573217678*^9, 3.943488578991692*^9}, {
  3.943488657430828*^9, 3.943488674631031*^9}, {3.943488905555903*^9, 
  3.943488969705639*^9}, {3.9435336648038673`*^9, 3.943533666445611*^9}, {
  3.943534525315949*^9, 3.943534529032213*^9}, {3.944005946498619*^9, 
  3.944005948184443*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"89b85e4d-4802-4b40-b6e5-d9d5f1138b38"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertpairs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "active_"}], "]"}], ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"getpertrus", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"getperts", "[", 
        RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", "active"}],
    ")"}], " "}]], "Code",
 CellChangeTimes->{{3.944004893875792*^9, 3.944004897345372*^9}, {
   3.944005058399239*^9, 3.9440050617568283`*^9}, {3.944005092743585*^9, 
   3.944005102983451*^9}, {3.944005327678811*^9, 3.9440053321178637`*^9}, {
   3.944005407103117*^9, 3.944005423682027*^9}, {3.944006005850071*^9, 
   3.944006006699265*^9}, {3.944007338237412*^9, 3.944007339278685*^9}, {
   3.944007509512716*^9, 3.94400754891026*^9}, 3.944008435691231*^9, 
   3.944008691246401*^9, 3.944009069951805*^9, {3.944048269647918*^9, 
   3.944048272157452*^9}, {3.944048316528047*^9, 3.944048320330218*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"41e0f7db-104a-4846-bdc6-82e8613020dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "pertpairs_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", "pertpairs", 
        ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
       "stepped", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9440059825918207`*^9, 3.944006012901524*^9}, 
   3.944009134480545*^9, {3.9440482631478033`*^9, 3.944048295191884*^9}, {
   3.944307174341209*^9, 3.944307177739485*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"70ee3023-4f28-426d-bd63-82fecb8f1e5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"totalpertdiffs", "[", "ru_", "]"}], ":=", " ", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{"pertdiffs", "[", "ru", "]"}], ",", " ", "3"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943488999175635*^9, 3.943489031675508*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"98769222-0260-425b-9432-156479b78447"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getruleloc", "[", 
   RowBox[{"bits_", ",", " ", "k_", ",", " ", "r_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"FirstPosition", "[", 
    RowBox[{
     RowBox[{"RuleTuples", "[", 
      RowBox[{"k", ",", " ", "r"}], "]"}], ",", " ", "bits"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943536225135035*^9, 3.943536268422502*^9}, {
  3.943536312907648*^9, 3.943536341524619*^9}, {3.943536877478697*^9, 
  3.943536882177637*^9}, {3.943630428601265*^9, 3.943630429778505*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"47522f53-f4f0-4f5a-a80d-879102e4a018"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotrule", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Trim\>\"", "->", 
         RowBox[{"{", 
          RowBox[{"None", ",", " ", "None"}], "}"}]}], ",", " ", 
        RowBox[{"ColorRules", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            TemplateBox[<|"color" -> GrayLevel[1]|>,
             "GrayLevelColorSwatchTemplate"]}], ",", 
           RowBox[{"1", "\[Rule]", 
            StyleBox[
             TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
              "HueColorSwatchTemplate"], "Input"]}], ",", 
           RowBox[{"2", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
             "HueColorSwatchTemplate"]}], ",", 
           RowBox[{"3", "\[Rule]", 
            TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
             "HueColorSwatchTemplate"]}], ",", " ", 
           RowBox[{"4", "->", 
            TemplateBox[<|"color" -> RGBColor[0, 0.56, 0]|>,
             "RGBColorSwatchTemplate"]}], ",", 
           RowBox[{"5", "->", 
            TemplateBox[<|"color" -> RGBColor[0, 0.56, 1]|>,
             "RGBColorSwatchTemplate"]}]}], "}"}]}], ",", 
        RowBox[{"Mesh", "->", "True"}], ",", " ", 
        RowBox[{"MeshStyle", "->", "Gray"}], ",", " ", "ArrayPlot"}], "}"}], 
      "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "digits", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", 
      RowBox[{"interpretrule", "[", "rule", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"digits", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{
       RowBox[{"{", "digits", "}"}], ",", " ", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"OptionValue", "[", "ColorRules", "]"}]}], ",", "\n", "   ", 
       RowBox[{"Mesh", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Mesh", "]"}]}], ",", " ", 
       RowBox[{"MeshStyle", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "MeshStyle", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943537352467441*^9, 3.943537416863598*^9}, {
  3.943537454925485*^9, 3.943537464455969*^9}, {3.943537496909256*^9, 
  3.943537581553046*^9}, {3.943537619871427*^9, 3.943537649738405*^9}, {
  3.943538447232518*^9, 3.94353845149244*^9}, {3.943538634075776*^9, 
  3.943538634190265*^9}, {3.943538670765509*^9, 3.943538713114396*^9}, {
  3.943540565226674*^9, 3.943540568004998*^9}, {3.9435406061099653`*^9, 
  3.943540635302889*^9}, {3.943540674619231*^9, 3.943540698404332*^9}, {
  3.94354085909251*^9, 3.943540865772614*^9}, {3.943540981445168*^9, 
  3.943541000003671*^9}, {3.943541180013606*^9, 3.943541187921694*^9}, {
  3.94354302763661*^9, 3.943543030319681*^9}, {3.9453780883516483`*^9, 
  3.945378114756994*^9}, {3.945378172005157*^9, 3.9453781728382187`*^9}, {
  3.945378240201233*^9, 3.945378249615368*^9}, {3.945378983589921*^9, 
  3.945379003824699*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"11e9a943-ffa8-4d87-8acf-7ac334323613"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotmaskedrule", "[", 
   RowBox[{"rule_", ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Overlap\>\"", "->", "False"}], ",", 
        RowBox[{"\"\<Trim\>\"", "->", 
         RowBox[{"{", 
          RowBox[{"None", ",", " ", "None"}], "}"}]}], ",", " ", 
        RowBox[{"ColorRules", "->", "withmask"}], ",", 
        RowBox[{"Mesh", "->", "True"}], ",", " ", 
        RowBox[{"MeshStyle", "->", "Gray"}], ",", " ", "ArrayPlot"}], "}"}], 
      "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "mult", ",", " ", "mask", 
      ",", " ", "masked", ",", "digits"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", 
      RowBox[{"interpretrule", "[", "rule", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"digits", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k", ",", " ", 
        RowBox[{"k", "^", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mult", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Overlap\>\"", "]"}], ",", " ", 
        RowBox[{"-", "1"}], ",", " ", "100"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", " ", "=", " ", 
      RowBox[{
       RowBox[{"RuleMask", "[", 
        RowBox[{"rule", ",", " ", 
         RowBox[{"TestLifetime", "[", 
          RowBox[{"rule", ",", " ", "200"}], "]"}]}], "]"}], "*", "mult"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"masked", " ", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"mask", "/.", " ", 
         RowBox[{"0", ":>", " ", "1"}]}], ")"}], " ", "*", " ", 
       RowBox[{"ReplaceAll", "[", 
        RowBox[{"digits", ",", " ", 
         RowBox[{"0", ":>", " ", "100"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ArrayPlot", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Overlap\>\"", "]"}], ",", " ", 
         RowBox[{"{", "masked", "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"digits", ",", " ", "mask"}], "}"}]}], "]"}], ",", " ", 
       RowBox[{"ColorRules", "->", 
        RowBox[{"OptionValue", "[", "ColorRules", "]"}]}], ",", "\n", "   ", 
       RowBox[{"Mesh", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Mesh", "]"}]}], ",", " ", 
       RowBox[{"MeshStyle", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "MeshStyle", "]"}]}], ",", " ", 
       RowBox[{"ImageSize", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "ImageSize", "]"}]}]}], "]"}]}]}], "\n", 
   "]"}], " "}]], "Code",
 CellChangeTimes->{{3.943543018520018*^9, 3.943543024925357*^9}, {
   3.943543056712764*^9, 3.943543086078494*^9}, {3.943543188883298*^9, 
   3.943543212356685*^9}, {3.943543467538574*^9, 3.943543469967079*^9}, {
   3.943544014779114*^9, 3.94354408055616*^9}, {3.943544118060804*^9, 
   3.94354413717463*^9}, {3.9435442207317657`*^9, 3.943544222286158*^9}, {
   3.943544898663068*^9, 3.943544899783491*^9}, {3.943565120332209*^9, 
   3.943565120715345*^9}, {3.943565232240555*^9, 3.943565248193024*^9}, {
   3.943571648337151*^9, 3.943571649091946*^9}, {3.945378293559987*^9, 
   3.945378299576045*^9}, 3.94537841066947*^9},
 CellLabel->"In[87]:=",ExpressionUUID->"8ca4d791-001e-4ff9-92cb-df43c5aa6a93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getgenelocs", "[", 
   RowBox[{"{", 
    RowBox[{"pca_", ",", " ", "ru_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "pidxs", ",", " ", 
      "windows", ",", " ", "oldwindows", ",", " ", "newwindows", ",", " ", 
      "oldrulesets", ",", " ", "newrulesets", ",", " ", "genepairs", ",", " ",
       "locs"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pidxs", " ", "=", " ", 
      RowBox[{"Position", "[", 
       RowBox[{"pca", ",", " ", 
        RowBox[{"perturb", "[", 
         RowBox[{"_", ",", "_"}], "]"}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"windows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"pca", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", " ", 
             RowBox[{"2", "r"}]}], ";;", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
             RowBox[{"2", "r"}]}]}]}], "]"}], "]"}], "&"}], "/@", " ", 
       "pidxs"}]}], ";", "\n", 
     RowBox[{"oldwindows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "/.", " ", 
         RowBox[{
          RowBox[{"perturb", "[", 
           RowBox[{"old_Integer", ",", " ", "new_Integer"}], "]"}], ":>", " ",
           "old"}]}], "&"}], "/@", "windows"}]}], ";", "\n", 
     RowBox[{"newwindows", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", " ", "/.", " ", 
         RowBox[{
          RowBox[{"perturb", "[", 
           RowBox[{"old_Integer", ",", " ", "new_Integer"}], "]"}], ":>", " ",
           "new"}]}], "&"}], "/@", "windows"}]}], ";", "\n", 
     RowBox[{"oldrulesets", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@",
        " ", "oldwindows"}]}], ";", "\n", 
     RowBox[{"newrulesets", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{
           RowBox[{"2", "r"}], "+", "1"}], ",", " ", "1"}], "]"}], "&"}], "/@",
        " ", "newwindows"}]}], ";", "\n", 
     RowBox[{"genepairs", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#1", ",", " ", "#2"}], "}"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"oldrulesets", ",", " ", "newrulesets"}], "}"}], ",", " ", 
        "2"}], "]"}]}], ";", "\n", 
     RowBox[{"locs", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruleloc", "[", 
          RowBox[{"#", ",", " ", "k", ",", " ", "r"}], "]"}], "&"}], ",", " ",
         "genepairs", ",", " ", 
        RowBox[{"{", "3", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.943535216934062*^9, 3.943535289748008*^9}, {
   3.943535408793947*^9, 3.943535462250216*^9}, {3.9435355220241146`*^9, 
   3.943535724103119*^9}, {3.943535840870116*^9, 3.943535901265486*^9}, {
   3.943535938187645*^9, 3.943536096169996*^9}, {3.943536151455696*^9, 
   3.943536172251875*^9}, {3.943536215521476*^9, 3.943536220496792*^9}, {
   3.943536363713807*^9, 3.943536364420107*^9}, {3.943537059843223*^9, 
   3.943537106041222*^9}, {3.943544859224308*^9, 3.943544860767973*^9}, {
   3.943567713933944*^9, 3.9435677560368*^9}, 3.943630348821065*^9, 
   3.943632168039295*^9, {3.943806688629696*^9, 3.943806694542572*^9}, {
   3.943988225981876*^9, 3.943988233116807*^9}, 3.9439883884248953`*^9, {
   3.943988618058452*^9, 3.943988658585402*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"5776f0b4-ff49-4d9e-ad5d-921e615769e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"withmask", " ", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0", "\[Rule]", 
      TemplateBox[<|"color" -> GrayLevel[1]|>,
       "GrayLevelColorSwatchTemplate"]}], ",", " ", 
     RowBox[{"1", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"2", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"3", "\[Rule]", 
      TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
       "HueColorSwatchTemplate"]}], ",", 
     RowBox[{"4", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 0]|>,
       "RGBColorSwatchTemplate"]}], ",", 
     RowBox[{"5", "->", 
      TemplateBox[<|"color" -> RGBColor[0, 0.56, 1]|>,
       "RGBColorSwatchTemplate"]}], ",", 
     RowBox[{"100", "->", 
      RowBox[{"GrayLevel", "[", "0.2", "]"}]}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.943541004391426*^9, 3.943541042345522*^9}, {
   3.9435411183138027`*^9, 3.943541131214537*^9}, {3.943544093893063*^9, 
   3.943544094051305*^9}, 3.943544191718172*^9, {3.945379045205536*^9, 
   3.945379049763938*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"cda64b35-4644-476c-b214-c3a22c1cc08f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getmidx", "[", 
   RowBox[{"x1_", ",", " ", "x2_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"x1", " ", "-", " ", "x2"}], ")"}], "/", " ", "2"}], "+", 
   "x2"}]}]], "Code",
 CellLabel->"In[90]:=",ExpressionUUID->"5b91306a-5235-432f-8739-e5cdb7a6bcab"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "getcurves"}]], "Input",
 CellChangeTimes->{{3.943988487047244*^9, 3.943988492324485*^9}},
 CellLabel->
  "In[1852]:=",ExpressionUUID->"469d274f-d616-4742-a656-ffaeac480ee0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getcurves", "[", 
   RowBox[{"locs_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    RowBox[{"y_", ":", "2"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "digs", ",", " ", "cols", ",", " ", "withmid", ",", " ", "pts", ",", " ",
       "curves", ",", " ", "styled"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"digs", " ", "=", " ", 
      RowBox[{"IntegerDigits", "[", 
       RowBox[{"n", ",", " ", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cols", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"digs", "[", 
            RowBox[{"[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], " ", "==", " ", 
           RowBox[{"digs", "[", 
            RowBox[{"[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ",", 
          TemplateBox[<|"color" -> RGBColor[0.36, 0.8300000000000001, 0]|>,
           "RGBColorSwatchTemplate"], ",", " ", 
          TemplateBox[<|"color" -> RGBColor[1., 0.63, 0.1]|>,
           "RGBColorSwatchTemplate"]}], "]"}], "&"}], "/@", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"locs", ",", " ", "1"}], "]"}]}]}], ";", "\n", 
     RowBox[{"withmid", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"getmidx", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], ",", " ", 
        RowBox[{"locs", " ", "-", " ", 
         RowBox[{"1", "/", "2"}]}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pts", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", "y"}], "}"}], ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "-", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "+", " ", 
                    "1"}], ")"}], "/", "2"}], ",", " ", 
                 RowBox[{"y", "+", "3"}]}], "]"}], ",", " ", "10"}], "]"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", "y"}], "}"}]}], "}"}],
          " ", "&"}], ",", " ", "withmid", ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"curves", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"BezierCurve", ",", " ", "pts", ",", " ", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", " ", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"styled", " ", "=", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"#1", ",", " ", "#2"}], "]"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Arrow", "/@", " ", "curves"}], ",", " ", "cols"}], "}"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Arrowheads", "[", "0.025", "]"}], ",", 
        RowBox[{"GrayLevel", "[", "0.4", "]"}], ",", " ", "styled"}], "}"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.943544795102071*^9, 3.943544838624312*^9}, {
   3.943544935265343*^9, 3.943544959621169*^9}, {3.943545013723435*^9, 
   3.9435450398428383`*^9}, {3.943546537026382*^9, 3.943546537139508*^9}, {
   3.943547863810707*^9, 3.9435478761548643`*^9}, {3.943564805141321*^9, 
   3.943564811748916*^9}, {3.943565199196966*^9, 3.943565206167427*^9}, {
   3.943986434658898*^9, 3.94398645798109*^9}, {3.943986494590817*^9, 
   3.943986520034356*^9}, {3.943986552387456*^9, 3.943986596681422*^9}, {
   3.943986939334586*^9, 3.943986981320734*^9}, {3.943987025957817*^9, 
   3.943987026062334*^9}, 3.943987077967525*^9, {3.943987388459023*^9, 
   3.943987404067129*^9}, {3.94398745275674*^9, 3.943987457919425*^9}, {
   3.943987529289364*^9, 3.943987567336049*^9}, {3.943987613937373*^9, 
   3.943987619026284*^9}, {3.943987650353419*^9, 3.943987663181628*^9}, {
   3.943987696403656*^9, 3.943987819599753*^9}, 3.94398786923733*^9, {
   3.943988043867075*^9, 3.94398804864673*^9}, {3.943988082476531*^9, 
   3.943988119566781*^9}, {3.94398824687779*^9, 3.94398824817213*^9}, {
   3.9439882855613832`*^9, 3.943988305778015*^9}, {3.943988386444175*^9, 
   3.9439884643267803`*^9}, {3.943988532267455*^9, 3.943988561178733*^9}, {
   3.9439886242932577`*^9, 3.943988632768743*^9}, {3.944307213996324*^9, 
   3.94430722298189*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"f561a8ee-a541-4829-8d20-5d76e4cc776a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbedRulePlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Mask\>\"", "->", "False"}], ",", " ", "ops"}], "}"}], 
        ",", "Last"}], "]"}]}], "}"}], ",", "\n", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"allops", "[", "\"\<Mask\>\"", "]"}], ",", " ", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"plotmaskedrule", "[", "ru", "]"}], ",", 
        RowBox[{"getcurves", "[", 
         RowBox[{
          RowBox[{"getgenelocs", "[", 
           RowBox[{"{", 
            RowBox[{"pca", ",", " ", "ru"}], "}"}], " ", "]"}], ",", "ru", 
          ",", " ", "2"}], "]"}], ",", " ", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}]}], "]"}], ",",
       " ", "\n", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"plotrule", "[", "ru", "]"}], ",", 
        RowBox[{"getcurves", "[", 
         RowBox[{
          RowBox[{"getgenelocs", "[", 
           RowBox[{"{", 
            RowBox[{"pca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "ru", 
          ",", " ", "1"}], "]"}], ",", " ", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
           RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}]}], "]"}]}], 
     "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.943546585830142*^9, 3.943546700959848*^9}, {
   3.943546733696267*^9, 3.943546783376753*^9}, {3.943565687127426*^9, 
   3.943565771163789*^9}, {3.943565808630843*^9, 3.943565815624713*^9}, {
   3.943566678352837*^9, 3.943566703834824*^9}, {3.943985383402685*^9, 
   3.943985451836494*^9}, {3.943985520761273*^9, 3.943985555021875*^9}, {
   3.943985585476218*^9, 3.943985599967126*^9}, {3.943985650309591*^9, 
   3.943985660710388*^9}, {3.943985700989663*^9, 3.943985776525967*^9}, {
   3.943985878536968*^9, 3.943985879537179*^9}, 3.943985972164542*^9, {
   3.943986035077784*^9, 3.943986038393976*^9}, {3.943986141046876*^9, 
   3.94398617546957*^9}, {3.943986295225086*^9, 3.943986295366105*^9}, {
   3.943988675757477*^9, 3.943988684293489*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"4ef5c2fd-2540-4840-b4bc-d647e18d6feb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"activebodytups", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"tupfunc_", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"4", "#"}], "+", "1"}], "&"}], ")"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "n", ",", " ", "k", ",", " ", "r", ",", " ", "lt", ",", " ", 
      "bodytups"}], "}"}], ",", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lt", " ", "=", " ", 
      RowBox[{"TestCALifeTime", "[", "ca", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bodytups", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", " ", 
          RowBox[{"tupfunc", "[", "r", "]"}], ",", " ", "1"}], "]"}], "&"}], "/@", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
              RowBox[{"2", "r"}]}], ";;", " ", 
             RowBox[{
              RowBox[{"#2", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
              RowBox[{"2", "r"}]}]}], "]"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ca", "[", 
            RowBox[{"[", 
             RowBox[{";;", "lt"}], "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nonzeroRange", "/@", "ca"}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{";;", "lt"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.9440046799197903`*^9, 3.944004692765506*^9}, {
  3.944004752693272*^9, 3.944004757086856*^9}, {3.944004857547843*^9, 
  3.94400489237796*^9}, {3.9440049467986803`*^9, 3.944005039118494*^9}, {
  3.944005171248589*^9, 3.944005188081563*^9}, {3.944010919817169*^9, 
  3.944010920742443*^9}, {3.944012827562276*^9, 3.944013017745034*^9}, {
  3.944013129031476*^9, 3.94401315476455*^9}, {3.944013392552102*^9, 
  3.944013392887691*^9}, {3.94424869201299*^9, 3.944248734874711*^9}, {
  3.944307227705228*^9, 3.944307231034797*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"5c2cfaa5-916d-44f1-9ae1-a17fffaa374f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getpertpairs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "active_"}], "]"}], ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"getpertrus", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"getperts", "[", 
        RowBox[{"#", ",", " ", "k"}], "]"}]}], "]"}], "&"}], "/@", "active"}],
    ")"}], " "}]], "Code",
 CellChangeTimes->{{3.944004893875792*^9, 3.944004897345372*^9}, {
   3.944005058399239*^9, 3.9440050617568283`*^9}, {3.944005092743585*^9, 
   3.944005102983451*^9}, {3.944005327678811*^9, 3.9440053321178637`*^9}, {
   3.944005407103117*^9, 3.944005423682027*^9}, {3.944006005850071*^9, 
   3.944006006699265*^9}, {3.944007338237412*^9, 3.944007339278685*^9}, {
   3.944007509512716*^9, 3.94400754891026*^9}, 3.944008435691231*^9, 
   3.944008691246401*^9, 3.944009069951805*^9, {3.944048269647918*^9, 
   3.944048272157452*^9}, {3.944048316528047*^9, 3.944048320330218*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"8954d162-4f8e-420b-9308-3ece81ecba04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pertdiffs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n_", ",", " ", "k_", ",", " ", "r_"}], "}"}], ",", " ", 
    "pertpairs_"}], "]"}], ":=", " ", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruparts", ",", " ", "stepped", ",", " ", "mask"}], "}"}], ",", 
    "\[IndentingNewLine]", " ", 
    RowBox[{
     RowBox[{"ruparts", " ", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getruparts", "[", 
          RowBox[{"#", ",", " ", "r"}], "]"}], "&"}], ",", " ", "pertpairs", 
        ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"stepped", " ", "=", " ", 
      RowBox[{"Replace", "[", 
       RowBox[{"ruparts", ",", " ", 
        RowBox[{"l_List", ":>", " ", 
         RowBox[{"Replace", "[", 
          RowBox[{"l", ",", " ", 
           RowBox[{"getsubs", "[", 
            RowBox[{"{", 
             RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], "]"}], ",", 
           " ", 
           RowBox[{"{", "4", "}"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mask", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"Except", "[", "0", "]"}], "->", "1"}]}], "]"}], "&"}], 
        ",", " ", "stepped", ",", " ", 
        RowBox[{"{", "3", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{"mask", ",", " ", 
       RowBox[{"{", "3", "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.9440059825918207`*^9, 3.944006012901524*^9}, 
   3.944009134480545*^9, {3.9440482631478033`*^9, 3.944048295191884*^9}, {
   3.944057877395526*^9, 3.944057901187666*^9}, {3.944057948755806*^9, 
   3.944058039270236*^9}, {3.944058180582039*^9, 3.944058247245678*^9}, {
   3.944058289014187*^9, 3.944058312282283*^9}, {3.9440583575057793`*^9, 
   3.944058364152249*^9}, {3.94430723420575*^9, 3.944307241522789*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"8993189a-b736-449c-a026-a7fc5825985f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"meanmicrofragility", "[", 
   RowBox[{"{", 
    RowBox[{"ca_", ",", " ", "ru_"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", ",", "k", ",", " ", "r", ",", "counts", ",", " ", "pd"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"counts", " ", "=", " ", 
      RowBox[{"ReverseSort", "[", 
       RowBox[{"Counts", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"activebodytups", "[", 
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
         "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pd", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", " ", 
        RowBox[{"getpertpairs", "[", 
         RowBox[{"ru", ",", " ", 
          RowBox[{"Keys", "[", "counts", "]"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"N", "@", 
      RowBox[{"Mean", "[", 
       RowBox[{"WeightedData", "[", 
        RowBox[{
         RowBox[{"Mean", "/@", " ", "pd"}], ",", " ", 
         RowBox[{"Values", "[", "counts", "]"}]}], "]"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944089470000523*^9, 3.944089567444223*^9}, {
  3.944089610819311*^9, 3.944089612627388*^9}, {3.944089651309394*^9, 
  3.944089728204438*^9}, {3.94408980953834*^9, 3.944089835320683*^9}, {
  3.94409000278721*^9, 3.944090044832939*^9}, {3.94409032329638*^9, 
  3.9440903345896797`*^9}, {3.944090367357248*^9, 3.944090446261436*^9}, {
  3.944091572228297*^9, 3.94409157774517*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"76d73aa6-a494-4450-9c21-505a85a21ed7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PerturbationSensitivityGraphs", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"size_", ":", "1"}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"counts", " ", "=", 
       RowBox[{
        RowBox[{"Rest", "[", 
         RowBox[{"Counts", "[", 
          RowBox[{"Sort", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"activebodytups", "[", 
              RowBox[{"{", 
               RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
            "]"}], "]"}], "]"}], "]"}], "*", "size"}]}], ",", " ", "\n", 
      "pairs", ",", " ", "diffs", ",", " ", "edges", ",", " ", "cols", ",", 
      " ", "styled", ",", " ", "cg", ",", " ", "cgs", ",", " ", "gps"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pairs", " ", "=", " ", 
      RowBox[{"getpertpairs", "[", 
       RowBox[{"ru", ",", 
        RowBox[{"Keys", "[", "counts", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"diffs", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", "pairs"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"edges", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[DirectedEdge]", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", " ", "pairs", ",", 
        " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cols", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{"#", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"0", ":>", 
              TemplateBox[<|"color" -> RGBColor[0, 0.77, 0]|>,
               "RGBColorSwatchTemplate"]}], ",", 
             RowBox[{"1", ":>", 
              TemplateBox[<|"color" -> RGBColor[0.88, 0.84, 0]|>,
               "RGBColorSwatchTemplate"]}], ",", " ", 
             RowBox[{"2", ":>", " ", "Orange"}], ",", 
             RowBox[{"3", ":>", " ", "Red"}]}], "}"}]}], "]"}], "&"}], ",", 
        " ", "diffs", ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"styled", "  ", "=", " ", "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"#1", ",", "#2"}], " ", "]"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"edges", ",", "cols"}], "}"}], ",", " ", "2"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"cg", " ", "=", " ", 
      RowBox[{"WeaklyConnectedGraphComponents", "[", 
       RowBox[{"Flatten", "[", "styled", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cgs", " ", "=", " ", 
      RowBox[{"ReverseSortBy", "[", 
       RowBox[{"cg", ",", " ", 
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"counts", "[", "#", "]"}], "&"}], "/@", 
           RowBox[{
            RowBox[{"EdgeList", "[", "#", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "]"}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"gps", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"cw", " ", "=", 
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"counts", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{
                RowBox[{"EdgeList", "[", "#", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "]"}]}], ",",
             " ", 
            RowBox[{"vws", " ", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "->", 
                RowBox[{
                 RowBox[{"counts", "[", "#", "]"}], "/", "20"}]}], "&"}], "/@", 
              RowBox[{"VertexList", "[", "#", "]"}]}]}]}], "}"}], ",", " ", 
          "\n", 
          RowBox[{"GraphPlot", "[", 
           RowBox[{"#", ",", 
            RowBox[{"ImageSize", "->", 
             RowBox[{"cw", "*", ".75"}]}], ",", 
            RowBox[{"EdgeShapeFunction", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", "\"\<FilledArrow\>\"", "}"}], ",", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{
                   RowBox[{"Arrow", "[", "#1", "]"}], ",", "\n", 
                   RowBox[{"Arrowheads", "[", 
                    RowBox[{
                    RowBox[{"counts", "[", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "200"}], 
                    "]"}], ",", " ", 
                   RowBox[{"Thickness", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"counts", "[", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"cw", "*", "5"}], ")"}]}], ")"}], "]"}]}], "]"}], 
                 "&"}], ")"}]}], "}"}]}], ",", " ", "\n", 
            RowBox[{"VertexLabels", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"x_", "/;", 
                RowBox[{
                 RowBox[{"counts", "[", "x", "]"}], ">=", "8"}]}], ":>", 
               RowBox[{"Placed", "[", 
                RowBox[{
                 RowBox[{"ArrayPlot", "[", 
                  RowBox[{
                   RowBox[{"{", "x", "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Mesh", "->", "True"}], ",", 
                   RowBox[{"ImageSize", "->", 
                    RowBox[{"1.25", 
                    RowBox[{"counts", "[", "x", "]"}]}]}], ",", " ", 
                   RowBox[{"ColorRules", "->", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"0", "\[Rule]", 
                    TemplateBox[<|"color" -> GrayLevel[1]|>,
                    "GrayLevelColorSwatchTemplate"]}], ",", 
                    RowBox[{"1", "\[Rule]", 
                    StyleBox[
                    TemplateBox[<|"color" -> Hue[0.06, 1, 1]|>,
                    "HueColorSwatchTemplate"], "Input"]}], ",", 
                    RowBox[{"2", "\[Rule]", 
                    TemplateBox[<|"color" -> Hue[0.73, 1, 1]|>,
                    "HueColorSwatchTemplate"]}], ",", 
                    RowBox[{"3", "\[Rule]", 
                    TemplateBox[<|"color" -> Hue[0.14, 0.81, 0.99]|>,
                    "HueColorSwatchTemplate"]}]}], "}"}]}]}], "]"}], ",", 
                 "Center"}], "]"}]}], "}"}]}]}], "]"}]}], "]"}], "&"}], "/@", 
       " ", "cgs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Multicolumn", "[", 
      RowBox[{"gps", ",", " ", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", " ", 
         RowBox[{"Floor", "[", 
          RowBox[{
           RowBox[{"Length", "[", "counts", "]"}], "/", "12"}], "]"}]}], 
        "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.944238420450803*^9, 3.944238467737119*^9}, {
   3.944238520618046*^9, 3.944238543749881*^9}, {3.944238579950418*^9, 
   3.9442387151492653`*^9}, 3.944238868297678*^9, {3.944238924562327*^9, 
   3.944238927340978*^9}, {3.944238963429169*^9, 3.944238964090165*^9}, {
   3.944239185557859*^9, 3.944239222900076*^9}, {3.944239355581547*^9, 
   3.944239357277615*^9}, {3.944239488113841*^9, 3.944239504221046*^9}, {
   3.944239547623726*^9, 3.944239547721741*^9}, 3.94423972060432*^9, {
   3.94430725336372*^9, 3.944307290711181*^9}, {3.944307328092708*^9, 
   3.944307347568986*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"9227b1b7-0d7b-48e5-ac25-014980542ee9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PerturbationSensitivityChart", "]"}], " ", "=", 
   " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<NumBars\>\"", "->", "100"}], ",", " ", 
     RowBox[{"\"\<ShowSequences\>\"", "->", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PerturbationSensitivityChart", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ca_", ",", " ", "ru_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "PerturbationSensitivityChart", "]"}]}], 
   "]"}], ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"counts", " ", "=", 
       RowBox[{"Rest", "[", 
        RowBox[{"Counts", "[", 
         RowBox[{"Sort", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"activebodytups", "[", 
             RowBox[{"{", 
              RowBox[{"ca", ",", " ", "ru"}], "}"}], "]"}], ",", " ", "1"}], 
           "]"}], "]"}], "]"}], "]"}]}], ",", " ", "n", ",", " ", "k", ",", 
      " ", "r", ",", " ", "pp", ",", " ", "pd", ",", "\n", "withcols", ",", 
      " ", "labfunc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "k", ",", " ", "r"}], "}"}], " ", "=", " ", 
      RowBox[{"interpretrule", "[", "ru", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pp", " ", "=", " ", 
      RowBox[{"getpertpairs", "[", 
       RowBox[{"ru", ",", 
        RowBox[{"Keys", "[", 
         RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pd", " ", "=", " ", 
      RowBox[{"pertdiffs", "[", 
       RowBox[{"ru", ",", "pp"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"withcols", " ", "=", "  ", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"Blend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                TemplateBox[<|"color" -> RGBColor[0, 0.77, 0]|>,
                 "RGBColorSwatchTemplate"], ",", 
                TemplateBox[<|"color" -> RGBColor[0.88, 0.84, 0]|>,
                 "RGBColorSwatchTemplate"], ",", " ", "Orange", ",", "Red"}], 
               "}"}], ",", 
              RowBox[{
               RowBox[{"Total", "[", "#2", "]"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"k", " ", "-", " ", "1"}], ")"}], " ", "*", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", "r"}], "+", "1"}], ")"}]}], ")"}]}]}], 
             "]"}]}], "]"}], "&"}], ",", " ", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], ",", " ", 
           "pd"}], "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{";;", 
         RowBox[{"UpTo", "[", 
          RowBox[{"Replace", "[", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<NumBars\>\"", "]"}], ",", " ", 
            RowBox[{"All", ":>", " ", 
             RowBox[{"Length", "[", "pd", "]"}]}]}], "]"}], "]"}]}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"labfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<ShowSequences\>\"", "]"}], ",", " ", 
        
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"PlotCA", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Keys", "[", 
                  RowBox[{"ReverseSort", "[", "counts", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"#2", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "}"}]}], ",",
               " ", 
              RowBox[{"ImageSize", "->", 
               RowBox[{"{", 
                RowBox[{"20", ",", " ", "30"}], "}"}]}]}], "]"}], ",", 
            "Below"}], "]"}], "&"}], ")"}], ",", " ", "Automatic"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"BarChart", "[", 
      RowBox[{"withcols", ",", " ", 
       RowBox[{"LabelingFunction", "->", " ", "labfunc"}]}], "]"}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.944241249383291*^9, 3.944241260816337*^9}, {
  3.944241295763332*^9, 3.944241382921158*^9}, {3.944241459928853*^9, 
  3.944241851170583*^9}, {3.944241923484763*^9, 3.944241947731597*^9}, {
  3.944242011537417*^9, 3.944242011751195*^9}, {3.944242998362563*^9, 
  3.944243009829999*^9}, {3.944307309202841*^9, 3.944307315017668*^9}, {
  3.944307358924268*^9, 3.944307369369523*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"687166cd-9349-4a64-af9d-54599751fe14"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Adaptive Cellular Automaton", "Section",
 CellChangeTimes->{{3.945266329376746*^9, 
  3.945266342090605*^9}},ExpressionUUID->"4fc1db56-03ee-46e3-b8fa-\
bf546a73f757"],

Cell[BoxData[
 RowBox[{"ClearAll", "@", "AdaptCA"}]], "Input",
 CellChangeTimes->{{3.945288805599286*^9, 3.945288812776019*^9}},
 CellLabel->
  "In[418]:=",ExpressionUUID->"64c1bb36-84e9-41c7-962a-588dfa935683"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymIndexMap", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymIndexMap", "[", 
    RowBox[{"k", ",", "r"}], "]"}], "=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tups", "=", 
       RowBox[{"Tuples", "[", 
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{"k", "-", "1"}]}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"2", "r"}], "+", "1"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Sort", "[", 
      RowBox[{"Catenate", "[", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{"tups", ",", "#"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"tups", ",", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{"Reverse", "[", "#", "]"}]}], "}"}], "]"}], "&"}]}], 
          "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Code",
 CellChangeTimes->{{3.921276552687866*^9, 3.921276580328933*^9}, {
  3.9216710929557953`*^9, 3.921671100676935*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"0a23268f-a11c-439d-a0e2-59a24b67a0a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymUp", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymUp", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{
    RowBox[{"SymIndexMap", "[", 
     RowBox[{"k", ",", "r"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.921276384975207*^9, 3.921276649760997*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"0b0e8d19-9312-4197-9836-619b59ac8dc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SymDown", "[", 
   RowBox[{"k_", ",", "r_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SymDown", "[", 
    RowBox[{"k", ",", "r"}], "\[IndentingNewLine]", "]"}], "=", 
   RowBox[{"Values", "[", 
    RowBox[{"KeySort", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"First", ",", "\[IndentingNewLine]", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"SymIndexMap", "[", 
          RowBox[{"k", ",", "r"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Last", "->", "First"}]}], "]"}]}], "]"}], "]"}], 
    "]"}]}]}]], "Code",
 CellChangeTimes->{{3.9212766561634283`*^9, 3.921276659673758*^9}, {
  3.9212767190156803`*^9, 3.921276735250161*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"26fc0ac2-e7a8-4c94-a4bd-abc4d2e33646"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RandomRuleMutation", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rn_", ",", "k_", ",", "r_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"many_Integer", ":", "1"}], ",", "\[IndentingNewLine]", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Symmetric\>\"", "->", "False"}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"up", ",", "down", ",", "cases"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"up", ",", "down"}], "}"}], "=", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<Symmetric\>\"", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"SymUp", "[", 
           RowBox[{"k", ",", "r"}], "]"}], ",", 
          RowBox[{"SymDown", "[", 
           RowBox[{"k", ",", "r"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"All", ",", "All"}], "}"}]}], "\[IndentingNewLine]", "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"cases", "=", 
      RowBox[{
       RowBox[{"IntegerDigits", "[", 
        RowBox[{"rn", ",", "k", ",", 
         RowBox[{"k", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "r"}], "+", "1"}], ")"}]}]}], "]"}], "[", 
       RowBox[{"[", "down", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FromDigits", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "up", "]"}], "]"}], ",", "k"}], "]"}], ",", "k", ",",
          "r"}], "}"}], "&"}], "[", "\[IndentingNewLine]", 
      RowBox[{"MapAt", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}], "]"}]}], ",", "k"}], "]"}], 
         "&"}], ",", "\[IndentingNewLine]", "cases", ",", 
        RowBox[{"List", "/@", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"1", ";;", 
            RowBox[{
             RowBox[{"Length", "[", "cases", "]"}], "-", "1"}]}], ",", 
           "many"}], "]"}]}]}], "]"}], "\[IndentingNewLine]", "]"}]}]}], " ", 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellLabel->
  "In[103]:=",ExpressionUUID->"1c06dd49-3956-4c69-9d3d-46b071ea723a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "AdaptCA", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<VariationFunction\>\"", "->", "RandomRuleMutation"}], ",", 
     RowBox[{"\"\<AutomatonFunction\>\"", "->", "getca"}], ",", " ", 
     RowBox[{"\"\<FitnessFunction\>\"", "->", "TestCALifeTime"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<FitnessDeathValue\>\"", "->", 
      RowBox[{"-", "Infinity"}]}], ",", 
     RowBox[{"\"\<Perturbation\>\"", "->", "None"}], ",", 
     RowBox[{"\"\<NPerturbations\>\"", "->", "1"}], ",", 
     RowBox[{"\"\<CombinationFunction\>\"", "->", "Min"}], ",", " ", 
     RowBox[{"\"\<SelectionFunction\>\"", "->", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"fit1", ",", " ", "fit2"}], "}"}], ",", " ", 
        RowBox[{"fit2", ">=", "fit1"}]}], "]"}]}], ",", " ", 
     RowBox[{"\"\<ReturnCAs\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<ReturnPerturbations\>\"", "->", "False"}], ",", " ", 
     RowBox[{"\"\<PerturbationFunction\>\"", "->", "None"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"AdaptCA", "[", 
   RowBox[{
    RowBox[{"initrule_", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "3", ",", " ", "1"}], "}"}]}], ",", " ", 
    RowBox[{"iterations_", ":", "100"}], ",", " ", 
    RowBox[{"ops", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "allops", ",", " ", "ca", ",", " ", "pcaops", ",", " ", "pertfunc", ",", 
      " ", "initcas", ",", " ", "initfits", ",", " ", "initobject", ",", " ", 
      "nperts", ",", " ", "evofunc", ",", " ", "ncas", ",", " ", "nfits", ",",
       " ", "nobject"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"allops", " ", "=", " ", 
      RowBox[{"Merge", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Options", "[", "AdaptCA", "]"}], ",", " ", "ops"}], "}"}], 
        ",", " ", "Last"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ca", " ", "=", " ", 
      RowBox[{
       RowBox[{"allops", "[", "\"\<AutomatonFunction\>\"", "]"}], "[", 
       "initrule", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pcaops", " ", "=", " ", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "allops", "]"}], ",", " ", 
         RowBox[{"Options", "[", "PerturbCA", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pertfunc", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], "=!=", 
         " ", "None"}], ",", " ", 
        RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], ",", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "&"}], ")"}]}], ",", 
            RowBox[{"True", "->", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "pcaops"}], "]"}], "&"}], ")"}]}], ",",
             " ", 
            RowBox[{"o_", ":>", "  ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"PerturbCA", "[", 
                RowBox[{"#", ",", " ", "o", ",", " ", "pcaops"}], "]"}], 
               "&"}], ")"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"initcas", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "ca", "}"}], ",", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"pertfunc", "[", 
           RowBox[{"{", 
            RowBox[{"ca", ",", " ", "initrule"}], "}"}], "]"}], ",", " ", 
          RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"initfits", " ", "=", " ", 
      RowBox[{
       RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "/@", 
       "initcas"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"initobject", " ", "=", "  ", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<rule\>\"", "->", " ", "initrule"}], ",", " ", 
        RowBox[{"\"\<fitness\>\"", "->", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<CombinationFunction\>\"", "]"}], "[", 
          "initfits", "]"}]}], ",", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<ReturnCAs\>\"", "]"}], ",", 
          RowBox[{"\"\<cas\>\"", "->", " ", "initcas"}], ",", "Nothing"}], 
         "]"}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nperts", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"allops", "[", "\"\<Perturbation\>\"", "]"}], "===", 
          "None"}], " ", "&&", 
         RowBox[{
          RowBox[{"allops", "[", "\"\<PerturbationFunction\>\"", "]"}], " ", "===",
           " ", "None"}]}], ",", " ", "0", ",", " ", 
        RowBox[{"allops", "[", "\"\<NPerturbations\>\"", "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"evofunc", " ", "=", " ", 
      RowBox[{"Function", "[", 
       RowBox[{"evoobject", ",", " ", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"nru", " ", "=", " ", 
             RowBox[{
              RowBox[{"allops", "[", "\"\<VariationFunction\>\"", "]"}], "[", 
              
              RowBox[{"evoobject", "[", "\"\<rule\>\"", "]"}], "]"}]}], ",", 
            " ", "nca", ",", " ", "ffit", ",", " ", "nfit"}], "}"}], ",", " ",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"nca", " ", "=", " ", 
            RowBox[{
             RowBox[{"allops", "[", "\"\<AutomatonFunction\>\"", "]"}], "[", 
             "nru", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ffit", "  ", "=", " ", 
            RowBox[{
             RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "[", 
             "nca", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"allops", "[", "\"\<FitnessDeathValue\>\"", "]"}], " ", 
              "==", "  ", "ffit"}], ",", " ", "evoobject", ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ncas", " ", "=", " ", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "nca", "}"}], ",", " ", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"pertfunc", "[", 
                    RowBox[{"{", 
                    RowBox[{"nca", ",", " ", "nru"}], "}"}], "]"}], ",", " ", 
                   "nperts"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"nfits", " ", "=", " ", 
               RowBox[{
                RowBox[{"allops", "[", "\"\<FitnessFunction\>\"", "]"}], "/@",
                 "ncas"}]}], ";", " ", "\[IndentingNewLine]", 
              RowBox[{"nfit", " ", "=", " ", 
               RowBox[{
                RowBox[{"allops", "[", "\"\<CombinationFunction\>\"", "]"}], 
                "[", "nfits", "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"nobject", " ", "=", " ", 
               RowBox[{"<|", 
                RowBox[{
                 RowBox[{"\"\<rule\>\"", "->", " ", "nru"}], ",", " ", 
                 RowBox[{"\"\<fitness\>\"", "->", "nfit"}], ",", " ", 
                 RowBox[{"\"\<cas\>\"", "->", " ", "ncas"}]}], "|>"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Merge", "[", 
               RowBox[{
                RowBox[{"KeyIntersection", "[", 
                 RowBox[{"{", 
                  RowBox[{"evoobject", ",", " ", "nobject"}], "}"}], "]"}], 
                ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"allops", "[", "\"\<SelectionFunction\>\"", "]"}], 
                   "[", 
                   RowBox[{
                    RowBox[{"evoobject", "[", "\"\<fitness\>\"", "]"}], ",", 
                    " ", "nfit"}], "]"}], ",", " ", "Last", ",", " ", 
                  "First"}], "]"}]}], "]"}]}]}], " ", "\[IndentingNewLine]", 
            "]"}]}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NestList", "[", 
      RowBox[{"evofunc", ",", " ", "initobject", ",", " ", "iterations"}], 
      "]"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.945266347298204*^9, 3.945266510611971*^9}, {
   3.945266548825857*^9, 3.945266550410791*^9}, {3.945268016078183*^9, 
   3.945268032142717*^9}, {3.945269107272526*^9, 3.94526911449774*^9}, {
   3.945269279580195*^9, 3.9452692938640947`*^9}, {3.945271810557001*^9, 
   3.945272218099633*^9}, {3.945273385911368*^9, 3.945273436835957*^9}, {
   3.945273506952347*^9, 3.945273560819565*^9}, {3.9452735910394588`*^9, 
   3.945274203127338*^9}, {3.945274237522272*^9, 3.945274343950425*^9}, {
   3.945274506234223*^9, 3.945274562658798*^9}, {3.945274616503378*^9, 
   3.9452746603173656`*^9}, {3.945274698429175*^9, 3.945274783319426*^9}, {
   3.945274848605851*^9, 3.9452749606025352`*^9}, {3.945275029070685*^9, 
   3.945275135733245*^9}, {3.945275182863851*^9, 3.945275221946412*^9}, {
   3.945275262417237*^9, 3.945275596744805*^9}, {3.945275738704367*^9, 
   3.945276013867606*^9}, 3.945276058551349*^9, 3.945276651635416*^9, {
   3.945276699749899*^9, 3.945276711552902*^9}, {3.945276792387329*^9, 
   3.9452768229580507`*^9}, {3.945277094229609*^9, 3.945277103309697*^9}, 
   3.945278579486566*^9, {3.945278684328342*^9, 3.945278777648252*^9}, {
   3.945283207433051*^9, 3.94528322304812*^9}, {3.945286751130001*^9, 
   3.945286967127088*^9}, {3.94528703938305*^9, 3.9452871136798*^9}, {
   3.945287144861001*^9, 3.945287157454178*^9}, {3.945287343138464*^9, 
   3.945287405517154*^9}, {3.945287451123786*^9, 3.94528751497371*^9}, {
   3.94528876852215*^9, 3.945288773503803*^9}, {3.94528926679877*^9, 
   3.945289335808309*^9}, {3.945289406537052*^9, 3.945289407270677*^9}, {
   3.94528950551687*^9, 3.945289510055008*^9}, {3.945291265390485*^9, 
   3.945291266776462*^9}, {3.945297202206361*^9, 3.945297251261252*^9}, {
   3.945299500736367*^9, 3.9452995337161303`*^9}, {3.945304908454424*^9, 
   3.945304913598891*^9}, {3.9453051411135817`*^9, 3.945305152655653*^9}, {
   3.945305457248176*^9, 3.945305457646864*^9}, 3.9453059174390373`*^9, 
   3.945352393400782*^9, {3.9453525156122513`*^9, 3.945352549273878*^9}, {
   3.94535285315694*^9, 3.945352856079548*^9}, {3.945353982277117*^9, 
   3.945353990091741*^9}, {3.945362901544997*^9, 3.94536291249011*^9}, 
   3.945363008943507*^9, {3.945363352880908*^9, 3.945363375695158*^9}, 
   3.945380154426285*^9, {3.945380185098514*^9, 3.945380186422291*^9}, 
   3.945380218135167*^9},
 CellLabel->
  "In[146]:=",ExpressionUUID->"a732ee15-b599-4761-a230-33dd80415b6f"]
}, Open  ]]
},
WindowSize->{Full, Full},
WindowMargins->{{144, Automatic}, {Automatic, 60}},
Magnification->1.25,
FrontEndVersion->"14.0 for Mac OS X x86 (64-bit) (December 12, 2023)",
StyleDefinitions->"ReverseColor.nb",
ExpressionUUID->"940e5b96-e9b5-4073-9edc-482c7856034a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1574, 35, 186, "Code",ExpressionUUID->"d4d55858-54bd-4a04-9121-5f28c1112ca4"],
Cell[CellGroupData[{
Cell[2157, 59, 152, 3, 84, "Section",ExpressionUUID->"d4dfd321-d1da-46f2-945d-01c197224088"],
Cell[2312, 64, 307, 6, 37, "Input",ExpressionUUID->"39566c88-cc56-4f88-9197-b94b12d65c5c"],
Cell[2622, 72, 1163, 26, 65, "Code",ExpressionUUID->"66586bd6-1558-4922-8781-dbbf32d27029"],
Cell[3788, 100, 1323, 34, 162, "Code",ExpressionUUID->"bb525146-aa8f-419c-b339-76ae1d0a2ebf"],
Cell[5114, 136, 777, 15, 65, "Code",ExpressionUUID->"7824730d-64c5-443c-ad56-0f01495e77b5"],
Cell[5894, 153, 1002, 25, 65, "Code",ExpressionUUID->"efc2a93a-0cc6-424f-badf-dd4c458a951e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6933, 183, 210, 4, 84, "Section",ExpressionUUID->"cf0c77fd-76e4-44d5-911f-081db9d3cd97"],
Cell[7146, 189, 211, 4, 37, "Input",ExpressionUUID->"0e1a29cf-f8c2-464c-b17d-225d55311ae5"],
Cell[7360, 195, 3893, 96, 162, "Code",ExpressionUUID->"dc2050e0-8d63-4cc7-b717-093004985c57"],
Cell[11256, 293, 1688, 33, 90, "Code",ExpressionUUID->"236f1f6b-ae32-4891-93eb-46abd3e368cb"],
Cell[12947, 328, 1777, 35, 65, "Code",ExpressionUUID->"a1ac0263-c9ed-44b1-89a4-a9f6a28dbc40"],
Cell[14727, 365, 1068, 24, 65, "Code",ExpressionUUID->"bc482545-8a99-4e13-a439-ea9bdf712480"],
Cell[15798, 391, 214, 4, 37, "Input",ExpressionUUID->"9d514693-cddc-4e38-9b54-ac1526389725"],
Cell[16015, 397, 7521, 173, 330, "Code",ExpressionUUID->"6c3a00f3-87ac-4f9a-837a-c3df21c6267f"],
Cell[23539, 572, 1744, 41, 114, "Code",ExpressionUUID->"62e5735f-c48a-4c83-8a06-a424b4070eb5"],
Cell[25286, 615, 1184, 33, 90, "Code",ExpressionUUID->"1215da87-9b66-4944-8205-67d788d9054a"],
Cell[26473, 650, 209, 4, 37, "Input",ExpressionUUID->"963ee29d-bccb-4012-b785-eb26b4a2a079"],
Cell[26685, 656, 361, 6, 37, "Input",ExpressionUUID->"44c86d15-07ce-46bb-b883-bca1c8af1b3c"],
Cell[27049, 664, 5278, 126, 378, "Code",ExpressionUUID->"76bdfc43-21d3-481f-8938-b7c7683e246e"],
Cell[32330, 792, 346, 6, 37, "Input",ExpressionUUID->"2e3b9bfe-7c4d-4727-9587-3b701953e93a"],
Cell[32679, 800, 4735, 101, 258, "Code",ExpressionUUID->"e5721ff3-e4b7-47dc-bde0-27b33fda6738"],
Cell[37417, 903, 1392, 33, 186, "Code",ExpressionUUID->"aebe8d83-fa83-4477-aba3-32562d14f188"],
Cell[38812, 938, 4553, 92, 210, "Code",ExpressionUUID->"1aad2baa-0495-436d-95f2-af44da44fb73"],
Cell[43368, 1032, 2963, 70, 234, "Code",ExpressionUUID->"3e4c1673-a209-481f-8807-8508bf6ca7d8"],
Cell[46334, 1104, 4082, 93, 354, "Code",ExpressionUUID->"2eb46e7c-52b3-4416-8da4-b23de34620c8"],
Cell[50419, 1199, 3007, 59, 162, "Code",ExpressionUUID->"39a76f62-7516-4258-8adc-761ad2341dbf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53463, 1263, 215, 4, 84, "Section",ExpressionUUID->"0d54c013-5695-4af7-a5d8-526052a920b4"],
Cell[CellGroupData[{
Cell[53703, 1271, 160, 3, 56, "Subsubsection",ExpressionUUID->"f9337781-00ed-4cf6-b7d6-15b108cb404b"],
Cell[53866, 1276, 1251, 27, 90, "Code",ExpressionUUID->"00820d1f-bba9-49cf-9118-7a39c77588ec"],
Cell[55120, 1305, 1311, 31, 65, "Code",ExpressionUUID->"ac9a4b45-3cd6-4fc9-a1af-a205b0f0c8cb"],
Cell[56434, 1338, 1187, 29, 114, "Code",ExpressionUUID->"8fdd11fb-bfc2-47ea-9605-81e667fb82c9"],
Cell[57624, 1369, 1645, 43, 138, "Code",ExpressionUUID->"feac0734-d090-4a95-a838-948cdde9892d"],
Cell[59272, 1414, 627, 12, 90, "Code",ExpressionUUID->"f7a36137-a1fb-499c-9888-f233a7dc896a"],
Cell[59902, 1428, 367, 8, 65, "Code",ExpressionUUID->"0cbe98b9-5d15-4e25-aea5-9f81b98a8f78"],
Cell[60272, 1438, 1005, 24, 65, "Code",ExpressionUUID->"5a97706c-555b-42d3-b8c3-5f2eb8316a29"],
Cell[61280, 1464, 511, 12, 65, "Code",ExpressionUUID->"8f501bd8-915e-4a2c-afbb-d228be7463e9"],
Cell[61794, 1478, 1508, 40, 162, "Code",ExpressionUUID->"46e71cfb-abac-4d3f-9522-826cc3d9f9e6"],
Cell[63305, 1520, 2554, 60, 186, "Code",ExpressionUUID->"f0aca7bf-a223-47fe-ba3b-4e1b3a0d8fcd"],
Cell[CellGroupData[{
Cell[65884, 1584, 278, 6, 37, "Input",ExpressionUUID->"f206f1f5-d424-41a8-8650-669e066d87bb"],
Cell[66165, 1592, 262, 7, 42, "Output",ExpressionUUID->"efa5eecf-26f2-4187-8fb4-35e66ca2c98b"]
}, Open  ]],
Cell[66442, 1602, 2216, 53, 186, "Code",ExpressionUUID->"880fbcd0-faff-4b3d-9261-78cca0261925"],
Cell[68661, 1657, 1723, 40, 186, "Code",ExpressionUUID->"0c8cc113-f9e5-4e0e-9927-9cded33aeb2e"],
Cell[70387, 1699, 2552, 60, 234, "Code",ExpressionUUID->"eab83cc5-4fb6-4205-88f0-e49ac63024f8"]
}, Closed]],
Cell[CellGroupData[{
Cell[72976, 1764, 161, 3, 45, "Subsubsection",ExpressionUUID->"c3934115-dd2b-402d-95db-e64b1755e4c9"],
Cell[73140, 1769, 212, 4, 37, "Input",ExpressionUUID->"19568139-b395-4661-9473-480d45d69885"],
Cell[73355, 1775, 2778, 53, 90, "Code",ExpressionUUID->"7e4575df-c6f4-4be7-91f2-5cfb605375ff"],
Cell[76136, 1830, 2263, 39, 90, "Code",ExpressionUUID->"93312ec3-2ccb-43ab-bfed-a7aca5100a95"],
Cell[78402, 1871, 2528, 49, 90, "Code",ExpressionUUID->"ae583b66-9d54-4247-a467-a8fe176680d2"],
Cell[80933, 1922, 2356, 46, 65, "Code",ExpressionUUID->"9c81f832-deaa-49c9-b65a-3024caef2c27"],
Cell[83292, 1970, 1909, 34, 65, "Code",ExpressionUUID->"13a70852-7b4b-403b-8ea5-d1bc82dd6d2a"],
Cell[85204, 2006, 3778, 83, 162, "Code",ExpressionUUID->"fea5e2fb-e273-49d4-9e3c-4248480d4226"],
Cell[88985, 2091, 8317, 185, 426, "Code",ExpressionUUID->"5ca3128a-7227-459a-9f6b-b2ee308f500d"],
Cell[97305, 2278, 1010, 21, 90, "Code",ExpressionUUID->"91cabbb1-3e5f-418a-8b1a-364f9395504c"],
Cell[98318, 2301, 224, 4, 37, "Input",ExpressionUUID->"fd7dfa2c-f86c-4b3f-a1dd-c2e180e5bb89"],
Cell[98545, 2307, 4130, 88, 282, "Code",ExpressionUUID->"dd2def3d-7d35-44cf-a24a-f73d80d1056e"],
Cell[102678, 2397, 1338, 32, 114, "Code",ExpressionUUID->"1036ea8a-45c1-4b55-8abe-80832ca01bbc"],
Cell[104019, 2431, 723, 18, 90, "Code",ExpressionUUID->"b56dbf97-9ff2-45c6-b5f2-96e02646739b"],
Cell[104745, 2451, 1515, 34, 90, "Code",ExpressionUUID->"4f8b6eaa-2edc-44db-9a2b-eaffe256f8bb"],
Cell[106263, 2487, 717, 18, 65, "Code",ExpressionUUID->"ecc43957-24ef-44e1-8558-3c233858326d"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[107029, 2511, 163, 3, 84, "Section",ExpressionUUID->"c0def580-a913-4d5e-a53d-54a25ec47976"],
Cell[107195, 2516, 410, 7, 37, "Input",ExpressionUUID->"78f72f05-bdc5-4221-9640-323bd721da42"],
Cell[107608, 2525, 1391, 30, 114, "Code",ExpressionUUID->"c84488ca-30e8-4ef8-a260-ba6d0411bb08"],
Cell[109002, 2557, 1845, 42, 114, "Code",ExpressionUUID->"031a155b-fcaf-41b6-9dcc-5435b2aba328"],
Cell[110850, 2601, 2420, 49, 162, "Code",ExpressionUUID->"e4f03766-0993-49fa-96b0-e51767b27f35"],
Cell[113273, 2652, 1222, 25, 90, "Code",ExpressionUUID->"914e413a-3638-490f-aca9-493735b3966c"],
Cell[114498, 2679, 618, 13, 65, "Code",ExpressionUUID->"fb87530d-1647-4eac-8404-f0e8157f5a49"],
Cell[115119, 2694, 1308, 31, 114, "Code",ExpressionUUID->"010986f6-6641-4c6a-9859-d5bc0c5ed0c0"],
Cell[116430, 2727, 1443, 32, 138, "Code",ExpressionUUID->"bd0ce26c-8793-41ce-9d99-a5fe0cc40a54"],
Cell[117876, 2761, 634, 16, 90, "Code",ExpressionUUID->"e9675c57-8c37-4554-b4d9-64de01f118e9"],
Cell[118513, 2779, 1720, 41, 114, "Code",ExpressionUUID->"57294f1b-a5b9-4720-99cf-4822c83dcf9b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[120270, 2825, 155, 3, 84, "Section",ExpressionUUID->"9833750c-2556-43b1-b3be-7cb6bb80404d"],
Cell[120428, 2830, 2856, 70, 162, "Code",ExpressionUUID->"87343c1c-81c4-4008-9ef2-649f897b7b84"],
Cell[123287, 2902, 318, 6, 37, "Input",ExpressionUUID->"9cd621fb-6046-44fb-ba5d-e0a6774cc4a0"],
Cell[123608, 2910, 1189, 27, 90, "Code",ExpressionUUID->"7133c0ef-2767-46cc-b759-35a901e7a5eb"],
Cell[124800, 2939, 2439, 66, 162, "Code",ExpressionUUID->"3f9495ca-95d8-4e4a-a37d-408683ffc6b3"],
Cell[127242, 3007, 2502, 52, 90, "Code",ExpressionUUID->"2c64da26-4ed6-479d-a657-a6c14a89bd13"],
Cell[129747, 3061, 1322, 25, 65, "Code",ExpressionUUID->"96687295-1def-49bb-8675-468fe0e90892"],
Cell[131072, 3088, 1865, 42, 90, "Code",ExpressionUUID->"5658bfaa-3608-4231-9ca2-7a7502e6aa61"],
Cell[132940, 3132, 275, 5, 37, "Input",ExpressionUUID->"e64beb7b-4dac-4bbf-9245-42397f2fce87"],
Cell[133218, 3139, 3944, 91, 258, "Code",ExpressionUUID->"f3faa165-d5e1-4e4c-a285-88710b1dddcf"]
}, Closed]],
Cell[CellGroupData[{
Cell[137199, 3235, 249, 4, 65, "Section",ExpressionUUID->"bc7b5f81-b8b3-411d-99af-77f90d1a1f1c"],
Cell[137451, 3241, 3266, 66, 162, "Code",ExpressionUUID->"5abfbed9-f83e-4006-a93c-e32bc3f9495b"],
Cell[140720, 3309, 316, 6, 37, "Input",ExpressionUUID->"387b6e43-db66-4b94-9d23-d3b5a400acb2"],
Cell[141039, 3317, 2209, 57, 138, "Code",ExpressionUUID->"55fa00ea-a9f3-404e-afc8-aa0fa7289c2c"]
}, Closed]],
Cell[CellGroupData[{
Cell[143285, 3379, 151, 3, 65, "Section",ExpressionUUID->"d6852212-b3fa-464d-9fd5-2873ef55d3c9"],
Cell[143439, 3384, 537, 15, 90, "Code",ExpressionUUID->"7f2be1c5-0353-4225-917f-f2d50cea3add"],
Cell[143979, 3401, 1837, 50, 210, "Code",ExpressionUUID->"1167ac24-28bb-42eb-8554-f1fe6819b441"],
Cell[145819, 3453, 1497, 33, 114, "Code",ExpressionUUID->"bee9e125-9c08-4ab3-a081-a2ef8ee2c10c"],
Cell[147319, 3488, 432, 11, 65, "Code",ExpressionUUID->"09adc84a-a279-4018-bdd1-53ae96dc4b48"],
Cell[147754, 3501, 1267, 31, 65, "Code",ExpressionUUID->"61c09f1a-6996-44c1-abac-9ee339ea646e"],
Cell[149024, 3534, 910, 22, 65, "Code",ExpressionUUID->"0fddcb93-8a52-4500-9fa7-9dc78c741d04"],
Cell[149937, 3558, 748, 20, 65, "Code",ExpressionUUID->"2ec127b0-b6c5-4950-9519-4c65d04e32ab"],
Cell[150688, 3580, 2052, 50, 138, "Code",ExpressionUUID->"89b85e4d-4802-4b40-b6e5-d9d5f1138b38"],
Cell[152743, 3632, 1091, 23, 65, "Code",ExpressionUUID->"41e0f7db-104a-4846-bdc6-82e8613020dc"],
Cell[153837, 3657, 1773, 47, 138, "Code",ExpressionUUID->"70ee3023-4f28-426d-bd63-82fecb8f1e5c"],
Cell[155613, 3706, 342, 7, 65, "Code",ExpressionUUID->"98769222-0260-425b-9432-156479b78447"],
Cell[155958, 3715, 633, 13, 65, "Code",ExpressionUUID->"47522f53-f4f0-4f5a-a80d-879102e4a018"],
Cell[156594, 3730, 3589, 78, 210, "Code",ExpressionUUID->"11e9a943-ffa8-4d87-8acf-7ac334323613"],
Cell[160186, 3810, 3675, 85, 282, "Code",ExpressionUUID->"8ca4d791-001e-4ff9-92cb-df43c5aa6a93"],
Cell[163864, 3897, 4265, 103, 306, "Code",ExpressionUUID->"5776f0b4-ff49-4d9e-ad5d-921e615769e1"],
Cell[168132, 4002, 1253, 29, 65, "Code",ExpressionUUID->"cda64b35-4644-476c-b214-c3a22c1cc08f"],
Cell[169388, 4033, 320, 9, 65, "Code",ExpressionUUID->"5b91306a-5235-432f-8739-e5cdb7a6bcab"],
Cell[169711, 4044, 214, 4, 37, "Input",ExpressionUUID->"469d274f-d616-4742-a656-ffaeac480ee0"],
Cell[169928, 4050, 5842, 135, 258, "Code",ExpressionUUID->"f561a8ee-a541-4829-8d20-5d76e4cc776a"],
Cell[175773, 4187, 2692, 62, 138, "Code",ExpressionUUID->"4ef5c2fd-2540-4840-b4bc-d647e18d6feb"],
Cell[178468, 4251, 2567, 64, 138, "Code",ExpressionUUID->"5c2cfaa5-916d-44f1-9ae1-a17fffaa374f"],
Cell[181038, 4317, 1091, 23, 65, "Code",ExpressionUUID->"8954d162-4f8e-420b-9308-3ece81ecba04"],
Cell[182132, 4342, 2336, 57, 162, "Code",ExpressionUUID->"8993189a-b736-449c-a026-a7fc5825985f"],
Cell[184471, 4401, 1721, 40, 162, "Code",ExpressionUUID->"76d73aa6-a494-4450-9c21-505a85a21ed7"],
Cell[186195, 4443, 8126, 192, 474, "Code",ExpressionUUID->"9227b1b7-0d7b-48e5-ac25-014980542ee9"],
Cell[194324, 4637, 4931, 122, 306, "Code",ExpressionUUID->"687166cd-9349-4a64-af9d-54599751fe14"]
}, Open  ]],
Cell[CellGroupData[{
Cell[199292, 4764, 172, 3, 84, "Section",ExpressionUUID->"4fc1db56-03ee-46e3-b8fa-bf546a73f757"],
Cell[199467, 4769, 211, 4, 37, "Input",ExpressionUUID->"64c1bb36-84e9-41c7-962a-588dfa935683"],
Cell[199681, 4775, 1702, 48, 162, "Code",ExpressionUUID->"0a23268f-a11c-439d-a0e2-59a24b67a0a2"],
Cell[201386, 4825, 508, 14, 90, "Code",ExpressionUUID->"0b0e8d19-9312-4197-9836-619b59ac8dc8"],
Cell[201897, 4841, 784, 20, 138, "Code",ExpressionUUID->"26fc0ac2-e7a8-4c94-a4bd-abc4d2e33646"],
Cell[202684, 4863, 2681, 73, 426, "Code",ExpressionUUID->"1c06dd49-3956-4c69-9d3d-46b071ea723a"],
Cell[205368, 4938, 11258, 239, 570, "Code",ExpressionUUID->"a732ee15-b599-4761-a230-33dd80415b6f"]
}, Open  ]]
}
]
*)

